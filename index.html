<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta name="description" content="血盟管理ツール"/>
		<meta name="robots" content="noindex"/>
		<meta id="ogimage" property="og:image" content="https://saimushi.github.io/rinerebotools/images/ogimage.png" />
		<title>L2R Tool</title>
		<link rel="icon" href="./favicon.ico">
		<link rel="mask-icon" href="./favicon.svg" sizes="any" color="black">
		<!-- bootstrap -->
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/css-spinning-spinners/1.1.1/load8.css"/>
		<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" />
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
		<!-- this app -->
		<style>
			html, body {
				height: 100%;
			}
			input, select, textarea {
				font-size: 16px !important;
			}
			table {
			  table-layout: fixed;
			}
			tr.activity-1 {
				background-color: rgb(183, 227, 255) !important;
			}
			.table-striped>tbody>tr {
				background-color: #f6f6f6;
			}
			.table-striped>tbody>tr:nth-of-type(odd) {
				background-color: #ffffff;
			}
			.table-hover>tbody>tr:hover {
				background-color: #2dabc1;
			}
			navigationbar .container {
				width: 100%;
			}
			.orverlay {
				display: none;
				position: fixed;
				height: 100%;
				width: 100%;
				z-index: 9999;
				background-color: rgba(0, 0, 0, 0.4);
			}
			.row {
				margin-left: 0;
				margin-right: 0;
			}
			route>.riotcontes>div:first-child {
				min-height: calc(100% - 300px);
			}
			route>party.riotcontes>div:first-child {
				min-height: calc(100% - 250px);
			}
			div.row {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-8 {
				padding-left: 0;
				padding-right: 0;
			}
			dashboard div.row div.col-xs-8 {
				padding-top: 50px;
			}
			div.row div.col-sm-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-sm-8 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div div.container-fluid {
				padding: 0;
			}
			.btn-group {
				width: 100%;
			}
			.btn-group .form-control {
				padding-right: 20px;
			}
			.clearbtn {
				position: absolute;
				right: 5px;
				top: 0;
				bottom: 0;
				height: 14px;
				margin: auto;
				font-size: 14px;
				cursor: pointer;
				color: #ccc;
			}
			th, tr {
				font-size: 10px;
			}
			#loader {
				z-index: 99999;
			}
			.footer {
				width: 100%;
				height: 180px;
			  background-color: lightgray;
			}
			.footer div {
				padding: 0;
				background-color: lightgray;
			}
		</style>
	</head>

	<body>
		<div id="loader" class="orverlay loading"></div>
		<div id="popup" class="orverlay"></div>
		<app class="container">
			<navigationbar></navigationbar>
			<router class="row">
				<route path="/">
					<top class="riotcontes"/>
				</route>
				<route path="dashboard">
					<dashboard class="riotcontes"/>
				</route>
				<route path="setting">
					<addclan class="riotcontes"/>
				</route>
				<route path="login">
					<login/>
				</route>
				<route path="addclan">
					<addclan class="riotcontes"/>
				</route>
				<route path="adduser">
					<adduser class="riotcontes"/>
				</route>
				<route path="addschedule">
					<addschedule class="riotcontes"/>
				</route>
				<route path="addnews">
					<addnews class="riotcontes"/>
				</route>
				<route path="modifyuser">
					<adduser class="riotcontes"/>
				</route>
				<route path="detailschedule">
					<detailschedule class="riotcontes"/>
				</route>
				<route path="party">
					<party class="riotcontes"/>
				</route>
				<route path="inquiry">
					<inquiry class="riotcontes"/>
				</route>
			</router>
		</app>
		<footer class="footer">
			<p class="text-muted" style="margin: 5px; color: white;">広告から外部サイトに出られます！</p>
			<div  class="row">
				<!-- rakuten -->
				<div class="col-sm-1">
					&nbsp;
				</div>
				<div class="col-sm-3">
					<table cellpadding="0" cellspacing="0" border="0" style="background-color: white; border:1px solid #ccc; width:350px;"><tr style="border-style:none;"><td style="vertical-align:top; border-style:none; padding:10px; width:75px;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow"><img border="0" alt="" src="http://thumbnail.image.rakuten.co.jp/@0_mall/kaen-web/cabinet/itunes10000.jpg?_ex=64x64" /></a></td><td style="font-size:12px; vertical-align:middle; border-style:none; padding:10px;"><p style="padding:0; margin:0;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow">APPLE アップル iTunesCard　アイチューンズカード10000円</a></p><p style="color:#666; margin-top:5px line-height:1.5;">価格:<span style="font-size:14px; color:#C00; font-weight:bold;">9,922円</span><br/><span style="font-size:10px; font-weight:normal;">(2018/8/6 13:08時点)</span><br/><span style="font-weight:bold;">感想(0件)</span></p></td></tr></table>
					<img border="0" width="1" height="1" src="https://www18.a8.net/0.gif?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT" alt="">
				</div>
				<!-- ドコモオンラインモール -->
				<div class="col-sm-3">
					<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" target="_blank" rel="nofollow">
						<img border="0" width="350" alt="" src="https://www29.a8.net/svt/bgt?aid=180806241950&wid=001&eno=01&mid=s00000014967001010000&mc=1">
					</a>
					<img border="0" width="1" height="1" src="https://www15.a8.net/0.gif?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" alt="">
				</div>
				<!-- お名前.com -->
				<div class="col-sm-3">
					<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" target="_blank" rel="nofollow">
						<img border="0" width="140" height="140" alt="" src="https://www26.a8.net/svt/bgt?aid=180806241949&wid=001&eno=01&mid=s00000000018015054000&mc=1">
					</a>
					<img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" alt="">
				</div>
			</div>
		</footer>

		<!-- Riot tags -->
		<section id="riot-tags">

			<script type="riot/tag">
				<navigationbar>
					<div if={'#party' != location.hash} class="navbar navbar-inverse navbar-fixed-top" role="navigation">
						<div class="container">
							<div class="navbar-header">
								<!-- sp用 -->
								<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
									<span class="sr-only">Toggle navigation</span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a class="navbar-brand" href="#" style="padding: 0;"><img src="./images/titlelogo.png" border="0" height="50" alt="L2R Tool"/></a>
							</div>
							<div class="collapse navbar-collapse">
								<ul class="nav navbar-nav">
									<li if={'#login' != location.hash}><a href="#dashboard">血盟ページ</a></li>
									<li if={'#login' != location.hash}><a href="{clan.url}">血盟コミュ</a></li>
									<li if={'#login' != location.hash && 'on'!=getParams['view']}><a href="#setting">設定</a></li>
									<li if={'#login' != location.hash && 'on'!=getParams['view']}><a href="./">ログアウト</a></li>
									<li><a href="#inquiry">お問い合わせ</a></li>
								</ul>
							</div>
						</div>
					</div>
				</navigationbar>
			</script>

			<script type="riot/tag">
				<top>
					this.on('mount', function() {
						// 認証
						auth();
					});
				</top>
			</script>

			<script type="riot/tag">
				<dashboard>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid" style="padding: 10px;">
								<h2 style="margin-top: 10px;"><a href="{clanurl}">{clanname}</a></h2>
								<h4>血盟員数: {usercnt}</h4>
								<small><b style="font-size: x-small;">{url}</b><br/><small style="color: red; font-size: xx-small;">※この血盟のURLです。忘れずメモして下さい！</small></small>
								<div if={'on'!=getParams['view']} class="row" style="padding-top: 10px;">
									<a class="btn btn-success" href="#addschedule" style="margin-bottom: 10px;">予定追加</a>
									<a class="btn btn-info" href="#adduser" style="margin-bottom: 10px;">血盟員追加</a>
									<a class="btn btn-warning" href="#addnews" style="margin-bottom: 10px;">お知らせ管理</a>
								</div>
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr class="info">
											<th>予定日</th>
											<th>予定内容</th>
											<th>参加人数</th>
										</tr>
									</thead>
									<tbody>
										<tr each="{schedule, index in schedules}">
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.date}</td>
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.name}</td>
											<td><a href="?clanid={clan.ID}&scheduleid={schedule.ID}{viewON}#party">{schedule.incount}</a></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<users data='{users}'/>
							</div>
						</div>
					</div>
					var url = location.protocol + '//' + document.domain + location.pathname;
					var clanname = '';
					var clanurl = 'javascript: void(0); return false;';
					var usercnt = 0;
					var users = [];
					var schedules = [];
					var cpSort = false;
					var viewON = '';
					this.on('mount', function() {
						if ('on' == getParams['view']) {
							this.viewON = '&view=on';
						}
						// 認証
						auth(false, function (clan) {
							if ('undefined' != typeof clan.name) {
								this.url = url + '?clanid=' + clan.ID;
								this.clanname = clan.name;
								this.clanurl = clan.url;
								getUsers(clan.ID, false, function(users) {
									this.users = users;
									this.usercnt = usercnt;
									for (var uidx=0; uidx < users.length; uidx++) {
										if (users[uidx].activity > -1) {
											this.usercnt++;
										}
									}
									riot.update();
									getSchedules(clan.ID, function(schedules) {
										this.schedules = schedules;
										riot.update();
									});
								});
							}
						});
						dispatchPortlateLayout();
					});
				</dashboard>
			</script>

			<script type="riot/tag">
				<login>
					<div class="row" style="padding-top: 45px">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div class="col-sm-6" style="height: 200px; padding-top: 50px; text-align: center; background-image: url('./images/logo.png'); background-repeat: no-repeat; background-size: contain; background-position: center bottom;">
							<h2>&nbsp;&nbsp;&nbsp;血盟管理を<b style="font-size: 120%;">も</b><b>っと</b>簡単に。</h2>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-2 bg-primary" style="margin-top: 50px; padding: 30px;">
							<h4>血盟ログイン</h4>
							<form id="loginform">
								<div class="form-group">
									<div class="btn-group">
										<input type="text" name="clanID" class="form-control" placeholder="血盟ID"/>
										<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
									</div>
								</div>
								<botton class="btn btn-success" onclick="onclickLogin(this)">ログイン</botton>
								&nbsp;&nbsp;&nbsp;<botton class="btn btn-info" onclick="onclickAddClan(this)">血盟登録</botton>
							</form>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div class="row">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div class="col-sm-6" style="padding-top: 30px; text-align: center;">
							<h4 style="margin: 0;">&nbsp;&nbsp;&nbsp;<small>血盟員管理／血盟イベントスケジュール／お知らせ通知／パーティ編成</small></h4>
							<h3 style="margin-top: 5px; margin-bottom: 20px;">&nbsp;&nbsp;&nbsp;<small><b>必要な全ての機能を備えています。</b></small></h3>
						</div>
						<div class="col-sm-4">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div class="row">
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-2">
							<img width="240" src="./images/sample001.png"/>
						</div>
						<div class="col-sm-2">
							<img width="240" src="./images/sample002.png"/>
						</div>
						<div class="col-sm-2">
							<img width="240" src="./images/sample003.png"/>
						</div>
						<div class="col-sm-2">
							<img width="240" src="./images/sample004.png"/>
						</div>
						<div class="col-sm-3">
							&nbsp;
						</div>
					</div>
					this.on('mount', function() {
						auth();
					});
				</login>
			</script>

			<script type="riot/tag">
				<addclan>
					<div style="padding: 10px;">
						<form id="registerClanform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="clan" value="{clan.name}" class="form-control" placeholder="血盟名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="url" value="{clan.url}" class="form-control" placeholder="血盟コミュニティURL"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={'#setting' == location.hash} class="form-group">
								<div class="btn-group">
									<input type="text" name="discordhookid" value="{clan.discordhookid}" class="form-control" placeholder="Discord Webhook ID"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={'#setting' == location.hash} class="form-group">
								<div class="btn-group">
									<input type="text" name="discordhooktoken" value="{clan.discordhooktoken}" class="form-control" placeholder="Discord Webhook Token"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<botton class="btn btn-success" onclick="onclickRegisterClan(this)">登録</botton>
						</form>
					</div>
					var clan = { ID: '', name: '', discordhookid: '', discordhooktoken: '', };
					this.on('mount', function() {
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							auth(false, function (clan) {
								// modifyモード
								this.clan = clan;
								riot.update();
							});
						}
					});
				</addclan>
			</script>

			<script type="riot/tag">
				<adduser>
					<div style="padding: 10px;">
						<h2>血盟員追加</h2>
						<form id="registerform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="username" value="{user.name}" class="form-control" placeholder="キャラクター名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<select class="form-control" name="userjob">
									<option>職業</option>
									<optgroup label="ヒューマン">
										<option if={user.job=='パラディン'} value="パラディン" selected="selected">パラディン</option>
										<option if={user.job=='ウォーロード'} value="ウォーロード" selected="selected">ウォーロード</option>
										<option if={user.job=='トレジャーハンター'} value="トレジャーハンター" selected="selected">トレジャーハンター</option>
										<option if={user.job=='ホークアイ'} value="ホークアイ" selected="selected">ホークアイ</option>
										<option if={user.job=='ソーサラー'} value="ソーサラー" selected="selected">ソーサラー</option>
										<option if={user.job=='ビショップ'} value="ビショップ" selected="selected">ビショップ</option>
										<option if={user.job!='パラディン'} value="パラディン">パラディン</option>
										<option if={user.job!='ウォーロード'} value="ウォーロード">ウォーロード</option>
										<option if={user.job!='トレジャーハンター'} value="トレジャーハンター">トレジャーハンター</option>
										<option if={user.job!='ホークアイ'} value="ホークアイ">ホークアイ</option>
										<option if={user.job!='ソーサラー'} value="ソーサラー">ソーサラー</option>
										<option if={user.job!='ビショップ'} value="ビショップ">ビショップ</option>
									</optgroup>
									<optgroup label="エルフ">
										<option if={user.job=='テンプルナイト'} value="テンプルナイト" selected="selected">テンプルナイト	</option>
										<option if={user.job=='ソードシンガー'} value="ソードシンガー" selected="selected">ソードシンガー	</option>
										<option if={user.job=='プレインズウォーカー'} value="プレインズウォーカー" selected="selected">プレインズウォーカー</option>
										<option if={user.job=='シルバーレンジャー'} value="シルバーレンジャー" selected="selected">シルバーレンジャー</option>
										<option if={user.job=='スペルシンガー'} value="スペルシンガー" selected="selected">スペルシンガー</option>
										<option if={user.job=='エルダー'} value="エルダー" selected="selected">エルダー</option>
										<option if={user.job!='テンプルナイト'} value="テンプルナイト">テンプルナイト	</option>
										<option if={user.job!='ソードシンガー'} value="ソードシンガー">ソードシンガー	</option>
										<option if={user.job!='プレインズウォーカー'} value="プレインズウォーカー">プレインズウォーカー</option>
										<option if={user.job!='シルバーレンジャー'} value="シルバーレンジャー">シルバーレンジャー</option>
										<option if={user.job!='スペルシンガー'} value="スペルシンガー">スペルシンガー</option>
										<option if={user.job!='エルダー'} value="エルダー">エルダー</option>
									</optgroup>
									<optgroup label="ダークエルフ">
										<option if={user.job=='シリエンナイト'} value="シリエンナイト" selected="selected">シリエンナイト</option>
										<option if={user.job=='ブレードダンサー'} value="ブレードダンサー" selected="selected">ブレードダンサー</option>
										<option if={user.job=='アビスウォーカー'} value="アビスウォーカー" selected="selected">アビスウォーカー</option>
										<option if={user.job=='ファントムレンジャー'} value="ファントムレンジャー" selected="selected">ファントムレンジャー</option>
										<option if={user.job=='スペルハウラー'} value="スペルハウラー" selected="selected">スペルハウラー</option>
										<option if={user.job=='シリエンエルダー'} value="シリエンエルダー" selected="selected">シリエンエルダー</option>
										<option if={user.job!='シリエンナイト'} value="シリエンナイト">シリエンナイト</option>
										<option if={user.job!='ブレードダンサー'} value="ブレードダンサー">ブレードダンサー</option>
										<option if={user.job!='アビスウォーカー'} value="アビスウォーカー">アビスウォーカー</option>
										<option if={user.job!='ファントムレンジャー'} value="ファントムレンジャー">ファントムレンジャー</option>
										<option if={user.job!='スペルハウラー'} value="スペルハウラー">スペルハウラー</option>
										<option if={user.job!='シリエンエルダー'} value="シリエンエルダー">シリエンエルダー</option>
									</optgroup>
									<optgroup label="ドワーフ">
										<option if={user.job=='ガーディアン'} value="ガーディアン" selected="selected">ガーディアン</option>
										<option if={user.job=='スレイヤー'} value="スレイヤー" selected="selected">スレイヤー</option>
										<option if={user.job=='スカベンジャー'} value="スカベンジャー" selected="selected">スカベンジャー</option>
										<option if={user.job=='ウォーレンジャー'} value="ウォーレンジャー" selected="selected">ウォーレンジャー</option>
										<option if={user.job=='クォーラルウィザード'} value="クォーラルウィザード" selected="selected">クォーラルウィザード</option>
										<option if={user.job=='セイジ'} value="セイジ" selected="selected">セイジ</option>
										<option if={user.job!='ガーディアン'} value="ガーディアン">ガーディアン</option>
										<option if={user.job!='スレイヤー'} value="スレイヤー">スレイヤー</option>
										<option if={user.job!='スカベンジャー'} value="スカベンジャー">スカベンジャー</option>
										<option if={user.job!='ウォーレンジャー'} value="ウォーレンジャー">ウォーレンジャー</option>
										<option if={user.job!='クォーラルウィザード'} value="クォーラルウィザード">クォーラルウィザード</option>
										<option if={user.job!='セイジ'} value="セイジ">セイジ</option>
									</optgroup>
								</select>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{4,8}" name="usercp" value="{user.cp}" class="form-control" placeholder="戦闘力"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{2,3}" name="userlevel" value="{user.level}" class="form-control" placeholder="レベル"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="discord" value="{user.discord}" class="form-control" placeholder="でぃすこ#4321"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="memo" value="{user.memo}" class="form-control" placeholder="なんでもメモ"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<select class="form-control" name="usermeteo">
									<option>メテオ</option>
									<option if={user.meteo==10} selected="selected">10</option>
									<option if={user.meteo==9} selected="selected">9</option>
									<option if={user.meteo==8} selected="selected">8</option>
									<option if={user.meteo==7} selected="selected">7</option>
									<option if={user.meteo==6} selected="selected">6</option>
									<option if={user.meteo==5} selected="selected">5</option>
									<option if={user.meteo==4} selected="selected">4</option>
									<option if={user.meteo==3} selected="selected">3</option>
									<option if={user.meteo==2} selected="selected">2</option>
									<option if={user.meteo==1} selected="selected">1</option>
									<option if={user.meteo!=10}>10</option>
									<option if={user.meteo!=9}>9</option>
									<option if={user.meteo!=8}>8</option>
									<option if={user.meteo!=7}>7</option>
									<option if={user.meteo!=6}>6</option>
									<option if={user.meteo!=5}>5</option>
									<option if={user.meteo!=4}>4</option>
									<option if={user.meteo!=3}>3</option>
									<option if={user.meteo!=2}>2</option>
									<option if={user.meteo!=1}>1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="useractivity">
									<option>区分</option>
									<option if={user.activity==1} value="1" selected="selected">アクティブ</option>
									<option if={user.activity==0} value="0" selected="selected">インアクティブ</option>
									<option if={user.activity==-9} value="-9" selected="selected">除名</option>
									<option if={user.activity==-1} value="-1" selected="selected">傭兵</option>
									<option if={user.activity!=1} value="1">アクティブ</option>
									<option if={user.activity!=0} value="0">インアクティブ</option>
									<option if={user.activity!=-9} value="-9">除名</option>
									<option if={user.activity!=-1} value="-1">傭兵</option>
								</select>
							</div>
							<div class="form-group bg-info">
								<h5>入団日(選択して下さい)</h5>
								<div class='input-group date' id='joinddate'/>
							</div>
							<botton class="btn btn-success" onclick="onclickRegister(this, '{user.ID}')">登録</botton>
							<botton if={user.ID!='' && 'on'!= getParams['view']} class="btn btn-danger" onclick="onclickUnregister(this, '{user.ID}')">削除</botton>
						</form>
					</div>
					var user = { ID: '', name: '', job: '', cp: '', level: '', meteo: 0, memo: '', activity: 9, joind: '',};
					this.on('mount', function() {
						//$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00",});
						auth(false, function (clan) {
							if ('#modifyuser' == location.hash && 'undefined' != typeof getParams['userid'] && 0 < getParams['userid'].length) {
								// modifyモード
								getUser(getParams['userid'], function(user) {
									console.log(user);
									this.user = user;
									$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00", defaultDate: user.joind, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.user = user;
								$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00"});
								riot.update();
							}
						});
					});
				</adduser>
			</script>

			<script type="riot/tag">
				<addschedule>
					<div style="padding: 10px;">
						<h4 if={'on'==getParams['view']}>{schedule.date}<h4/>
						<h4 if={'on'==getParams['view']}>{schedule.name}<h4/>
						<h4 if={'#detailschedule' == location.hash}>参加予定: {schedule.incount} 人<h4/>
						<form id="addscheduleform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="schedulename" value="{schedule.name}" class="form-control" placeholder="予定内容"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="scheduletag" value="{schedule.tag}" class="form-control" placeholder="#要塞戦"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group bg-info">
								<h5>予定日時(選択して下さい)</h5>
								<div class='input-group date' id='scheduledate'/>
							</div>
							<input type="hidden" name="scheduleincount" value="{schedule.incount}" id='scheduleincount'/>
							<botton class="btn btn-success" onclick="onclickRegisterSchedule(this, '{schedule.ID}')">登録</botton>
							<botton if={'#detailschedule' != location.hash} class="btn btn-danger" onclick="onclickRegisterSchedule(this, '{schedule.ID}', true)">登録(同一タグの前回のPT編成をコピー)</botton>
						</form>
					</div>
					var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, };
					this.on('mount', function() {
						if ('on'==getParams['view']) {
							$('#addscheduleform').hide();
						}
						auth(false, function (clan) {
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								// modifyモード
								getSchedule(getParams['scheduleid'], function(schedule) {
									console.log(schedule);
									this.schedule = schedule;
									$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, defaultDate: schedule.date, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.schedule = schedule;
								$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, });
								riot.update();
							}
						});
					});
				</addschedule>
			</script>

			<script type="riot/tag">
				<party>
					<div style="margin-top: -55px;">
						<h5 style="margin-top: 0; margin-bottom: 5px; padding-left: 5px;"><a href="{scheduleURL}">PT編成 {partySchedule.date} {partySchedule.name} 参加予定:{partySchedule.incount}人</a>&nbsp;&nbsp;&nbsp;<a href="{clan.url}">[ 血盟コミュに戻る ]</a></h5>
						<div class="row">
							<table class="table">
								<tr each="{party, index in parties}">
									<td if={'undefined' != typeof pusers} each="{pusers, pindex in party}" style="padding: 0;">

												<table class="table table-striped"style="overflow: hidden; margin-bottom: 5px;">
													<tr if={pusers[0].party==39} style="background-color: dodgerblue; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">聖刻</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==38} style="background-color: blue; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">偵察</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==37} style="background-color: navy; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">封殺</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==29} style="background-color: limegreen; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">FW1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==28} style="border: none; background-color: green; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">FW2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==27} style="border: none; background-color: darkgreen; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">FW3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==19} style="border: none; background-color: gold; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">MF1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==18} style="border: none; background-color: orange; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">MF2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==17} style="border: none; background-color: darkorange; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">MF3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==9} style="border: none; background-color: red; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">DF1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==8} style="border: none; background-color: crimson; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">DF2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==7} style="border: none; background-color: firebrick; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">DF3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==0} style="border: none; background-color: gray; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">欠席</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr each="{puser, uindex in pusers}" style="border: none;" class="activity{puser.activity}">
														<td style="border: none; padding: 5px; border-left: 1px solid gray; height: 26px;">{puser.name}</td>
														<td style="overflow: hidden; border: none; padding: 5px; border-left: 1px solid gray;">{puser.cp}</td>
														<td if={jobbufs[puser.job]=='攻撃'} style="border: none; padding: 5px; background-color: firebrick;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={jobbufs[puser.job]=='クリ'} style="border: none; padding: 5px; background-color: orange;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={jobbufs[puser.job]=='防御'} style="border: none; padding: 5px; background-color: blue;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={jobbufs[puser.job]=='移動'} style="border: none; padding: 5px; background-color: green;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={jobbufs[puser.job]=='命中'} style="border: none; padding: 5px; background-color: dodgerblue;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={jobbufs[puser.job]=='HP'} style="border: none; padding: 5px; background-color: deeppink;"><img src="{jobimages[puser.job]}" alt="{puser.job}" width="15"/></td>
														<td if={'undefined' == typeof jobbufs[puser.job]} style="border: none; padding: 5px; background-color: gray;">&nbsp;</td>
													</tr>
												</table>

									</td>
								</tr>
							</table>

						</div>
					</div>
					var scheduleURL = '';
					var partySchedule = {name:'', date: '', incount: 0, };
					var parties = [];
					this.on('mount', function() {
						var viewGrid = function (schedule, data) {
							this.scheduleURL = '?clanid=' + clan.ID + '&scheduleid=' + schedule.ID + '#detailschedule';
							if ('on' == getParams['view']) {
									this.scheduleURL = this.scheduleURL.replace('#detailschedule', '&view=on#detailschedule')
							}
							this.partySchedule = schedule;
							this.parties = parties;
							var rowCnt = 0;
							var partyCnt = 0;
							var beforeParty = -1;
							this.parties[rowCnt] = [];
							for (var pidx=0; pidx < data.length; pidx++) {
								if (beforeParty != data[pidx].party) {
									if (0 < partyCnt && 5 > this.parties[rowCnt][partyCnt-1].length) {
										var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
										for (var mpidx=0; mpidx < paddingLen; mpidx++) {
											var emptyUser = {name: '　', cp: '　',};
											this.parties[rowCnt][partyCnt-1].push(emptyUser);
										}
									}
									partyCnt++;
									if (0 < partyCnt && 0 == (partyCnt-1)%5) {
										rowCnt++;
									}
									if ('undefined' == typeof this.parties[rowCnt]) {
										this.parties[rowCnt] = [];
									}
									if ('undefined' == typeof this.parties[rowCnt][partyCnt-1]) {
										this.parties[rowCnt][partyCnt-1] = [];
									}
								}
								this.parties[rowCnt][partyCnt-1].push(data[pidx]);
								beforeParty = data[pidx].party;
							}
							if (0 < partyCnt && 5 > this.parties[rowCnt][partyCnt-1].length) {
								var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
								for (var mpidx=0; mpidx < paddingLen; mpidx++) {
									var emptyUser = {name: '　', cp: '　',};
									this.parties[rowCnt][partyCnt-1].push(emptyUser);
								}
							}
							console.log(this.parties);
							riot.update();
						};
						if (partyUsers != null && 'undefined' != typeof partyUsers.length) {
							partyUsers.sort(function(a, b){
								if( a.cp > b.cp ) return -1;
								if( a.cp < b.cp ) return 1;
								return 0;
							});
							partyUsers.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
							viewGrid(schedule, partyUsers);
						}
						else {
							auth(false, function (clan) {
								// APIからデータを撮ってくる
								getSchedule(getParams['scheduleid'], function(schedule) {
									getScheduleUsers(getParams['scheduleid'], null, function(entryOKUsers) {
										viewGrid(schedule, entryOKUsers);
									});
								});
							});
						}
					});
				</party>
			</script>

			<script type="riot/tag">
				<detailschedule>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>参加登録</h3>
									<form id="entryscheduleform">
										<div class="form-group">
											<select class="form-control" name="scheduleuser">
												<option value="-1">参加キャラ</option>
												<option each="{user, index in selectusers}" value={index} data={user.name}>{user.outlabel}{user.name}</option>
											</select>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="schedulecomment" class="form-control" placeholder="コメント(任意 希望配置とかあれば)"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<input type="hidden" name="scheduleparty" class="form-control" value="0"/>
											<div class="btn-group">
												<botton class="btn btn-success" onclick="{onEntryOK}">◯</botton>
												<botton class="btn btn-warning" onclick="{onEntryMaybe}">△</botton>
												<botton class="btn btn-danger" onclick="{onEntryNG}">✕</botton>
											</div>
										</div>
										<div if={'on'!=getParams['view']}>
											<h4 >PT設定</h4>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="39">聖刻</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="38">偵察</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="37">封殺</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="29">FW1</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="28">FW2</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="27">FW3</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="19">MF1</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="18">MF2</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="17">MF3</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="9">DF1</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="8">DF2</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="7">DF3</botton>
												</div>
											</div>
										</div>
									</form>
								</div>
								<h3 style="margin-left: 10px; margin-bottom: -10px;">予定詳細</h3>
								<addschedule/>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<h3 style="padding-left: 10px;">参加者一覧 <small><a href="javascript: void(0);" onclick="{showPT}">[PT表]</a><small></h3>
								<users data='{scheduleusers}' mode='schedule'/>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>未表明者一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th style="width:100px;">未表明キャラ</th>
												<th style="width:200px;">discordタグ</th>
												<th>メモ</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{outuser, index in outusers}" >
												<td class="action"><botton class="btn btn-danger" onclick="onclickNotify(this, '{outuser.name}', '{outuser.discord}');">催促</botton></td>
												<td onclick="onclickModify(this, '{outuser.ID}');"><strong class="scheduleusername">{outuser.name}</strong></td>
												<td onclick="onclickModify(this, '{outuser.ID}');"><strong class="danger">{outuser.discord}</strong></td>
												<td onclick="onclickModify(this, '{outuser.ID}');">{outuser.memo}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>同一タグお知らせ一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action"><botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton></td>
												<td class="newstext" style="width: 34px; font-size: 5px;"><pre>{news.text}</pre></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					var selectusers = [];
					var scheduleusers = [];
					var outusers = [];
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getUsers(clan.ID, true, function(users) {
								thisis.selectusers = users;
								getScheduleUsers(getParams['scheduleid'], null, function(scheduleusers) {
									var inuser = [];
									var outuser = [];
									thisis.outusers = [];
									thisis.scheduleusers = scheduleusers;
									console.log(thisis.scheduleusers);
									for (var uidx=0; uidx < thisis.selectusers.length; uidx++) {
										var entryed = false;
										thisis.selectusers[uidx].outlabel = '未表明:';
										for (var suidx=0; suidx < thisis.scheduleusers.length; suidx++) {
											if (thisis.selectusers[uidx].name == thisis.scheduleusers[suidx].name){
												thisis.selectusers[uidx].outlabel = '';
												thisis.selectusers[uidx].entry = thisis.scheduleusers[suidx].entry;
												thisis.selectusers[uidx].party = thisis.scheduleusers[suidx].party;
												inuser.push(thisis.selectusers[uidx]);
												entryed = true;
											}
										}
										if (thisis.selectusers[uidx].activity < 0) {
											thisis.selectusers[uidx].outlabel = '';
											inuser.push(thisis.selectusers[uidx]);
											entryed = true;
										}
										if (false === entryed) {
											outuser.push(thisis.selectusers[uidx]);
										}
									}
									if (0 < outuser.length) {
										thisis.outusers = outuser;
										thisis.selectusers = outuser.concat(inuser);
									}
									$('#addscheduleform input[name=scheduletag]').ready(function (){
										var tag = $('#addscheduleform input[name=scheduletag]').val();
										if ('undefined' != typeof tag && 0 < tag.length) {
											getNews(clan.ID, tag, function (newses) {
												thisis.newses = newses;
												riot.update();
											});
										}
										else {
											riot.update();
										}
									});
								});
							});
						});
						dispatchPortlateLayout();
					});
					showPT = function () {
						partyUsers = thisis.scheduleusers;
						var newhref = '?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#party';
						if ('on' == getParams['view']) {
								newhref = newhref.replace('#party', '&view=on#party')
						}
						location.href = newhref;
					};
					onEntryOK = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers[index];
						scheduleuser.entry = 1;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length) {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryMaybe = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers[index];
						scheduleuser.entry = 0;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length) {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryNG = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers[index];
						scheduleuser.entry = -1;
						scheduleuser.party = 0;
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length) {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryPT = function (target) {
						var partyData = $(target.srcElement).data();
						if ('undefined' != typeof partyData && 'undefined' != typeof partyData.party && 0 < parseInt(partyData.party)){
							var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
							if (0 > parseInt(index)) {
								alert('参加キャラを選択して下さい。');
								return;
							}
							var scheduleuser = thisis.selectusers[index];
							if ('undefined' == typeof scheduleuser.entry) {
								alert('出欠登録を先にする必要があります。');
								return;
							}
							if (0 > parseInt(scheduleuser.entry)) {
								alert('欠席予定の方をPTに入れる事は出来ません。');
								return;
							}
							scheduleuser.comment = '';
							var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
							if (0 < comment.length) {
								scheduleuser.comment = comment;
							}
							var bufDuplicated = false;
							var jobDuplicated = false;
							var entryCnt = 0;
							for (var eIdx=0; eIdx < thisis.scheduleusers.length; eIdx++) {
								if ('undefined' != typeof thisis.scheduleusers[eIdx].party && partyData.party == thisis.scheduleusers[eIdx].party) {
									entryCnt++;
									if (scheduleuser.job == thisis.scheduleusers[eIdx].job) {
										jobDuplicated = true;
										bufDuplicated = false;
									}
									if (false == jobDuplicated && 'undefined' != jobbufs[scheduleuser.job] && 'undefined' != typeof jobbufs[thisis.scheduleusers[eIdx].job] && jobbufs[scheduleuser.job] == jobbufs[thisis.scheduleusers[eIdx].job]) {
										bufDuplicated = true;
									}
									if (5 <= entryCnt) {
										alert('このPTは既に5人編成済みです。');
										return;
										break;
									}
								}
							}
							if (jobDuplicated) {
								if (!confirm('同じ職種のキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							if (bufDuplicated) {
								if (!confirm('同種PTバフのキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							scheduleuser.party = partyData.party;
							registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
								getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
									$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
										onclickRegisterSchedule(null, getParams['scheduleid']);
									});
								});
							});
						}
					};
				</detailschedule>
			</script>

			<script type="riot/tag">
				<addnews>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ登録</h3>
									<form id="editnewsform">
										<div class="form-group">
											<textarea class="form-control" name="newstext" placeholder="【周知】木曜22時はギロフェスです！" rows="3">{news.text}</textarea>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newstag" class="form-control" placeholder="#要塞戦"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newsid" class="form-control" placeholder="任意:空欄は新規登録"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<botton class="btn btn-success" onclick="onclickRegisterNews(this)">登録</botton>
									</form>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ一覧</h3>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
												<th style="width:60px;">タグ</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');" style="margin-top: 10px;">修正</botton>
												</td>
												<td class="newstext"><pre>{news.text}</pre></td>
												<td class="newstag">{news.tag}</td>
											</tr>
										</tbody>
									</table>
							</div>
						</div>
					</div>
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getNews(clan.ID, null, function(newses) {
								thisis.newses = newses;
								riot.update();
							});
						});
						dispatchPortlateLayout();
					});
				</addnews>
			</script>

			<script type="riot/tag">
				<users>
					<div style="padding-left: 10px; padding-right: 10px;">
						<table class="table table-bordered table-hover table-striped">
							<thead>
								<tr class="info">
									<th if={opts.mode=='schedule'} style="width: 28px; font-size: 5px;"></th>
									<th if={opts.mode=='schedule'} onclick="{sortPT}" style="width: 40px;">PT</th>
									<th style="width: 100px;">キャラ</th>
									<th onclick="{sortCP}" style="width: 50px;">戦闘力</th>
									<th onclick="{sortJob}" style="width: 30px; font-size: 5px;">Job</th>
									<th onclick="{sortLevel}" style="width: 34px; font-size: 5px;">Lv</th>
									<th style="width: 28px; font-size: 5px;">メ</th>
									<th if={opts.mode!='schedule'}>メモ</th>
									<th if={opts.mode=='schedule'}>コメント</th>
									<th style="width: 40px;">区分</th>
									<th if={opts.mode!='schedule'} onclick="{sortJoind}" style="width: 70px;">入隊日</th>
								</tr>
							</thead>
							<tbody>
								<tr each="{user, index in opts.data}" class="activity{user.activity}">
									<td if={opts.mode=='schedule' && user.entry==1} onclick="onclickModify(this, '{user.ID}');" class="success">◯</td>
									<td if={opts.mode=='schedule' && user.entry==0} onclick="onclickModify(this, '{user.ID}');" class="warning">△</td>
									<td if={opts.mode=='schedule' && user.entry==-1} onclick="onclickModify(this, '{user.ID}');" class="danger">✕</td>
									<td if={opts.mode=='schedule' && user.party==39} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="39" style="background-color: dodgerblue; color: white; font-size: 8px;">聖刻</td>
									<td if={opts.mode=='schedule' && user.party==38} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="38" style="background-color: blue; color: white; font-size: 8px;">偵察</td>
									<td if={opts.mode=='schedule' && user.party==37} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="37" style="background-color: navy; color: white; font-size: 8px;">封殺</td>
									<td if={opts.mode=='schedule' && user.party==29} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="29" style="background-color: limegreen; color: white; font-size: 8px;">FW1</td>
									<td if={opts.mode=='schedule' && user.party==28} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="28" style="background-color: green; color: white; font-size: 8px;">FW2</td>
									<td if={opts.mode=='schedule' && user.party==27} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="27" style="background-color: darkgreen; color: white; font-size: 8px;">FW3</td>
									<td if={opts.mode=='schedule' && user.party==19} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="19" style="background-color: gold; color: white; font-size: 8px;">MF1</td>
									<td if={opts.mode=='schedule' && user.party==18} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="18" style="background-color: orange; color: white; font-size: 8px;">MF2</td>
									<td if={opts.mode=='schedule' && user.party==17} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="17" style="background-color: darkorange; color: white; font-size: 8px;">MF3</td>
									<td if={opts.mode=='schedule' && user.party==9} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="9" style="background-color: red; color: white; font-size: 8px;">DF1</td>
									<td if={opts.mode=='schedule' && user.party==8} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="8" style="background-color: crimson; color: white; font-size: 8px;">DF2</td>
									<td if={opts.mode=='schedule' && user.party==7} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="7" style="background-color: firebrick; color: white; font-size: 8px;">DF3</td>
									<td if={opts.mode=='schedule' && user.party==0} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="0" style="background-color: gray; color: white; font-size: 8px;">無</td>
									<td if={opts.mode=='schedule' && user.party===''} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="0" style="background-color: black; color: white; font-size: 8px;">無</td>
									<td if={opts.mode=='schedule' && user.party==undefined} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="0" style="background-color: black; color: white; font-size: 8px;">無</td>
									<td onclick="onclickModify(this, '{user.ID}');" class="scheduleusername">{user.name}</td>
									<td>{user.cp}</td>

									<td if={jobbufs[user.job]=='攻撃'} onclick="onclickModify(this, '{user.ID}');" style="background-color: firebrick;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={jobbufs[user.job]=='クリ'} onclick="onclickModify(this, '{user.ID}');" style="background-color: orange;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={jobbufs[user.job]=='防御'} onclick="onclickModify(this, '{user.ID}');" style="background-color: blue;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={jobbufs[user.job]=='移動'} onclick="onclickModify(this, '{user.ID}');" style="background-color: green;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={jobbufs[user.job]=='命中'} onclick="onclickModify(this, '{user.ID}');" style="background-color: dodgerblue;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={jobbufs[user.job]=='HP'} onclick="onclickModify(this, '{user.ID}');" style="background-color: deeppink;"><img src="{jobimages[user.job]}" alt="{user.job}" width="15"/></td>
									<td if={'undefined' == typeof jobbufs[user.job]} onclick="onclickModify(this, '{user.ID}');" style="font-size: 5px;">{puser.job}</td>

									<td onclick="onclickModify(this, '{user.ID}');">{user.level}</td>
									<td if={user.meteo==10} onclick="onclickModify(this, '{user.ID}');">{user.meteo}</td>
									<td if={user.meteo!=10} onclick="onclickModify(this, '{user.ID}');" class="warning">{user.meteo}</td>
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');">{user.memo}</td>
									<td if={opts.mode=='schedule'} onclick="onclickModify(this, '{user.ID}');" class="schedulecomment">{user.comment}</td>
									<td if={user.activity==1} onclick="onclickModify(this, '{user.ID}');" class="success">アク</td>
									<td if={user.activity==0} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-size: 7px;">イン</td>
									<td if={user.activity==-9} onclick="onclickModify(this, '{user.ID}');" class="danger">除名</td>
									<td if={user.activity==-1} onclick="onclickModify(this, '{user.ID}');" class="info">傭兵</td>
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');">{user.joind}</td>
								</tr>
							</tbody>
						</table>
					</div>
					var thisis;
					this.on('mount', function() {
						thisis = this;
						thisis.users = opts.data;
					});
					var cpdesc = true;
					var leveldesc = true;
					var joinddesc = true;
					var jobdesc = true;
					var partydesc = true;
					sortCP = function () {
						if (cpdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.cp < b.cp ) return -1;
								if( a.cp > b.cp ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.cp > b.cp ) return -1;
								if( a.cp < b.cp ) return 1;
								return 0;
							});
						}
					};
					sortLevel = function () {
						if (leveldesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level < b.level ) return -1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level > b.level ) return -1;
								if( a.level < b.level ) return 1;
								return 0;
							});
						}
					};
					sortPT = function () {
						if (partydesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							opts.data.sort(function(a, b){
								if( a.party < b.party ) return -1;
								if( a.party > b.party ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							opts.data.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
						}
					};
					sortJob = function () {
						if (jobdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job < b.job ) return -1;
								if( a.job > b.job ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job > b.job ) return -1;
								if( a.job < b.job ) return 1;
								return 0;
							});
						}
					};
					sortJoind = function () {
						if (joinddesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return -1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return 1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return 1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return 1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return 1;
								return 0;
							});
						}
					};
				</users>
			</script>

			<script type="riot/tag">
				<inquiry>
					<div style="padding: 20px;">
						<h3>お問い合わせ</h3>
						<br/>
						<h4><a href="https://twitter.com/saimushi" target="_blank" class="text-success"><i class="fab fa-twitter"></i> saimushi</a></h4>
						<h4><a href="https://discord.gg/mKbGHCd" target="_blank" class="text-info"><i class="fab fa-discord"></i> L2R血盟管理ツール</a></h4>
						<br/>
						<h5>各種SNS上でお気軽にお問い合わせ下さい。</h5>
						<h5>ご要望もお待ちしています！m(_ _)m</5>
					</div>
				</inquiry>
			</script>

		</section>

		<section id="scripts">
			<!-- bootstrap -->
			<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
			<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

			<!-- Riot -->
			<script src="//cdn.jsdelivr.net/npm/riot@3.9/riot+compiler.min.js"></script>
			<!-- Riot tag base rooting -->
			<script src="//cdn.jsdelivr.net/npm/riot-route@3.1.3/dist/route+tag.min.js"></script>

			<!-- Firebase -->
			<script src="//www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>

			<!-- Discord -->
			<script src="//greasyfork.org/scripts/29088-discord-js-for-browser/code/Discordjs%20for%20Browser.js?version=208579"></script>

			<script>
				// Initialize Firebase
				var config = {
					apiKey: "AIzaSyDYyTbnnltwtf4qPOjn7i1d3PRVAQBclIE",
					authDomain: "rinerebo-210503.firebaseapp.com",
					databaseURL: "https://rinerebo-210503.firebaseio.com",
					projectId: "rinerebo-210503",
					storageBucket: "rinerebo-210503.appspot.com",
					messagingSenderId: "599651332341",
					timestampsInSnapshots: true,
				};
				firebase.initializeApp(config);
			</script>

			<!-- this app -->
			<script>
				var publicURL = 'saimushi.github.io/rinerebotools';
				var getParams = {};
				var loadingCount = 0;
				var clan = { ID: '', name: '', discordhookid: '', discordhooktoken: '', };
				var user = { ID: '', name: '', job: '', cp: '', level: '', meteo: 0, memo: '', activity: 9, joind: '', discord: ''};
				var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, };
				var partySchedule = {name:'', date: '', incount: 0, };
				var news = { ID: '', text: '', tag: '', };
				var partyUsers = null;

				var jobimages = [];
				jobimages['パラディン'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-2.png';
				jobimages['ウォーロード'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-3.png';
				jobimages['トレジャーハンター'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-5.png';
				jobimages['ホークアイ'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-6.png';
				jobimages['ソーサラー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-8.png';
				jobimages['ビショップ'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/human/job/icon-9.png';
				jobimages['テンプルナイト'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-11.png';
				jobimages['ソードシンガー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-12.png';
				jobimages['プレインズウォーカー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-14.png';
				jobimages['シルバーレンジャー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-15.png';
				jobimages['スペルシンガー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-17.png';
				jobimages['エルダー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/elf/job/icon-18.png';
				jobimages['シリエンナイト'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-20.png';
				jobimages['ブレードダンサー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-21.png';
				jobimages['アビスウォーカー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-23.png';
				jobimages['ファントムレンジャー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-24.png';
				jobimages['スペルハウラー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-26.png';
				jobimages['シリエンエルダー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/darkelf/job/icon-27.png';
				jobimages['ガーディアン'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-29.png';
				jobimages['スレイヤー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-30.png';
				jobimages['スカベンジャー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-32.png';
				jobimages['ウォーレンジャー'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-33.png';
				jobimages['クォーラルウィザード'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-35.png';
				jobimages['セイジ'] = 'https://l2r-prod.s3.amazonaws.com/img/pc/class/dwarf/job/icon-36.png';

				// jobimages['パラディン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pa_icon.png';
				// jobimages['ウォーロード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/waro_icon.png';
				// jobimages['トレジャーハンター'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/tr_icon.png';
				// jobimages['ホークアイ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/ho_icon.png';
				// jobimages['ソーサラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/so_icon.png';
				// jobimages['ビショップ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bs_icon.png';
				// jobimages['テンプルナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/te_icon.png';
				// jobimages['ソードシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sws_icon.png';
				// jobimages['プレインズウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pw_icon.png';
				// jobimages['シルバーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sr_icon.png';
				// jobimages['スペルシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sps_icon.png';
				// jobimages['エルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/el_icon.png';
				// jobimages['シリエンナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sn_icon.png';
				// jobimages['ブレードダンサー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bd_icon.png';
				// jobimages['アビスウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/aw_icon.png';
				// jobimages['ファントムレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/fr_icon.png';
				// jobimages['スペルハウラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sh_icon.png';
				// jobimages['シリエンエルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/se_icon.png';
				// jobimages['ガーディアン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/gd_icon.png';
				// jobimages['スレイヤー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sl_icon.png';
				// jobimages['スカベンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sb_icon.png';
				// jobimages['ウォーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/wl_icon.png';
				// jobimages['クォーラルウィザード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/qw_icon.png';
				// jobimages['セイジ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sj_icon.png';

				var jobbufs = [];
				jobbufs['パラディン'] = '防御';
				jobbufs['ウォーロード'] = '攻撃';
				jobbufs['トレジャーハンター'] = '移動';
				jobbufs['ホークアイ'] = '命中';
				jobbufs['ソーサラー'] = 'クリ';
				jobbufs['ビショップ'] = 'HP';
				jobbufs['テンプルナイト'] = '防御';
				jobbufs['ソードシンガー'] = '攻撃';
				jobbufs['プレインズウォーカー'] = '移動';
				jobbufs['シルバーレンジャー'] = '命中';
				jobbufs['スペルシンガー'] = 'クリ';
				jobbufs['エルダー'] = 'HP';
				jobbufs['シリエンナイト'] = '防御';
				jobbufs['ブレードダンサー'] = '攻撃';
				jobbufs['アビスウォーカー'] = '移動';
				jobbufs['ファントムレンジャー'] = '命中';
				jobbufs['スペルハウラー'] = 'クリ';
				jobbufs['シリエンエルダー'] = 'HP';
				jobbufs['ガーディアン'] = '防御';
				jobbufs['スレイヤー'] = '攻撃';
				jobbufs['スカベンジャー'] = '移動';
				jobbufs['ウォーレンジャー'] = '命中';
				jobbufs['クォーラルウィザード'] = 'クリ';
				jobbufs['セイジ'] = 'HP';

				var dispatchPortlateLayout = function(){
					if ((navigator.userAgent.indexOf('iPhone') > 0 && navigator.userAgent.indexOf('iPad') == -1) || navigator.userAgent.indexOf('iPod') > 0 || navigator.userAgent.indexOf('Android') > 0) {
						var orientation = window.orientation;
						if(orientation == 0){
							$("body").addClass("portrait");
							$("body").removeClass("landscape");
							$('.col-xs-4').addClass('col-sm-4').removeClass('col-xs-4');
							$('.col-xs-8').addClass('col-sm-8').removeClass('col-xs-8');
						}
						else{
							$("body").addClass("landscape");
							$("body").removeClass("portrait");
							$('.col-sm-4').addClass('col-xs-4').removeClass('col-sm-4');
							$('.col-sm-8').addClass('col-xs-8').removeClass('col-sm-8');
						}
					}
				}

				var getUrlVars = function(){
					var vars = {};
					var param = location.search.substring(1).split('&');
					for(var i = 0; i < param.length; i++) {
							var keySearch = param[i].search(/=/);
							var key = '';
							if(keySearch != -1) key = param[i].slice(0, keySearch);
							var val = param[i].slice(param[i].indexOf('=', 0) + 1);
							if(key != '') vars[key] = decodeURI(val);
					}
					return vars;
				};
				var loading = function (show) {
					if (show) {
						loadingCount++;
						$('#loader').fadeIn();
					}
					else {
						loadingCount--;
						if (1 > loadingCount) {
							$('#loader').fadeOut();
							loadingCount = 0;
						}
					}
				};
				var auth = function (clanID, callback) {
					loading(true);
					var loginRedirect = false;
					var key = null;
					if ('undefined' != typeof clanID && 0 < clanID.length) {
						key = clanID;
						loginRedirect = true;
					} else if ('undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
						key = getParams['clanid'];
						if ('' == location.hash || '#login' == location.hash) {
							loginRedirect = true;
						}
					}
					if (key == null) {
						// ログイン画面へ
						location.href = '#login';
						loading(false);
						return;
					}
					// firbase問い合わせ
					firebase.firestore().collection("clans").doc(key).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							// 血盟名が取れていればOK
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								clan = data;
								clan.ID = snapshot.id;
								if (loginRedirect) {
									getParams['clanid'] = key;
									var newhref = '?clanid=' + key + '#dashboard';
									if ('on' == getParams['view']) {
										newhref = newhref.replace('#dashboard', '&view=on#dashboard');
									}
									location.href = newhref;
								}
								if (callback) {
									callback(data);
								}
								loading(false);
								return;
							}
						}
						alert('該当する血盟が見つかりませんでした。');
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '#login';
					}).catch(function(error) {
						alert('認証エラーが発生した為、ログイン処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '#login';
						loading(false);
					});
				};
				var registerClan = function (updateID, data, callback) {
					loading(true);
					if (updateID != null && 0 < updateID.length) {
						console.log(data);
						firebase.firestore().collection("clans").doc(updateID).set(data).then(function(snapshot) {
							if (callback) {
								callback(updateID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else  {
						firebase.firestore().collection("clans").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('登録エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerNews = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						newsID = data.ID;
						delete data.ID;
						firebase.firestore().collection("news").doc(newsID).set(data).then(function(snapshot) {
							if (callback) {
								callback(newsID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("news").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerSchedule = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						scheduleID = data.ID;
						delete data.ID;
						firebase.firestore().collection("schedules").doc(scheduleID).set(data).then(function(snapshot) {
							if (callback) {
								callback(scheduleID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("schedules").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerScheduleuser = function (scheduleID, data, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("schedules").doc(scheduleID).collection("users").doc(data.ID).set(data).then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参加登録エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerUser = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						userID = data.ID;
						delete data.ID;
						firebase.firestore().collection("users").doc(userID).set(data).then(function(snapshot) {
							if (callback) {
								callback(userID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("users").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("users").doc(userID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('更新エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedules = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var targettime = Math.round((new Date()).getTime() - (60 * 60 * 24 * 1000));
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).orderBy("date", "asc").startAt(targettime).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								console.log(snapshot);
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									if (targettime > data.date.getTime()){
										return;
									}
									data.date = data.date.toLocaleString();
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUsers = function (clanID, selectable, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("users").where("clanid", "==", clanID);
					if (selectable) {
						// XXX >,>=,<,=<とorderはどうも一緒には出来ない模様・・・
						collection = collection.where("activity", ">", -9);
					}
					else {
						collection = collection.orderBy("activity", "desc").orderBy("joind", "asc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								console.log(snapshot);
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind) {
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getNews = function (clanID, tag, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("news").where("clanid", "==", clanID);
					if (null != tag && 0 < tag.length) {
						collection = collection.where("tag", "==", tag);
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								console.log(snapshot);
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleByTag = function (clanID, tag, callback) {
					if (tag == null || 'undefined' == typeof tag || 1 > tag.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).where("tag", "==", tag).orderBy('incount', 'desc').limit(3).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								console.log(snapshot);
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind) {
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedule = function (scheduleID, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").doc(scheduleID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.date) {
								data.date = data.date.toLocaleString();
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleUsers = function (scheduleID, entryOK, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("schedules").doc(scheduleID).collection("users");
					if (entryOK) {
						collection = collection.where('entry', '>', -1);
					}
					else {
						//collection = collection.orderBy("entry", "desc").orderBy("cp", "desc");
						collection = collection.orderBy("party", "desc").orderBy("cp", "desc").orderBy("entry", "desc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("users").doc(userID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.joind) {
								data.joind = data.joind.toLocaleString();
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var clerinput = function (target) {
					$(target).parent().find('input').val('');
				};
				var onclickLogin = function (target) {
					var clanID = $('#loginform').find('input[name=clanID]').val();
					auth(clanID);
				};
				var onclickAddClan = function (target) {
					location.href='#addclan';
				};
				var onclickRegisterClan = function (target) {
					var clanname = $('#registerClanform').find('input[name=clan]').val();
					var clanurl = $('#registerClanform').find('input[name=url]').val();
					var updateClnaID = null;
					if (0 < clanname.length) {
						var data = {name: clanname, url: clanurl, };
						var webhookID = $('#registerClanform').find('input[name=discordhookid]').val();
						var webhookToken = $('#registerClanform').find('input[name=discordhooktoken]').val();
						if ('undefined' != typeof webhookID && 0 < webhookID.length) {
							data.discordhookid = webhookID;
						}
						if ('undefined' != typeof webhookToken && 0 < webhookToken.length) {
							data.discordhooktoken = webhookToken;
						}
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							updateClnaID = getParams['clanid'];
						}
						registerClan(updateClnaID, data, function (newClanID){
							alert('登録しました。');
							if ('#addclan' == location.hash) {
								var url = location.protocol + '//' + document.domain + location.pathname + '?clanid=' + newClanID;
								alert('あなたの血盟URLは「' + url + '」です。\nログイン用血盟IDは「' + newClanID + '」です。\n無くさないように保管してください！');
							}
							getParams['clanid'] = newClanID;
							location.href = '?clanid=' + newClanID + '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var duplicateEntryUserCnt = 0;
				var duplicateEntryCnt = 0;
				var duplicateEntrySchedule = function (baseSchedule, newSchedule, duplicateEntryUsers) {
					if (duplicateEntryUserCnt < duplicateEntryUsers.length) {
						if (0 > duplicateEntryUsers[duplicateEntryUserCnt].entry) {
							duplicateEntryUserCnt++;
							duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
							return;
						}
						duplicateEntryUsers[duplicateEntryUserCnt].entry = 0;
						registerScheduleuser(newSchedule.ID, duplicateEntryUsers[duplicateEntryUserCnt], function (){
							duplicateEntryCnt++;
							duplicateEntryUserCnt++;
							duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
						});
						return;
					}
					else {
						newSchedule.incount = duplicateEntryCnt;
						registerSchedule(clan.ID, newSchedule, function (){
							// コピー完了
							alert('登録しました。');
							location.href = '#dashboard';
						});
					}
				};
				var onclickRegisterSchedule = function (target, scheduleID, duplicate) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduletag = $('#addscheduleform').find('input[name=scheduletag]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					var scheduleincount = $('#addscheduleform').find('input[name=scheduleincount]').val();
					if (1 > scheduleincount.length) {
						scheduleincount = '0';
					}
					if (true == duplicate) {
						if (1 > scheduletag.length) {
							alert('コピー元になるタグの設定がありません。');
							return;
						}
					}
					if (0 < schedulename.length && 0 < scheduledate.length && 0 < scheduleincount.length) {
						var data = { ID: scheduleID, name: schedulename, date: new Date(scheduledate), tag: scheduletag, incount: parseInt(scheduleincount), };
						registerSchedule(clan.ID, data, function (newScheduleID){
							data.ID = newScheduleID;
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								if (target) {
									alert('更新しました。');
								}
								else {
									//location.href = '?clanid=' + clan.ID + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
									location.reload();
								}
								return;
							}
							if (true == duplicate) {
								getScheduleByTag(clan.ID, scheduletag, function(datas){
									console.log(datas);
									console.log(datas.length);
									if (1 < datas.length) {
										var baseSchedule = {incount:0};
										if ('undefined' != typeof datas[2] && baseSchedule.incount < datas[2].incount) {
											baseSchedule = datas[2];
										}
										if ('undefined' != typeof datas[1] && baseSchedule.incount < datas[1].incount) {
											baseSchedule = datas[1];
										}
										if ('undefined' != typeof datas[0] && baseSchedule.incount < datas[0].incount) {
											baseSchedule = datas[0];
										}
										if (1 > baseSchedule.incount){
											alert('登録しました。');
											location.href = '#dashboard';
											return;
										}
										getScheduleUsers(baseSchedule.ID, null, function (entryUsers){
											if (0 < entryUsers.length) {
												duplicateEntryUserCnt = 0;
												duplicateEntrySchedule(baseSchedule, data, entryUsers);
												return;
											}
											alert('登録しました。');
											location.href = '#dashboard';
										});
									}
								});
								return;
							}
							alert('登録しました。');
							location.href = '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickRegisterNews = function (target) {
					var newstext = $('#editnewsform').find('textarea[name=newstext]').val();
					var newsID = $('#editnewsform').find('input[name=newsid]').val();
					var newstag = $('#editnewsform').find('input[name=newstag]').val();
					if ('undefined' != typeof newstext && 0 < newstext.length) {
						var data = { ID: newsID, text: newstext, tag: newstag, };
						registerNews(clan.ID, data, function (){
							alert('登録しました。');
							location.reload();
							return;
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickRegister = function (target, userID) {
					var username = $('#registerform').find('input[name=username]').val();
					var userjob = $('#registerform').find('select[name=userjob] option:selected').val();
					var userlevel = $('#registerform').find('input[name=userlevel]').val();
					var usercp = $('#registerform').find('input[name=usercp]').val();
					var usermemo = $('#registerform').find('input[name=memo]').val();
					var userdiscord = $('#registerform').find('input[name=discord]').val();
					var usermeteo = $('#registerform').find('select[name=usermeteo] option:selected').val();
					var useractivity = $('#registerform').find('select[name=useractivity] option:selected').val();
					var userjoind = $('#registerform').find('#joinddate').data().date;
					if ('職業' != userjob && 'メテオ' != usermeteo && '状態' != useractivity && 0 < username.length && 0 < userjob.length && 0 < userlevel.length && 0 < usercp.length && 0 < usermeteo.length && 0 < useractivity.length) {
						var data = { ID: userID, name: username, job: userjob, level: parseInt(userlevel), cp: parseInt(usercp), memo: usermemo, meteo: parseInt(usermeteo), activity: parseInt(useractivity), discord: userdiscord, };
						if (0 < userjoind.length) {
							data.joind = new Date(userjoind);
						}
						registerUser(clan.ID, data, function (){
							alert('登録しました。');
							location.href='#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickUnregister = function (target, userID) {
					if (confirm('本当に削除してよろしいですか？')) {
						unregisterUser(userID, function (){
							alert('削除しました。');
							location.href='#dashboard';
						});
						return;
					}
				};
				var onclickSchedule = function (target, scheduleID) {
					getParams['clanid'] = clan.ID;
					getParams['scheduleid'] = scheduleID;
					var newhref = '?clanid=' + clan.ID + '&scheduleid=' + scheduleID + '#detailschedule';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#detailschedule', '&view=on#detailschedule');
					}
					location.href = newhref;
				};
				var onclickModify = function (target, rowID) {
					if ('#addnews' == location.hash) {
						var newstext = $(target).parent().parent().find('.newstext').text();
						var newstag = $(target).parent().parent().find('.newstag').text();
						$('#editnewsform').find('input[name=newsid]').val(rowID);
						$('#editnewsform').find('textarea[name=newstext]').val(newstext);
						$('#editnewsform').find('input[name=newstag]').val(newstag);
						$("html,body").animate({scrollTop: 0}, "100");
						return;
					}
					else if ('#detailschedule' == location.hash) {
						var scheduleusername = $(target).parent().find('.scheduleusername').text();
						var schedulecomment = $(target).parent().find('.schedulecomment').text();
						var scheduleparty = $(target).parent().find('.scheduleparty').data();
						var scheduleuserindex = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + scheduleusername + '"]').val();
						$('#entryscheduleform').find('select[name=scheduleuser]').val(scheduleuserindex);
						$('#entryscheduleform').find('input[name=schedulecomment]').val(schedulecomment);
						if ('undefined' != typeof scheduleparty && 'undefined' != typeof scheduleparty.party) {
							$('#entryscheduleform').find('input[name=scheduleparty]').val(scheduleparty.party);
						}
						$("html,body").animate({scrollTop: 0}, "100");
						return;
					}
					getParams['clanid'] = clan.ID;
					getParams['userid'] = rowID;
					var newhref = '?clanid=' + clan.ID + '&userid=' + rowID + '#modifyuser';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#modifyuser', '&view=on#modifyuser');
					}
					location.href = newhref;
				};
				var onclickInfomation = function (target) {
					var message = $(target).parent().parent().find('.newstext').text();
					if (-1 < message.indexOf('***url***')) {
						message = message.replace('***url***', location.href);
					}
					if (-1 < message.indexOf('***urlview***')) {
						message = message.replace('***urlview***', location.href.replace('#detailschedule', '&view=on#detailschedule'));
					}
					if (-1 < message.indexOf('***pt***')) {
						message = message.replace('***pt***', location.href.replace('#detailschedule', '#party'));
					}
					if (-1 < message.indexOf('***ptview***')) {
						message = message.replace('***ptview***', location.href.replace('#detailschedule', '&view=on#party'));
					}
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに通知しました!');
					return;
				};
				var onclickNotify = function (target, name, discord) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					if (false === ('undefined' != typeof clan.discordhookid && 0 < clan.discordhookid.length)) {
						alert('血盟で使用しているDiscordのWebhook情報が登録されていない為、この機能を利用出来ません！\n「設定」から設定して下さい。');
						return;
					}
					var discordIDMsg = '';
					if ('undefined' != typeof discord && 0 < discord.length) {
						discordIDMsg = ' ( \@' + discord + ' ) ';
					}
					var message = '【緊急】おいぃ！ ' + name + discordIDMsg + '！！「 ' + schedulename + ' (' + scheduledate + '開催) 」' + 'への出欠登録がされてないぞ！！【催促】';
					message = message + '\n欠席でいいのか！？良くないならば今スグ登録タノムっ！！ => ' + location.protocol + '//' + publicURL + '/?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに催促通知しました!');
					return;
				};
				$(function() {
					loading(true);
					getParams = getUrlVars();
					$(window).load(function() {
						riot.mount('navigationbar');
						riot.mount('router');
						loading(false);
					});
					$(window).resize(function(){
						dispatchPortlateLayout();
					});
				});
			</script>
		</section>

	</body>
</html>
