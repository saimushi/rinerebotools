<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta name="robots" content="noindex"/>
		<!-- Line2revo -->
		<meta name="description" content="血盟管理ツール"/>
		<meta id="ogimage" property="og:image" content="https://line2revo.fun/images/l2r/ogimage.png" />
		<title>L2R Tool</title>
		<!-- end/ -->
		<!-- kurosaba --
		<meta name="description" content="ギルド管理ツール"/>
		<meta id="ogimage" property="og:image" content="https://kurosaba.fun/images/kurosaba/ogimage.png" />
		<title>【黒い砂漠】ギルド管理 Tool</title>
		<!-- end/ -->
		<link rel="icon" href="./favicon.ico">
		<link rel="mask-icon" href="./favicon.svg" sizes="any" color="black">
		<!-- bootstrap -->
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/css-spinning-spinners/1.1.1/load8.css"/>
		<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" />
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

		<!-- ブラウザ・モードチェック -->
		<script type="text/javascript">
			var browserEnabled = true;
			var result = null;
	 	  var agent = window.navigator.userAgent.toLowerCase();
	  	var version = window.navigator.appVersion.toLowerCase();
		  if(agent.indexOf("msie") > -1){
		    if (version.indexOf("msie 6.") > -1){
		      result = 'IE6';
		    }
				else if (version.indexOf("msie 7.") > -1){
		      result = 'IE7';
		    }
				else if (version.indexOf("msie 8.") > -1){
		      result = 'IE8';
		    }
				else if (version.indexOf("msie 9.") > -1){
		      result = 'IE9';
		    }
				else if (version.indexOf("msie 10.") > -1){
		      result = 'IE10';
		    }
				else{
		      result = 'IE(バージョン不明)';
		    }
				browserEnabled = false;
		  }
			else if(agent.indexOf("trident/7") > -1){
		    result = 'IE11';
				browserEnabled = false;
		  }
			else if(agent.indexOf("edge") > -1){
		    result = 'Edge';
				browserEnabled = false;
		  }
			else if (agent.indexOf("chrome") > -1){
		    result = 'Chrome';
		  }
			else if (agent.indexOf("safari") > -1){
		    result = 'Safari';
		  }
			else if (agent.indexOf("opera") > -1){
		    result = 'Opera';
				browserEnabled = false;
		  }
			else if (agent.indexOf("firefox") > -1){
		    result = 'Firefox';
				browserEnabled = false;
		  }
			if (true !== browserEnabled) {
				alert('申し訳御座いません、お使いのブラウザには現在対応していせん。\nPCでご利用の場合はGoogle Chromeを推奨します。');
			}
			var mode = 1;
			var clanLabel = '血盟';
			var clanPageLabel = '血盟コミュ';
			var clanMemberLabel = '血盟員';
			if (-1 < location.hostname.indexOf('kurosaba') || 4000 == location.port) {
				console.log('mode=kurosaba');
				mode = 2;
				clanLabel = 'ギルド';
				clanPageLabel = 'ギルドサイト';
				clanMemberLabel = 'ギルドメンバー';
			}
		</script>

		<!-- this app styles -->
		<style>
			html, body {
				height: 100%;
			}
			input, select, textarea {
				font-size: 16px !important;
			}
			table {
			  table-layout: fixed;
			}
			ul li {
				padding-top: 5px;
				padding-bottom: 5px;
			}
			li.activity-1 span.username, li.activity-1 span.cp {
				background-color: rgb(183, 227, 255) !important;
			}
			.navbar {
				min-height: 60px;
			}
			navigationbar.kurosaba .navbar {
				border-bottom: solid 1px #9d9d9d;
				background-color: white;
			}
			navigationbar.kurosaba .navbar .navbar-nav>li>a {
				color: #333;
			}
			navigationbar.kurosaba .navbar .navbar-nav>li>a:hover {
				color: #999;
			}
			navigationbar.kurosaba .navbar .navbar-toggle.collapsed {
				background-color: gray;
			}
			navigationbar.kurosaba .navbar .navbar-toggle.collapsed .icon-bar {
				background-color: white;
			}
			.navbar-toggle {
				margin-top: 12px;
				margin-bottom: 13px;
			}
			.table-striped>tbody>tr {
				background-color: #f6f6f6;
			}
			.table-striped>tbody>tr:nth-of-type(odd) {
				background-color: #ffffff;
			}
			dashboard .table-striped>tbody#partylist.mode1partylist>tr:nth-child(-n+30) {
				background-color: #dff3fa;
			}
			.table-hover>tbody>tr:hover {
				background-color: #2dabc1;
			}
			navigationbar {
				display: block;
				height: 60px;
			}
			navigationbar .container {
				width: 100%;
			}
			@media (max-width: 1113px) {
				.datepicker.col-md-6 {
					width: 100%;
				}
			}
			.orverlay {
				display: none;
				position: fixed;
				height: 100%;
				width: 100%;
				z-index: 9999;
				background-color: rgba(0, 0, 0, 0.4);
			}
			.helppanel {
				margin-top: 20px;
				padding: 10px;
				padding-top: 5px;
			}
			.helppanel div {
				background-color: white;
				padding: 10px;
			}
			.row {
				margin-left: 0;
				margin-right: 0;
			}
			.btn-default {
				background-color: #bbb;
				color: white;
			}
			route>.riotcontes>div:first-child {
				min-height: calc(100% - 300px);
			}
			.riotcontes {
				top: 61px;
				padding-bottom: 200px;
				width: 100%;
			}
			div.row {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-8 {
				padding-left: 0;
				padding-right: 0;
			}
			dashboard div.row div.col-xs-8, contribution div.row div.col-xs-8 {
				padding-top: 50px;
			}
			div.row div.col-sm-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-sm-8 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div div.container-fluid {
				padding: 0;
			}
			.btn-group {
				width: 100%;
			}
			.btn-group .form-control {
				padding-right: 20px;
			}
			.clearbtn {
				position: absolute;
				right: 5px;
				top: 0;
				bottom: 0;
				height: 14px;
				margin: auto;
				font-size: 14px;
				cursor: pointer;
				color: #ccc;
			}
			th, tr {
				font-size: 10px;
			}
			td.scheduleparty[data-party="49"], input[name=schedulept49label]+.clearbtn {
				background-color: #bbb;
			}
			td.scheduleparty[data-party="48"], input[name=schedulept48label]+.clearbtn {
				background-color: #aaa;
			}
			td.scheduleparty[data-party="39"], input[name=schedulept39label]+.clearbtn {
				background-color: dodgerblue;
			}
			td.scheduleparty[data-party="38"], input[name=schedulept38label]+.clearbtn {
				background-color: blue;
			}
			td.scheduleparty[data-party="37"], input[name=schedulept37label]+.clearbtn {
				background-color: navy;
			}
			td.scheduleparty[data-party="29"], input[name=schedulept29label]+.clearbtn {
				background-color: limegreen;
			}
			td.scheduleparty[data-party="28"], input[name=schedulept28label]+.clearbtn {
				background-color: green;
			}
			td.scheduleparty[data-party="27"], input[name=schedulept27label]+.clearbtn {
				background-color: darkgreen;
			}
			td.scheduleparty[data-party="19"], input[name=schedulept19label]+.clearbtn {
				background-color: gold;
			}
			td.scheduleparty[data-party="18"], input[name=schedulept18label]+.clearbtn {
				background-color: orange;
			}
			td.scheduleparty[data-party="17"], input[name=schedulept17label]+.clearbtn {
				background-color: darkorange;
			}
			td.scheduleparty[data-party="9"], input[name=schedulept9label]+.clearbtn {
				background-color: red;
			}
			td.scheduleparty[data-party="8"], input[name=schedulept8label]+.clearbtn {
				background-color: crimson;
			}
			td.scheduleparty[data-party="7"], input[name=schedulept7label]+.clearbtn {
				background-color: firebrick;
			}
			td.scheduleparty[data-party="0"] {
				background-color: #444;
			}
			td.scheduleparty[data-party=""] {
				background-color: #444;
			}
			.jobimage p {
				display: block;
				width: 20px;
				height: 12px;
				font-size: 13px;
				color: white;
				margin-top: -18px;
			}
			party li .jobimage p {
				margin-left: 4px;
			}
			app {
				 display: block;
				 width: 100% !important;
				 padding-left: 0 !important;
				 padding-right: 0 !important;
				 padding-bottom: 20px;
				 min-height: calc(100% - 180px - 60px);
			}
			addoperation span.cp {
				display: none;
			}
			addoperation span.username {
				width: 104px !important;
			}
			users>div {
				overflow: auto;
			}
			users>div table {
				table-layout: auto;
			}
			users>div table td {
				padding: 0 !important;
				padding-top: 2px !important;
			}
			users>div table th, users>div table td {
				padding-left: 2px !important;
				padding-right: 2px !important;
				text-align: center;
				vertical-align: middle !important;
				font-size: xx-small;
			}
			@media screen and (max-width: 480px) {
				td.jobimage p {
					display: none;
				}
				tr.partycp td {
					padding-right: 35px !important;
				}
			}
			#loader {
				z-index: 99999;
			}
			.footer {
				position: relative;
				width: 100%;
				height: 180px;
			  background-color: lightgray;
				bottom: 0;
				-webkit-transform: translate3d(0,0,0);
			}
			.footer div {
				padding: 0;
				background-color: lightgray;
			}
			#payment-request-button {
				position: fixed;
				width: 100px;
				z-index: 2000;
				top: 10px;
				right: 70px;
			}
			.donation-form {
				position: fixed;
				width: 82px;
				z-index: 1500;
				top: 13px;
				right: 180px;
				height: 0;
			}
		</style>
	</head>
	<body>
		<div id="loader" class="orverlay loading"></div>
		<div id="popup" class="orverlay"></div>
		<donation></donation>
		<navigationbar></navigationbar>
		<app class="container">
			<router class="row">
				<route path="/">
					<top class="riotcontes"/>
				</route>
				<route path="dashboard">
					<dashboard class="riotcontes"/>
				</route>
				<route path="setting">
					<addclan class="riotcontes"/>
				</route>
				<route path="login">
					<login/>
				</route>
				<route path="addclan">
					<addclan class="riotcontes"/>
				</route>
				<route path="adduser">
					<adduser class="riotcontes"/>
				</route>
				<route path="addschedule">
					<addschedule class="riotcontes"/>
				</route>
				<route path="addnews">
					<addnews class="riotcontes"/>
				</route>
				<route path="contribution">
					<contribution class="riotcontes"/>
				</route>
				<route path="modifyuser">
					<adduser class="riotcontes"/>
				</route>
				<route path="detailschedule">
					<detailschedule class="riotcontes"/>
				</route>
				<route path="party">
					<party class="riotcontes"/>
				</route>
				<route path="addoperation">
					<addoperation class="riotcontes"/>
				</route>
				<route path="howto">
					<howto class="riotcontes"/>
				</route>
				<route path="inquiry">
					<inquiry class="riotcontes"/>
				</route>
				<route path="manage">
					<manage class="riotcontes"/>
				</route>
				<route path="donation">
					<donat class="riotcontes"/>
				</route>
			</router>
		</app>
		<footerbar></footerbar>

		<!-- Riot tags -->
		<section id="riot-tags">
			<!-- donation -->
			<script type="riot/tag" src="./customtags/donation.tag"></script>

			<!-- navigationbar -->
			<script type="riot/tag">
				<navigationbar>
					<div if={'#party' != location.hash} class="navbar navbar-inverse navbar-fixed-top" role="navigation">
						<div class="container">
							<div class="navbar-header">
								<!-- sp用 -->
								<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
									<span class="sr-only">Toggle navigation</span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a if={mode==1 && null == getParams['clanid']} class="navbar-brand" href="./" style="padding: 0;"><img src="./images/l2r/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
								<a if={mode==1 && null != getParams['clanid']} class="navbar-brand" href="?clanid={clan.ID}" style="padding: 0;"><img src="./images/l2r/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
								<a if={mode==2 && null == getParams['clanid']} class="navbar-brand" href="./" style="padding: 0;"><img src="./images/kurosaba/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
								<a if={mode==2 && null != getParams['clanid']} class="navbar-brand" href="?clanid={clan.ID}" style="padding: 0;"><img src="./images/kurosaba/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
							</div>
							<div class="collapse navbar-collapse">
								<ul class="nav navbar-nav">
									<li if={'#login' != location.hash && '' != location.hash}><a href="#dashboard">{clanLabel}ページ</a></li>
									<li if={'#login' != location.hash && '' != location.hash}><a href="{clan.url}">{clanPageLabel}</a></li>
									<li if={'#login' != location.hash && '' != location.hash && 'on'!=getParams['view']}><a href="#setting">設定</a></li>
									<li if={'#login' != location.hash && '' != location.hash && 'on'!=getParams['view']}><a href="./">ログアウト</a></li>
									<li><a href="#howto">ヘルプ</a></li>
									<li><a href="#inquiry">お問い合わせ</a></li>
								</ul>
							</div>
						</div>
					</div>
					this.on('mount', function() {
						if (mode==2) {
							$('navigationbar').addClass('kurosaba');
						}
						$(".navbar-nav li a").click(function(event) {
							$(".navbar-collapse").collapse('hide');
						});
					});
				</navigationbar>
			</script>

			<!-- footerbar -->
			<script type="riot/tag">
				<footerbar>
					<footer class="footer">
						<p class="text-muted" style="margin: 5px; color: white;">広告から外部サイトに出られます！</p>
						<div  class="row">
							<!-- rakuten -->
							<div class="col-sm-2">
								&nbsp;
							</div>
							<div class="col-sm-3">
								<table cellpadding="0" cellspacing="0" border="0" style="background-color: white; border:1px solid #ccc; width:350px;"><tr style="border-style:none;"><td style="vertical-align:top; border-style:none; padding:10px; width:75px;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow"><img border="0" alt="" src="http://thumbnail.image.rakuten.co.jp/@0_mall/kaen-web/cabinet/itunes10000.jpg?_ex=64x64" /></a></td><td style="font-size:12px; vertical-align:middle; border-style:none; padding:10px;"><p style="padding:0; margin:0;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow">APPLE アップル iTunesCard　アイチューンズカード10000円</a></p><p style="color:#666; margin-top:5px line-height:1.5;">価格:<span style="font-size:14px; color:#C00; font-weight:bold;">9,922円</span><br/><span style="font-size:10px; font-weight:normal;">(2018/8/6 13:08時点)</span><br/><span style="font-weight:bold;">感想(0件)</span></p></td></tr></table>
								<img border="0" width="1" height="1" src="https://www18.a8.net/0.gif?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT" alt="">
							</div>
							<!-- ドコモオンラインモール -->
							<div class="col-sm-3">
								<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" target="_blank" rel="nofollow">
									<img border="0" width="350" alt="" src="https://www29.a8.net/svt/bgt?aid=180806241950&wid=001&eno=01&mid=s00000014967001010000&mc=1">
								</a>
								<img border="0" width="1" height="1" src="https://www15.a8.net/0.gif?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" alt="">
							</div>
							<!-- お名前.com -->
							<div class="col-sm-3">
								<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" target="_blank" rel="nofollow">
									<img border="0" width="140" height="140" alt="" src="https://www26.a8.net/svt/bgt?aid=180806241949&wid=001&eno=01&mid=s00000000018015054000&mc=1">
								</a>
								<img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" alt="">
							</div>
						</div>
					</footer>
				</footerbar>
			</script>

			<!-- top -->
			<script type="riot/tag">
				<top>
					this.on('mount', function() {
						// 認証
						auth();
					});
				</top>
			</script>

			<!-- donat -->
			<script type="riot/tag">
				<donat>
					<div style="padding: 10px;">
						<h2>寄付に興味を持って頂き有難うございます！</h2>
						<h3>寄付は右上の「寄付する」「Apple Pay(対応機種のみ)」ボタンより行なえます。</h3>
					</div>
					interval = null;
					thisis = null;
					this.on('mount', function() {
						this.interval = interval;
						thisis = this;
						thisis.interval = setInterval(function() {
							if ($('.stripe-button-el')[0] && thisis.interval) {
								clearInterval(thisis.interval);
								thisis.interval = null;
								if ($('#payment-request-button')[0]) {
									$('#payment-request-button')[0].click();
								}
								else {
									$('.stripe-button-el')[0].click();
								}
							}
						}, 2000);
					});
				</donat>
			</script>

			<!-- dashboard -->
			<script type="riot/tag">
				<dashboard>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid" style="padding: 10px;">
								<h2 style="margin-top: 5px;"><a href="{clanurl}">{clanname}</a></h2>
								<h4>アクティブ{clanMemberLabel}数: {usercnt}</h4>
								<h5 if={mode==1}><a href="https://l2.netmarble.jp/event/lrt3/" target="_blank" style="color: #31b0d5;">LRT選考基準CP: {prelrtcp.toLocaleString()}</a></h5>
								<h5>総アクティブCP: {totalcp.toLocaleString()}</h5>
								<small>
									<b style="font-size: x-small;">{url}</b>
									<br/>
									<small style="color: red; font-size: xx-small;">
										※この{clanLabel}のURLです。忘れずメモして下さい！
										<br/>
										※ゲーム内のコミュにこのURLをリンクすると幸せになれます！
									</small>
								</small>
								<div if={'on'!=getParams['view']} class="row" style="padding-top: 10px;">
									<a class="btn btn-success" href="#addschedule" style="margin-bottom: 10px;">予定追加</a>
									<a class="btn btn-info" href="#adduser" style="margin-bottom: 10px;">{clanMemberLabel}追加</a>
									<a class="btn btn-warning" href="#addnews" style="margin-bottom: 10px;">お知らせ管理</a>
									<a if={mode==1} class="btn btn-primary" href="#addoperation" style="margin-bottom: 10px;">作戦書管理</a>
									<a if={mode==1} class="btn btn-primary" href="#contribution" style="margin-bottom: 10px;">週間貢献度集計</a>
								</div>
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr class="info">
											<th>予定日</th>
											<th>予定内容</th>
											<th>参加人数</th>
										</tr>
									</thead>
									<tbody>
										<tr each="{schedule, index in schedules}">
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.date}</td>
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.name}</td>
											<td if={schedule.type!=1}><a href="?clanid={clan.ID}&scheduleid={schedule.ID}{viewON}#party">{schedule.incount}</a></td>
											<td if={schedule.type==1}>出欠不要</td>
										</tr>
									</tbody>
								</table>
							</div>
							<br/>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div if={mode==1} style="width: 150px; margin-top: -45px; margin-left: auto; margin-right: 10px; margin-bottom: 5px;">
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: firebrick;">&nbsp;前衛&nbsp;{attckAssistans}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: orange;">&nbsp;魔攻&nbsp;{criticalAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: blue;">&nbsp;盾職&nbsp;{defenseAssistans}</span>
									<br style="clear: both;"/>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: green;">&nbsp;短剣&nbsp;{moveAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: dodgerblue;">&nbsp;弓職&nbsp;{hitAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: deeppink;">&nbsp;回復&nbsp;{healAssistans}</span>
									<br style="clear: both;"/>
								</div>
								<users data='{users}'/>
							</div>
						</div>
					</div>
					var attckAssistans = 0;
					var criticalAssistants = 0;
					var defenseAssistans = 0;
					var moveAssistants = 0;
					var hitAssistants = 0;
					var healAssistans = 0;

					var url = location.protocol + '//' + document.domain + location.pathname;
					var clanname = '';
					var clanurl = 'javascript: void(0); return false;';
					var usercnt = 0;
					var totalcp = 0;
					var prelrtcp = 0;
					var users = [];
					var schedules = [];
					var cpSort = false;
					var viewON = '';
					var thisis;
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						thisis = this;
						thisis.attckAssistans = attckAssistans;
						thisis.criticalAssistants = criticalAssistants;
						thisis.defenseAssistans = defenseAssistans;
						thisis.moveAssistants = moveAssistants;
						thisis.hitAssistants = hitAssistants;
						thisis.healAssistans = healAssistans;
						if ('on' == getParams['view']) {
							this.viewON = '&view=on';
						}
						// 認証
						auth(false, function (clan) {
							if ('undefined' != typeof clan.name) {
								this.url = url + '?clanid=' + clan.ID;
								this.clanname = clan.name;
								this.clanurl = clan.url;
								getUsers(clan.ID, false, function(users) {
									this.users = users;
									this.usercnt = usercnt;
									this.totalcp = totalcp;
									this.prelrtcp = prelrtcp;
									for (var uidx=0; uidx < users.length; uidx++) {
										if (users[uidx].activity > 0) {
											this.totalcp += parseInt(users[uidx].cp);
											if (30 > this.usercnt) {
												this.prelrtcp += parseInt(users[uidx].cp);
											}
											this.usercnt++;
											// 種別振り分けは一度すれば十分
											if (jobbufs[users[uidx].job]=='攻撃') {
												thisis.attckAssistans++;
											}
											if (jobbufs[users[uidx].job]=='クリ') {
												thisis.criticalAssistants++;
											}
											if (jobbufs[users[uidx].job]=='防御') {
												thisis.defenseAssistans++;
											}
											if (jobbufs[users[uidx].job]=='移動') {
												thisis.moveAssistants++;
											}
											if (jobbufs[users[uidx].job]=='命中') {
												thisis.hitAssistants++;
											}
											if (jobbufs[users[uidx].job]=='HP') {
												thisis.healAssistans++;
											}
										}
									}
									riot.update();
									//sortCP();
									getSchedules(clan.ID, function(schedules) {
										this.schedules = schedules;
										riot.update();
									});
								});
							}
						});
						dispatchPortlateLayout();
					});
				</dashboard>
			</script>

			<!-- login -->
			<script type="riot/tag">
				<login>
					<div class="row" style="padding-top: 45px">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div if={mode==1} class="col-sm-6" style="height: 200px; padding-top: 50px; text-align: center; background-image: url('./images/l2r/logo.png'); background-repeat: no-repeat; background-size: contain; background-position: center bottom;">
							<h2>&nbsp;&nbsp;&nbsp;{clanLabel}管理を<b style="font-size: 120%;">も</b><b>っと</b>簡単に。</h2>
						</div>
						<div if={mode==2} class="col-sm-6" style="height: 200px; padding-top: 50px; text-align: center; background-image: url('https://file.gameon.jp/blackdesert/images/lp/logo_new.png'); background-repeat: no-repeat; background-size: contain; background-position: center bottom;">
							<br/><br/><br/><br/><br/><br/><br/><br/>
							<h2>&nbsp;&nbsp;&nbsp;{clanLabel}管理を<b style="font-size: 120%;">も</b><b>っと</b>簡単に。</h2>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-3 bg-primary" style="margin-top: 120px; padding: 30px;">
							<h4>{clanLabel}ログイン</h4>
							<form id="loginform" onsubmit="return onclickLogin(this);">
								<div class="form-group">
									<div class="btn-group">
										<input type="text" name="clanID" class="form-control" placeholder="{clanLabel}ID"/>
										<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
									</div>
								</div>
								<botton class="btn btn-success" onclick="onclickLogin(this)" style="margin-bottom: 10px;">ログイン</botton>
								&nbsp;&nbsp;&nbsp;<botton class="btn btn-info" onclick="onclickAddClan(this)" style="margin-bottom: 10px;">{clanLabel}登録</botton>
							</form>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div class="row">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div class="col-sm-6" style="padding-top: 30px; text-align: center;">
							<h4 style="margin: 0;">&nbsp;&nbsp;&nbsp;<small>{clanMemberLabel}管理／{clanLabel}イベントスケジュール／お知らせ通知／パーティ編成</small></h4>
							<h3 style="margin-top: 5px; margin-bottom: 20px;">&nbsp;&nbsp;&nbsp;<small><b>必要な全ての機能を備えています。</b></small></h3>
						</div>
						<div class="col-sm-4">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div if="{mode==1}" class="row parent-container" style="padding-bottom: 140px">
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-2">
							<a href="./images/l2r/sample001.png"><img width="240" src="./images/l2r/sample001.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/l2r/sample002.png"><img width="240" src="./images/l2r/sample002.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/l2r/sample003.png"><img width="240" src="./images/l2r/sample003.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/l2r/sample004.png"><img width="240" src="./images/l2r/sample004.png"/></a>
						</div>
						<div class="col-sm-3">
							&nbsp;
						</div>
					</div>
					this.on('mount', function() {
						riot.mount('footerbar');
						$('.parent-container').magnificPopup({
  						delegate: 'a',
  						type: 'image',
  						gallery: {
    						enabled:true
  						}
  					});
						auth();
					});
				</login>
			</script>

			<!-- addclan -->
			<script type="riot/tag">
				<addclan>
					<div style="padding: 10px;">
						<form id="registerClanform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="clan" value="{clan.name}" class="form-control" placeholder="(必須){clanLabel}名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
								<small class="text-danger">※必須</small>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="url" value="{clan.url}" class="form-control" placeholder="(任意){clanPageLabel}URL"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
								<small class="text-info">※任意</small>
							</div>
							<div if={'#setting' == location.hash} class="form-group">
								<div class="btn-group">
									<input type="text" name="discordwebhook" value="{clan.discordwebhook}" class="form-control" placeholder="(任意)https://discordapp.com/api/webhooks/473768563144916994/SCTXRlLW_uGeATZwyqU72nzU1tviFZHvVkoAMA_Q8wN5macrPFZsrxP6eMFpe3tJ8val"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
								<small class="text-info">※任意 DiscordのWebhooks設定の「WEBHOOK URL」をそのままコピペして下さい</small>
							</div>
							<div if={'#setting' == location.hash} class="form-check">
								<input if={'number' == typeof clan.twitterDisabled && clan.twitterDisabled === 1} type="checkbox" name="twitterDisabled" value="1"  class="form-check-input" id="twitterDisabled"/>
								<input if={false == ('number' == typeof clan.twitterDisabled && clan.twitterDisabled === 1)} type="checkbox" name="twitterDisabled" value="1"  class="form-check-input" id="twitterDisabled" checked="checked"/>
								<label if={mode==1} class="form-check-label" for="twitterDisabled">公式ツイートを自動通知</label>
								<label if={mode==2} class="form-check-label" for="twitterDisabled">黒砂モバイル公式ツイートを自動通知</label>
								<br/>
								<br/>
							</div>
							<div if={'#setting' == location.hash && mode == 2} class="form-check">
								<input if={'number' == typeof clan.twitterPCEnabled && clan.twitterPCEnabled === 1} type="checkbox" name="twitterPCEnabled" value="1"  class="form-check-input" id="twitterPCEnabled" checked="checked"/>
								<input if={false == ('number' == typeof clan.twitterPCEnabled && clan.twitterPCEnabled === 1)} type="checkbox" name="twitterPCEnabled" value="1"  class="form-check-input" id="twitterPCEnabled"/>
								<label class="form-check-label" for="twitterPCEnabled">黒砂PC公式ツイートを自動通知</label>
								<br/>
								<br/>
							</div>
							<botton class="btn btn-success" onclick="onclickRegisterClan(this)">登録</botton>
						</form>
					</div>
					var clan = { ID: '', name: '', discordwebhook: '', discordhookid: '', discordhooktoken: '', };
					this.on('mount', function() {
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							auth(false, function (clan) {
								// modifyモード
								if ('string' == typeof clan.discordhookid && 'string' == typeof clan.discordhooktoken && 0 < clan.discordhookid.length && 0 < clan.discordhooktoken.length) {
									clan.discordwebhook = 'https://discordapp.com/api/webhooks/'+ clan.discordhookid + '/' + clan.discordhooktoken;
								}
								// modifyモード
								this.clan = clan;
								riot.update();
							});
						}
					});
				</addclan>
			</script>

			<!-- adduser -->
			<script type="riot/tag">
				<adduser>
					<div style="padding-left: 10px; padding-right: 10px;">
						<h2>{clanMemberLabel}追加</h2>
						<form id="registerform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="username" value="{user.name}" class="form-control" placeholder="キャラクター名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userjob">
									<option>職業</option>
									<optgroup label="カマエル">
										<option if={user.job=='バーサーカー'} value="バーサーカー" selected="selected">{jobs['バーサーカー']}</option>
										<option if={user.job!='バーサーカー'} value="バーサーカー">{jobs['バーサーカー']}</option>
										<option if={user.job=='アヴァレスタ'} value="アヴァレスタ" selected="selected">{jobs['アヴァレスタ']}</option>
										<option if={user.job!='アヴァレスタ'} value="アヴァレスタ">{jobs['アヴァレスタ']}</option>
										<option if={user.job=='ソウルブレーカー'} value="ソウルブレーカー" selected="selected">{jobs['ソウルブレーカー']}</option>
										<option if={user.job!='ソウルブレーカー'} value="ソウルブレーカー">{jobs['ソウルブレーカー']}</option>
									</optgroup>
									<optgroup label="オーク">
										<option if={user.job=='オークレイダー'} value="オークレイダー" selected="selected">{jobs['オークレイダー']}</option>
										<option if={user.job!='オークレイダー'} value="オークレイダー">{jobs['オークレイダー']}</option>
										<option if={user.job=='オークモンク'} value="オークモンク" selected="selected">{jobs['オークモンク']}</option>
										<option if={user.job!='オークモンク'} value="オークモンク">{jobs['オークモンク']}</option>
										<option if={user.job=='オークシャーマン'} value="オークシャーマン" selected="selected">{jobs['オークシャーマン']}</option>
										<option if={user.job!='オークシャーマン'} value="オークシャーマン">{jobs['オークシャーマン']}</option>
									</optgroup>
									<optgroup label="ヒューマン">
										<option if={user.job=='パラディン'} value="パラディン" selected="selected">{jobs['パラディン']}</option>
										<option if={user.job!='パラディン'} value="パラディン">{jobs['パラディン']}</option>
										<option if={user.job=='ウォーロード'} value="ウォーロード" selected="selected">{jobs['ウォーロード']}</option>
										<option if={user.job!='ウォーロード'} value="ウォーロード">{jobs['ウォーロード']}</option>
										<option if={user.job=='トレジャーハンター'} value="トレジャーハンター" selected="selected">{jobs['トレジャーハンター']}</option>
										<option if={user.job!='トレジャーハンター'} value="トレジャーハンター">{jobs['トレジャーハンター']}</option>
										<option if={user.job=='ホークアイ'} value="ホークアイ" selected="selected">{jobs['ホークアイ']}</option>
										<option if={user.job!='ホークアイ'} value="ホークアイ">{jobs['ホークアイ']}</option>
										<option if={user.job=='ソーサラー'} value="ソーサラー" selected="selected">{jobs['ソーサラー']}</option>
										<option if={user.job!='ソーサラー'} value="ソーサラー">{jobs['ソーサラー']}</option>
										<option if={user.job=='ビショップ'} value="ビショップ" selected="selected">{jobs['ビショップ']}</option>
										<option if={user.job!='ビショップ'} value="ビショップ">{jobs['ビショップ']}</option>
									</optgroup>
									<optgroup label="エルフ">
										<option if={user.job=='テンプルナイト'} value="テンプルナイト" selected="selected">{jobs['テンプルナイト']}</option>
										<option if={user.job!='テンプルナイト'} value="テンプルナイト">{jobs['テンプルナイト']}</option>
										<option if={user.job=='ソードシンガー'} value="ソードシンガー" selected="selected">{jobs['ソードシンガー']}</option>
										<option if={user.job!='ソードシンガー'} value="ソードシンガー">{jobs['ソードシンガー']}</option>
										<option if={user.job=='プレインズウォーカー'} value="プレインズウォーカー" selected="selected">{jobs['プレインズウォーカー']}</option>
										<option if={user.job!='プレインズウォーカー'} value="プレインズウォーカー">{jobs['プレインズウォーカー']}</option>
										<option if={user.job=='シルバーレンジャー'} value="シルバーレンジャー" selected="selected">{jobs['シルバーレンジャー']}</option>
										<option if={user.job!='シルバーレンジャー'} value="シルバーレンジャー">{jobs['シルバーレンジャー']}</option>
										<option if={user.job=='スペルシンガー'} value="スペルシンガー" selected="selected">{jobs['スペルシンガー']}</option>
										<option if={user.job!='スペルシンガー'} value="スペルシンガー">{jobs['スペルシンガー']}</option>
										<option if={user.job=='エルダー'} value="エルダー" selected="selected">{jobs['エルダー']}</option>
										<option if={user.job!='エルダー'} value="エルダー">{jobs['エルダー']}</option>
									</optgroup>
									<optgroup label="ダークエルフ">
										<option if={user.job=='シリエンナイト'} value="シリエンナイト" selected="selected">{jobs['シリエンナイト']}</option>
										<option if={user.job!='シリエンナイト'} value="シリエンナイト">{jobs['シリエンナイト']}</option>
										<option if={user.job=='ブレードダンサー'} value="ブレードダンサー" selected="selected">{jobs['ブレードダンサー']}</option>
										<option if={user.job!='ブレードダンサー'} value="ブレードダンサー">{jobs['ブレードダンサー']}</option>
										<option if={user.job=='アビスウォーカー'} value="アビスウォーカー" selected="selected">{jobs['アビスウォーカー']}</option>
										<option if={user.job!='アビスウォーカー'} value="アビスウォーカー">{jobs['アビスウォーカー']}</option>
										<option if={user.job=='ファントムレンジャー'} value="ファントムレンジャー" selected="selected">{jobs['ファントムレンジャー']}</option>
										<option if={user.job!='ファントムレンジャー'} value="ファントムレンジャー">{jobs['ファントムレンジャー']}</option>
										<option if={user.job=='スペルハウラー'} value="スペルハウラー" selected="selected">{jobs['スペルハウラー']}</option>
										<option if={user.job!='スペルハウラー'} value="スペルハウラー">{jobs['スペルハウラー']}</option>
										<option if={user.job=='シリエンエルダー'} value="シリエンエルダー" selected="selected">{jobs['シリエンエルダー']}</option>
										<option if={user.job!='シリエンエルダー'} value="シリエンエルダー">{jobs['シリエンエルダー']}</option>
									</optgroup>
									<optgroup label="ドワーフ">
										<option if={user.job=='ガーディアン'} value="ガーディアン" selected="selected">{jobs['ガーディアン']}</option>
										<option if={user.job!='ガーディアン'} value="ガーディアン">{jobs['ガーディアン']}</option>
										<option if={user.job=='スレイヤー'} value="スレイヤー" selected="selected">{jobs['スレイヤー']}</option>
										<option if={user.job!='スレイヤー'} value="スレイヤー">{jobs['スレイヤー']}</option>
										<option if={user.job=='スカベンジャー'} value="スカベンジャー" selected="selected">{jobs['スカベンジャー']}</option>
										<option if={user.job!='スカベンジャー'} value="スカベンジャー">{jobs['スカベンジャー']}</option>
										<option if={user.job=='ウォーレンジャー'} value="ウォーレンジャー" selected="selected">{jobs['ウォーレンジャー']}</option>
										<option if={user.job!='ウォーレンジャー'} value="ウォーレンジャー">{jobs['ウォーレンジャー']}</option>
										<option if={user.job=='クォーラルウィザード'} value="クォーラルウィザード" selected="selected">{jobs['クォーラルウィザード']}</option>
										<option if={user.job!='クォーラルウィザード'} value="クォーラルウィザード">{jobs['クォーラルウィザード']}</option>
										<option if={user.job=='セイジ'} value="セイジ" selected="selected">{jobs['セイジ']}</option>
										<option if={user.job!='セイジ'} value="セイジ">{jobs['セイジ']}</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==2} class="form-group">
								<select class="form-control" name="userjob">
									<option>クラス</option>
									<option if={user.job=='ウォーリア'} value="ウォーリア" selected="selected">ウォーリア</option>
									<option if={user.job!='ウォーリア'} value="ウォーリア">ウォーリア</option>
									<option if={user.job=='ヴァルキリー'} value="ヴァルキリー" selected="selected">ヴァルキリー</option>
									<option if={user.job!='ヴァルキリー'} value="ヴァルキリー">ヴァルキリー</option>
									<option if={user.job=='ジャイアント'} value="ジャイアント" selected="selected">ジャイアント</option>
									<option if={user.job!='ジャイアント'} value="ジャイアント">ジャイアント</option>
									<option if={user.job=='ウイッチ'} value="ウイッチ" selected="selected">ウイッチ</option>
									<option if={user.job!='ウイッチ'} value="ウイッチ">ウイッチ</option>
									<option if={user.job=='レンジャー'} value="レンジャー" selected="selected">レンジャー</option>
									<option if={user.job!='レンジャー'} value="レンジャー">レンジャー</option>
									<option if={user.job=='ブレイダー'} value="ブレイダー" selected="selected">ブレイダー</option>
									<option if={user.job!='ブレイダー'} value="ブレイダー">ブレイダー</option>
									<option if={user.job=='リトルサマナー'} value="リトルサマナー" selected="selected">リトルサマナー</option>
									<option if={user.job!='リトルサマナー'} value="リトルサマナー">リトルサマナー</option>
									<option if={user.job=='ソーサレス'} value="ソーサレス" selected="selected">ソーサレス</option>
									<option if={user.job!='ソーサレス'} value="ソーサレス">ソーサレス</option>
									<option if={user.job=='ウィザード'} value="ウィザード" selected="selected">ウィザード</option>
									<option if={user.job!='ウィザード'} value="ウィザード">ウィザード</option>
									<option if={user.job=='ツバキ'} value="ツバキ" selected="selected">ツバキ</option>
									<option if={user.job!='ツバキ'} value="ツバキ">ツバキ</option>
									<option if={user.job=='ニンジャ'} value="ニンジャ" selected="selected">ニンジャ</option>
									<option if={user.job!='ニンジャ'} value="ニンジャ">ニンジャ</option>
									<option if={user.job=='クノイチ'} value="クノイチ" selected="selected">クノイチ</option>
									<option if={user.job!='クノイチ'} value="クノイチ">クノイチ</option>
									<option if={user.job=='ミスティック'} value="ミスティック" selected="selected">ミスティック</option>
									<option if={user.job!='ミスティック'} value="ミスティック">ミスティック</option>
									<option if={user.job=='格闘家'} value="格闘家" selected="selected">格闘家</option>
									<option if={user.job!='格闘家'} value="格闘家">格闘家</option>
									<option if={user.job=='ダークナイト'} value="ダークナイト" selected="selected">ダークナイト</option>
									<option if={user.job!='ダークナイト'} value="ダークナイト">ダークナイト</option>
									<option if={user.job=='ラン'} value="ラン" selected="selected">ラン</option>
									<option if={user.job!='ラン'} value="ラン">ラン</option>
									<option if={user.job=='アーチャー'} value="アーチャー" selected="selected">アーチャー</option>
									<option if={user.job!='アーチャー'} value="アーチャー">アーチャー</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userjob3d">
									<option value="0">3次職未転職</option>
									<option if={user.job3d=='1'} value="1" selected="selected">3次職転職済</option>
									<option if={user.job3d!='1'} value="1">3次職転職済</option>
								</select>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{4,8}" name="usercp" value="{user.cp}" class="form-control" placeholder="戦闘力"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usersubjob">
									<option>デュアルクラス</option>
									<optgroup label="カマエル">
										<option if={user.subjob=='バーサーカー'} value="バーサーカー" selected="selected">{jobs['バーサーカー']}</option>
										<option if={user.subjob!='バーサーカー'} value="バーサーカー">{jobs['バーサーカー']}</option>
										<option if={user.subjob=='アヴァレスタ'} value="アヴァレスタ" selected="selected">{jobs['アヴァレスタ']}</option>
										<option if={user.subjob!='アヴァレスタ'} value="アヴァレスタ">{jobs['アヴァレスタ']}</option>
										<option if={user.subjob=='ソウルブレーカー'} value="ソウルブレーカー" selected="selected">{jobs['ソウルブレーカー']}</option>
										<option if={user.subjob!='ソウルブレーカー'} value="ソウルブレーカー">{jobs['ソウルブレーカー']}</option>
									</optgroup>
									<optgroup label="オーク">
										<option if={user.subjob=='オークレイダー'} value="オークレイダー" selected="selected">{jobs['オークレイダー']}</option>
										<option if={user.subjob!='オークレイダー'} value="オークレイダー">{jobs['オークレイダー']}</option>
										<option if={user.subjob=='オークモンク'} value="オークモンク" selected="selected">{jobs['オークモンク']}</option>
										<option if={user.subjob!='オークモンク'} value="オークモンク">{jobs['オークモンク']}</option>
										<option if={user.subjob=='オークシャーマン'} value="オークシャーマン" selected="selected">{jobs['オークシャーマン']}</option>
										<option if={user.subjob!='オークシャーマン'} value="オークシャーマン">{jobs['オークシャーマン']}</option>
									</optgroup>
									<optgroup label="ヒューマン">
										<option if={user.subjob=='パラディン'} value="パラディン" selected="selected">{jobs['パラディン']}</option>
										<option if={user.subjob!='パラディン'} value="パラディン">{jobs['パラディン']}</option>
										<option if={user.subjob=='ウォーロード'} value="ウォーロード" selected="selected">{jobs['ウォーロード']}</option>
										<option if={user.subjob!='ウォーロード'} value="ウォーロード">{jobs['ウォーロード']}</option>
										<option if={user.subjob=='トレジャーハンター'} value="トレジャーハンター" selected="selected">{jobs['トレジャーハンター']}</option>
										<option if={user.subjob!='トレジャーハンター'} value="トレジャーハンター">{jobs['トレジャーハンター']}</option>
										<option if={user.subjob=='ホークアイ'} value="ホークアイ" selected="selected">{jobs['ホークアイ']}</option>
										<option if={user.subjob!='ホークアイ'} value="ホークアイ">{jobs['ホークアイ']}</option>
										<option if={user.subjob=='ソーサラー'} value="ソーサラー" selected="selected">{jobs['ソーサラー']}</option>
										<option if={user.subjob!='ソーサラー'} value="ソーサラー">{jobs['ソーサラー']}</option>
										<option if={user.subjob=='ビショップ'} value="ビショップ" selected="selected">{jobs['ビショップ']}</option>
										<option if={user.subjob!='ビショップ'} value="ビショップ">{jobs['ビショップ']}</option>
									</optgroup>
									<optgroup label="エルフ">
										<option if={user.subjob=='テンプルナイト'} value="テンプルナイト" selected="selected">{jobs['テンプルナイト']}</option>
										<option if={user.subjob!='テンプルナイト'} value="テンプルナイト">{jobs['テンプルナイト']}</option>
										<option if={user.subjob=='ソードシンガー'} value="ソードシンガー" selected="selected">{jobs['ソードシンガー']}</option>
										<option if={user.subjob!='ソードシンガー'} value="ソードシンガー">{jobs['ソードシンガー']}</option>
										<option if={user.subjob=='プレインズウォーカー'} value="プレインズウォーカー" selected="selected">{jobs['プレインズウォーカー']}</option>
										<option if={user.subjob!='プレインズウォーカー'} value="プレインズウォーカー">{jobs['プレインズウォーカー']}</option>
										<option if={user.subjob=='シルバーレンジャー'} value="シルバーレンジャー" selected="selected">{jobs['シルバーレンジャー']}</option>
										<option if={user.subjob!='シルバーレンジャー'} value="シルバーレンジャー">{jobs['シルバーレンジャー']}</option>
										<option if={user.subjob=='スペルシンガー'} value="スペルシンガー" selected="selected">{jobs['スペルシンガー']}</option>
										<option if={user.subjob!='スペルシンガー'} value="スペルシンガー">{jobs['スペルシンガー']}</option>
										<option if={user.subjob=='エルダー'} value="エルダー" selected="selected">{jobs['エルダー']}</option>
										<option if={user.subjob!='エルダー'} value="エルダー">{jobs['エルダー']}</option>
									</optgroup>
									<optgroup label="ダークエルフ">
										<option if={user.subjob=='シリエンナイト'} value="シリエンナイト" selected="selected">{jobs['シリエンナイト']}</option>
										<option if={user.subjob!='シリエンナイト'} value="シリエンナイト">{jobs['シリエンナイト']}</option>
										<option if={user.subjob=='ブレードダンサー'} value="ブレードダンサー" selected="selected">{jobs['ブレードダンサー']}</option>
										<option if={user.subjob!='ブレードダンサー'} value="ブレードダンサー">{jobs['ブレードダンサー']}</option>
										<option if={user.subjob=='アビスウォーカー'} value="アビスウォーカー" selected="selected">{jobs['アビスウォーカー']}</option>
										<option if={user.subjob!='アビスウォーカー'} value="アビスウォーカー">{jobs['アビスウォーカー']}</option>
										<option if={user.subjob=='ファントムレンジャー'} value="ファントムレンジャー" selected="selected">{jobs['ファントムレンジャー']}</option>
										<option if={user.subjob!='ファントムレンジャー'} value="ファントムレンジャー">{jobs['ファントムレンジャー']}</option>
										<option if={user.subjob=='スペルハウラー'} value="スペルハウラー" selected="selected">{jobs['スペルハウラー']}</option>
										<option if={user.subjob!='スペルハウラー'} value="スペルハウラー">{jobs['スペルハウラー']}</option>
										<option if={user.subjob=='シリエンエルダー'} value="シリエンエルダー" selected="selected">{jobs['シリエンエルダー']}</option>
										<option if={user.subjob!='シリエンエルダー'} value="シリエンエルダー">{jobs['シリエンエルダー']}</option>
									</optgroup>
									<optgroup label="ドワーフ">
										<option if={user.subjob=='ガーディアン'} value="ガーディアン" selected="selected">{jobs['ガーディアン']}</option>
										<option if={user.subjob!='ガーディアン'} value="ガーディアン">{jobs['ガーディアン']}</option>
										<option if={user.subjob=='スレイヤー'} value="スレイヤー" selected="selected">{jobs['スレイヤー']}</option>
										<option if={user.subjob!='スレイヤー'} value="スレイヤー">{jobs['スレイヤー']}</option>
										<option if={user.subjob=='スカベンジャー'} value="スカベンジャー" selected="selected">{jobs['スカベンジャー']}</option>
										<option if={user.subjob!='スカベンジャー'} value="スカベンジャー">{jobs['スカベンジャー']}</option>
										<option if={user.subjob=='ウォーレンジャー'} value="ウォーレンジャー" selected="selected">{jobs['ウォーレンジャー']}</option>
										<option if={user.subjob!='ウォーレンジャー'} value="ウォーレンジャー">{jobs['ウォーレンジャー']}</option>
										<option if={user.subjob=='クォーラルウィザード'} value="クォーラルウィザード" selected="selected">{jobs['クォーラルウィザード']}</option>
										<option if={user.subjob!='クォーラルウィザード'} value="クォーラルウィザード">{jobs['クォーラルウィザード']}</option>
										<option if={user.subjob=='セイジ'} value="セイジ" selected="selected">{jobs['セイジ']}</option>
										<option if={user.subjob!='セイジ'} value="セイジ">{jobs['セイジ']}</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usersubjob3d">
									<option value="0">デュアルクラス3次職未転職</option>
									<option if={user.subjob3d=='1'} value="1" selected="selected">デュアルクラス3次職転職済</option>
									<option if={user.subjob3d!='1'} value="1">デュアルクラス3次職転職済</option>
								</select>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{4,8}" name="usersubcp" value="{user.subcp}" class="form-control" placeholder="デュアルクラス戦闘力"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{1,3}" name="userlevel" value="{user.level}" class="form-control" placeholder="レベル"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={mode==2} class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{1,3}" name="userspiritlevel" value="{user.spiritlevel}" class="form-control" placeholder="精霊レベル"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="discord" value="{user.discord}" class="form-control" placeholder="でぃすこ#4321"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="memo" value="{user.memo}" class="form-control" placeholder="なんでもメモ"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="useracce1">
									<option>装飾品</option>
									<optgroup label="エルヴン">
										<option if={user.acce1==79} value="79" selected="selected">エルヴン 平均特性10</option>
										<option if={user.acce1==78} value="78" selected="selected">エルヴン 平均特性9</option>
										<option if={user.acce1==77} value="77" selected="selected">エルヴン 平均特性8</option>
										<option if={user.acce1==76} value="76" selected="selected">エルヴン 平均特性7</option>
										<option if={user.acce1==75} value="75" selected="selected">エルヴン 平均特性6</option>
										<option if={user.acce1==74} value="74" selected="selected">エルヴン 平均特性5</option>
										<option if={user.acce1==73} value="73" selected="selected">エルヴン 平均特性4</option>
										<option if={user.acce1==72} value="72" selected="selected">エルヴン 平均特性3</option>
										<option if={user.acce1==71} value="71" selected="selected">エルヴン 平均特性2</option>
										<option if={user.acce1==70} value="70" selected="selected">エルヴン 平均特性1</option>
										<option if={user.acce1!=79} value="79">エルヴン 平均特性10</option>
										<option if={user.acce1!=78} value="78">エルヴン 平均特性9</option>
										<option if={user.acce1!=77} value="77">エルヴン 平均特性8</option>
										<option if={user.acce1!=76} value="76">エルヴン 平均特性7</option>
										<option if={user.acce1!=75} value="75">エルヴン 平均特性6</option>
										<option if={user.acce1!=74} value="74">エルヴン 平均特性5</option>
										<option if={user.acce1!=73} value="73">エルヴン 平均特性4</option>
										<option if={user.acce1!=72} value="72">エルヴン 平均特性3</option>
										<option if={user.acce1!=71} value="71">エルヴン 平均特性2</option>
										<option if={user.acce1!=70} value="70">エルヴン 平均特性1</option>
									</optgroup>
									<optgroup label="ナッセン">
										<option if={user.acce1==59} value="59" selected="selected">ナッセン 平均特性10</option>
										<option if={user.acce1==58} value="58" selected="selected">ナッセン 平均特性9</option>
										<option if={user.acce1==57} value="57" selected="selected">ナッセン 平均特性8</option>
										<option if={user.acce1==56} value="56" selected="selected">ナッセン 平均特性7</option>
										<option if={user.acce1==55} value="55" selected="selected">ナッセン 平均特性6</option>
										<option if={user.acce1==54} value="54" selected="selected">ナッセン 平均特性5</option>
										<option if={user.acce1==53} value="53" selected="selected">ナッセン 平均特性4</option>
										<option if={user.acce1==52} value="52" selected="selected">ナッセン 平均特性3</option>
										<option if={user.acce1==51} value="51" selected="selected">ナッセン 平均特性2</option>
										<option if={user.acce1==50} value="50" selected="selected">ナッセン 平均特性1</option>
										<option if={user.acce1!=59} value="59">ナッセン 平均特性10</option>
										<option if={user.acce1!=58} value="58">ナッセン 平均特性9</option>
										<option if={user.acce1!=57} value="57">ナッセン 平均特性8</option>
										<option if={user.acce1!=56} value="56">ナッセン 平均特性7</option>
										<option if={user.acce1!=55} value="55">ナッセン 平均特性6</option>
										<option if={user.acce1!=54} value="54">ナッセン 平均特性5</option>
										<option if={user.acce1!=53} value="53">ナッセン 平均特性4</option>
										<option if={user.acce1!=52} value="52">ナッセン 平均特性3</option>
										<option if={user.acce1!=51} value="51">ナッセン 平均特性2</option>
										<option if={user.acce1!=50} value="50">ナッセン 平均特性1</option>
									</optgroup>
									<optgroup label="カラ">
										<option if={user.acce1==69} value="69" selected="selected">カラ 平均特性10</option>
										<option if={user.acce1==68} value="68" selected="selected">カラ 平均特性9</option>
										<option if={user.acce1==67} value="67" selected="selected">カラ 平均特性8</option>
										<option if={user.acce1==66} value="66" selected="selected">カラ 平均特性7</option>
										<option if={user.acce1==65} value="65" selected="selected">カラ 平均特性6</option>
										<option if={user.acce1==64} value="64" selected="selected">カラ 平均特性5</option>
										<option if={user.acce1==63} value="63" selected="selected">カラ 平均特性4</option>
										<option if={user.acce1==62} value="62" selected="selected">カラ 平均特性3</option>
										<option if={user.acce1==61} value="61" selected="selected">カラ 平均特性2</option>
										<option if={user.acce1==60} value="69" selected="selected">カラ 平均特性1</option>
										<option if={user.acce1!=69} value="69">カラ 平均特性10</option>
										<option if={user.acce1!=68} value="68">カラ 平均特性9</option>
										<option if={user.acce1!=67} value="67">カラ 平均特性8</option>
										<option if={user.acce1!=66} value="66">カラ 平均特性7</option>
										<option if={user.acce1!=65} value="65">カラ 平均特性6</option>
										<option if={user.acce1!=64} value="64">カラ 平均特性5</option>
										<option if={user.acce1!=63} value="63">カラ 平均特性4</option>
										<option if={user.acce1!=62} value="62">カラ 平均特性3</option>
										<option if={user.acce1!=61} value="61">カラ 平均特性2</option>
										<option if={user.acce1!=60} value="60">カラ 平均特性1</option>
									</optgroup>
									<optgroup label="ブラックオール">
										<option if={user.acce1==39} value="39" selected="selected">ブラックオール 平均特性10</option>
										<option if={user.acce1==38} value="38" selected="selected">ブラックオール 平均特性9</option>
										<option if={user.acce1==37} value="37" selected="selected">ブラックオール 平均特性8</option>
										<option if={user.acce1==36} value="36" selected="selected">ブラックオール 平均特性7</option>
										<option if={user.acce1==35} value="35" selected="selected">ブラックオール 平均特性6</option>
										<option if={user.acce1==34} value="34" selected="selected">ブラックオール 平均特性5</option>
										<option if={user.acce1==33} value="33" selected="selected">ブラックオール 平均特性4</option>
										<option if={user.acce1==32} value="32" selected="selected">ブラックオール 平均特性3</option>
										<option if={user.acce1==31} value="31" selected="selected">ブラックオール 平均特性2</option>
										<option if={user.acce1==30} value="30" selected="selected">ブラックオール 平均特性1</option>
										<option if={user.acce1!=39} value="39">ブラックオール 平均特性10</option>
										<option if={user.acce1!=38} value="38">ブラックオール 平均特性9</option>
										<option if={user.acce1!=37} value="37">ブラックオール 平均特性8</option>
										<option if={user.acce1!=36} value="36">ブラックオール 平均特性7</option>
										<option if={user.acce1!=35} value="35">ブラックオール 平均特性6</option>
										<option if={user.acce1!=34} value="34">ブラックオール 平均特性5</option>
										<option if={user.acce1!=33} value="33">ブラックオール 平均特性4</option>
										<option if={user.acce1!=32} value="32">ブラックオール 平均特性3</option>
										<option if={user.acce1!=31} value="31">ブラックオール 平均特性2</option>
										<option if={user.acce1!=30} value="30">ブラックオール 平均特性1</option>
									</optgroup>
									<optgroup label="魔女">
										<option if={user.acce1==89} value="89" selected="selected">魔女 平均特性10</option>
										<option if={user.acce1==88} value="88" selected="selected">魔女 平均特性9</option>
										<option if={user.acce1==87} value="87" selected="selected">魔女 平均特性8</option>
										<option if={user.acce1==86} value="86" selected="selected">魔女 平均特性7</option>
										<option if={user.acce1==85} value="85" selected="selected">魔女 平均特性6</option>
										<option if={user.acce1==84} value="84" selected="selected">魔女 平均特性5</option>
										<option if={user.acce1==83} value="83" selected="selected">魔女 平均特性4</option>
										<option if={user.acce1==82} value="82" selected="selected">魔女 平均特性3</option>
										<option if={user.acce1==81} value="81" selected="selected">魔女 平均特性2</option>
										<option if={user.acce1==80} value="80" selected="selected">魔女 平均特性1</option>
										<option if={user.acce1!=89} value="89">魔女 平均特性10</option>
										<option if={user.acce1!=88} value="88">魔女 平均特性9</option>
										<option if={user.acce1!=87} value="87">魔女 平均特性8</option>
										<option if={user.acce1!=86} value="86">魔女 平均特性7</option>
										<option if={user.acce1!=85} value="85">魔女 平均特性6</option>
										<option if={user.acce1!=84} value="84">魔女 平均特性5</option>
										<option if={user.acce1!=83} value="83">魔女 平均特性4</option>
										<option if={user.acce1!=82} value="82">魔女 平均特性3</option>
										<option if={user.acce1!=81} value="81">魔女 平均特性2</option>
										<option if={user.acce1!=80} value="80">魔女 平均特性1</option>
									</optgroup>
									<optgroup label="アルボール">
										<option if={user.acce1==29} value="29" selected="selected">アルボール 平均特性10</option>
										<option if={user.acce1==28} value="28" selected="selected">アルボール 平均特性9</option>
										<option if={user.acce1==27} value="27" selected="selected">アルボール 平均特性8</option>
										<option if={user.acce1==26} value="26" selected="selected">アルボール 平均特性7</option>
										<option if={user.acce1==25} value="25" selected="selected">アルボール 平均特性6</option>
										<option if={user.acce1==24} value="24" selected="selected">アルボール 平均特性5</option>
										<option if={user.acce1==23} value="23" selected="selected">アルボール 平均特性4</option>
										<option if={user.acce1==22} value="22" selected="selected">アルボール 平均特性3</option>
										<option if={user.acce1==21} value="21" selected="selected">アルボール 平均特性2</option>
										<option if={user.acce1==20} value="20" selected="selected">アルボール 平均特性1</option>
										<option if={user.acce1!=29} value="29">アルボール 平均特性10</option>
										<option if={user.acce1!=28} value="28">アルボール 平均特性9</option>
										<option if={user.acce1!=27} value="27">アルボール 平均特性8</option>
										<option if={user.acce1!=26} value="26">アルボール 平均特性7</option>
										<option if={user.acce1!=25} value="25">アルボール 平均特性6</option>
										<option if={user.acce1!=24} value="24">アルボール 平均特性5</option>
										<option if={user.acce1!=23} value="23">アルボール 平均特性4</option>
										<option if={user.acce1!=22} value="22">アルボール 平均特性3</option>
										<option if={user.acce1!=21} value="21">アルボール 平均特性2</option>
										<option if={user.acce1!=20} value="20">アルボール 平均特性1</option>
									</optgroup>
									<optgroup label="フェニックス">
										<option if={user.acce1==19} value="19" selected="selected">フェニックス 平均特性10</option>
										<option if={user.acce1==18} value="18" selected="selected">フェニックス 平均特性9</option>
										<option if={user.acce1==17} value="17" selected="selected">フェニックス 平均特性8</option>
										<option if={user.acce1==16} value="16" selected="selected">フェニックス 平均特性7</option>
										<option if={user.acce1==15} value="15" selected="selected">フェニックス 平均特性6</option>
										<option if={user.acce1==14} value="14" selected="selected">フェニックス 平均特性5</option>
										<option if={user.acce1==13} value="13" selected="selected">フェニックス 平均特性4</option>
										<option if={user.acce1==12} value="12" selected="selected">フェニックス 平均特性3</option>
										<option if={user.acce1==11} value="11" selected="selected">フェニックス 平均特性2</option>
										<option if={user.acce1==10} value="10" selected="selected">フェニックス 平均特性1</option>
										<option if={user.acce1!=19} value="19">フェニックス 平均特性10</option>
										<option if={user.acce1!=18} value="18">フェニックス 平均特性9</option>
										<option if={user.acce1!=17} value="17">フェニックス 平均特性8</option>
										<option if={user.acce1!=16} value="16">フェニックス 平均特性7</option>
										<option if={user.acce1!=15} value="15">フェニックス 平均特性6</option>
										<option if={user.acce1!=14} value="14">フェニックス 平均特性5</option>
										<option if={user.acce1!=13} value="13">フェニックス 平均特性4</option>
										<option if={user.acce1!=12} value="12">フェニックス 平均特性3</option>
										<option if={user.acce1!=11} value="11">フェニックス 平均特性2</option>
										<option if={user.acce1!=10} value="10">フェニックス 平均特性1</option>
									</optgroup>
									<optgroup label="ムーンストーン">
										<option if={user.acce1==49} value="49" selected="selected">ムーンストーン 平均特性10</option>
										<option if={user.acce1==48} value="48" selected="selected">ムーンストーン 平均特性9</option>
										<option if={user.acce1==47} value="47" selected="selected">ムーンストーン 平均特性8</option>
										<option if={user.acce1==46} value="46" selected="selected">ムーンストーン 平均特性7</option>
										<option if={user.acce1==45} value="45" selected="selected">ムーンストーン 平均特性6</option>
										<option if={user.acce1==44} value="44" selected="selected">ムーンストーン 平均特性5</option>
										<option if={user.acce1==43} value="43" selected="selected">ムーンストーン 平均特性4</option>
										<option if={user.acce1==42} value="42" selected="selected">ムーンストーン 平均特性3</option>
										<option if={user.acce1==41} value="41" selected="selected">ムーンストーン 平均特性2</option>
										<option if={user.acce1==40} value="40" selected="selected">ムーンストーン 平均特性1</option>
										<option if={user.acce1!=49} value="49">ムーンストーン 平均特性10</option>
										<option if={user.acce1!=48} value="48">ムーンストーン 平均特性9</option>
										<option if={user.acce1!=47} value="47">ムーンストーン 平均特性8</option>
										<option if={user.acce1!=46} value="46">ムーンストーン 平均特性7</option>
										<option if={user.acce1!=45} value="45">ムーンストーン 平均特性6</option>
										<option if={user.acce1!=44} value="44">ムーンストーン 平均特性5</option>
										<option if={user.acce1!=43} value="43">ムーンストーン 平均特性4</option>
										<option if={user.acce1!=42} value="42">ムーンストーン 平均特性3</option>
										<option if={user.acce1!=41} value="41">ムーンストーン 平均特性2</option>
										<option if={user.acce1!=40} value="40">ムーンストーン 平均特性1</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="useracce2">
									<option>サブ装飾品</option>
									<optgroup label="エルヴン">
										<option if={user.acce2==79} value="79" selected="selected">エルヴン 平均特性10</option>
										<option if={user.acce2==78} value="78" selected="selected">エルヴン 平均特性9</option>
										<option if={user.acce2==77} value="77" selected="selected">エルヴン 平均特性8</option>
										<option if={user.acce2==76} value="76" selected="selected">エルヴン 平均特性7</option>
										<option if={user.acce2==75} value="75" selected="selected">エルヴン 平均特性6</option>
										<option if={user.acce2==74} value="74" selected="selected">エルヴン 平均特性5</option>
										<option if={user.acce2==73} value="73" selected="selected">エルヴン 平均特性4</option>
										<option if={user.acce2==72} value="72" selected="selected">エルヴン 平均特性3</option>
										<option if={user.acce2==71} value="71" selected="selected">エルヴン 平均特性2</option>
										<option if={user.acce2==70} value="70" selected="selected">エルヴン 平均特性1</option>
										<option if={user.acce2!=79} value="79">エルヴン 平均特性10</option>
										<option if={user.acce2!=78} value="78">エルヴン 平均特性9</option>
										<option if={user.acce2!=77} value="77">エルヴン 平均特性8</option>
										<option if={user.acce2!=76} value="76">エルヴン 平均特性7</option>
										<option if={user.acce2!=75} value="75">エルヴン 平均特性6</option>
										<option if={user.acce2!=74} value="74">エルヴン 平均特性5</option>
										<option if={user.acce2!=73} value="73">エルヴン 平均特性4</option>
										<option if={user.acce2!=72} value="72">エルヴン 平均特性3</option>
										<option if={user.acce2!=71} value="71">エルヴン 平均特性2</option>
										<option if={user.acce2!=70} value="70">エルヴン 平均特性1</option>
									</optgroup>
									<optgroup label="ナッセン">
										<option if={user.acce2==59} value="59" selected="selected">ナッセン 平均特性10</option>
										<option if={user.acce2==58} value="58" selected="selected">ナッセン 平均特性9</option>
										<option if={user.acce2==57} value="57" selected="selected">ナッセン 平均特性8</option>
										<option if={user.acce2==56} value="56" selected="selected">ナッセン 平均特性7</option>
										<option if={user.acce2==55} value="55" selected="selected">ナッセン 平均特性6</option>
										<option if={user.acce2==54} value="54" selected="selected">ナッセン 平均特性5</option>
										<option if={user.acce2==53} value="53" selected="selected">ナッセン 平均特性4</option>
										<option if={user.acce2==52} value="52" selected="selected">ナッセン 平均特性3</option>
										<option if={user.acce2==51} value="51" selected="selected">ナッセン 平均特性2</option>
										<option if={user.acce2==50} value="50" selected="selected">ナッセン 平均特性1</option>
										<option if={user.acce2!=59} value="59">ナッセン 平均特性10</option>
										<option if={user.acce2!=58} value="58">ナッセン 平均特性9</option>
										<option if={user.acce2!=57} value="57">ナッセン 平均特性8</option>
										<option if={user.acce2!=56} value="56">ナッセン 平均特性7</option>
										<option if={user.acce2!=55} value="55">ナッセン 平均特性6</option>
										<option if={user.acce2!=54} value="54">ナッセン 平均特性5</option>
										<option if={user.acce2!=53} value="53">ナッセン 平均特性4</option>
										<option if={user.acce2!=52} value="52">ナッセン 平均特性3</option>
										<option if={user.acce2!=51} value="51">ナッセン 平均特性2</option>
										<option if={user.acce2!=50} value="50">ナッセン 平均特性1</option>
									</optgroup>
									<optgroup label="カラ">
										<option if={user.acce2==69} value="69" selected="selected">カラ 平均特性10</option>
										<option if={user.acce2==68} value="68" selected="selected">カラ 平均特性9</option>
										<option if={user.acce2==67} value="67" selected="selected">カラ 平均特性8</option>
										<option if={user.acce2==66} value="66" selected="selected">カラ 平均特性7</option>
										<option if={user.acce2==65} value="65" selected="selected">カラ 平均特性6</option>
										<option if={user.acce2==64} value="64" selected="selected">カラ 平均特性5</option>
										<option if={user.acce2==63} value="63" selected="selected">カラ 平均特性4</option>
										<option if={user.acce2==62} value="62" selected="selected">カラ 平均特性3</option>
										<option if={user.acce2==61} value="61" selected="selected">カラ 平均特性2</option>
										<option if={user.acce2==60} value="69" selected="selected">カラ 平均特性1</option>
										<option if={user.acce2!=69} value="69">カラ 平均特性10</option>
										<option if={user.acce2!=68} value="68">カラ 平均特性9</option>
										<option if={user.acce2!=67} value="67">カラ 平均特性8</option>
										<option if={user.acce2!=66} value="66">カラ 平均特性7</option>
										<option if={user.acce2!=65} value="65">カラ 平均特性6</option>
										<option if={user.acce2!=64} value="64">カラ 平均特性5</option>
										<option if={user.acce2!=63} value="63">カラ 平均特性4</option>
										<option if={user.acce2!=62} value="62">カラ 平均特性3</option>
										<option if={user.acce2!=61} value="61">カラ 平均特性2</option>
										<option if={user.acce2!=60} value="60">カラ 平均特性1</option>
									</optgroup>
									<optgroup label="ブラックオール">
										<option if={user.acce2==39} value="39" selected="selected">ブラックオール 平均特性10</option>
										<option if={user.acce2==38} value="38" selected="selected">ブラックオール 平均特性9</option>
										<option if={user.acce2==37} value="37" selected="selected">ブラックオール 平均特性8</option>
										<option if={user.acce2==36} value="36" selected="selected">ブラックオール 平均特性7</option>
										<option if={user.acce2==35} value="35" selected="selected">ブラックオール 平均特性6</option>
										<option if={user.acce2==34} value="34" selected="selected">ブラックオール 平均特性5</option>
										<option if={user.acce2==33} value="33" selected="selected">ブラックオール 平均特性4</option>
										<option if={user.acce2==32} value="32" selected="selected">ブラックオール 平均特性3</option>
										<option if={user.acce2==31} value="31" selected="selected">ブラックオール 平均特性2</option>
										<option if={user.acce2==30} value="30" selected="selected">ブラックオール 平均特性1</option>
										<option if={user.acce2!=39} value="39">ブラックオール 平均特性10</option>
										<option if={user.acce2!=38} value="38">ブラックオール 平均特性9</option>
										<option if={user.acce2!=37} value="37">ブラックオール 平均特性8</option>
										<option if={user.acce2!=36} value="36">ブラックオール 平均特性7</option>
										<option if={user.acce2!=35} value="35">ブラックオール 平均特性6</option>
										<option if={user.acce2!=34} value="34">ブラックオール 平均特性5</option>
										<option if={user.acce2!=33} value="33">ブラックオール 平均特性4</option>
										<option if={user.acce2!=32} value="32">ブラックオール 平均特性3</option>
										<option if={user.acce2!=31} value="31">ブラックオール 平均特性2</option>
										<option if={user.acce2!=30} value="30">ブラックオール 平均特性1</option>
									</optgroup>
									<optgroup label="魔女">
										<option if={user.acce2==89} value="89" selected="selected">魔女 平均特性10</option>
										<option if={user.acce2==88} value="88" selected="selected">魔女 平均特性9</option>
										<option if={user.acce2==87} value="87" selected="selected">魔女 平均特性8</option>
										<option if={user.acce2==86} value="86" selected="selected">魔女 平均特性7</option>
										<option if={user.acce2==85} value="85" selected="selected">魔女 平均特性6</option>
										<option if={user.acce2==84} value="84" selected="selected">魔女 平均特性5</option>
										<option if={user.acce2==83} value="83" selected="selected">魔女 平均特性4</option>
										<option if={user.acce2==82} value="82" selected="selected">魔女 平均特性3</option>
										<option if={user.acce2==81} value="81" selected="selected">魔女 平均特性2</option>
										<option if={user.acce2==80} value="80" selected="selected">魔女 平均特性1</option>
										<option if={user.acce2!=89} value="89">魔女 平均特性10</option>
										<option if={user.acce2!=88} value="88">魔女 平均特性9</option>
										<option if={user.acce2!=87} value="87">魔女 平均特性8</option>
										<option if={user.acce2!=86} value="86">魔女 平均特性7</option>
										<option if={user.acce2!=85} value="85">魔女 平均特性6</option>
										<option if={user.acce2!=84} value="84">魔女 平均特性5</option>
										<option if={user.acce2!=83} value="83">魔女 平均特性4</option>
										<option if={user.acce2!=82} value="82">魔女 平均特性3</option>
										<option if={user.acce2!=81} value="81">魔女 平均特性2</option>
										<option if={user.acce2!=80} value="80">魔女 平均特性1</option>
									</optgroup>
									<optgroup label="アルボール">
										<option if={user.acce2==29} value="29" selected="selected">アルボール 平均特性10</option>
										<option if={user.acce2==28} value="28" selected="selected">アルボール 平均特性9</option>
										<option if={user.acce2==27} value="27" selected="selected">アルボール 平均特性8</option>
										<option if={user.acce2==26} value="26" selected="selected">アルボール 平均特性7</option>
										<option if={user.acce2==25} value="25" selected="selected">アルボール 平均特性6</option>
										<option if={user.acce2==24} value="24" selected="selected">アルボール 平均特性5</option>
										<option if={user.acce2==23} value="23" selected="selected">アルボール 平均特性4</option>
										<option if={user.acce2==22} value="22" selected="selected">アルボール 平均特性3</option>
										<option if={user.acce2==21} value="21" selected="selected">アルボール 平均特性2</option>
										<option if={user.acce2==20} value="20" selected="selected">アルボール 平均特性1</option>
										<option if={user.acce2!=29} value="29">アルボール 平均特性10</option>
										<option if={user.acce2!=28} value="28">アルボール 平均特性9</option>
										<option if={user.acce2!=27} value="27">アルボール 平均特性8</option>
										<option if={user.acce2!=26} value="26">アルボール 平均特性7</option>
										<option if={user.acce2!=25} value="25">アルボール 平均特性6</option>
										<option if={user.acce2!=24} value="24">アルボール 平均特性5</option>
										<option if={user.acce2!=23} value="23">アルボール 平均特性4</option>
										<option if={user.acce2!=22} value="22">アルボール 平均特性3</option>
										<option if={user.acce2!=21} value="21">アルボール 平均特性2</option>
										<option if={user.acce2!=20} value="20">アルボール 平均特性1</option>
									</optgroup>
									<optgroup label="フェニックス">
										<option if={user.acce2==19} value="19" selected="selected">フェニックス 平均特性10</option>
										<option if={user.acce2==18} value="18" selected="selected">フェニックス 平均特性9</option>
										<option if={user.acce2==17} value="17" selected="selected">フェニックス 平均特性8</option>
										<option if={user.acce2==16} value="16" selected="selected">フェニックス 平均特性7</option>
										<option if={user.acce2==15} value="15" selected="selected">フェニックス 平均特性6</option>
										<option if={user.acce2==14} value="14" selected="selected">フェニックス 平均特性5</option>
										<option if={user.acce2==13} value="13" selected="selected">フェニックス 平均特性4</option>
										<option if={user.acce2==12} value="12" selected="selected">フェニックス 平均特性3</option>
										<option if={user.acce2==11} value="11" selected="selected">フェニックス 平均特性2</option>
										<option if={user.acce2==10} value="10" selected="selected">フェニックス 平均特性1</option>
										<option if={user.acce2!=19} value="19">フェニックス 平均特性10</option>
										<option if={user.acce2!=18} value="18">フェニックス 平均特性9</option>
										<option if={user.acce2!=17} value="17">フェニックス 平均特性8</option>
										<option if={user.acce2!=16} value="16">フェニックス 平均特性7</option>
										<option if={user.acce2!=15} value="15">フェニックス 平均特性6</option>
										<option if={user.acce2!=14} value="14">フェニックス 平均特性5</option>
										<option if={user.acce2!=13} value="13">フェニックス 平均特性4</option>
										<option if={user.acce2!=12} value="12">フェニックス 平均特性3</option>
										<option if={user.acce2!=11} value="11">フェニックス 平均特性2</option>
										<option if={user.acce2!=10} value="10">フェニックス 平均特性1</option>
									</optgroup>
									<optgroup label="ムーンストーン">
										<option if={user.acce2==49} value="49" selected="selected">ムーンストーン 平均特性10</option>
										<option if={user.acce2==48} value="48" selected="selected">ムーンストーン 平均特性9</option>
										<option if={user.acce2==47} value="47" selected="selected">ムーンストーン 平均特性8</option>
										<option if={user.acce2==46} value="46" selected="selected">ムーンストーン 平均特性7</option>
										<option if={user.acce2==45} value="45" selected="selected">ムーンストーン 平均特性6</option>
										<option if={user.acce2==44} value="44" selected="selected">ムーンストーン 平均特性5</option>
										<option if={user.acce2==43} value="43" selected="selected">ムーンストーン 平均特性4</option>
										<option if={user.acce2==42} value="42" selected="selected">ムーンストーン 平均特性3</option>
										<option if={user.acce2==41} value="41" selected="selected">ムーンストーン 平均特性2</option>
										<option if={user.acce2==40} value="40" selected="selected">ムーンストーン 平均特性1</option>
										<option if={user.acce2!=49} value="49">ムーンストーン 平均特性10</option>
										<option if={user.acce2!=48} value="48">ムーンストーン 平均特性9</option>
										<option if={user.acce2!=47} value="47">ムーンストーン 平均特性8</option>
										<option if={user.acce2!=46} value="46">ムーンストーン 平均特性7</option>
										<option if={user.acce2!=45} value="45">ムーンストーン 平均特性6</option>
										<option if={user.acce2!=44} value="44">ムーンストーン 平均特性5</option>
										<option if={user.acce2!=43} value="43">ムーンストーン 平均特性4</option>
										<option if={user.acce2!=42} value="42">ムーンストーン 平均特性3</option>
										<option if={user.acce2!=41} value="41">ムーンストーン 平均特性2</option>
										<option if={user.acce2!=40} value="40">ムーンストーン 平均特性1</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userbukicos">
									<option value="">武器コス</option>
									<optgroup label="ブラスバンド">
										<option if={user.bukicos=='楽団10'} value="楽団10" selected="selected">ブラスバンド 特性Lv10</option>
										<option if={user.bukicos=='楽団9'} value="楽団9" selected="selected">ブラスバンド 特性Lv9</option>
										<option if={user.bukicos=='楽団8'} value="楽団8" selected="selected">ブラスバンド 特性Lv8</option>
										<option if={user.bukicos=='楽団7'} value="楽団7" selected="selected">ブラスバンド 特性Lv7</option>
										<option if={user.bukicos=='楽団6'} value="楽団6" selected="selected">ブラスバンド 特性Lv6</option>
										<option if={user.bukicos=='楽団5'} value="楽団5" selected="selected">ブラスバンド 特性Lv5</option>
										<option if={user.bukicos=='楽団4'} value="楽団4" selected="selected">ブラスバンド 特性Lv4</option>
										<option if={user.bukicos=='楽団3'} value="楽団3" selected="selected">ブラスバンド 特性Lv3</option>
										<option if={user.bukicos=='楽団2'} value="楽団2" selected="selected">ブラスバンド 特性Lv2</option>
										<option if={user.bukicos=='楽団1'} value="楽団1" selected="selected">ブラスバンド 特性Lv1</option>
										<option if={user.bukicos!='楽団10'} value="楽団10">ブラスバンド 特性Lv10</option>
										<option if={user.bukicos!='楽団9'} value="楽団9">ブラスバンド 特性Lv9</option>
										<option if={user.bukicos!='楽団8'} value="楽団8">ブラスバンド 特性Lv8</option>
										<option if={user.bukicos!='楽団7'} value="楽団7">ブラスバンド 特性Lv7</option>
										<option if={user.bukicos!='楽団6'} value="楽団6">ブラスバンド 特性Lv6</option>
										<option if={user.bukicos!='楽団5'} value="楽団5">ブラスバンド 特性Lv5</option>
										<option if={user.bukicos!='楽団4'} value="楽団4">ブラスバンド 特性Lv4</option>
										<option if={user.bukicos!='楽団3'} value="楽団3">ブラスバンド 特性Lv3</option>
										<option if={user.bukicos!='楽団2'} value="楽団2">ブラスバンド 特性Lv2</option>
										<option if={user.bukicos!='楽団1'} value="楽団1">ブラスバンド 特性Lv1</option>
									</optgroup>
									<optgroup label="海賊王">
										<option if={user.bukicos=='海賊10'} value="海賊10" selected="selected">海賊王 特性Lv10</option>
										<option if={user.bukicos=='海賊9'} value="海賊9" selected="selected">海賊王 特性Lv9</option>
										<option if={user.bukicos=='海賊8'} value="海賊8" selected="selected">海賊王 特性Lv8</option>
										<option if={user.bukicos=='海賊7'} value="海賊7" selected="selected">海賊王 特性Lv7</option>
										<option if={user.bukicos=='海賊6'} value="海賊6" selected="selected">海賊王 特性Lv6</option>
										<option if={user.bukicos=='海賊5'} value="海賊5" selected="selected">海賊王 特性Lv5</option>
										<option if={user.bukicos=='海賊4'} value="海賊4" selected="selected">海賊王 特性Lv4</option>
										<option if={user.bukicos=='海賊3'} value="海賊3" selected="selected">海賊王 特性Lv3</option>
										<option if={user.bukicos=='海賊2'} value="海賊2" selected="selected">海賊王 特性Lv2</option>
										<option if={user.bukicos=='海賊1'} value="海賊1" selected="selected">海賊王 特性Lv1</option>
										<option if={user.bukicos!='海賊10'} value="海賊10">海賊王 特性Lv10</option>
										<option if={user.bukicos!='海賊9'} value="海賊9">海賊王 特性Lv9</option>
										<option if={user.bukicos!='海賊8'} value="海賊8">海賊王 特性Lv8</option>
										<option if={user.bukicos!='海賊7'} value="海賊7">海賊王 特性Lv7</option>
										<option if={user.bukicos!='海賊6'} value="海賊6">海賊王 特性Lv6</option>
										<option if={user.bukicos!='海賊5'} value="海賊5">海賊王 特性Lv5</option>
										<option if={user.bukicos!='海賊4'} value="海賊4">海賊王 特性Lv4</option>
										<option if={user.bukicos!='海賊3'} value="海賊3">海賊王 特性Lv3</option>
										<option if={user.bukicos!='海賊2'} value="海賊2">海賊王 特性Lv2</option>
										<option if={user.bukicos!='海賊1'} value="海賊1">海賊王 特性Lv1</option>
									</optgroup>
									<optgroup label="百鬼夜行">
										<option if={user.bukicos=='百鬼10'} value="百鬼10" selected="selected">百鬼夜行 特性Lv10</option>
										<option if={user.bukicos=='百鬼9'} value="百鬼9" selected="selected">百鬼夜行 特性Lv9</option>
										<option if={user.bukicos=='百鬼8'} value="百鬼8" selected="selected">百鬼夜行 特性Lv8</option>
										<option if={user.bukicos=='百鬼7'} value="百鬼7" selected="selected">百鬼夜行 特性Lv7</option>
										<option if={user.bukicos=='百鬼6'} value="百鬼6" selected="selected">百鬼夜行 特性Lv6</option>
										<option if={user.bukicos=='百鬼5'} value="百鬼5" selected="selected">百鬼夜行 特性Lv5</option>
										<option if={user.bukicos=='百鬼4'} value="百鬼4" selected="selected">百鬼夜行 特性Lv4</option>
										<option if={user.bukicos=='百鬼3'} value="百鬼3" selected="selected">百鬼夜行 特性Lv3</option>
										<option if={user.bukicos=='百鬼2'} value="百鬼2" selected="selected">百鬼夜行 特性Lv2</option>
										<option if={user.bukicos=='百鬼1'} value="百鬼1" selected="selected">百鬼夜行 特性Lv1</option>
										<option if={user.bukicos!='百鬼10'} value="百鬼10">百鬼夜行 特性Lv10</option>
										<option if={user.bukicos!='百鬼9'} value="百鬼9">百鬼夜行 特性Lv9</option>
										<option if={user.bukicos!='百鬼8'} value="百鬼8">百鬼夜行 特性Lv8</option>
										<option if={user.bukicos!='百鬼7'} value="百鬼7">百鬼夜行 特性Lv7</option>
										<option if={user.bukicos!='百鬼6'} value="百鬼6">百鬼夜行 特性Lv6</option>
										<option if={user.bukicos!='百鬼5'} value="百鬼5">百鬼夜行 特性Lv5</option>
										<option if={user.bukicos!='百鬼4'} value="百鬼4">百鬼夜行 特性Lv4</option>
										<option if={user.bukicos!='百鬼3'} value="百鬼3">百鬼夜行 特性Lv3</option>
										<option if={user.bukicos!='百鬼2'} value="百鬼2">百鬼夜行 特性Lv2</option>
										<option if={user.bukicos!='百鬼1'} value="百鬼1">百鬼夜行 特性Lv1</option>
									</optgroup>
									<optgroup label="トラベラーズ">
										<option if={user.bukicos=='旅人10'} value="旅人10" selected="selected">トラベラーズ 特性Lv10</option>
										<option if={user.bukicos=='旅人9'} value="旅人9" selected="selected">トラベラーズ 特性Lv9</option>
										<option if={user.bukicos=='旅人8'} value="旅人8" selected="selected">トラベラーズ 特性Lv8</option>
										<option if={user.bukicos=='旅人7'} value="旅人7" selected="selected">トラベラーズ 特性Lv7</option>
										<option if={user.bukicos=='旅人6'} value="旅人6" selected="selected">トラベラーズ 特性Lv6</option>
										<option if={user.bukicos=='旅人5'} value="旅人5" selected="selected">トラベラーズ 特性Lv5</option>
										<option if={user.bukicos=='旅人4'} value="旅人4" selected="selected">トラベラーズ 特性Lv4</option>
										<option if={user.bukicos=='旅人3'} value="旅人3" selected="selected">トラベラーズ 特性Lv3</option>
										<option if={user.bukicos=='旅人2'} value="旅人2" selected="selected">トラベラーズ 特性Lv2</option>
										<option if={user.bukicos=='旅人1'} value="旅人1" selected="selected">トラベラーズ 特性Lv1</option>
										<option if={user.bukicos!='旅人10'} value="旅人10">トラベラーズ 特性Lv10</option>
										<option if={user.bukicos!='旅人9'} value="旅人9">トラベラーズ 特性Lv9</option>
										<option if={user.bukicos!='旅人8'} value="旅人8">トラベラーズ 特性Lv8</option>
										<option if={user.bukicos!='旅人7'} value="旅人7">トラベラーズ 特性Lv7</option>
										<option if={user.bukicos!='旅人6'} value="旅人6">トラベラーズ 特性Lv6</option>
										<option if={user.bukicos!='旅人5'} value="旅人5">トラベラーズ 特性Lv5</option>
										<option if={user.bukicos!='旅人4'} value="旅人4">トラベラーズ 特性Lv4</option>
										<option if={user.bukicos!='旅人3'} value="旅人3">トラベラーズ 特性Lv3</option>
										<option if={user.bukicos!='旅人2'} value="旅人2">トラベラーズ 特性Lv2</option>
										<option if={user.bukicos!='旅人1'} value="旅人1">トラベラーズ 特性Lv1</option>
									</optgroup>
									<optgroup label="ハロウィン">
										<option if={user.bukicos=='カボ10'} value="カボ10" selected="selected">ハロウィン 特性Lv10</option>
										<option if={user.bukicos=='カボ9'} value="カボ9" selected="selected">ハロウィン 特性Lv9</option>
										<option if={user.bukicos=='カボ8'} value="カボ8" selected="selected">ハロウィン 特性Lv8</option>
										<option if={user.bukicos=='カボ7'} value="カボ7" selected="selected">ハロウィン 特性Lv7</option>
										<option if={user.bukicos=='カボ6'} value="カボ6" selected="selected">ハロウィン 特性Lv6</option>
										<option if={user.bukicos=='カボ5'} value="カボ5" selected="selected">ハロウィン 特性Lv5</option>
										<option if={user.bukicos=='カボ4'} value="カボ4" selected="selected">ハロウィン 特性Lv4</option>
										<option if={user.bukicos=='カボ3'} value="カボ3" selected="selected">ハロウィン 特性Lv3</option>
										<option if={user.bukicos=='カボ2'} value="カボ2" selected="selected">ハロウィン 特性Lv2</option>
										<option if={user.bukicos=='カボ1'} value="カボ1" selected="selected">ハロウィン 特性Lv1</option>
										<option if={user.bukicos!='カボ10'} value="カボ10">ハロウィン 特性Lv10</option>
										<option if={user.bukicos!='カボ9'} value="カボ9">ハロウィン 特性Lv9</option>
										<option if={user.bukicos!='カボ8'} value="カボ8">ハロウィン 特性Lv8</option>
										<option if={user.bukicos!='カボ7'} value="カボ7">ハロウィン 特性Lv7</option>
										<option if={user.bukicos!='カボ6'} value="カボ6">ハロウィン 特性Lv6</option>
										<option if={user.bukicos!='カボ5'} value="カボ5">ハロウィン 特性Lv5</option>
										<option if={user.bukicos!='カボ4'} value="カボ4">ハロウィン 特性Lv4</option>
										<option if={user.bukicos!='カボ3'} value="カボ3">ハロウィン 特性Lv3</option>
										<option if={user.bukicos!='カボ2'} value="カボ2">ハロウィン 特性Lv2</option>
										<option if={user.bukicos!='カボ1'} value="カボ1">ハロウィン 特性Lv1</option>
									</optgroup>
									<optgroup label="アイスエッジ">
										<option if={user.bukicos=='氷刃10'} value="氷刃10" selected="selected">アイスエッジ 特性Lv10</option>
										<option if={user.bukicos=='氷刃9'} value="氷刃9" selected="selected">アイスエッジ 特性Lv9</option>
										<option if={user.bukicos=='氷刃8'} value="氷刃8" selected="selected">アイスエッジ 特性Lv8</option>
										<option if={user.bukicos=='氷刃7'} value="氷刃7" selected="selected">アイスエッジ 特性Lv7</option>
										<option if={user.bukicos=='氷刃6'} value="氷刃6" selected="selected">アイスエッジ 特性Lv6</option>
										<option if={user.bukicos=='氷刃5'} value="氷刃5" selected="selected">アイスエッジ 特性Lv5</option>
										<option if={user.bukicos=='氷刃4'} value="氷刃4" selected="selected">アイスエッジ 特性Lv4</option>
										<option if={user.bukicos=='氷刃3'} value="氷刃3" selected="selected">アイスエッジ 特性Lv3</option>
										<option if={user.bukicos=='氷刃2'} value="氷刃2" selected="selected">アイスエッジ 特性Lv2</option>
										<option if={user.bukicos=='氷刃1'} value="氷刃1" selected="selected">アイスエッジ 特性Lv1</option>
										<option if={user.bukicos!='氷刃10'} value="氷刃10">アイスエッジ 特性Lv10</option>
										<option if={user.bukicos!='氷刃9'} value="氷刃9">アイスエッジ 特性Lv9</option>
										<option if={user.bukicos!='氷刃8'} value="氷刃8">アイスエッジ 特性Lv8</option>
										<option if={user.bukicos!='氷刃7'} value="氷刃7">アイスエッジ 特性Lv7</option>
										<option if={user.bukicos!='氷刃6'} value="氷刃6">アイスエッジ 特性Lv6</option>
										<option if={user.bukicos!='氷刃5'} value="氷刃5">アイスエッジ 特性Lv5</option>
										<option if={user.bukicos!='氷刃4'} value="氷刃4">アイスエッジ 特性Lv4</option>
										<option if={user.bukicos!='氷刃3'} value="氷刃3">アイスエッジ 特性Lv3</option>
										<option if={user.bukicos!='氷刃2'} value="氷刃2">アイスエッジ 特性Lv2</option>
										<option if={user.bukicos!='氷刃1'} value="氷刃1">アイスエッジ 特性Lv1</option>
									</optgroup>
									<optgroup label="フェアリーローズ">
										<option if={user.bukicos=='薔薇10'} value="薔薇10" selected="selected">フェアリーローズ 特性Lv10</option>
										<option if={user.bukicos=='薔薇9'} value="薔薇9" selected="selected">フェアリーローズ 特性Lv9</option>
										<option if={user.bukicos=='薔薇8'} value="薔薇8" selected="selected">フェアリーローズ 特性Lv8</option>
										<option if={user.bukicos=='薔薇7'} value="薔薇7" selected="selected">フェアリーローズ 特性Lv7</option>
										<option if={user.bukicos=='薔薇6'} value="薔薇6" selected="selected">フェアリーローズ 特性Lv6</option>
										<option if={user.bukicos=='薔薇5'} value="薔薇5" selected="selected">フェアリーローズ 特性Lv5</option>
										<option if={user.bukicos=='薔薇4'} value="薔薇4" selected="selected">フェアリーローズ 特性Lv4</option>
										<option if={user.bukicos=='薔薇3'} value="薔薇3" selected="selected">フェアリーローズ 特性Lv3</option>
										<option if={user.bukicos=='薔薇2'} value="薔薇2" selected="selected">フェアリーローズ 特性Lv2</option>
										<option if={user.bukicos=='薔薇1'} value="薔薇1" selected="selected">フェアリーローズ 特性Lv1</option>
										<option if={user.bukicos!='薔薇10'} value="薔薇10">フェアリーローズ 特性Lv10</option>
										<option if={user.bukicos!='薔薇9'} value="薔薇9">フェアリーローズ 特性Lv9</option>
										<option if={user.bukicos!='薔薇8'} value="薔薇8">フェアリーローズ 特性Lv8</option>
										<option if={user.bukicos!='薔薇7'} value="薔薇7">フェアリーローズ 特性Lv7</option>
										<option if={user.bukicos!='薔薇6'} value="薔薇6">フェアリーローズ 特性Lv6</option>
										<option if={user.bukicos!='薔薇5'} value="薔薇5">フェアリーローズ 特性Lv5</option>
										<option if={user.bukicos!='薔薇4'} value="薔薇4">フェアリーローズ 特性Lv4</option>
										<option if={user.bukicos!='薔薇3'} value="薔薇3">フェアリーローズ 特性Lv3</option>
										<option if={user.bukicos!='薔薇2'} value="薔薇2">フェアリーローズ 特性Lv2</option>
										<option if={user.bukicos!='薔薇1'} value="薔薇1">フェアリーローズ 特性Lv1</option>
									</optgroup>
									<optgroup label="アリス">
										<option if={user.bukicos=='ｱﾘｽ10'} value="ｱﾘｽ10" selected="selected">アリス 特性Lv10</option>
										<option if={user.bukicos=='ｱﾘｽ9'} value="ｱﾘｽ9" selected="selected">アリス 特性Lv9</option>
										<option if={user.bukicos=='ｱﾘｽ8'} value="ｱﾘｽ8" selected="selected">アリス 特性Lv8</option>
										<option if={user.bukicos=='ｱﾘｽ7'} value="ｱﾘｽ7" selected="selected">アリス 特性Lv7</option>
										<option if={user.bukicos=='ｱﾘｽ6'} value="ｱﾘｽ6" selected="selected">アリス 特性Lv6</option>
										<option if={user.bukicos=='ｱﾘｽ5'} value="ｱﾘｽ5" selected="selected">アリス 特性Lv5</option>
										<option if={user.bukicos=='ｱﾘｽ4'} value="ｱﾘｽ4" selected="selected">アリス 特性Lv4</option>
										<option if={user.bukicos=='ｱﾘｽ3'} value="ｱﾘｽ3" selected="selected">アリス 特性Lv3</option>
										<option if={user.bukicos=='ｱﾘｽ2'} value="ｱﾘｽ2" selected="selected">アリス 特性Lv2</option>
										<option if={user.bukicos=='ｱﾘｽ1'} value="ｱﾘｽ1" selected="selected">アリス 特性Lv1</option>
										<option if={user.bukicos!='ｱﾘｽ10'} value="ｱﾘｽ10">アリス 特性Lv10</option>
										<option if={user.bukicos!='ｱﾘｽ9'} value="ｱﾘｽ9">アリス 特性Lv9</option>
										<option if={user.bukicos!='ｱﾘｽ8'} value="ｱﾘｽ8">アリス 特性Lv8</option>
										<option if={user.bukicos!='ｱﾘｽ7'} value="ｱﾘｽ7">アリス 特性Lv7</option>
										<option if={user.bukicos!='ｱﾘｽ6'} value="ｱﾘｽ6">アリス 特性Lv6</option>
										<option if={user.bukicos!='ｱﾘｽ5'} value="ｱﾘｽ5">アリス 特性Lv5</option>
										<option if={user.bukicos!='ｱﾘｽ4'} value="ｱﾘｽ4">アリス 特性Lv4</option>
										<option if={user.bukicos!='ｱﾘｽ3'} value="ｱﾘｽ3">アリス 特性Lv3</option>
										<option if={user.bukicos!='ｱﾘｽ2'} value="ｱﾘｽ2">アリス 特性Lv2</option>
										<option if={user.bukicos!='ｱﾘｽ1'} value="ｱﾘｽ1">アリス 特性Lv1</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usermanto">
									<option value="">マント</option>
									<optgroup label="高潔なる血のマント">
										<option if={user.manto=='高潔30'} value="高潔30" selected="selected">高潔Lv30</option>
										<option if={user.manto=='高潔29'} value="高潔29" selected="selected">高潔Lv29</option>
										<option if={user.manto=='高潔28'} value="高潔28" selected="selected">高潔Lv28</option>
										<option if={user.manto=='高潔27'} value="高潔27" selected="selected">高潔Lv27</option>
										<option if={user.manto=='高潔26'} value="高潔26" selected="selected">高潔Lv26</option>
										<option if={user.manto=='高潔25'} value="高潔25" selected="selected">高潔Lv25</option>
										<option if={user.manto=='高潔24'} value="高潔24" selected="selected">高潔Lv24</option>
										<option if={user.manto=='高潔23'} value="高潔23" selected="selected">高潔Lv23</option>
										<option if={user.manto=='高潔22'} value="高潔22" selected="selected">高潔Lv22</option>
										<option if={user.manto=='高潔21'} value="高潔21" selected="selected">高潔Lv21</option>
										<option if={user.manto=='高潔20'} value="高潔20" selected="selected">高潔Lv20</option>
										<option if={user.manto=='高潔19'} value="高潔19" selected="selected">高潔Lv19</option>
										<option if={user.manto=='高潔18'} value="高潔18" selected="selected">高潔Lv18</option>
										<option if={user.manto=='高潔17'} value="高潔17" selected="selected">高潔Lv17</option>
										<option if={user.manto=='高潔16'} value="高潔16" selected="selected">高潔Lv16</option>
										<option if={user.manto=='高潔15'} value="高潔15" selected="selected">高潔Lv15</option>
										<option if={user.manto=='高潔14'} value="高潔14" selected="selected">高潔Lv14</option>
										<option if={user.manto=='高潔13'} value="高潔13" selected="selected">高潔Lv13</option>
										<option if={user.manto=='高潔12'} value="高潔12" selected="selected">高潔Lv12</option>
										<option if={user.manto=='高潔11'} value="高潔11" selected="selected">高潔Lv11</option>
										<option if={user.manto=='高潔10'} value="高潔10" selected="selected">高潔Lv10</option>
										<option if={user.manto=='高潔9'} value="高潔9" selected="selected">高潔Lv9</option>
										<option if={user.manto=='高潔8'} value="高潔8" selected="selected">高潔Lv8</option>
										<option if={user.manto=='高潔7'} value="高潔7" selected="selected">高潔Lv7</option>
										<option if={user.manto=='高潔6'} value="高潔6" selected="selected">高潔Lv6</option>
										<option if={user.manto=='高潔5'} value="高潔5" selected="selected">高潔Lv5</option>
										<option if={user.manto=='高潔4'} value="高潔4" selected="selected">高潔Lv4</option>
										<option if={user.manto=='高潔3'} value="高潔3" selected="selected">高潔Lv3</option>
										<option if={user.manto=='高潔2'} value="高潔2" selected="selected">高潔Lv2</option>
										<option if={user.manto=='高潔1'} value="高潔1" selected="selected">高潔Lv1</option>
										<option if={user.manto!='高潔30'} value="高潔30">高潔Lv30</option>
										<option if={user.manto!='高潔29'} value="高潔29">高潔Lv29</option>
										<option if={user.manto!='高潔28'} value="高潔28">高潔Lv28</option>
										<option if={user.manto!='高潔27'} value="高潔27">高潔Lv27</option>
										<option if={user.manto!='高潔26'} value="高潔26">高潔Lv26</option>
										<option if={user.manto!='高潔25'} value="高潔25">高潔Lv25</option>
										<option if={user.manto!='高潔24'} value="高潔24">高潔Lv24</option>
										<option if={user.manto!='高潔23'} value="高潔23">高潔Lv23</option>
										<option if={user.manto!='高潔22'} value="高潔22">高潔Lv22</option>
										<option if={user.manto!='高潔21'} value="高潔21">高潔Lv21</option>
										<option if={user.manto!='高潔20'} value="高潔20">高潔Lv20</option>
										<option if={user.manto!='高潔19'} value="高潔19">高潔Lv19</option>
										<option if={user.manto!='高潔18'} value="高潔18">高潔Lv18</option>
										<option if={user.manto!='高潔17'} value="高潔17">高潔Lv17</option>
										<option if={user.manto!='高潔16'} value="高潔16">高潔Lv16</option>
										<option if={user.manto!='高潔15'} value="高潔15">高潔Lv15</option>
										<option if={user.manto!='高潔14'} value="高潔14">高潔Lv14</option>
										<option if={user.manto!='高潔13'} value="高潔13">高潔Lv13</option>
										<option if={user.manto!='高潔12'} value="高潔12">高潔Lv12</option>
										<option if={user.manto!='高潔11'} value="高潔11">高潔Lv11</option>
										<option if={user.manto!='高潔10'} value="高潔10">高潔Lv10</option>
										<option if={user.manto!='高潔9'} value="高潔9">高潔Lv9</option>
										<option if={user.manto!='高潔8'} value="高潔8">高潔Lv8</option>
										<option if={user.manto!='高潔7'} value="高潔7">高潔Lv7</option>
										<option if={user.manto!='高潔6'} value="高潔6">高潔Lv6</option>
										<option if={user.manto!='高潔5'} value="高潔5">高潔Lv5</option>
										<option if={user.manto!='高潔4'} value="高潔4">高潔Lv4</option>
										<option if={user.manto!='高潔3'} value="高潔3">高潔Lv3</option>
										<option if={user.manto!='高潔2'} value="高潔2">高潔Lv2</option>
										<option if={user.manto!='高潔1'} value="高潔1">高潔Lv1</option>
									</optgroup>
									<optgroup label="ハギオスのマント">
										<option if={user.manto=='ハギ30'} value="ハギ30" selected="selected">ハギオスLv30</option>
										<option if={user.manto=='ハギ29'} value="ハギ29" selected="selected">ハギオスLv29</option>
										<option if={user.manto=='ハギ28'} value="ハギ28" selected="selected">ハギオスLv28</option>
										<option if={user.manto=='ハギ27'} value="ハギ27" selected="selected">ハギオスLv27</option>
										<option if={user.manto=='ハギ26'} value="ハギ26" selected="selected">ハギオスLv26</option>
										<option if={user.manto=='ハギ25'} value="ハギ25" selected="selected">ハギオスLv25</option>
										<option if={user.manto=='ハギ24'} value="ハギ24" selected="selected">ハギオスLv24</option>
										<option if={user.manto=='ハギ23'} value="ハギ23" selected="selected">ハギオスLv23</option>
										<option if={user.manto=='ハギ22'} value="ハギ22" selected="selected">ハギオスLv22</option>
										<option if={user.manto=='ハギ21'} value="ハギ21" selected="selected">ハギオスLv21</option>
										<option if={user.manto=='ハギ20'} value="ハギ20" selected="selected">ハギオスLv20</option>
										<option if={user.manto=='ハギ19'} value="ハギ19" selected="selected">ハギオスLv19</option>
										<option if={user.manto=='ハギ18'} value="ハギ18" selected="selected">ハギオスLv18</option>
										<option if={user.manto=='ハギ17'} value="ハギ17" selected="selected">ハギオスLv17</option>
										<option if={user.manto=='ハギ16'} value="ハギ16" selected="selected">ハギオスLv16</option>
										<option if={user.manto=='ハギ15'} value="ハギ15" selected="selected">ハギオスLv15</option>
										<option if={user.manto=='ハギ14'} value="ハギ14" selected="selected">ハギオスLv14</option>
										<option if={user.manto=='ハギ13'} value="ハギ13" selected="selected">ハギオスLv13</option>
										<option if={user.manto=='ハギ12'} value="ハギ12" selected="selected">ハギオスLv12</option>
										<option if={user.manto=='ハギ11'} value="ハギ11" selected="selected">ハギオスLv11</option>
										<option if={user.manto=='ハギ10'} value="ハギ10" selected="selected">ハギオスLv10</option>
										<option if={user.manto=='ハギ9'} value="ハギ9" selected="selected">ハギオスLv9</option>
										<option if={user.manto=='ハギ8'} value="ハギ8" selected="selected">ハギオスLv8</option>
										<option if={user.manto=='ハギ7'} value="ハギ7" selected="selected">ハギオスLv7</option>
										<option if={user.manto=='ハギ6'} value="ハギ6" selected="selected">ハギオスLv6</option>
										<option if={user.manto=='ハギ5'} value="ハギ5" selected="selected">ハギオスLv5</option>
										<option if={user.manto=='ハギ4'} value="ハギ4" selected="selected">ハギオスLv4</option>
										<option if={user.manto=='ハギ3'} value="ハギ3" selected="selected">ハギオスLv3</option>
										<option if={user.manto=='ハギ2'} value="ハギ2" selected="selected">ハギオスLv2</option>
										<option if={user.manto=='ハギ1'} value="ハギ1" selected="selected">ハギオスLv1</option>
										<option if={user.manto!='ハギ30'} value="ハギ30">ハギオスLv30</option>
										<option if={user.manto!='ハギ29'} value="ハギ29">ハギオスLv29</option>
										<option if={user.manto!='ハギ28'} value="ハギ28">ハギオスLv28</option>
										<option if={user.manto!='ハギ27'} value="ハギ27">ハギオスLv27</option>
										<option if={user.manto!='ハギ26'} value="ハギ26">ハギオスLv26</option>
										<option if={user.manto!='ハギ25'} value="ハギ25">ハギオスLv25</option>
										<option if={user.manto!='ハギ24'} value="ハギ24">ハギオスLv24</option>
										<option if={user.manto!='ハギ23'} value="ハギ23">ハギオスLv23</option>
										<option if={user.manto!='ハギ22'} value="ハギ22">ハギオスLv22</option>
										<option if={user.manto!='ハギ21'} value="ハギ21">ハギオスLv21</option>
										<option if={user.manto!='ハギ20'} value="ハギ20">ハギオスLv20</option>
										<option if={user.manto!='ハギ19'} value="ハギ19">ハギオスLv19</option>
										<option if={user.manto!='ハギ18'} value="ハギ18">ハギオスLv18</option>
										<option if={user.manto!='ハギ17'} value="ハギ17">ハギオスLv17</option>
										<option if={user.manto!='ハギ16'} value="ハギ16">ハギオスLv16</option>
										<option if={user.manto!='ハギ15'} value="ハギ15">ハギオスLv15</option>
										<option if={user.manto!='ハギ14'} value="ハギ14">ハギオスLv14</option>
										<option if={user.manto!='ハギ13'} value="ハギ13">ハギオスLv13</option>
										<option if={user.manto!='ハギ12'} value="ハギ12">ハギオスLv12</option>
										<option if={user.manto!='ハギ11'} value="ハギ11">ハギオスLv11</option>
										<option if={user.manto!='ハギ10'} value="ハギ10">ハギオスLv10</option>
										<option if={user.manto!='ハギ9'} value="ハギ9">ハギオスLv9</option>
										<option if={user.manto!='ハギ8'} value="ハギ8">ハギオスLv8</option>
										<option if={user.manto!='ハギ7'} value="ハギ7">ハギオスLv7</option>
										<option if={user.manto!='ハギ6'} value="ハギ6">ハギオスLv6</option>
										<option if={user.manto!='ハギ5'} value="ハギ5">ハギオスLv5</option>
										<option if={user.manto!='ハギ4'} value="ハギ4">ハギオスLv4</option>
										<option if={user.manto!='ハギ3'} value="ハギ3">ハギオスLv3</option>
										<option if={user.manto!='ハギ2'} value="ハギ2">ハギオスLv2</option>
										<option if={user.manto!='ハギ1'} value="ハギ1">ハギオスLv1</option>
									</optgroup>
									<optgroup label="堅守なる氷結のマント">
										<option if={user.manto=='氷結30'} value="氷結30" selected="selected">氷結Lv30</option>
										<option if={user.manto=='氷結29'} value="氷結29" selected="selected">氷結Lv29</option>
										<option if={user.manto=='氷結28'} value="氷結28" selected="selected">氷結Lv28</option>
										<option if={user.manto=='氷結27'} value="氷結27" selected="selected">氷結Lv27</option>
										<option if={user.manto=='氷結26'} value="氷結26" selected="selected">氷結Lv26</option>
										<option if={user.manto=='氷結25'} value="氷結25" selected="selected">氷結Lv25</option>
										<option if={user.manto=='氷結24'} value="氷結24" selected="selected">氷結Lv24</option>
										<option if={user.manto=='氷結23'} value="氷結23" selected="selected">氷結Lv23</option>
										<option if={user.manto=='氷結22'} value="氷結22" selected="selected">氷結Lv22</option>
										<option if={user.manto=='氷結21'} value="氷結21" selected="selected">氷結Lv21</option>
										<option if={user.manto=='氷結20'} value="氷結20" selected="selected">氷結Lv20</option>
										<option if={user.manto=='氷結19'} value="氷結19" selected="selected">氷結Lv19</option>
										<option if={user.manto=='氷結18'} value="氷結18" selected="selected">氷結Lv18</option>
										<option if={user.manto=='氷結17'} value="氷結17" selected="selected">氷結Lv17</option>
										<option if={user.manto=='氷結16'} value="氷結16" selected="selected">氷結Lv16</option>
										<option if={user.manto=='氷結15'} value="氷結15" selected="selected">氷結Lv15</option>
										<option if={user.manto=='氷結14'} value="氷結14" selected="selected">氷結Lv14</option>
										<option if={user.manto=='氷結13'} value="氷結13" selected="selected">氷結Lv13</option>
										<option if={user.manto=='氷結12'} value="氷結12" selected="selected">氷結Lv12</option>
										<option if={user.manto=='氷結11'} value="氷結11" selected="selected">氷結Lv11</option>
										<option if={user.manto=='氷結10'} value="氷結10" selected="selected">氷結Lv10</option>
										<option if={user.manto=='氷結9'} value="氷結9" selected="selected">氷結Lv9</option>
										<option if={user.manto=='氷結8'} value="氷結8" selected="selected">氷結Lv8</option>
										<option if={user.manto=='氷結7'} value="氷結7" selected="selected">氷結Lv7</option>
										<option if={user.manto=='氷結6'} value="氷結6" selected="selected">氷結Lv6</option>
										<option if={user.manto=='氷結5'} value="氷結5" selected="selected">氷結Lv5</option>
										<option if={user.manto=='氷結4'} value="氷結4" selected="selected">氷結Lv4</option>
										<option if={user.manto=='氷結3'} value="氷結3" selected="selected">氷結Lv3</option>
										<option if={user.manto=='氷結2'} value="氷結2" selected="selected">氷結Lv2</option>
										<option if={user.manto=='氷結1'} value="氷結1" selected="selected">氷結Lv1</option>
										<option if={user.manto!='氷結30'} value="氷結30">氷結Lv30</option>
										<option if={user.manto!='氷結29'} value="氷結29">氷結Lv29</option>
										<option if={user.manto!='氷結28'} value="氷結28">氷結Lv28</option>
										<option if={user.manto!='氷結27'} value="氷結27">氷結Lv27</option>
										<option if={user.manto!='氷結26'} value="氷結26">氷結Lv26</option>
										<option if={user.manto!='氷結25'} value="氷結25">氷結Lv25</option>
										<option if={user.manto!='氷結24'} value="氷結24">氷結Lv24</option>
										<option if={user.manto!='氷結23'} value="氷結23">氷結Lv23</option>
										<option if={user.manto!='氷結22'} value="氷結22">氷結Lv22</option>
										<option if={user.manto!='氷結21'} value="氷結21">氷結Lv21</option>
										<option if={user.manto!='氷結20'} value="氷結20">氷結Lv20</option>
										<option if={user.manto!='氷結19'} value="氷結19">氷結Lv19</option>
										<option if={user.manto!='氷結18'} value="氷結18">氷結Lv18</option>
										<option if={user.manto!='氷結17'} value="氷結17">氷結Lv17</option>
										<option if={user.manto!='氷結16'} value="氷結16">氷結Lv16</option>
										<option if={user.manto!='氷結15'} value="氷結15">氷結Lv15</option>
										<option if={user.manto!='氷結14'} value="氷結14">氷結Lv14</option>
										<option if={user.manto!='氷結13'} value="氷結13">氷結Lv13</option>
										<option if={user.manto!='氷結12'} value="氷結12">氷結Lv12</option>
										<option if={user.manto!='氷結11'} value="氷結11">氷結Lv11</option>
										<option if={user.manto!='氷結10'} value="氷結10">氷結Lv10</option>
										<option if={user.manto!='氷結9'} value="氷結9">氷結Lv9</option>
										<option if={user.manto!='氷結8'} value="氷結8">氷結Lv8</option>
										<option if={user.manto!='氷結7'} value="氷結7">氷結Lv7</option>
										<option if={user.manto!='氷結6'} value="氷結6">氷結Lv6</option>
										<option if={user.manto!='氷結5'} value="氷結5">氷結Lv5</option>
										<option if={user.manto!='氷結4'} value="氷結4">氷結Lv4</option>
										<option if={user.manto!='氷結3'} value="氷結3">氷結Lv3</option>
										<option if={user.manto!='氷結2'} value="氷結2">氷結Lv2</option>
										<option if={user.manto!='氷結1'} value="氷結1">氷結Lv1</option>
									</optgroup>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usermeteo">
									<option>メテオ</option>
									<option if={user.meteo==10} value="10" selected="selected">メテオLv10</option>
									<option if={user.meteo==9} value="9" selected="selected">メテオLv9</option>
									<option if={user.meteo==8} value="8" selected="selected">メテオLv8</option>
									<option if={user.meteo==7} value="7" selected="selected">メテオLv7</option>
									<option if={user.meteo==6} value="6" selected="selected">メテオLv6</option>
									<option if={user.meteo==5} value="5" selected="selected">メテオLv5</option>
									<option if={user.meteo==4} value="4" selected="selected">メテオLv4</option>
									<option if={user.meteo==3} value="3" selected="selected">メテオLv3</option>
									<option if={user.meteo==2} value="2" selected="selected">メテオLv2</option>
									<option if={user.meteo==1} value="1" selected="selected">メテオLv1</option>
									<option if={user.meteo!=10} value="10">メテオLv10</option>
									<option if={user.meteo!=9} value="9">メテオLv9</option>
									<option if={user.meteo!=8} value="8">メテオLv8</option>
									<option if={user.meteo!=7} value="7">メテオLv7</option>
									<option if={user.meteo!=6} value="6">メテオLv6</option>
									<option if={user.meteo!=5} value="5">メテオLv5</option>
									<option if={user.meteo!=4} value="4">メテオLv4</option>
									<option if={user.meteo!=3} value="3">メテオLv3</option>
									<option if={user.meteo!=2} value="2">メテオLv2</option>
									<option if={user.meteo!=1} value="1">メテオLv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userdzone">
									<option value="">ディフェンスゾーン</option>
									<option if={user.dzone==10} value="10" selected="selected">ディフェンスゾーンLv10</option>
									<option if={user.dzone==9} value="9" selected="selected">ディフェンスゾーンLv9</option>
									<option if={user.dzone==8} value="8" selected="selected">ディフェンスゾーンLv8</option>
									<option if={user.dzone==7} value="7" selected="selected">ディフェンスゾーンLv7</option>
									<option if={user.dzone==6} value="6" selected="selected">ディフェンスゾーンLv6</option>
									<option if={user.dzone==5} value="5" selected="selected">ディフェンスゾーンLv5</option>
									<option if={user.dzone==4} value="4" selected="selected">ディフェンスゾーンLv4</option>
									<option if={user.dzone==3} value="3" selected="selected">ディフェンスゾーンLv3</option>
									<option if={user.dzone==2} value="2" selected="selected">ディフェンスゾーンLv2</option>
									<option if={user.dzone==1} value="1" selected="selected">ディフェンスゾーンLv1</option>
									<option if={user.dzone!=10} value="10">ディフェンスゾーンLv10</option>
									<option if={user.dzone!=9} value="9">ディフェンスゾーンLv9</option>
									<option if={user.dzone!=8} value="8">ディフェンスゾーンLv8</option>
									<option if={user.dzone!=7} value="7">ディフェンスゾーンLv7</option>
									<option if={user.dzone!=6} value="6">ディフェンスゾーンLv6</option>
									<option if={user.dzone!=5} value="5">ディフェンスゾーンLv5</option>
									<option if={user.dzone!=4} value="4">ディフェンスゾーンLv4</option>
									<option if={user.dzone!=3} value="3">ディフェンスゾーンLv3</option>
									<option if={user.dzone!=2} value="2">ディフェンスゾーンLv2</option>
									<option if={user.dzone!=1} value="1">ディフェンスゾーンLv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userpvpat">
									<option>対人攻撃特性</option>
									<option if={user.pvpat==10} value="10" selected="selected">対人攻撃特性Lv10</option>
									<option if={user.pvpat==9} value="9" selected="selected">対人攻撃特性Lv9</option>
									<option if={user.pvpat==8} value="8" selected="selected">対人攻撃特性Lv8</option>
									<option if={user.pvpat==7} value="7" selected="selected">対人攻撃特性Lv7</option>
									<option if={user.pvpat==6} value="6" selected="selected">対人攻撃特性Lv6</option>
									<option if={user.pvpat==5} value="5" selected="selected">対人攻撃特性Lv5</option>
									<option if={user.pvpat==4} value="4" selected="selected">対人攻撃特性Lv4</option>
									<option if={user.pvpat==3} value="3" selected="selected">対人攻撃特性Lv3</option>
									<option if={user.pvpat==2} value="2" selected="selected">対人攻撃特性Lv2</option>
									<option if={user.pvpat==1} value="1" selected="selected">対人攻撃特性Lv1</option>
									<option if={user.pvpat!=10} value="10">対人攻撃特性Lv10</option>
									<option if={user.pvpat!=9} value="9">対人攻撃特性Lv9</option>
									<option if={user.pvpat!=8} value="8">対人攻撃特性Lv8</option>
									<option if={user.pvpat!=7} value="7">対人攻撃特性Lv7</option>
									<option if={user.pvpat!=6} value="6">対人攻撃特性Lv6</option>
									<option if={user.pvpat!=5} value="5">対人攻撃特性Lv5</option>
									<option if={user.pvpat!=4} value="4">対人攻撃特性Lv4</option>
									<option if={user.pvpat!=3} value="3">対人攻撃特性Lv3</option>
									<option if={user.pvpat!=2} value="2">対人攻撃特性Lv2</option>
									<option if={user.pvpat!=1} value="1">対人攻撃特性Lv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userpvpdf">
									<option>対人防御特性(平均)</option>
									<option if={user.pvpdf==10} value="10" selected="selected">対人防御特性Lv10</option>
									<option if={user.pvpdf==9} value="9" selected="selected">対人防御特性Lv9</option>
									<option if={user.pvpdf==8} value="8" selected="selected">対人防御特性Lv8</option>
									<option if={user.pvpdf==7} value="7" selected="selected">対人防御特性Lv7</option>
									<option if={user.pvpdf==6} value="6" selected="selected">対人防御特性Lv6</option>
									<option if={user.pvpdf==5} value="5" selected="selected">対人防御特性Lv5</option>
									<option if={user.pvpdf==4} value="4" selected="selected">対人防御特性Lv4</option>
									<option if={user.pvpdf==3} value="3" selected="selected">対人防御特性Lv3</option>
									<option if={user.pvpdf==2} value="2" selected="selected">対人防御特性Lv2</option>
									<option if={user.pvpdf==1} value="1" selected="selected">対人防御特性Lv1</option>
									<option if={user.pvpdf!=10} value="10">対人防御特性Lv10</option>
									<option if={user.pvpdf!=9} value="9">対人防御特性Lv9</option>
									<option if={user.pvpdf!=8} value="8">対人防御特性Lv8</option>
									<option if={user.pvpdf!=7} value="7">対人防御特性Lv7</option>
									<option if={user.pvpdf!=6} value="6">対人防御特性Lv6</option>
									<option if={user.pvpdf!=5} value="5">対人防御特性Lv5</option>
									<option if={user.pvpdf!=4} value="4">対人防御特性Lv4</option>
									<option if={user.pvpdf!=3} value="3">対人防御特性Lv3</option>
									<option if={user.pvpdf!=2} value="2">対人防御特性Lv2</option>
									<option if={user.pvpdf!=1} value="1">対人防御特性Lv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usersweet">
									<option>スイート特性</option>
									<option if={user.sweet==10} value="10" selected="selected">スイート特性Lv10</option>
									<option if={user.sweet==9} value="9" selected="selected">スイート特性Lv9</option>
									<option if={user.sweet==8} value="8" selected="selected">スイート特性Lv8</option>
									<option if={user.sweet==7} value="7" selected="selected">スイート特性Lv7</option>
									<option if={user.sweet==6} value="6" selected="selected">スイート特性Lv6</option>
									<option if={user.sweet==5} value="5" selected="selected">スイート特性Lv5</option>
									<option if={user.sweet==4} value="4" selected="selected">スイート特性Lv4</option>
									<option if={user.sweet==3} value="3" selected="selected">スイート特性Lv3</option>
									<option if={user.sweet==2} value="2" selected="selected">スイート特性Lv2</option>
									<option if={user.sweet==1} value="1" selected="selected">スイート特性Lv1</option>
									<option if={user.sweet!=10} value="10">スイート特性Lv10</option>
									<option if={user.sweet!=9} value="9">スイート特性Lv9</option>
									<option if={user.sweet!=8} value="8">スイート特性Lv8</option>
									<option if={user.sweet!=7} value="7">スイート特性Lv7</option>
									<option if={user.sweet!=6} value="6">スイート特性Lv6</option>
									<option if={user.sweet!=5} value="5">スイート特性Lv5</option>
									<option if={user.sweet!=4} value="4">スイート特性Lv4</option>
									<option if={user.sweet!=3} value="3">スイート特性Lv3</option>
									<option if={user.sweet!=2} value="2">スイート特性Lv2</option>
									<option if={user.sweet!=1} value="1">スイート特性Lv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userboss">
									<option>ボス特性</option>
									<option if={user.boss==10} value="10" selected="selected">ボス特性Lv10</option>
									<option if={user.boss==9} value="9" selected="selected">ボス特性Lv9</option>
									<option if={user.boss==8} value="8" selected="selected">ボス特性Lv8</option>
									<option if={user.boss==7} value="7" selected="selected">ボス特性Lv7</option>
									<option if={user.boss==6} value="6" selected="selected">ボス特性Lv6</option>
									<option if={user.boss==5} value="5" selected="selected">ボス特性Lv5</option>
									<option if={user.boss==4} value="4" selected="selected">ボス特性Lv4</option>
									<option if={user.boss==3} value="3" selected="selected">ボス特性Lv3</option>
									<option if={user.boss==2} value="2" selected="selected">ボス特性Lv2</option>
									<option if={user.boss==1} value="1" selected="selected">ボス特性Lv1</option>
									<option if={user.boss!=10} value="10">ボス特性Lv10</option>
									<option if={user.boss!=9} value="9">ボス特性Lv9</option>
									<option if={user.boss!=8} value="8">ボス特性Lv8</option>
									<option if={user.boss!=7} value="7">ボス特性Lv7</option>
									<option if={user.boss!=6} value="6">ボス特性Lv6</option>
									<option if={user.boss!=5} value="5">ボス特性Lv5</option>
									<option if={user.boss!=4} value="4">ボス特性Lv4</option>
									<option if={user.boss!=3} value="3">ボス特性Lv3</option>
									<option if={user.boss!=2} value="2">ボス特性Lv2</option>
									<option if={user.boss!=1} value="1">ボス特性Lv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="usermamono">
									<option>魔物特性</option>
									<option if={user.mamono==10} value="10" selected="selected">魔物特性Lv10</option>
									<option if={user.mamono==9} value="9" selected="selected">魔物特性Lv9</option>
									<option if={user.mamono==8} value="8" selected="selected">魔物特性Lv8</option>
									<option if={user.mamono==7} value="7" selected="selected">魔物特性Lv7</option>
									<option if={user.mamono==6} value="6" selected="selected">魔物特性Lv6</option>
									<option if={user.mamono==5} value="5" selected="selected">魔物特性Lv5</option>
									<option if={user.mamono==4} value="4" selected="selected">魔物特性Lv4</option>
									<option if={user.mamono==3} value="3" selected="selected">魔物特性Lv3</option>
									<option if={user.mamono==2} value="2" selected="selected">魔物特性Lv2</option>
									<option if={user.mamono==1} value="1" selected="selected">魔物特性Lv1</option>
									<option if={user.mamono!=10} value="10">魔物特性Lv10</option>
									<option if={user.mamono!=9} value="9">魔物特性Lv9</option>
									<option if={user.mamono!=8} value="8">魔物特性Lv8</option>
									<option if={user.mamono!=7} value="7">魔物特性Lv7</option>
									<option if={user.mamono!=6} value="6">魔物特性Lv6</option>
									<option if={user.mamono!=5} value="5">魔物特性Lv5</option>
									<option if={user.mamono!=4} value="4">魔物特性Lv4</option>
									<option if={user.mamono!=3} value="3">魔物特性Lv3</option>
									<option if={user.mamono!=2} value="2">魔物特性Lv2</option>
									<option if={user.mamono!=1} value="1">魔物特性Lv1</option>
								</select>
							</div>
							<div if={mode==1} class="form-group">
								<select class="form-control" name="userdragon">
									<option>竜特性</option>
									<option if={user.dragon==10} value="10" selected="selected">竜特性Lv10</option>
									<option if={user.dragon==9} value="9" selected="selected">竜特性Lv9</option>
									<option if={user.dragon==8} value="8" selected="selected">竜特性Lv8</option>
									<option if={user.dragon==7} value="7" selected="selected">竜特性Lv7</option>
									<option if={user.dragon==6} value="6" selected="selected">竜特性Lv6</option>
									<option if={user.dragon==5} value="5" selected="selected">竜特性Lv5</option>
									<option if={user.dragon==4} value="4" selected="selected">竜特性Lv4</option>
									<option if={user.dragon==3} value="3" selected="selected">竜特性Lv3</option>
									<option if={user.dragon==2} value="2" selected="selected">竜特性Lv2</option>
									<option if={user.dragon==1} value="1" selected="selected">竜特性Lv1</option>
									<option if={user.dragon!=10} value="10">竜特性Lv10</option>
									<option if={user.dragon!=9} value="9">竜特性Lv9</option>
									<option if={user.dragon!=8} value="8">竜特性Lv8</option>
									<option if={user.dragon!=7} value="7">竜特性Lv7</option>
									<option if={user.dragon!=6} value="6">竜特性Lv6</option>
									<option if={user.dragon!=5} value="5">竜特性Lv5</option>
									<option if={user.dragon!=4} value="4">竜特性Lv4</option>
									<option if={user.dragon!=3} value="3">竜特性Lv3</option>
									<option if={user.dragon!=2} value="2">竜特性Lv2</option>
									<option if={user.dragon!=1} value="1">竜特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="useractivity">
									<option>区分</option>
									<option if={user.activity==1} value="1" selected="selected">アクティブ</option>
									<option if={user.activity==0} value="0" selected="selected">インアクティブ</option>
									<option if={user.activity==-9} value="-9" selected="selected">除名</option>
									<option if={user.activity==-1} value="-1" selected="selected">傭兵</option>
									<option if={user.activity!=1} value="1">アクティブ</option>
									<option if={user.activity!=0} value="0">インアクティブ</option>
									<option if={user.activity!=-9} value="-9">除名</option>
									<option if={user.activity!=-1} value="-1">傭兵</option>
								</select>
							</div>
							<div class="form-group bg-info">
								<h5>入団日(選択して下さい)</h5>
								<div class='input-group date' id='joinddate'/>
							</div>
							<botton class="btn btn-success" onclick="onclickRegister(this, '{user.ID}', '{escapeHTML(user.name)}')">登録</botton>
							<botton if={user.ID!='' && 'on'!= getParams['view']} class="btn btn-danger" onclick="onclickUnregister(this, '{user.ID}')">削除</botton>
						</form>
					</div>
					var user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: '', spiritlevel:'', meteo: 0, dzone: null, acce1: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '',};
					this.on('mount', function() {
						//$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00",});
						auth(false, function (clan) {
							if ('#modifyuser' == location.hash && 'undefined' != typeof getParams['userid'] && 0 < getParams['userid'].length) {
								// modifyモード
								getUser(getParams['userid'], function(user) {
									this.user = user;
									console.log(this.user);
									$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00", defaultDate: user.joind, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.user = user;
								$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00"});
								riot.update();
							}
						});
					});
				</adduser>
			</script>

			<!-- addschedule -->
			<script type="riot/tag">
				<addschedule>
					<div style="padding: 10px;">
						<h4 if={'on'==getParams['view']}>{schedule.date}<h4/>
						<h4 if={'on'==getParams['view']}>{schedule.name}<h4/>
						<h4 if={'#detailschedule' == location.hash && schedule.type!=1}>参加予定: {schedule.incount} 人<h4/>
						<form id="addscheduleform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="schedulename" value="{schedule.name}" class="form-control" placeholder="予定内容"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="scheduletag" value="{schedule.tag}" class="form-control" placeholder="#要塞戦"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group bg-info">
								<h5>予定日時(選択して下さい)</h5>
								<div class='input-group date' id='scheduledate'/>
							</div>
							<div class="form-group">
								<select class="form-control" name="scheduletype">
									<option value="0">出欠確認アリ</option>
									<option if={schedule.type!=1} value="1">出欠確認不要(予定のみ)</option>
									<option if={schedule.type==1} value="1" selected="selected">出欠確認不要(予定のみ)</option>
								</select>
							</div>
							<div class="form-check">
								<input if={schedule.autoReset==true} type="checkbox" name="scheduleautoreset" value="1"  class="form-check-input" id="scheduleautoreset" checked="checked"/>
								<input if={schedule.autoReset!=true} type="checkbox" name="scheduleautoreset" value="1"  class="form-check-input" id="scheduleautoreset"/>
								<label class="form-check-label" for="scheduleautoreset">自動リセットを有効</label>
								<br/>
								<small>※毎週同じ予定を開催する場合に有効です。</small>
								<br/>
								<small>※この機能を利用する為には<a href="{botURL}" target="_blank">"{botName}"</a>の導入が必要です！</small>
								<br/>
								<input if={schedule.autoResetPT==true} type="checkbox" name="scheduleautoresetpt" value="1"  class="form-check-input" id="scheduleautoresetpt" checked="checked"/>
								<input if={schedule.autoResetPT!=true} type="checkbox" name="scheduleautoresetpt" value="1"  class="form-check-input" id="scheduleautoresetpt"/>
								<label class="form-check-label" for="scheduleautoresetpt">自動リセット時に編成と参加不参加もリセット</label>
								<br/>
								<br/>
							</div>
							<input type="hidden" name="scheduleincount" value="{schedule.incount}" id='scheduleincount'/>
							<botton class="btn btn-success" onclick="onclickRegisterSchedule(this, '{schedule.ID}')">登録</botton>
							<botton if={'#detailschedule' != location.hash} class="btn btn-danger" onclick="onclickRegisterSchedule(this, '{schedule.ID}', true)">登録(同一タグの前回のPT編成をコピー)</botton>
						</form>
						<br/>
						<br/>
						<br/>
					</div>
					var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, type: 0, autoReset: null, };
					this.on('mount', function() {
						if ('on'==getParams['view']) {
							$('#addscheduleform').hide();
						}
						auth(false, function (clan) {
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								// modifyモード
								getSchedule(getParams['scheduleid'], function(schedule) {
									this.schedule = schedule;
									$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, defaultDate: schedule.date, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.schedule = schedule;
								$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, });
								riot.update();
							}
						});
					});
				</addschedule>
			</script>

			<!-- party -->
			<script type="riot/tag">
				<party>
					<div style="position: fixed; top: 5px;">
						<h5 style="margin-top: 0; margin-bottom: 5px; padding-left: 5px;"><a href="{scheduleURL}">PT編成 {partySchedule.date} {partySchedule.name} 参加予定:{partySchedule.incount}人</a>&nbsp;&nbsp;&nbsp;<a href="{clan.url}">[ {clanPageLabel}に戻る ]</a></h5>
						<div id="partytable" class="row">
							<table>
								<tr each="{party, index in parties}">
									<td each="{pusers, pindex in party}" if={pusers != null} style="width: 20%; padding: 0; border: none;">

												<ul class="table table-striped" id="partytable{(index*5)+pindex}" style="overflow: hidden; margin-bottom: 0px;" data-party="{pusers[0].party}">
													<li if={pusers[0].party==49 || pusers[0].party==99} class="ptlabel" style="background-color: #bbb; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt49label && 0 < partySchedule.pt49label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt49label}</div></span>
														<span if={!('string' == typeof partySchedule.pt49label && 0 < partySchedule.pt49label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">1A</span>
														<span if={!('string' == typeof partySchedule.pt49label && 0 < partySchedule.pt49label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==48} class="ptlabel" style="background-color: #aaa; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt48label && 0 < partySchedule.pt48label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt48label}</div></span>
														<span if={!('string' == typeof partySchedule.pt48label && 0 < partySchedule.pt48label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">1B</span>
														<span if={!('string' == typeof partySchedule.pt48label && 0 < partySchedule.pt48label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==39 || pusers[0].party==89} class="ptlabel" style="background-color: dodgerblue; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt39label && 0 < partySchedule.pt39label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt39label}</div></span>
														<span if={!('string' == typeof partySchedule.pt39label && 0 < partySchedule.pt39label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">2A</span>
														<span if={!('string' == typeof partySchedule.pt39label && 0 < partySchedule.pt39label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">聖刻</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==38} class="ptlabel" style="background-color: blue; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt38label && 0 < partySchedule.pt38label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt38label}</div></span>
														<span if={!('string' == typeof partySchedule.pt38label && 0 < partySchedule.pt38label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">2B</span>
														<span if={!('string' == typeof partySchedule.pt38label && 0 < partySchedule.pt38label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">偵察</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==37} class="ptlabel" style="background-color: navy; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt37label && 0 < partySchedule.pt37label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt37label}</div></span>
														<span if={!('string' == typeof partySchedule.pt37label && 0 < partySchedule.pt37label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span if={!('string' == typeof partySchedule.pt37label && 0 < partySchedule.pt37label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">封殺</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==29 || pusers[0].party==79} class="ptlabel" style="background-color: limegreen; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt29label && 0 < partySchedule.pt29label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt29label}</div></span>
														<span if={!('string' == typeof partySchedule.pt29label && 0 < partySchedule.pt29label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">3A</span>
														<span if={!('string' == typeof partySchedule.pt29label && 0 < partySchedule.pt29label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW1</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==28} class="ptlabel" style="border: none; background-color: green; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt28label && 0 < partySchedule.pt28label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt28label}</div></span>
														<span if={!('string' == typeof partySchedule.pt28label && 0 < partySchedule.pt28label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">3B</span>
														<span if={!('string' == typeof partySchedule.pt28label && 0 < partySchedule.pt28label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW2</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==27} class="ptlabel" style="border: none; background-color: darkgreen; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt27label && 0 < partySchedule.pt27label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt27label}</div></span>
														<span if={!('string' == typeof partySchedule.pt27label && 0 < partySchedule.pt27label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span if={!('string' == typeof partySchedule.pt27label && 0 < partySchedule.pt27label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW3</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==19 || pusers[0].party==69} class="ptlabel" style="border: none; background-color: gold; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt19label && 0 < partySchedule.pt19label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt19label}</div></span>
														<span if={!('string' == typeof partySchedule.pt19label && 0 < partySchedule.pt19label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">4A</span>
														<span if={!('string' == typeof partySchedule.pt19label && 0 < partySchedule.pt19label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF1</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==18} class="ptlabel" style="border: none; background-color: orange; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt18label && 0 < partySchedule.pt18label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt18label}</div></span>
														<span if={!('string' == typeof partySchedule.pt18label && 0 < partySchedule.pt18label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">4B</span>
														<span if={!('string' == typeof partySchedule.pt18label && 0 < partySchedule.pt18label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF2</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==17} class="ptlabel" style="border: none; background-color: darkorange; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt17label && 0 < partySchedule.pt17label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt17label}</div></span>
														<span if={!('string' == typeof partySchedule.pt17label && 0 < partySchedule.pt17label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span if={!('string' == typeof partySchedule.pt17label && 0 < partySchedule.pt17label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF3</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==9 || pusers[0].party==59} class="ptlabel" style="border: none; background-color: red; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt9label && 0 < partySchedule.pt9label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt9label}</div></span>
														<span if={!('string' == typeof partySchedule.pt9label && 0 < partySchedule.pt9label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">5A</span>
														<span if={!('string' == typeof partySchedule.pt9label && 0 < partySchedule.pt9label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF1</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==8} class="ptlabel" style="border: none; background-color: crimson; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt8label && 0 < partySchedule.pt8label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt8label}</div></span>
														<span if={!('string' == typeof partySchedule.pt8label && 0 < partySchedule.pt8label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">5B</span>
														<span if={!('string' == typeof partySchedule.pt8label && 0 < partySchedule.pt8label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF2</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==7} class="ptlabel" style="border: none; background-color: firebrick; color: white; font-size: 8px;">
														<span if={'string' == typeof partySchedule.pt7label && 0 < partySchedule.pt7label.length} style="border: none; width:100px; padding: 5px;"><div style="height: 14px; overflow: hidden;">{partySchedule.pt7label}</div></span>
														<span if={!('string' == typeof partySchedule.pt7label && 0 < partySchedule.pt7label.length) && -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</span>
														<span if={!('string' == typeof partySchedule.pt7label && 0 < partySchedule.pt7label.length) && 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF3</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li if={pusers[0].party==0} class="ptlabel" style="border: none; background-color: #444; color: white; font-size: 8px;" class="pt0">
														<span style="border: none; width:100px; padding: 5px;">欠席</span>
														<span style="border: none;"></span>
														<span if={mode==1} style="border: none; width:25px;"></span>
													</li>
													<li each="{puser, uindex in pusers}" style="border: none;" class="ptuser activity{puser.activity} pt{puser.party}" data-userid="{puser.ID}">
														<span if={puser.status==2} class="username text-info" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 24px; line-height: 1.6; overflow: hidden;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</span>
														<span if={puser.status==1} class="username text-success" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 24px; line-height: 1.6; overflow: hidden;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</span>
														<span if={puser.status==-1} class="username text-danger" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 24px; line-height: 1.6; overflow: hidden;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</span>
														<span if={puser.entry!=1 && puser.status!=-1 && puser.status!=2 && puser.status!=1} class="username" style="color: orange; font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 24px; line-height: 1.6; overflow: hidden;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</span>
														<span if={puser.entry==1 && puser.status!=-1 && puser.status!=2 && puser.status!=1} class="username" style="border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 24px; line-height: 1.6; overflow: hidden;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</span>
														<span style="overflow: hidden; border: none; padding: 5px; border-left: 1px solid gray; text-align: right;" class="cp">{puser.cp}</span>
														<span if={mode==1 && jobbufs[puser.job]=='攻撃'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: firebrick;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==1 && jobbufs[puser.job]=='クリ'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: orange;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==1 && jobbufs[puser.job]=='防御'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: blue;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==1 && jobbufs[puser.job]=='移動'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: green;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==1 && jobbufs[puser.job]=='命中'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: dodgerblue;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==1 && jobbufs[puser.job]=='HP'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: deeppink;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 != puser.job3d}>2d</p></span>
														<span if={mode==2 && jobbufs[puser.job]=='近距離'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: salmon;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/></span>
														<span if={mode==2 && jobbufs[puser.job]=='遠距離'} class="jobimage" style="border: none; padding: 3px; padding-left: 1px; background-color: dodgerblue;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/></span>
														<span if={'undefined' == typeof jobbufs[puser.job]} class="jobimage" style="border: none; padding: 3px; background-color: #444;">&nbsp;</span>
													</li>
													<li if={'on'!=getParams['view']} class="partycp pt{pusers[0].party}" style="padding: 0; border: solid 1px gray; border-top: solid 1px #ddd; border-bottom: solid 1px #ddd; background-color: white; text-align: right; height: 20px;">
														<b>{partyCPs[((index)*5)+pindex].toLocaleString()}</b>&nbsp;
													</li>
												</ul>

									</td>
								</tr>
							</table>
						</div>
					</div>
					<style>
						table {
							width: 100%;
						}
						table td {
							vertical-align: top;
						}
						span {
							display: block;
							float: left;
							max-width: 100%;
							padding: 0;
							height: 24px;
						}
						span.username {
							width: 100px;
							/*max-width: 100px;
							min-width: 93px;*/
						}
						span.cp {
							width: calc(100% - 124px);
						}
						span.jobimage {
							width: 24px;
						}
						li {
							clear: both;
							padding: 0;
							height: 24px;
							border-left: none;
						}
						li:nth-child(even) span {
							background: #f9f9f9;
						}
						.ptlabel, .ptlabel span {
							height: 24px;
						}
						@media screen and (max-width: 700px) {
							.ptlabel span:nth-child(n+2) {
								display: none;
							}
							span.username {
								width: calc(100% - 24px);
							}
							span.cp {
								display: none;
							}
						}
					</style>
					var scheduleURL = '';
					var partySchedule = {name:'', date: '', incount: 0, autoReset: null, };
					var parties = [];
					var partyCPs = [];
					var entryUsers = [];
					this.on('unmount', function() {
						$('donation').show();
						$('footer').show();
					});
					this.on('mount', function() {
						if (location.hash == '#party') {
							$('donation').hide();
							$('footer').hide();
						}
						var viewGrid = function (schedule, data) {
							entryUsers = data;
							if (-1 < schedule.tag.indexOf('レイド')) {
								for (var pidx=0; pidx < data.length; pidx++) {
									if (0 == (data[pidx].party + 1) % 10) {
										data[pidx].party = data[pidx].party + 50;
									}
									if (1 == data[pidx].dual) {
										data[pidx].job = data[pidx].subjob;
										data[pidx].job3d = data[pidx].subjob3d;
										data[pidx].cp = data[pidx].subcp;
										data[pidx].activity = -1;
									}
								}
								// PTで並べ直し
								data.sort(function(a, b){
									if( a.party > b.party ) {
										return -1;
									}
									if( a.party < b.party ) {
										return 1;
									}
									return 0;
								});
								console.log(data);
							}
							data.sort(function(a, b){
								if( 'undefined' == typeof a.status  ) {
									a.status = 0;
								}
								if( 'undefined' == typeof b.status  ) {
									b.status = 0;
								}
								if( a.party >= b.party ) {
									if( a.status > b.status ) {
										return -1;
									}
									if( a.status <= b.status ) {
										return 1;
									}
								}
								return 0;
							});
							this.scheduleURL = '?clanid=' + clan.ID + '&scheduleid=' + schedule.ID + '#detailschedule';
							if ('on' == getParams['view']) {
									this.scheduleURL = this.scheduleURL.replace('#detailschedule', '&view=on#detailschedule')
							}
							this.partySchedule = schedule;
							this.parties = parties;
							this.partyCPs = partyCPs;
							var rowCnt = 0;
							var partyCnt = 0;
							var beforeParty = -1;
							this.parties[rowCnt] = [];
							if (-1 < this.partySchedule.tag.indexOf('レイド')) {
								this.parties[0] = [];
								this.parties[1] = [];
								this.parties[0][0] = [{name:'', party:99},{name:'', party:99},{name:'', party:99},{name:'', party:99},{name:'', party:99}];
								this.parties[0][1] = [{name:'', party:89},{name:'', party:89},{name:'', party:89},{name:'', party:89},{name:'', party:89}];
								this.parties[0][2] = [{name:'', party:79},{name:'', party:79},{name:'', party:79},{name:'', party:79},{name:'', party:79}];
								this.parties[0][3] = [{name:'', party:69},{name:'', party:69},{name:'', party:69},{name:'', party:69},{name:'', party:69}];
								this.parties[0][4] = [{name:'', party:59},{name:'', party:59},{name:'', party:59},{name:'', party:59},{name:'', party:59}];
								this.parties[1][5] = [{name:'', party:48},{name:'', party:48},{name:'', party:48},{name:'', party:48},{name:'', party:48}];
								this.parties[1][6] = [{name:'', party:38},{name:'', party:38},{name:'', party:38},{name:'', party:38},{name:'', party:38}];
								this.parties[1][7] = [{name:'', party:28},{name:'', party:28},{name:'', party:28},{name:'', party:28},{name:'', party:28}];
								this.parties[1][8] = [{name:'', party:18},{name:'', party:18},{name:'', party:18},{name:'', party:18},{name:'', party:18}];
								this.parties[1][9] = [{name:'', party:8},{name:'', party:8},{name:'', party:8},{name:'', party:8},{name:'', party:8}];
								this.partyCPs[0] = 0;
								this.partyCPs[1] = 0;
								this.partyCPs[2] = 0;
								this.partyCPs[3] = 0;
								this.partyCPs[4] = 0;
								this.partyCPs[5] = 0;
								this.partyCPs[6] = 0;
								this.partyCPs[7] = 0;
								this.partyCPs[8] = 0;
								this.partyCPs[9] = 0;
							}
							this.partyCPs[partyCnt] = 0;
							for (var pidx=0; pidx < data.length; pidx++) {
								if (beforeParty != data[pidx].party) {
									if (0 < partyCnt && 5 >= this.parties[rowCnt][partyCnt-1].length) {
										var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
										for (var mpidx=0; mpidx < paddingLen; mpidx++) {
											var emptyUser = {name: '　', cp: '　',};
											this.parties[rowCnt][partyCnt-1].push(emptyUser);
										}
									}
									partyCnt++;
									if (1 < partyCnt && 0 == (partyCnt-1)%5) {
										rowCnt++;
									}
									if ('undefined' == typeof this.parties[rowCnt]) {
										this.parties[rowCnt] = [];
									}
									if ('undefined' == typeof this.parties[rowCnt][partyCnt-1]) {
										this.parties[rowCnt][partyCnt-1] = [];
										this.partyCPs[partyCnt-1] = 0;
									}
									if (-1 < this.partySchedule.tag.indexOf('レイド') && 'undefined' != typeof this.parties[rowCnt][partyCnt-1] && 'undefined' != typeof this.parties[rowCnt][partyCnt-1][0] && this.parties[rowCnt][partyCnt-1][0].name == '') {
										while (11 > partyCnt && this.parties[rowCnt][partyCnt-1][0].party != data[pidx].party) {
											if (0 < partyCnt && 5 >= this.parties[rowCnt][partyCnt-1].length) {
												var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
												for (var mpidx=0; mpidx < paddingLen; mpidx++) {
													console.log('mpidx='+paddingLen+' & '+mpidx);
													var emptyUser = {name: '　', cp: '　',};
													this.parties[rowCnt][partyCnt-1].push(emptyUser);
												}
											}
											partyCnt++;
											if (1 < partyCnt && 0 == (partyCnt-1)%5) {
												rowCnt++;
											}
											if ('undefined' == typeof this.parties[rowCnt]) {
												this.parties[rowCnt] = [];
											}
											if ('undefined' == typeof this.parties[rowCnt][partyCnt-1]) {
												this.parties[rowCnt][partyCnt-1] = [];
												this.partyCPs[partyCnt-1] = 0;
											}
										}
									}
								}
								if (-1 < this.partySchedule.tag.indexOf('レイド') && 'undefined' != typeof this.parties[rowCnt][partyCnt-1] && 'undefined' != typeof this.parties[rowCnt][partyCnt-1][0] && this.parties[rowCnt][partyCnt-1][0].name == '') {
									this.parties[rowCnt][partyCnt-1] = [];
									this.parties[rowCnt][partyCnt-1][0] = data[pidx];
								}
								else {
									this.parties[rowCnt][partyCnt-1].push(data[pidx]);
								}
								this.partyCPs[partyCnt-1] += parseInt(data[pidx].cp);
								beforeParty = data[pidx].party;
							}
							if (0 < partyCnt && 5 > this.parties[rowCnt][partyCnt-1].length) {
								var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
								for (var mpidx=0; mpidx < paddingLen; mpidx++) {
									var emptyUser = {name: '　', cp: '　',};
									this.parties[rowCnt][partyCnt-1].push(emptyUser);
								}
							}
							console.log('this.parties=');
							console.log(this.parties);
							console.log(this.partyCPs);
							riot.update();
							if (opts.scheduleid && 'function' == typeof onLoadParty) {
								onLoadParty(schedule);
							}
							else {
								// XXX PC・タブレットのみドラッグアンドドロップソートを有効にする
								if ($('#partytable') && 0 < $('#partytable').size()/* && 760 < window.innerWidth && 700 < window.innerHeight*/) {
									for (var pidx=0; pidx < 11; pidx++) {
										if ($('#partytable'+pidx) && 0 < $('#partytable'+pidx+' li').size()) {
											//$('#partytable'+pidx).sortable();
											Sortable.create($('#partytable'+pidx)[0],
												{
													group: {
															name: 'partytable',
													},
													draggable: '.ptuser',
													onEnd: function(e) {
														console.log(e);
														if (e.newIndex == e.oldIndex && e.from == e.to) {
															return;
														}
														console.log(e.item);
														console.log(e.to);
														var _targetUserID = $(e.item).data('userid');
														console.log(_targetUserID);
														if ('undefined' == typeof _targetUserID) {
															return;
														}
														var _targetUsers = entryUsers.filter(function(_user){
															return _user.ID == _targetUserID;
														});
														var scheduleuser = _targetUsers[0];
														console.log(scheduleuser);
														var _newParty = $(e.to).data('party');
														if (-1 < schedule.tag.indexOf('レイド')) {
															if (0 == (_newParty + 1) % 10) {
																_newParty = _newParty - 50;
															}
														}
														if ('undefined' != typeof scheduleuser.party && scheduleuser.party == _newParty) {
															return;
														}
														scheduleuser.party = _newParty;
														var entrypusers = entryUsers.filter(function(_user){
															return _user.party == _newParty;
														});
														if (5 <= entrypusers.length) {
															alert('このPTは既に5人編成済みですが処理そのまま保存されますのでご注意下さい！');
														}
														loading(true);
														registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
															loading(false);
														});
														return false;
													},
												}
											);
										}
									}
								}
							}
						};
						if (partyUsers != null && 'undefined' != typeof partyUsers.length) {
							partyUsers.sort(function(a, b){
								if( parseInt(a.cp) > parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return 1;
								return 0;
							});
							partyUsers.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
							viewGrid(schedule, partyUsers);
						}
						else {
							auth(false, function (clan) {
								if (location.hash == '#party') {
									$('footer').hide();
								}
								var scheduleid = undefined
								if (location.hash == '#party') {
									scheduleid = getParams['scheduleid'];
								}
								else if (opts.scheduleid) {
									scheduleid = opts.scheduleid;
								}
								if ('undefined' == typeof scheduleid || scheduleid == 'none') {
									return;
								}
								// APIからデータを撮ってくる
								getSchedule(scheduleid, function(schedule) {
									var removeusers = {};
									getUsers(clan.ID, false, function(users) {
										console.log('pusers=');
										console.log(users);
										getScheduleUsers(scheduleid, null, function(entryOKUsers) {
											console.log(entryOKUsers);
											for (var uidx=0; uidx < users.length; uidx++) {
												for (var euidx=0; euidx < entryOKUsers.length; euidx++) {
													if (users[uidx].ID != entryOKUsers[euidx].ID) {
														if (!removeusers[entryOKUsers[euidx].ID]) {
															removeusers[entryOKUsers[euidx].ID] = 0;
														}
														removeusers[entryOKUsers[euidx].ID]++;
														if (removeusers[entryOKUsers[euidx].ID] == users.length) {
															entryOKUsers.splice(euidx, 1);
														}
													}
												}
											}
											console.log('removeusers=');
											console.log(removeusers);
											viewGrid(schedule, entryOKUsers);
										});
									});
								});
							});
						}
					});
				</party>
			</script>

			<!-- detailschedule -->
			<script type="riot/tag">
				<detailschedule>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div if={schedule.type!=1} style="padding-left: 10px; padding-right: 10px;">
									<h3>参加登録</h3>
									<form id="entryscheduleform">
										<div class="form-group">
											<select class="form-control" name="scheduleuser">
												<option value="-1">参加キャラ</option>
												<option each="{_user, index in selectusers_}" value={index} data={escapeHTML(_user.name)}>{_user.outlabel}{_user.name}</option>
											</select>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="schedulecomment" class="form-control" placeholder="コメント(任意 希望配置とかあれば)"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<input type="hidden" name="scheduleparty" class="form-control" value="0"/>
											<div class="btn-group">
												<botton class="btn btn-success" onclick="{onEntryOK}">◯</botton>
												<botton class="btn btn-warning" onclick="{onEntryMaybe}">△</botton>
												<botton class="btn btn-danger" onclick="{onEntryNG}">✕</botton>
											</div>
										</div>
										<br/>
										<div if={'on'!=getParams['view']}>
											<h4 if={-1 < schedule.tag.indexOf('レイド')}>
												レイドPT設定
												<small style="font-size: xx-small;">
													<br/>
													※レイドボス一覧で上から1,2,3と勘定するのが理想です
												</small>
											</h4>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-default" disabled="disabled"><b>ボス1</b></botton>
													<botton class="btn btn-default" onclick="{onEntryPT}" data-party="49">1A</botton>
													<botton class="btn btn-default" onclick="{onEntryPT}" data-party="48">1B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
												<botton class="btn btn-info" disabled="disabled"><b>ボス2</b></botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="39">2A</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="38">2B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-success" disabled="disabled"><b>ボス3</b></botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="29">3A</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="28">3B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-warning" disabled="disabled"><b>ボス4</b></botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="19">4A</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="18">4B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger" disabled="disabled"><b>ボス5</b></botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="9">5A</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="8">5B</botton>
												</div>
											</div>
											<h4 if={0 > schedule.tag.indexOf('レイド')}>PT設定</h4>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="39">聖刻</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="38">偵察</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="37">封殺</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="29">FW1</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="28">FW2</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="27">FW3</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="19">MF1</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="18">MF2</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="17">MF3</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="9">DF1</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="8">DF2</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="7">DF3</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-default focus" onclick="{onEntryPT}" data-party="0">PTから外す</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger focus" onclick="{onAllDientryPT}">PTオールリセット</botton>
												</div>
											</div>
											<div class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger focus" onclick="{onAllDientry}">出欠フルリセット</botton>
												</div>
											</div>
										</div>
										<br/>
										<div if={'on'!=getParams['view']}>
											<h4>PTラベル設定 <small><botton onclick="{switchPTLabelEdit}" style="border: 1px solid gray;">開く</botton></small></h4>
											<div id="ptlabelform" style="display: none;">
												<small>※ラベルは<a href="javascript: void(0);" onclick="{showPT}">PT表</a>時に適用されます</small>
												<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept49label" value="{schedule.pt49label}" class="form-control" placeholder="1A"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept48label" value="{schedule.pt48label}" class="form-control" placeholder="1B"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept39label" value="{schedule.pt39label}" class="form-control" placeholder="2A"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept39label" value="{schedule.pt39label}" class="form-control" placeholder="聖刻"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept38label" value="{schedule.pt38label}" class="form-control" placeholder="2B"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept38label" value="{schedule.pt38label}" class="form-control" placeholder="偵察"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept37label" value="{schedule.pt37label}" class="form-control" placeholder="封殺"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept29label" value="{schedule.pt29label}" class="form-control" placeholder="3A"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept29label" value="{schedule.pt29label}" class="form-control" placeholder="FW1"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept28label" value="{schedule.pt28label}" class="form-control" placeholder="3B"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept28label" value="{schedule.pt28label}" class="form-control" placeholder="FW2"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept27label" value="{schedule.pt27label}" class="form-control" placeholder="FW3"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept19label" value="{schedule.pt19label}" class="form-control" placeholder="4A"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept19label" value="{schedule.pt19label}" class="form-control" placeholder="MF1"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept18label" value="{schedule.pt18label}" class="form-control" placeholder="4B"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept18label" value="{schedule.pt18label}" class="form-control" placeholder="MF2"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept17label" value="{schedule.pt17label}" class="form-control" placeholder="MF3"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept9label" value="{schedule.pt9label}" class="form-control" placeholder="5A"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept9label" value="{schedule.pt9label}" class="form-control" placeholder="DF1"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<input if={-1 < schedule.tag.indexOf('レイド')} type="text" name="schedulept8label" value="{schedule.pt8label}" class="form-control" placeholder="5B"/>
														<input if={0 > schedule.tag.indexOf('レイド')} type="text" name="schedulept8label" value="{schedule.pt8label}" class="form-control" placeholder="DF2"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
													<div class="btn-group">
														<input type="text" name="schedulept7label" value="{schedule.pt7label}" class="form-control" placeholder="DF3"/>
														<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
													</div>
												</div>
												<div class="form-group">
													<div class="btn-group">
														<botton class="btn btn-success" onclick="onclickSavePTLabel(this, '{schedule.ID}')">適用</botton>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>
								<br/>
								<h3 style="margin-left: 10px; margin-bottom: -10px;">予定詳細</h3>
								<addschedule/>
							</div>
						</div>
						<div class="col-xs-8">
							<div if={schedule.type!=1} class="container-fluid">
								<h3 style="padding-left: 10px;">参加者一覧 <small><a href="javascript: void(0);" onclick="{showPT}">[PT表]</a></small></h3>
								<div if={mode==1} style="width: 150px; margin-top: -50px; margin-left: auto; margin-right: 10px; margin-bottom: 5px;">
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: firebrick;">&nbsp;前衛&nbsp;{attckAssistans}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: orange;">&nbsp;魔攻&nbsp;{criticalAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: blue;">&nbsp;盾職&nbsp;{defenseAssistans}</span>
									<br style="clear: both;"/>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: green;">&nbsp;短剣&nbsp;{moveAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: dodgerblue;">&nbsp;弓職&nbsp;{hitAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: deeppink;">&nbsp;回復&nbsp;{healAssistans}</span>
									<br style="clear: both;"/>
								</div>
								<users if={-1 < schedule.tag.indexOf('レイド')} data='{scheduleusers}' mode='schedule' submode='bossraid'/>
								<users if={-1 < schedule.tag.indexOf('要塞') || -1 < schedule.tag.indexOf('攻城')} data='{scheduleusers}' mode='schedule' submode='gvg'/>
								<users if={0 > schedule.tag.indexOf('レイド') && 0 > schedule.tag.indexOf('要塞') && 0 > schedule.tag.indexOf('攻城')} data='{scheduleusers}' mode='schedule'/>
							</div>
							<div if={schedule.type!=1 && 'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>未表明者一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th style="width:80px;">未表明キャラ</th>
												<th style="width:100px;">discordタグ</th>
												<th>メモ</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{_outuser, index in outusers}" >
												<td class="action"><botton class="btn btn-danger" onclick="onclickNotify(this, &quot;{_outuser.name}&quot;, &quot;{_outuser.discord}&quot;);">催促</botton></td>
												<td onclick="onclickModify(this, '{_outuser.ID}');"><strong class="scheduleusername">{_outuser.name}</strong></td>
												<td onclick="onclickModify(this, '{_outuser.ID}');" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;"><strong class="danger">{_outuser.discord}</strong></td>
												<td onclick="onclickDetail(this, '{_outuser.ID}');" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;">{_outuser.memo}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>同一タグお知らせ一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<br/>
													<br/>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');">修正</botton>
												</td>
												<td class="newstext" style="width: 34px; font-size: 5px;"><pre>{news.text}</pre></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					var attckAssistans = 0;
					var criticalAssistants = 0;
					var defenseAssistans = 0;
					var moveAssistants = 0;
					var hitAssistants = 0;
					var healAssistans = 0;

					var selectusers = [];
					var scheduleusers = [];
					var outusers = [];
					var removeusers = {};
					var removed = false;
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getUsers(clan.ID, false, function(users) {
								thisis.selectusers = users;
								getScheduleUsers(getParams['scheduleid'], null, function(scheduleusers) {
									thisis.attckAssistans = attckAssistans;
									thisis.criticalAssistants = criticalAssistants;
									thisis.defenseAssistans = defenseAssistans;
									thisis.moveAssistants = moveAssistants;
									thisis.hitAssistants = hitAssistants;
									thisis.healAssistans = healAssistans;
									var inuser = [];
									var outuser = [];
									thisis.outusers = [];
									scheduleusers.sort(function(a, b){
										if( 'undefined' == typeof a.status  ) {
											a.status = 0;
										}
										if( 'undefined' == typeof b.status  ) {
											b.status = 0;
										}
										if( a.party >= b.party ) {
											if( a.status > b.status ) {
												return -1;
											}
											if( a.status <= b.status ) {
												return 1;
											}
										}
										return 0;
									});
									thisis.scheduleusers = scheduleusers;
									var inLoop = 0;
									for (var uidx=0; uidx < thisis.selectusers.length; uidx++) {
										var entryed = false;
										thisis.selectusers[uidx].outlabel = '未表明:';
										for (var suidx=0; suidx < thisis.scheduleusers.length; suidx++) {
											if (thisis.selectusers[uidx].ID == thisis.scheduleusers[suidx].ID){
												// 最新パラメータのコピー
												thisis.scheduleusers[suidx].name = thisis.selectusers[uidx].name;
												thisis.scheduleusers[suidx].cp = parseInt(thisis.selectusers[uidx].cp);
												thisis.scheduleusers[suidx].activity = thisis.selectusers[uidx].activity;
												if (mode==1) {
													thisis.scheduleusers[suidx].job3d = thisis.selectusers[uidx].job3d;
													thisis.scheduleusers[suidx].acce1 = parseInt(thisis.selectusers[uidx].acce1);
													if ('undefined' != typeof thisis.selectusers[uidx].acce2 && null != thisis.selectusers[uidx].acce2 && '' != thisis.selectusers[uidx].acce2) {
														thisis.scheduleusers[suidx].acce2 = parseInt(thisis.selectusers[uidx].acce2);
													}
													thisis.scheduleusers[suidx].bukicos = thisis.selectusers[uidx].bukicos;
													thisis.scheduleusers[suidx].meteo = thisis.selectusers[uidx].meteo;
													thisis.scheduleusers[suidx].dzone = thisis.selectusers[uidx].dzone;
													thisis.scheduleusers[suidx].manto = thisis.selectusers[uidx].manto;
													thisis.scheduleusers[suidx].pvpat = thisis.selectusers[uidx].pvpat;
													thisis.scheduleusers[suidx].pvpdf = thisis.selectusers[uidx].pvpdf;
													thisis.scheduleusers[suidx].sweet = thisis.selectusers[uidx].sweet;
													thisis.scheduleusers[suidx].mamono = thisis.selectusers[uidx].mamono;
													thisis.scheduleusers[suidx].dragon = thisis.selectusers[uidx].dragon;
													thisis.scheduleusers[suidx].boss = thisis.selectusers[uidx].boss;
													thisis.scheduleusers[suidx].subjob = thisis.selectusers[uidx].subjob;
													thisis.scheduleusers[suidx].subjob3d = thisis.selectusers[uidx].subjob3d;
													thisis.scheduleusers[suidx].subcp = thisis.selectusers[uidx].subcp;
												}
												thisis.selectusers[uidx].outlabel = '';
												if (thisis.selectusers[uidx].activity == -9) {
													thisis.selectusers[uidx].outlabel = '除名:';
												}
												thisis.selectusers[uidx].entry = thisis.scheduleusers[suidx].entry;
												thisis.selectusers[uidx].party = thisis.scheduleusers[suidx].party;
												if ('undefined' != typeof thisis.scheduleusers[suidx].status) {
													thisis.selectusers[uidx].status = thisis.scheduleusers[suidx].status;
												}
												if ('undefined' != typeof thisis.scheduleusers[suidx].voice) {
													thisis.selectusers[uidx].voice = thisis.scheduleusers[suidx].voice;
												}
												if (inLoop < thisis.scheduleusers.length) {
													// 種別振り分けは一度すれば十分
													if (jobbufs[thisis.scheduleusers[suidx].job]=='攻撃') {
														thisis.attckAssistans++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='クリ') {
														thisis.criticalAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='防御') {
														thisis.defenseAssistans++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='移動') {
														thisis.moveAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='命中') {
														thisis.hitAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='HP') {
														thisis.healAssistans++;
													}
													inLoop++;
												}
												inuser.push(thisis.selectusers[uidx]);
												entryed = true;
											}
											else {
												// 一致しないユーザーは削除用にストック
												if (!removeusers[thisis.scheduleusers[suidx].ID]) {
													removeusers[thisis.scheduleusers[suidx].ID] = 0;
												}
												removeusers[thisis.scheduleusers[suidx].ID]++;
												if (removeusers[thisis.scheduleusers[suidx].ID] == thisis.selectusers.length) {
													if (0 < parseInt(thisis.scheduleusers[suidx].entry)) {
														schedule.incount--;
														if (0 > schedule.incount) {
															schedule.incount = 0;
														}
													}
													thisis.scheduleusers[suidx] = null;
													removed = true;
												}
											}
										}
										if (false == entryed && thisis.selectusers[uidx].activity < 0) {
											thisis.selectusers[uidx].outlabel = '';
											if (thisis.selectusers[uidx].activity == -1) {
												thisis.selectusers[uidx].outlabel = '傭兵:';
											}
											inuser.push(thisis.selectusers[uidx]);
											entryed = true;
										}
										if (false === entryed) {
											outuser.push(thisis.selectusers[uidx]);
										}
									}
									if (removed) {
										var _scheduleusers = [];
										for (var suidx=0; suidx < thisis.scheduleusers.length; suidx++) {
											if (null != thisis.scheduleusers[suidx]) {
												_scheduleusers.push(thisis.scheduleusers[suidx]);
											}
										}
										thisis.scheduleusers = _scheduleusers;
									}
									if (0 < outuser.length) {
										thisis.outusers = outuser;
										thisis.selectusers = inuser;
										var length = outuser.length;
										for (var oIdx=0; oIdx < length; oIdx++) {
											thisis.selectusers.unshift(outuser[oIdx]);
										}
										// XXX バグ対応の暫定処理
										selectusers_ = thisis.selectusers;
										thisis.selectusers_ = selectusers_;
									}
									else {
										thisis.selectusers_ = thisis.selectusers;
									}
									$('#addscheduleform input[name=scheduletag]').ready(function (){
										console.log(window.innerWidth + ' & ' + window.innerHeight);
										//if ($('#partylist') && 0 < $('#partylist').size() && 'iOS' != platform.os.family && 'Android' != platform.os.family && 'Windows Phone' != platform.os.family) {
											// XXX PCのみドラッグアンドドロップソートを有効にする
										if ($('#partylist') && 0 < $('#partylist').size() && 760 < window.innerWidth && 700 < window.innerHeight) {
											// XXX PC・タブレットのみドラッグアンドドロップソートを有効にする
											Sortable.create( document.getElementById('partylist'),
												{
													tag: 'tr',
													/*handle: '. draggable',*/
												  onUpdate: function(e) {
														console.log(e);
														console.log(e.newIndex);
														var to = $($('#partylist tr')[e.newIndex-1]).find('.scheduleparty');
														var from  = $($('#partylist tr')[e.newIndex]).find('.scheduleparty');
														var next = $($('#partylist tr')[e.newIndex+1]).find('.scheduleparty');
														var dataindex = parseInt($($('#partylist tr')[e.newIndex]).attr('index'));
														console.log(dataindex);
														console.log(to);
														console.log(from);
														console.log(next);
														if (!to.text()) {
															to = next;
														}
														var scheduleusername = from.parent().find('.scheduleusername').text();
														var schedulecomment = from.parent().find('.schedulecomment').text();
														var scheduleparty = to.data();
														var scheduleuserindex = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + escapeHTML(scheduleusername) + '"]').val();
														if (scheduleparty.party == thisis.selectusers_[scheduleuserindex].party) {
															// PT変わってないので無視
															return;
														}
														console.log(scheduleuserindex);
														var scheduleuser = thisis.selectusers_[scheduleuserindex];
														scheduleuser.party = scheduleparty.party;
														thisis.scheduleusers[dataindex].party = parseInt(scheduleparty.party);
														console.log(thisis.selectusers_);
														var entryCnt = 0;
														for (var eIdx=0; eIdx < thisis.scheduleusers.length; eIdx++) {
															if ('undefined' != typeof thisis.scheduleusers[eIdx].party && scheduleuser.party == thisis.scheduleusers[eIdx].party && 0 < parseInt(scheduleuser.party)) {
																entryCnt++;
																if (5 < entryCnt) {
																	alert('このPTは既に5人編成済みですが処理そのまま保存されますのでご注意下さい！');
																	break;
																}
															}
														}
														from.data(to.data());
														from.text(to.text());
														from.attr('data-party', scheduleparty.party);
														if (1 > thisis.scheduleusers[dataindex].party) {
															var target = from.parent().find('.scheduleuserstatus');
															console.log('target=');
															console.log(target);
															$(target).removeClass('bg-info');
															$(target).removeClass('bg-success');
															$(target).removeClass('bg-danger');
															$(target).removeClass('text-info');
															$(target).removeClass('text-success');
															$(target).removeClass('text-danger');
															$(target).attr('propaty', 0);
															$(target).text('');
															thisis.scheduleusers[dataindex].status = 0;
														}
														loading(true);
														registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
															loading(false);
														});
														return false;
													}
												}
											);
										}
										var tag = $('#addscheduleform input[name=scheduletag]').val();
										if ('undefined' != typeof tag && 0 < tag.length) {
											getNews(clan.ID, tag, function (newses) {
												thisis.newses = newses;
												riot.update();
											});
										}
										else {
											riot.update();
										}
									});
								});
							});
						});
						dispatchPortlateLayout();
					});
					showPT = function () {
						//partyUsers = thisis.scheduleusers;
						var newhref = '?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#party';
						if ('on' == getParams['view']) {
								newhref = newhref.replace('#party', '&view=on#party')
						}
						location.href = newhref;
					};
					switchPTLabelEdit = function (event) {
						if ($(event.target).text() == '開く') {
							$('#ptlabelform').show();
							$(event.target).text('閉じる');
						} else {
							$('#ptlabelform').hide();
							$(event.target).text('開く');
						}
					};
					onEntryOK = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = 1;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryMaybe = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = 0;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						else if (!confirm('条件付きで参加可の場合コメントにその条件を明記して\n予定の管理者にその旨を伝えましょう！\n無視して登録を続ける場合はOKを押して下さい。')){
							return;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryNG = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index) || isNaN(parseInt(index))) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = -1;
						scheduleuser.status = 0;
						scheduleuser.party = 0;
						scheduleuser.voice = 0;
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					switchType = function (target, propaty) {
						var now = $(target).attr('propaty');
						if ('status' == propaty) {
							next = parseInt(now) - 1;
							if (-1 > next) {
								next = 2;
							}
						}
						else if ('dual' == propaty) {
							next = parseInt(now) + 1;
							if (1 < next) {
								next = 0;
							}
						}
						else {
							next = parseInt(now) + 1;
							if (2 < next) {
								next = -1;
							}
						}
						var scheduleusername = $(target).parent().find('.scheduleusername').text();
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + escapeHTML(scheduleusername) + '"]').val();
						var scheduleuser = thisis.selectusers_[index];
						if ('undefined' == typeof scheduleuser.entry) {
							alert('出欠登録を先にする必要があります。');
							return;
						}
						if ('status' == propaty) {
							if (0 > parseInt(scheduleuser.entry)) {
								alert('欠席予定の方のステータスを変更する事は出来ません。');
								return;
							}
							if ('undefined' == typeof scheduleuser.party) {
								alert('PTに入っていない方のステータスを変更する事は出来ません。');
								return;
							}
							if (0 >= parseInt(scheduleuser.party)) {
								alert('PTに入っていない方のステータスを変更する事は出来ません。');
								return;
							}
							scheduleuser.status = next;
						}
						scheduleuser[propaty] = next;
						loading(true);
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							if ('status' == propaty) {
								$(target).removeClass('bg-info');
								$(target).removeClass('bg-success');
								$(target).removeClass('bg-danger');
								$(target).removeClass('text-info');
								$(target).removeClass('text-success');
								$(target).removeClass('text-danger');
								if (2 == next) {
									$(target).addClass('bg-info');
									$(target).addClass('text-info');
									$(target).attr('propaty', next);
									$(target).text('リダ');
								}
								else if (1 == next) {
									$(target).addClass('bg-success');
									$(target).addClass('text-success');
									$(target).attr('propaty', next);
									$(target).text('サブ');
								}
								else if (-1 == next) {
									$(target).addClass('bg-danger');
									$(target).addClass('text-danger');
									$(target).attr('propaty', next);
									$(target).text('急欠');
								}
								else {
									$(target).attr('propaty', next);
									$(target).text('');
								}
							}
							else if ('dual' == propaty) {
								$(target).removeClass('bg-info');
								if (1 == next) {
									$(target).addClass('bg-info');
									$(target).attr('propaty', next);
									$(target).text('Dual');
								}
								else {
									$(target).attr('propaty', next);
									$(target).text('');
								}
							}
							else if ('voice' == propaty) {
								$(target).removeClass('bg-success');
								if (1 == next) {
									$(target).addClass('bg-info');
									$(target).removeClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').addClass('fa-microphone');
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').text('');
								}
								else if (2 == next) {
									$(target).removeClass('bg-info');
									$(target).addClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').addClass('fa-microphone-slash');
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').text('');
								}
								else if (-1 == next) {
									$(target).removeClass('bg-success');
									$(target).removeClass('bg-info');
									$(target).attr('propaty', next);
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').text('✕');
								}
								else {
									$(target).removeClass('bg-info');
									$(target).removeClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').text('');
								}
							}
							thisis.selectusers_[index] = scheduleuser;
							loading(false);
						});
					}
					onEntryPT = function (target) {
						var partyData = $(target.srcElement).data();
						if ('undefined' != typeof partyData && 'undefined' != typeof partyData.party && 0 <= parseInt(partyData.party)){
							var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
							if (0 > parseInt(index)) {
								alert('参加キャラを選択して下さい。');
								return;
							}
							var scheduleuser = thisis.selectusers_[index];
							if ('undefined' == typeof scheduleuser.entry) {
								alert('出欠登録を先にする必要があります。');
								return;
							}
							if (0 > parseInt(scheduleuser.entry)) {
								alert('欠席予定の方をPTに入れる事は出来ません。');
								return;
							}
							scheduleuser.comment = '';
							var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
							if (0 < comment.length) {
								scheduleuser.comment = comment;
							}
							var uIdx = 0;
							var bufDuplicated = false;
							var jobDuplicated = false;
							var entryCnt = 0;
							for (var eIdx=0; eIdx < thisis.scheduleusers.length; eIdx++) {
								if (thisis.scheduleusers[eIdx] != null) {
									if ('undefined' != typeof thisis.scheduleusers[eIdx].party && 0 < partyData.party && partyData.party == thisis.scheduleusers[eIdx].party) {
										entryCnt++;
										if (scheduleuser.job == thisis.scheduleusers[eIdx].job) {
											jobDuplicated = true;
											bufDuplicated = false;
										}
										if (false == jobDuplicated && 'undefined' != jobbufs[scheduleuser.job] && 'undefined' != typeof jobbufs[thisis.scheduleusers[eIdx].job] && jobbufs[scheduleuser.job] == jobbufs[thisis.scheduleusers[eIdx].job]) {
											bufDuplicated = true;
										}
										if (5 <= entryCnt) {
											alert('このPTは既に5人編成済みです。');
											return;
											break;
										}
									}
									if (scheduleuser.name == thisis.scheduleusers[eIdx].name) {
										uIdx = eIdx;
									}
								}
							}
							if (jobDuplicated) {
								if (!confirm('同じ職種のキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							if (bufDuplicated) {
								if (!confirm('同種PTバフのキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							scheduleuser.party = partyData.party;
							thisis.scheduleusers[uIdx].party = partyData.party;
							var targetElm = $('#partylist tr[index="'+uIdx+'"] .scheduleparty');
							targetElm.data(partyData);
							if ($(target.srcElement).text() == 'PTから外す') {
								targetElm.text('無');
							}
							else {
								targetElm.text($(target.srcElement).text());
							}
							targetElm.attr('data-party', partyData.party);
							loading(true);
							registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
								loading(false);
								/*getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
									$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
										onclickRegisterSchedule(null, getParams['scheduleid']);
									});
								});*/
							});
						}
					};
					onAllDientry = function (target) {
						if (!confirm('全てのキャラの出欠をリセットします！PT編成も全てリセットされます！\nよろしいですか？')) {
							return;
						}
						loading(true);
						allDientry = function (uIdx){
							console.log('uIdx='+uIdx);
							if ('undefined' != typeof thisis.scheduleusers[uIdx] && 'undefined' != typeof thisis.scheduleusers[uIdx].ID) {
								unregisterScheduleuser(getParams['scheduleid'], thisis.scheduleusers[uIdx].ID, function (){
									allDientry(uIdx+1);
								});
							}
							else if (uIdx < thisis.scheduleusers.length) {
								allDientry(uIdx+1);
							}
							else {
								$('#addscheduleform').find('input[name=scheduleincount]').val(0).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
									alert('全てのキャラの出欠をリセットしました。');
								});
								return;
							}
						};
						allDientry(0);
					};
					onAllDientryPT = function (target) {
						if (!confirm('全てのキャラをPTから外します！\nよろしいですか？')) {
							return;
						}
						loading(true);
						allDientryPT = function (uIdx){
							console.log('uIdx='+uIdx);
							if ('undefined' != typeof thisis.scheduleusers[uIdx] && 0 < thisis.scheduleusers[uIdx].party) {
								thisis.scheduleusers[uIdx].party = 0;
								if ('同一タグの前回のPT編成をコピー' == thisis.scheduleusers[uIdx].comment) {
									thisis.scheduleusers[uIdx].comment = '';
								}
								registerScheduleuser(getParams['scheduleid'], thisis.scheduleusers[uIdx], function (){
									allDientryPT(uIdx+1);
								});
							}
							else if (uIdx < thisis.scheduleusers.length) {
								allDientryPT(uIdx+1);
							}
							else {
								loading(false);
								alert('全てのキャラをPTから外しました。');
								location.reload();
								return;
							}
						};
						allDientryPT(0);
					};
				</detailschedule>
			</script>

			<!-- addnews -->
			<script type="riot/tag">
				<addnews>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ登録</h3>
									<form id="editnewsform">
										<div class="form-group">
											<textarea class="form-control" name="newstext" placeholder="【周知】木曜22時はギロフェスです！" rows="3">{news.text}</textarea>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newstag" class="form-control" placeholder="#要塞戦"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
											<small style="font-size: xx-small;">
												予定とタグで連動した場合、お知らせテキストには予定の情報を変数で利用できます
												<br/>
												【利用可能な変数】
												<br/>
												***urlview*** (参加者(閲覧者)用の予定のURL)
												<br/>
												***ptview*** (参加者(閲覧者)用のPT編成URL)
												<br/>
												***url*** (予定のURL)
												<br/>
												***pt*** (予定の(参加者用では無い)PT編成URL)
												<br/>
												***date*** (予定日時)
												<br/>
												***title*** (予定名)
											</small>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newsid" class="form-control" placeholder="任意:空欄は新規登録"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<br/>
										<h4>お知らせの自動通知設定</h4>
										<small style="font-size: xx-small;">
											※デフォルトは同じタグで設定された予定と連動した通知になっています
											<br/>
											設定を変えた場合、予定とは連動せずに独立して通知されます。
										</small>
										<div class="form-group">
											<select class="form-control" name="newsnotifymode">
												<option value="">同じタグの予定と連動</option>
												<option value="1">毎日通知</option>
												<option value="11">毎週日曜通知</option>
												<option value="12">毎週月曜通知</option>
												<option value="13">毎週火曜通知</option>
												<option value="14">毎週水曜通知</option>
												<option value="15">毎週木曜通知</option>
												<option value="16">毎週金曜通知</option>
												<option value="17">毎週土曜通知</option>
											</select>
										</div>
										<div class="form-group">
											<select class="form-control" name="newsnotifytime">
											<option value="">3日前から0時頃に通知</option>
												<option value="24">0時頃</option>
												<option value="23">23時頃</option>
												<option value="22">22時頃</option>
												<option value="21">21時頃</option>
												<option value="20">20時頃</option>
												<option value="19">19時頃</option>
												<option value="18">18時頃</option>
												<option value="17">17時頃</option>
												<option value="16">16時頃</option>
												<option value="15">15時頃</option>
												<option value="14">14時頃</option>
												<option value="13">13時頃</option>
												<option value="12">12時頃</option>
												<option value="11">11時頃</option>
												<option value="10">10時頃</option>
												<option value="9">9時頃</option>
												<option value="8">8時頃</option>
												<option value="7">7時頃</option>
												<option value="6">6時頃</option>
											</select>
										</div>
										<botton class="btn btn-success" onclick="onclickRegisterNews(this)">登録</botton>
										<botton if={'on'!= getParams['view']} class="btn btn-danger" onclick="onclickUnRegisterNews(this)">削除</botton>
									</form>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ一覧</h3>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
												<th style="width:60px;">タグ</th>
												<th style="width:60px;">通知設定</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');" style="margin-top: 10px;">修正</botton>
												</td>
												<td class="newstext"><pre>{news.text}</pre></td>
												<td class="newstag">{news.tag}</td>
												<td>
													<p class="notifymode" if={'undefined' == typeof news.notifymode || 0 == news.notifymode || isNaN(news.notifymode)}>同じタグ<br/>の予定<br/>と連動</p>
													<p class="notifymode" if={1 == news.notifymode}>毎日</p>
													<p class="notifymode" if={11 == news.notifymode}>毎週日曜</p>
													<p class="notifymode" if={12 == news.notifymode}>毎週月曜</p>
													<p class="notifymode" if={13 == news.notifymode}>毎週火曜</p>
													<p class="notifymode" if={14 == news.notifymode}>毎週水曜</p>
													<p class="notifymode" if={15 == news.notifymode}>毎週木曜</p>
													<p class="notifymode" if={16 == news.notifymode}>毎週金曜</p>
													<p class="notifymode" if={17 == news.notifymode}>毎週土曜</p>
													<p class="notifytime" if={'undefined' == typeof news.notifytime || 0 == news.notifytime || isNaN(news.notifytime)}>3日前<br/>から0時</p>
													<p class="notifytime" if={24 == news.notifytime}>0時</p>
													<p class="notifytime" if={23 == news.notifytime}>23時</p>
													<p class="notifytime" if={22 == news.notifytime}>22時</p>
													<p class="notifytime" if={21 == news.notifytime}>21時</p>
													<p class="notifytime" if={20 == news.notifytime}>20時</p>
													<p class="notifytime" if={19 == news.notifytime}>19時</p>
													<p class="notifytime" if={18 == news.notifytime}>18時</p>
													<p class="notifytime" if={17 == news.notifytime}>17時</p>
													<p class="notifytime" if={16 == news.notifytime}>16時</p>
													<p class="notifytime" if={15 == news.notifytime}>15時</p>
													<p class="notifytime" if={14 == news.notifytime}>14時</p>
													<p class="notifytime" if={13 == news.notifytime}>13時</p>
													<p class="notifytime" if={12 == news.notifytime}>12時</p>
													<p class="notifytime" if={11 == news.notifytime}>11時</p>
													<p class="notifytime" if={10 == news.notifytime}>10時</p>
													<p class="notifytime" if={9 == news.notifytime}>9時</p>
													<p class="notifytime" if={8 == news.notifytime}>8時</p>
													<p class="notifytime" if={7 == news.notifytime}>7時</p>
													<p class="notifytime" if={6 == news.notifytime}>6時</p>
												</td>
											</tr>
										</tbody>
									</table>
							</div>
						</div>
					</div>
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getNews(clan.ID, null, function(newses) {
								thisis.newses = newses;
								riot.update();
							});
						});
						dispatchPortlateLayout();
					});
				</addnews>
			</script>

			<!-- contribution -->
			<script type="riot/tag">
				<contribution>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid" style="padding-left: 10px; padding-right: 10px;">
								<h3>週間貢献度集計 {targetDate}</h3>
								<div if={'on'!= getParams['view']}>
									<form id="entrycontributionform">
										<div class="form-group">
											<select class="form-control" name="contributionuser">
												<option value="-1">集計対象キャラ</option>
												<option each="{user, index in users}" value={index} data={user.name}>{user.name}</option>
											</select>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="number" name="contribution" class="form-control" placeholder="貢献度数"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<select class="form-control" name="weekquestcnt">
												<option value="0">週クエ消化数:0</option>
												<option value="1">週クエ消化数:1</option>
												<option value="2">週クエ消化数:2</option>
												<option value="3">週クエ消化数:3</option>
												<option value="4">週クエ消化数:4</option>
												<option value="5">週クエ消化数:5</option>
												<option value="6">週クエ消化数:6</option>
												<option value="7">週クエ消化数:7</option>
												<option value="8">週クエ消化数:8</option>
												<option value="9">週クエ消化数:9</option>
												<option value="10">週クエ消化数:10</option>
											</select>
										</div>
										<div class="form-group bg-info">
											<h5>集計日</h5>
											<div class='input-group date' id='contributiondate'/>
										</div>
										<div class="form-group">
											<botton class="btn btn-success" onclick="{onclickRegisterContribution}">登録</botton>
										</div>
									</form>
								</div>
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr class="info">
											<th>集計日</th>
											<th if={'on'!= getParams['view']} style="width: 70px;">&nbsp;</th>
										</tr>
									</thead>
									<tbody>
										<tr each="{contribution, index in contributions}">
											<td if={'on'== getParams['view']}><a href="?clanid={clan.ID}&contributiondate={contribution.date.replace(/\//g, '-')}&view=on#contribution">{contribution.date}</a></td>
											<td if={'on'!= getParams['view']}><a href="?clanid={clan.ID}&contributiondate={contribution.date.replace(/\//g, '-')}#contribution">{contribution.date}</a></td>
											<td if={'on'!= getParams['view']}><a class="btn btn-danger" href="javascript:void(0)" onclick="onclickUnregisterContribution('{contribution.ID}')">削除</a></td>
										</tr>
									</tbody>
								</table>
							</div>
							<br/>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid" style="margin-top: -25px;">
								<users data='{users}' mode='contribution' contributiondata='{contributionUsers}'/>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>同一タグお知らせ一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<br/>
													<br/>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');">修正</botton>
												</td>
												<td class="newstext" style="width: 34px; font-size: 5px;"><pre>{news.text}</pre></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					var contributiondesc = false;
					var targetDate;
					var users = [];
					var newses = [];
					var contributionUsers = {};
					var contributions = {};
					var thisis;
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						thisis = this;
						thisis.targetDate = targetDate;
						sortContribution = function () {
							if (contributiondesc) {
								contributiondesc = false;
								thisis.users.sort(function(a, b){
									var aContribution = 0;
									var bContribution = 0;
									if ('undefined' != typeof thisis.contributionUsers[a.ID]) {
										aContribution = parseInt(thisis.contributionUsers[a.ID].contribution) - (50 * thisis.contributionUsers[a.ID].weekquestcnt);
									}
									if ('undefined' != typeof thisis.contributionUsers[b.ID]) {
										bContribution = parseInt(thisis.contributionUsers[b.ID].contribution) - (50 * thisis.contributionUsers[b.ID].weekquestcnt);
									}
									if( aContribution < bContribution ) return -1;
									if( aContribution > bContribution ) return 1;
									return 0;
								});
							}
							else {
								contributiondesc = true;
								thisis.users.sort(function(a, b){
									var aContribution = 0;
									var bContribution = 0;
									if ('undefined' != typeof thisis.contributionUsers[a.ID]) {
										aContribution = parseInt(thisis.contributionUsers[a.ID].contribution) - (50 * thisis.contributionUsers[a.ID].weekquestcnt);
									}
									if ('undefined' != typeof thisis.contributionUsers[b.ID]) {
										bContribution = parseInt(thisis.contributionUsers[b.ID].contribution) - (50 * thisis.contributionUsers[b.ID].weekquestcnt);
									}
									if( aContribution > bContribution ) return -1;
									if( aContribution < bContribution ) return 1;
									return 0;
								});
							}
						};
						onclickUnregisterContribution = function (targetID) {
							unregisterContribution(clan.ID, targetID, function (){
								alert('削除しました。');
								location.reload();
								return;
							});
							return;
						};
						onclickRegisterContribution = function (target) {
							var index = $('#entrycontributionform').find('select[name=contributionuser] option:selected').val();
							if (0 > parseInt(index)) {
								alert('集計対象キャラを選択して下さい。');
								return;
							}
							var contribution = $('#entrycontributionform').find('input[name=contribution]').val();
							if (0 >= contribution.length) {
								alert('貢献度を入力して下さい。');
								return;
							}
							contribution = parseInt(contribution);
							var weekquestcnt = parseInt($('#entrycontributionform').find('select[name=weekquestcnt] option:selected').val());
							var contributionUser = this.users[index];
							var contributiondate = $('#entrycontributionform').find('#contributiondate').data().date;
							contributionUser.contribution = contribution;
							contributionUser.weekquestcnt = weekquestcnt;
							contributionUser.contributiondate = new Date(contributiondate);
							registerContribution(clan.ID, contributiondate, contributionUser, function (){
								alert('登録しました。');
								location.reload();
								return;
							});
							return;
						};
						var now = new Date();
						nowStr = now.toLocaleString();
						if ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length) {
							contributiondate = getParams['contributiondate'];
							nowStr = contributiondate.replace(/-/g, '/') + ' 00:00:00';
							var now = new Date(nowStr);
						}
						var month = '' + (now.getMonth() + 1);
						var day = '' + now.getDate();
						if (1 === month.length) {
							nowStr = nowStr.replace('/' + month + '/', '/0' + month + '/');
						}
						if (1 === day.length) {
							nowStr = nowStr.replace('/' + day + ' ', '/0' + day + ' ');
						}
						nowStr = nowStr.split(' ')[0];
						thisis.targetDate = nowStr;
						// 認証
						auth(false, function (clan) {
							getContributions(clan.ID, function(contributions) {
								thisis.contributions = contributions;
								thisis.contributionUsers = contributionUsers;
								$('#contributiondate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00", defaultDate: nowStr + ' 00:00:00'});
								getNews(clan.ID, '週間貢献度集計', function (newses) {
									thisis.newses = newses;
									getUsers(clan.ID, 0, function(users) {
										thisis.users = users;
										var contributionLabel = nowStr.replace(/\//g, '') + '-'  + clan.ID;
										//if ('undefined' != typeof thisis.contributions[contributionLabel]) {
											getContributionUsers(clan.ID, nowStr, function(contributionUsers) {
												thisis.contributionUsers = contributionUsers;
												sortContribution();
												riot.update();
											});
											return;
										//}
										//riot.update();
									});
								});
							});
						});
						dispatchPortlateLayout();
					});
				</contribution>
			</script>

			<!-- users -->
			<script type="riot/tag">
				<users>
					<div style="margin-left: 10px; margin-right: 10px;">
						<table class="table table-bordered table-hover table-striped">
							<thead>
								<tr class="info">
									<th if={opts.mode!='schedule'} onclick="{sortContribution}" style="width: 20px;">No</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 45px; max-width: 45px; min-width: 45px;">実貢献度</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 35px; max-width: 35px; min-width: 35px;">貢献度</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 35px; max-width: 35px; min-width: 35px;">週クエ</th>
									<th if={opts.mode=='schedule'} style="width: 20px; max-width: 20px; min-width: 20px;"></th>
									<th if={opts.mode=='schedule'} onclick="{sortPT}" style="width: 25px; max-width: 25px; min-width: 25px;">PT</th>
									<th if={opts.mode=='schedule'} style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">status</th>
									<th if={opts.mode=='schedule' && opts.submode!='bossraid'} style="width: 25px; max-width: 25px; min-width: 25px;">VC</th>
									<th if={opts.mode=='schedule' && opts.submode=='bossraid'} style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">Dual<br>で参加</th>
									<th style="width: 80px; max-width: 200px; min-width: 80px; text-align: left;">キャラ</th>
									<th if={opts.mode!='contribution'} onclick="{sortCP}" style="width: 40px; max-width: 40px; min-width: 40px;">戦闘力</th>
									<th if={opts.mode!='contribution'} onclick="{sortJob}" style="width: 25px; max-width: 25px; min-width: 25px;">Job</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="font-size: 6px; width: 40px; max-width: 40px; min-width: 40px;">Dual<br>戦闘力</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">Dual<br>クラス</th>
									<th if={mode==1 && opts.mode!='contribution'} onclick="{sortAcce1}" style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">装飾品</th>
									<th if={mode==1 && opts.mode!='contribution'} style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">サブ<br>装飾品</th>
									<th if={mode==1 && opts.mode!='contribution'} style="font-size: 6px; width: 25px; max-width: 23px; min-width: 25px;">武器<br>コス</th>
									<th if={mode==1 && opts.mode!='contribution'} style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">マント</th>
									<th if={opts.mode!='schedule'} onclick="{sortLevel}" style="width: 20px; max-width: 20px; min-width: 20px;">Lv</th>
									<th if={mode==2 && opts.mode!='schedule'} onclick="{sortLevel}" style="font-size: 6px; width: 20px; max-width: 20px; min-width: 20px;">精霊<br>Lv</th>
									<th if={mode==1 && opts.mode=='contribution'} style="font-size: 6px; width: 20px; max-width: 20px; min-width: 20px;">メテオ</th>
									<th if={mode==1} style="width: 15px; max-width: 15px; min-width: 15px;">Dz</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} style="background-color: royalblue; color: white; width: 15px; max-width: 15px; min-width: 15px;">攻</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} style="background-color: royalblue; color: white; width: 15px; max-width: 15px; min-width: 15px;">防</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} style="background-color: yellow; width: 15px; max-width: 15px; min-width: 15px;">甘</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="background-color: crimson; color: white; width: 15px; max-width: 15px; min-width: 15px;">魔</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="background-color: crimson; color: white; width: 15px; max-width: 15px; min-width: 15px;">竜</th>
									<th if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="width: 15px; max-width: 15px; min-width: 15px;">ボ</th>
									<th style="width: 15px; max-width: 15px; min-width: 15px;">区</th>
									<th if={opts.mode!='schedule'} onclick="{sortJoind}" style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">入隊日</th>
									<th if={opts.mode!='schedule'} onclick="{sortJoind}" style="font-size: 6px; width: 25px; max-width: 25px; min-width: 25px;">更新日</th>
									<th if={opts.mode=='schedule'} style="font-size: 6px; text-align: left; width: auto; max-width: 3000px; min-width: 30px;">コメント</th>
									<th if={opts.mode!='schedule'} style="font-size: 6px; text-align: left; width: auto; max-width: 3000px; min-width: 30px;">メモ</th>
								</tr>
							</thead>
							<tbody id="partylist" class="mode{mode}partylist">
								<tr each="{user, index in opts.data}" class="activity{user.activity}" id="party_{index+1}" index="{index}">
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{index+1}</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="text-info contribution draggable" contribution="{opts.contributiondata[user.ID].contribution}" onclick="onclickModify(this, '{user.ID}');" style="text-align: right;"><b>{opts.contributiondata[user.ID].contribution - (50*opts.contributiondata[user.ID].weekquestcnt)}</b></td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="contribution draggable" contribution="0" onclick="onclickModify(this, '{user.ID}');">未入力</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="orgcontribution draggable" onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{opts.contributiondata[user.ID].contribution}</td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="orgcontribution draggable" onclick="onclickModify(this, '{user.ID}');">未入力</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="weekquestcnt draggable" weekquestcnt="{opts.contributiondata[user.ID].weekquestcnt}" onclick="onclickModify(this, '{user.ID}');">{opts.contributiondata[user.ID].weekquestcnt}</td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="weekquestcnt draggable" weekquestcnt="0" onclick="onclickModify(this, '{user.ID}');">未入力</td>
									<td if={opts.mode=='schedule' && user.entry==1} onclick="onclickModify(this, '{user.ID}');" class="success draggable">◯</td>
									<td if={opts.mode=='schedule' && user.entry==0} onclick="onclickModify(this, '{user.ID}');" class="warning draggable">△</td>
									<td if={opts.mode=='schedule' && user.entry==-1} onclick="onclickModify(this, '{user.ID}');" class="danger draggable">✕</td>

									<td if={opts.mode=='schedule' && user.party==49 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="49" style="color: white;">1A</td>
									<td if={opts.mode=='schedule' && user.party==48 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="48" style="color: white;">1B</td>
									<td if={opts.mode=='schedule' && user.party==39 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="39" style="color: white;">2A</td>
									<td if={opts.mode=='schedule' && user.party==38 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="38" style="color: white;">2B</td>
									<td if={opts.mode=='schedule' && user.party==37 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>
									<td if={opts.mode=='schedule' && user.party==29 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="29" style="color: white;">3A</td>
									<td if={opts.mode=='schedule' && user.party==28 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="28" style="color: white;">3B</td>
									<td if={opts.mode=='schedule' && user.party==27 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>
									<td if={opts.mode=='schedule' && user.party==19 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="19" style="color: white;">4A</td>
									<td if={opts.mode=='schedule' && user.party==18 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="18" style="color: white;">4B</td>
									<td if={opts.mode=='schedule' && user.party==17 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>
									<td if={opts.mode=='schedule' && user.party==9 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="9" style="color: white;">5A</td>
									<td if={opts.mode=='schedule' && user.party==8 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="8" style="color: white;">5B</td>
									<td if={opts.mode=='schedule' && user.party==7 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>

									<td if={opts.mode=='schedule' && user.party==39 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="39" style="color: white;">聖刻</td>
									<td if={opts.mode=='schedule' && user.party==38 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="38" style="color: white;">偵察</td>
									<td if={opts.mode=='schedule' && user.party==37 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="37" style="color: white;">封殺</td>
									<td if={opts.mode=='schedule' && user.party==29 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="29" style="color: white;">FW1</td>
									<td if={opts.mode=='schedule' && user.party==28 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="28" style="color: white;">FW2</td>
									<td if={opts.mode=='schedule' && user.party==27 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="27" style="color: white;">FW3</td>
									<td if={opts.mode=='schedule' && user.party==19 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="19" style="color: white;">MF1</td>
									<td if={opts.mode=='schedule' && user.party==18 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="18" style="color: white;">MF2</td>
									<td if={opts.mode=='schedule' && user.party==17 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="17" style="color: white;">MF3</td>
									<td if={opts.mode=='schedule' && user.party==9 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="9" style="color: white;">DF1</td>
									<td if={opts.mode=='schedule' && user.party==8 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="8" style="color: white;">DF2</td>
									<td if={opts.mode=='schedule' && user.party==7 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="7" style="color: white;">DF3</td>

									<td if={opts.mode=='schedule' && user.party==0} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>
									<td if={opts.mode=='schedule' && user.party===''} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white;">無</td>
									<td if={opts.mode=='schedule' && user.party==undefined} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="0" style="color: white;">無</td>

									<td if={opts.mode=='schedule' && user.status==2} class="scheduleuserstatus bg-info text-info draggable" propaty="2" onclick="switchType(this, 'status');" style="font-size: xx-small;">リダ</td>
									<td if={opts.mode=='schedule' && user.status==1} class="scheduleuserstatus bg-success text-success draggable" propaty="1" onclick="switchType(this, 'status');" style="font-size: xx-small;">サブ</td>
									<td if={opts.mode=='schedule' && user.status==-1} class="scheduleuserstatus bg-danger text-danger draggable" propaty="-1" onclick="switchType(this, 'status');" style="font-size: xx-small;">急欠</td>
									<td if={opts.mode=='schedule' && user.status!=-1 && user.status!=2 && user.status!=1} class="scheduleuserstatus draggable" propaty="0" onclick="switchType(this, 'status');" style="font-size: xx-small;">&nbsp;</td>
									<td if={opts.mode=='schedule' && opts.submode!='bossraid' && user.voice==1} class="scheduleuservoice bg-info draggable" propaty="1" onclick="switchType(this, 'voice');"><i class="fas fa-microphone"></i></td>
									<td if={opts.mode=='schedule' && opts.submode!='bossraid' && user.voice==2} class="scheduleuservoice bg-success draggable" propaty="2" onclick="switchType(this, 'voice');"><i class="fas fa-microphone-slash"></i></td>
									<td if={opts.mode=='schedule' && opts.submode!='bossraid' && user.voice==-1} class="scheduleuservoice bg-success draggable" propaty="-1" onclick="switchType(this, 'voice');"><i class="fas">✕</i></td>
									<td if={opts.mode=='schedule' && opts.submode!='bossraid' && user.voice!=-1 && user.voice!=2 && user.voice!=1} class="scheduleuservoice draggable" propaty="0" onclick="switchType(this, 'voice');"><i class="fas"></i></td>
									<td if={opts.mode=='schedule' && opts.submode=='bossraid' && user.dual!=1} class="scheduleuserdual text-info draggable" propaty="0" onclick="switchType(this, 'dual');"></td>
									<td if={opts.mode=='schedule' && opts.submode=='bossraid' && user.dual==1} class="scheduleuserdual bg-info text-info draggable" propaty="1" onclick="switchType(this, 'dual');">Dual</td>
									<td onclick="onclickModify(this, '{user.ID}');" class="scheduleusername contributionusername draggable" style="text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{user.name}</td>
									<td if={opts.mode!='contribution'} style="text-align: right;">{user.cp}</td>

									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='攻撃'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: firebrick;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='クリ'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: orange;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='防御'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: blue;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='移動'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: green;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='命中'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: dodgerblue;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==1 && opts.mode!='contribution' && jobbufs[user.job]=='HP'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: deeppink;"><img src={jobimages[user.job]} title="{jobs[user.job]}" alt="{jobs[user.job]}" width="20"/><p if={1 != user.job3d}>2d</p></td>
									<td if={mode==2 && opts.mode!='contribution' && jobbufs[user.job]=='近距離'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: salmon;"><img src={jobimages[user.job]} title="{user.job}" alt="{user.job}" width="20"/></td>
									<td if={mode==2 && opts.mode!='contribution' && jobbufs[user.job]=='遠距離'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: dodgerblue;"><img src={jobimages[user.job]} title="{user.job}" alt="{user.job}" width="20"/></td>
									<td if={opts.mode!='contribution' && 'undefined' == typeof jobbufs[user.job]} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="font-size: 5px;">{user.job}</td>

									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} style="text-align: right;">{user.subcp}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='攻撃'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: firebrick;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='クリ'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: orange;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='防御'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: blue;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='移動'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: green;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='命中'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: dodgerblue;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && jobbufs[user.subjob]=='HP'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: deeppink;"><img src={jobimages[user.subjob]} title="{jobs[user.subjob]}" alt="{jobs[user.subjob]}" width="20"/><p if={1 != user.subjob3d}>2d</p></td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid') && 'undefined' == typeof jobbufs[user.subjob]} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="font-size: 5px;">{user.subjob}</td>

									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 80 <= user.acce1 && 90 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_75801_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 70 <= user.acce1 && 80 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66514_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 60 <= user.acce1 && 70 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(./images/l2r/kara.jpg)  no-repeat left top; background-size: auto 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 50 <= user.acce1 && 60 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66511_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 40 <= user.acce1 && 50 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66502_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 30 <= user.acce1 && 40 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66517_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 20 <= user.acce1 && 30 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66505_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 10 <= user.acce1 && 20 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66508_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && false === ('undefined' != typeof user.acce1 && 10 <= user.acce1)} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 20px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_noimage.png)  no-repeat center top; background-size: 0">&nbsp;</td>

									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 80 <= user.acce2 && 90 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_75801_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 70 <= user.acce2 && 80 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66514_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 60 <= user.acce2 && 70 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(./images/l2r/kara.jpg)  no-repeat left top; background-size: auto 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 50 <= user.acce2 && 60 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66511_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 40 <= user.acce2 && 50 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66502_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 30 <= user.acce2 && 40 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66517_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 20 <= user.acce2 && 30 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66505_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && 'undefined' != typeof user.acce2 && 10 <= user.acce2 && 20 > user.acce2} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66508_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce2+'').substring(1))+1}</td>
									<td if={mode==1 && opts.mode!='contribution' && false === ('undefined' != typeof user.acce2 && 10 <= user.acce2)} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 20px; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_noimage.png)  no-repeat center top; background-size: 0">&nbsp;</td>

									<td if={mode==1 && opts.mode!='contribution'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="text-align: right"> {user.bukicos}</td>
									<td if={mode==1 && opts.mode!='contribution'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="text-align: right">{user.manto}</td>

									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{user.level}</td>
									<td if={mode==2 && opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{user.spiritlevel}</td>
									<td if={mode==1 && opts.mode=='contribution' && user.meteo==10} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{user.meteo}</td>
									<td if={mode==1 && opts.mode=='contribution' && user.meteo!=10} onclick="onclickModify(this, '{user.ID}');" class="warning" style="text-align: right;">{user.meteo}</td>
									<td if={mode==1 && user.dzone==10} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-weight: bold; text-align: right;">{user.dzone}</td>
									<td if={mode==1 && isNaN(user.dzone)} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;"></td>
									<td if={mode==1 && !isNaN(user.dzone) && user.dzone!=10} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{user.dzone}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: royalblue; color: white; text-align: right;">{user.pvpat}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: royalblue; color: white; text-align: right;">{user.pvpdf}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='gvg')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: yellow; text-align: right;">{user.sweet}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: crimson; color: white; text-align: right;">{user.mamono}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: crimson; color: white; text-align: right;">{user.dragon}</td>
									<td if={mode==1 && true==(!opts.mode || opts.submode=='bossraid')} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="text-align: right;">{user.boss}</td>
									<td if={user.activity==1} onclick="onclickModify(this, '{user.ID}');" class="success" style="font-size: xx-small;">AC</td>
									<td if={user.activity==0} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-size: xx-small;">IAC</td>
									<td if={user.activity==-9} onclick="onclickModify(this, '{user.ID}');" class="danger" style="font-size: xx-small;">除</td>
									<td if={user.activity==-1} onclick="onclickModify(this, '{user.ID}');" class="info" style="font-size: xx-small;">傭</td>
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{user.joind.replace('/', '\n')}</td>
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="text-align: right;">{('string' == typeof user.modified)? user.modified.replace('/', '\n'): ''}</td>
									<td if={opts.mode!='schedule'} onclick="onclickDetail(this, '{user.ID}');" style="font-size: 6px; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{user.memo}</td>
									<td if={opts.mode=='schedule'} onclick="onclickDetail(this, '{user.ID}');" class="schedulecomment" style="font-size: 6px; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{user.comment}</td>
								</tr>
							</tbody>
						</table>
						<botton if={mode==1} class="btn btn-danger" onclick="onclickCSVExport(this);">CSVエクスポート</botton>
						<label if={mode==1} class="btn btn-info" for="csvimport">CSVインポート</label>
						<a style="display:none;" id="downloader" href="#"></a>
						<form style="display:none;" id="csvimportForm" name="csvimport">
							<input id="csvimport" name="csv" type="file" />
						</form>
					</div>
					var thisis;
					this.on('mount', function() {
						thisis = this;
						thisis.users = opts.data;
						var reader = new FileReader();
						reader.addEventListener('load', function() {
							var fileBody = reader.result;
							if (0 > fileBody.indexOf('\n') && 0 > fileBody.indexOf('\r')) {
								alert('指定されたファイルはCSVファイルでは無いか\nまたはデータが1行以下です');
								return;
							}
							var delim = '\n';
							// 2行以上あるCSVファイル
							if (-1 > fileBody.indexOf('\r')) {
								delim = '\r';
							}
							var lines = reader.result.split(delim);
							if (1 > lines.length) {
								alert('指定されたファイルはCSVファイルでは無いか\nまたはデータがありません');
								return;
							}
							console.log(lines);
							var fields = lines[0].replace(/[\r\n]/g, '').trim().split(',');
							console.log(fields);
							if (21 > fields.length){
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							if (0 > fields[1].indexOf('キャラ名')
							 || 0 > fields[2].indexOf('戦闘力')
							 || 0 > fields[3].indexOf('Job')
							 || 0 > fields[4].indexOf('3次職')
							 || 0 > fields[5].indexOf('デュアル戦闘力')
							 || 0 > fields[6].indexOf('デュアルクラス')
							 || 0 > fields[7].indexOf('デュアル3次職')
							 || 0 > fields[8].indexOf('装飾品')
							 || 0 > fields[9].indexOf('特性')
							 || 0 > fields[10].indexOf('サブ装飾品')
							 || 0 > fields[11].indexOf('サブ特性')
							 || 0 > fields[12].indexOf('武器コス')
							 || 0 > fields[13].indexOf('マント')
							 || 0 > fields[14].indexOf('Lv')
							 || 0 > fields[15].indexOf('ディフェンスゾーンLv')
							 || 0 > fields[16].indexOf('対人攻撃特性')
							 || 0 > fields[17].indexOf('対人防御特性(平均)')
							 || 0 > fields[18].indexOf('スイート特性')
							 || 0 > fields[19].indexOf('魔物特性')
							 || 0 > fields[20].indexOf('竜特性')
							 || 0 > fields[21].indexOf('ボス特性')
							 || 0 > fields[22].indexOf('区分')
							 || 0 > fields[23].indexOf('入隊日')
							 || 0 > fields[24].indexOf('更新日')
							 || 0 > fields[25].indexOf('メモ')
							) {
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							var _users = [];
							for (var lidx=1; lidx < lines.length; lidx++) {
								line = lines[lidx].replace(/[\r\n]/g, '').trim();
								if (1 > line.length || -1 < line.indexOf('キャラ名') || -1 < line.indexOf('戦闘力') || -1 < line.indexOf('cp') || -1 < line.indexOf('CP')) {
									continue;
								}
								var cols = line.split(',');
								console.log(cols);
								if (25 > cols.length){
									alert('項目が足らない行がありました。\n' + lidx + '行目か' + (lidx+1) + '行目かを確認して下さい。');
									return;
								}
								for (var colidx=1; colidx < cols.length; colidx++) {
									cols[colidx] = cols[colidx].replace(/^"(.*)"$/, '$1');
								}
								console.log(cols);
								var _user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: 0, meteo: 0, dzone: null, acce1: 0, acce2: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '' };
								_user.name = cols[1].replace(/""/, '"').trim();
								_user.cp = parseInt(cols[2].trim());
								_user.job = rejobs[cols[3].trim()];
								_user.job3d = (cols[4].trim() == '3次職')? 1: 0;
								_user.subcp = ('' == cols[5].trim())? null: parseInt(cols[5].trim());
								_user.subjob = ('' == cols[6].trim())? null: rejobs[cols[6].trim()];
								_user.subjob3d = ('' == cols[7].trim())? null: ((cols[7].trim() == '3次職')? 1: 0);
								_user.acce1 = cols[8].trim();
								acce1tokusei = cols[9].trim();
								if (-1 < _user.acce1.indexOf('カラ')) {
									_user.acce1 = 60 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('魔女')) {
									_user.acce1 = 80 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('エルヴン')) {
									_user.acce1 = 70 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ナッセン')) {
									_user.acce1 = 50 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ムーンストーン')) {
									_user.acce1 = 40 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ブラックオール')) {
									_user.acce1 = 30 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('アルボール')) {
									_user.acce1 = 20 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('フェニックス')) {
									_user.acce1 = 10 + parseInt(acce1tokusei) -1;
								}
								else {
									_user.acce1 = 0;
								}
								_user.acce2 = cols[10].trim();
								acce2tokusei = cols[11].trim();
								if (-1 < _user.acce2.indexOf('カラ')) {
									_user.acce2 = 60 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('魔女')) {
									_user.acce2 = 80 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('エルヴン')) {
									_user.acce2 = 70 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('ナッセン')) {
									_user.acce2 = 50 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('ムーンストーン')) {
									_user.acce2 = 40 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('ブラックオール')) {
									_user.acce2 = 30 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('アルボール')) {
									_user.acce2 = 20 + parseInt(acce2tokusei) -1;
								}
								else if (-1 < _user.acce2.indexOf('フェニックス')) {
									_user.acce2 = 10 + parseInt(acce2tokusei) -1;
								}
								else {
									_user.acce2 = 0;
								}
								_user.bukicos = cols[12].trim();
								_user.manto = cols[13].trim();
								_user.level = parseInt(cols[14].trim());
								_user.meteo = 10;
								_user.dzone = (cols[15].trim() == '')? null: parseInt(cols[15].trim());
								_user.pvpat = (cols[16].trim() == '')? null: parseInt(cols[16].trim());
								_user.pvpdf = (cols[17].trim() == '')? null: parseInt(cols[17].trim());
								_user.sweet = (cols[18].trim() == '')? null: parseInt(cols[18].trim());
								_user.mamono = (cols[19].trim() == '')? null: parseInt(cols[19].trim());
								_user.dragon = (cols[20].trim() == '')? null: parseInt(cols[20].trim());
								_user.boss = (cols[21].trim() == '')? null: parseInt(cols[21].trim());
								_user.activity = cols[22].trim();
								if (_user.activity == 'アクティブ') {
									_user.activity = 1;
								}
								else if (_user.activity == 'インアクティブ') {
									_user.activity = 0;
								}
								else if (_user.activity == '傭兵') {
									_user.activity = -1;
								}
								else if (_user.activity == '除名') {
									_user.activity = -9;
								}
								var _joind = cols[23].trim().replace(' ', '/').split('/');
								_user.joind = (('0000' + _joind[0]).slice(-4)) + '/' + (('00' + _joind[1]).slice(-2)) + '/' + (('00' + _joind[2]).slice(-2));
								var _modified = (cols[24].trim() == '')? null: cols[24].trim().replace(' ', '/').split('/');
								if (null != _modified) {
									_user.modified = (('0000' + _modified[0]).slice(-4)) + '/' + (('00' + _modified[1]).slice(-2)) + '/' + (('00' + _modified[2]).slice(-2));
								}
								_user.memo = cols[25].replace(/""/, '"').trim();
								_users.push(_user);
							}
							console.log('usser=');
							console.log(_users);
							console.log(clan.ID);
							if (1 > _users.length) {
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							if (!confirm(_users.length + '件のユーザーをインポートします。\n(※同じキャラ名以外のデータは必ず追加になる事にご注意下さい！)\n本当にインポートしてよろしいですか？')) {
								return;
							}
							// register
							var registerUsers = function (_argUIdx, _argUsers) {
								if (_argUIdx < _argUsers.length) {
									getUserFromName(clan.ID, _argUsers[_argUIdx].name, function (_user){
										if (null != _user && 'undefined' != typeof _user.ID) {
											_argUsers[_argUIdx].ID = _user.ID;
										}
										registerUser(clan.ID, _argUsers[_argUIdx], function (){
											_argUIdx = _argUIdx + 1;
											registerUsers(_argUIdx, _argUsers);
										});
									});
								}
								else {
									alert('インポートしました。');
									location.reload();
								}
							};
							registerUsers(0, _users);
						});
						$('#csvimportForm').change(function (e){
							if (0 < e.target.files.length) {
								var csv = e.target.files[0];
								console.log(csv);
								if (csv.type != 'text/plain' && csv.type != 'text/csv' && csv.type != 'application/vnd.ms-excel') {
									alert('指定されたファイルはCSVファイルではありません');
									return;
								}
								reader.readAsText(csv);
							}
						});
					});
					var cpdesc = false;
					var leveldesc = true;
					var joinddesc = true;
					var jobdesc = true;
					var partydesc = true;
					var acce1desc = false;
					sortCP = function () {
						if (cpdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) > parseInt(b.cp) ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( parseInt(a.cp) > parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return 1;
								return 0;
							});
						}
					};
					sortLevel = function () {
						if (leveldesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level < b.level ) return -1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level > b.level ) return -1;
								if( a.level < b.level ) return 1;
								return 0;
							});
						}
					};
					sortPT = function () {
						if (partydesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.party < b.party ) return -1;
								if( a.party > b.party ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
						}
					};
					sortJob = function () {
						if (jobdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job < b.job ) return -1;
								if( a.job > b.job ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job > b.job ) return -1;
								if( a.job < b.job ) return 1;
								return 0;
							});
						}
					};
					sortAcce1 = function () {
						if (acce1desc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < -1) return 1;
								if ('undefined' == typeof a.acce1) return -1;
								if ('undefined' == typeof b.acce1) return 1;
								if( a.acce1 < b.acce1 || 'undefined' == typeof b.acce1) return -1;
								if( a.acce1 > b.acce1 ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < -1) return 1;
								if ('undefined' == typeof a.acce1) return 1;
								if ('undefined' == typeof b.acce1) return -1;
								if( a.acce1 > b.acce1 ) return -1;
								if( a.acce1 < b.acce1 ) return 1;
								return 0;
							});
						}
					};
					sortJoind = function () {
						if (joinddesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return -1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return 1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return 1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return 1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return 1;
								return 0;
							});
						}
					};
				</users>
			</script>

			<!-- addoperation -->
			<script type="riot/tag">
				<addoperation>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>作戦書登録</h3>
									<form id="editnewsform">
										<br/>
										<h4>作戦名</h4>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" id="operationname" name="operationname" class="form-control" value="" placeholder="一点突破作戦！"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<br/>
										<h4>編成</h4>
										<div class="form-group">
											<select class="form-control" id="operationscheduleID" onchange="onchangeSchedule(this);">
												<option value="none"></option>
												<option each="{schedule, index in schedules}" value="{schedule.ID}">{schedule.name} ({schedule.ID})</option>
											</select>
											<small style="font-size: xx-small;">
												※ 作成済みの予定の編成を読み込んで使用します。<br/>
												新たに編成を行いたい場合は「<a href="#addschedule">予定追加</a>」から行って下さい。<br/>
											</small>
											<a id="partyimage" href="#" style="display: none;"><img src="" style="width: 300px;"/></a>
											<party id="partyview" style="display: none;" scheduleid='{scheduleid}'>
										</div>
										<br/>
										<h4>マップ</h4>
										<canvas id="map" width="1200" height="800" style="width: 300px;"></canvas>
										<div class="form-group">
											<select class="form-control" id="operationmap" name="map" onchange="onchangeMap(this);">
												<option value="11">要塞戦攻略</option>
												<option value="12">要塞戦防衛</option>
											</select>
											<img id="map11image" src="./images/l2r/map-at.jpg" style="display: none;"/>
											<img id="map12image" src="./images/l2r/map-df.jpg" style="display: none;"/>
										</div>
										<h4>開始位置</h4>
										<div class="form-group">
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-info" style="background-color: #269abc; border-color: #1b6d85;">聖刻</label>
												<label class="btn btn-info active"><input type="radio" name="pt39position" id="pt39positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-info"><input type="radio" name="pt39position" id="pt39positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-info"><input type="radio" name="pt39position" id="pt39positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-info" style="background-color: #269abc; border-color: #1b6d85;">偵察</label>
												<label class="btn btn-info active"><input type="radio" name="pt38position" id="pt38positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-info"><input type="radio" name="pt38position" id="pt38positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-info"><input type="radio" name="pt38position" id="pt38positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-info" style="background-color: #269abc; border-color: #1b6d85;">封殺</label>
												<label class="btn btn-info active"><input type="radio" name="pt37position" id="pt37positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-info"><input type="radio" name="pt37position" id="pt37positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-info"><input type="radio" name="pt37position" id="pt37positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-success" style="background-color: #398439; border-color: #255625;">FW1</label>
												<label class="btn btn-success active"><input type="radio" name="pt29position" id="pt29positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-success"><input type="radio" name="pt29position" id="pt29positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-success"><input type="radio" name="pt29position" id="pt29positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-success" style="background-color: #398439; border-color: #255625;">FW2</label>
												<label class="btn btn-success active"><input type="radio" name="pt28position" id="pt28positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-success"><input type="radio" name="pt28position" id="pt28positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-success"><input type="radio" name="pt28position" id="pt28positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-success" style="background-color: #398439; border-color: #255625;">FW3</label>
												<label class="btn btn-success active"><input type="radio" name="pt27position" id="pt27positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-success"><input type="radio" name="pt27position" id="pt27positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-success"><input type="radio" name="pt27position" id="pt27positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-warning" style="background-color: #d58512; border-color: #d58512;">MF1</label>
												<label class="btn btn-warning active"><input type="radio" name="pt19position" id="pt19positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-warning"><input type="radio" name="pt19position" id="pt19positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-warning"><input type="radio" name="pt19position" id="pt19positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-warning" style="background-color: #d58512; border-color: #d58512;">MF2</label>
												<label class="btn btn-warning active"><input type="radio" name="pt18position" id="pt18positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-warning"><input type="radio" name="pt18position" id="pt18positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-warning"><input type="radio" name="pt18position" id="pt18positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-warning" style="background-color: #d58512; border-color: #d58512;">MF3</label>
												<label class="btn btn-warning active"><input type="radio" name="pt17position" id="pt17positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-warning"><input type="radio" name="pt17position" id="pt17positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-warning"><input type="radio" name="pt17position" id="pt17positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>

											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-danger" style="background-color: #ac2925; border-color: #761c19;">DF1</label>
												<label class="btn btn-danger active"><input type="radio" name="pt9position" id="pt9positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-danger"><input type="radio" name="pt9position" id="pt9positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-danger"><input type="radio" name="pt9position" id="pt9positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-danger" style="background-color: #ac2925; border-color: #761c19;">DF2</label>
												<label class="btn btn-danger active"><input type="radio" name="pt8position" id="pt8positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-danger"><input type="radio" name="pt8position" id="pt8positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-danger"><input type="radio" name="pt8position" id="pt8positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
											<br/>
											<br/>
											<div class="btn-group btn-group-toggle" data-toggle="buttons">
											  <label class="btn btn-danger" style="background-color: #ac2925; border-color: #761c19;">DF3</label>
												<label class="btn btn-danger active"><input type="radio" name="pt7position" id="pt7positionNone" value="" autocomplete="off" onchange="onchangeMap(this);" checked="checked">無</label>
											  <label class="btn btn-danger"><input type="radio" name="pt7position" id="pt7positionleft" value="left" autocomplete="off" onchange="onchangeMap(this);">左</label>
											  <label class="btn btn-danger"><input type="radio" name="pt7position" id="pt7positionright" value="right" autocomplete="off" onchange="onchangeMap(this);">右</label>
											</div>
										</div>
										<br/>
										<h4>ルール</h4>
										<div class="form-group">
											<select id="rule" class="form-control" name="rule">
												<option value="11">即復活アリ</option>
												<option value="12">LRTルール</option>
											</select>
										</div>
										<div class="form-group">
											<textarea id="detailrule" class="form-control" name="detailrule" placeholder="バフ、高級p、ssあり" rows="3"></textarea>
										</div>
										<br/>
										<h4>作戦</h4>
										<div class="form-group">
											<textarea id="operation" class="form-control" name="operation" placeholder="" rows="3"></textarea>
											<br/>
											<label class="btn btn-info" for="operationimage"><i class="fas fa-camera"></i> 画像添付</label>
											<input type="hidden" id="operationimageurl" name="operationimageurl" value=""/>
											<input type="file" id="operationimage" style="display: none;" onchange="{onchangeFile}"/>
											<br/>
											<img id="operationimage-thumbnail" crossOrigin="" style="padding-top: 10px; max-width: 300px;" src=""/>
										</div>
										<br/>
										<h4>初動</h4>
										<div class="form-group">
											<textarea id="firstattack" class="form-control" name="firstattack" placeholder="" rows="3"></textarea>
											<br/>
											<label class="btn btn-info" for="firstattackimage"><i class="fas fa-camera"></i> 画像添付</label>
											<input type="hidden" id="firstattackimageurl" name="firstattackimageurl" value=""/>
											<input type="file" id="firstattackimage" style="display: none;" onchange="{onchangeFile}"/>
											<br/>
											<img id="firstattackimage-thumbnail" crossOrigin="" style="padding-top: 10px; max-width: 300px;" src=""/>
										</div>
										<br/>
										<h4>その他事項</h4>
										<div class="form-group">
											<textarea id="otheroperation" class="form-control" name="otheroperation" placeholder="刻印中のポジションは・・・" rows="3"></textarea>
											<br/>
											<label class="btn btn-info" for="otherimage"><i class="fas fa-camera"></i> 画像添付</label>
											<input type="hidden" id="otherimageurl" name="otherimageurl" value=""/>
											<input type="file" id="otherimage" style="display: none;" onchange="{onchangeFile}"/>
											<br/>
											<img id="otherimage-thumbnail" crossOrigin="" style="padding-top: 10px; max-width: 300px;" src=""/>
										</div>
										<br/>
										<h4>作戦書ID</h4>
										<div class="form-group">
											<div class="btn-group">
												<input id="operationid" type="text" name="operationid" class="form-control" placeholder="任意:空欄は新規登録"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-check">
											<input type="checkbox" name="share" value="1"  class="form-check-input" id="operationshare"/>
											<label class="form-check-label" for="operationshare">誰でも閲覧可能にする</label>
										</div>
										<br/>
										<botton id="previewOperationBtn" class="btn btn-info" onclick={onclickPreviewOperation}>PDFプレビュー</botton>
										<botton id="downloadOperationBtn" class="btn btn-warning" onclick={onclickPreviewOperation}>PDFダウンロード</botton>
										<botton id="shareOperationBtn" class="btn btn-danger" onclick={onclickPreviewOperation}>Discord共有</botton>
										<br/>
										<br/>
										<botton if={'on'!= getParams['view']} class="btn btn-success" onclick={onclickRegisterOperation}>保存</botton>
										<br/>
										<br/>
									</form>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>作戦書一覧</h3>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:100px;">登録{clanLabel}</th>
												<th style="width:100px;">作戦名</th>
												<th class="tdoperation">作戦</th>
												<th style="width:70px;">ルール</th>
												<th style="width:50px;">登録日</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{operation, index in operations}" onclick={onclickOperationModify}>
												<td class="clanname" data-index="{operation.ID}">
													<p if={operation.share==false}>{operation.clanname}</p>
													<b if={operation.share==true} style="color: limegreen;"><i class="fa fa-retweet" aria-hidden="true"></i> {operation.clanname}</b>
												</td>
												<td class="operationname">{operation.name}</td>
												<td class="tdoperation"><pre class="operation tdoperation">{operation.operation}</pre></td>
												<td class="operationrule" if={operation.rule==11}>即復活アリ</td>
												<td class="operationrule" if={operation.rule==12}>LRTルール</td>
												<td class="operationrule" if={operation.rule!=11 && operation.rule!=12}></td>
												<td class="operationdate" style="text-align: right;">{operation.date.split(' ')[0].replace('/', '\n')}</td>
											</tr>
										</tbody>
									</table>
							</div>
						</div>
					</div>
					<style>
						#partytable {
							width: 640px;
						}
						#partytable .pt0 {
							display: none;
						}
						@media screen and (max-width: 767px) {
							.tdoperation {
								width: 0;
								display: none;
							}
						}
					</style>
					var operation = { name: '', detailrule: '', };
					var operations = {};
					var schedules = [];
					var scheduleid = 'none';
					var targetSchedule = { name: '要塞戦', pt39label: '聖刻', pt38label: '偵察', pt37label: '封殺',  pt29label: 'FW1', pt28label: 'FW2', pt27label: 'FW3', pt19label: 'MF1', pt18label: 'MF2', pt17label: 'MF3', pt9label: 'DF1', pt8label: 'DF2', pt7label: 'DF3', };
					var thisis;
					this.on('mount', function() {
						this.operation = operation;
						this.operations = operations;
						this.schedules = schedules;
						this.scheduleid = scheduleid;
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getOperations(clan.ID, function(operations) {
								thisis.operations = operations;
								getSchedules(clan.ID, function(_schedules) {
									var __schedules = [];
									for (var sidx=0; sidx < _schedules.length; sidx++) {
										if (-1 < _schedules[sidx].name.indexOf('要塞') || -1 < _schedules[sidx].tag.indexOf('要塞')) {
											__schedules.push(_schedules[sidx]);
										}
									}
									thisis.schedules = __schedules;
									onchangeMap(this);
									riot.update();
								});
							});
						});
						dispatchPortlateLayout();
					});
					onchangeSchedule = function (target) {
						console.log(thisis.scheduleid);
						thisis.scheduleid = $('#operationscheduleID option:selected').val();
						console.log(thisis.scheduleid);
						$('#partyimage img').attr('src', '');
						$('#partyimage').attr('href', 'javascript:void(0);');
						$('#partyimage').hide();
						riot.mount('party', {operation:true});
						riot.update();
					};
					var convertParty = false;
					onLoadParty = function (schedule) {
						if (convertParty) {
							return;
						}
						targetSchedule = $.extend(targetSchedule, schedule);
						convertParty = true;
						$('#partyview').show();
						html2canvas($('#partytable'), {
        			onrendered: function(canvas){
          			//imgタグのsrcの中に、html2canvasがレンダリングした画像を指定する。
          			var imgData = canvas.toDataURL();
								$('#partyimage img').attr('src', imgData);
								$('#partyimage').attr('href', '?clanid=' + clan.ID + '&scheduleid=' + schedule.ID + '#detailschedule');
								$('#partyimage').show();
								convertParty = false;
								$('#partyview').hide();
								onchangeMap(this);
        			}
      			});
					};
					onchangeMap = function (target) {
						var mapmode = parseInt($('#operationmap option:selected').val());
						var mapimg = document.getElementById('map' + mapmode + 'image');
						var canvas = document.getElementById('map');
    				var ctx = canvas.getContext('2d');
						ctx.drawImage(mapimg, 0, 0, canvas.width, canvas.height);
						//ctx.fillStyle = "blue";
						//ctx.fillRect(0, 460, canvas.width, 60);
						if ($('input[name=pt39position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt39label, 200, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt39label, 700, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}
						else if ($('input[name=pt39position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt39label, 350, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt39label, 900, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}
						if ($('input[name=pt38position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt38label, 250, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt38label, 750, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}
						else if ($('input[name=pt38position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt38label, 400, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt38label, 950, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}
						if ($('input[name=pt37position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt37label, 300, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt37label, 800, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}
						else if ($('input[name=pt37position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt37label, 450, 600, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt37label, 1000, 400, { fontSize: 23, color: 'white', backgroundcolor: '#269abc'});
							}
						}

						if ($('input[name=pt29position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt29label, 200, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt29label, 700, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}
						else if ($('input[name=pt29position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt29label, 350, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt29label, 900, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}
						if ($('input[name=pt28position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt28label, 250, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt28label, 750, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}
						else if ($('input[name=pt28position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt28label, 400, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt28label, 950, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}
						if ($('input[name=pt27position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt27label, 300, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt27label, 800, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}
						else if ($('input[name=pt27position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt27label, 450, 650, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt27label, 1000, 450, { fontSize: 23, color: 'white', backgroundcolor: '#398439'});
							}
						}

						if ($('input[name=pt19position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt19label, 200, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt19label, 700, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}
						else if ($('input[name=pt19position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt19label, 350, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt19label, 900, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}
						if ($('input[name=pt18position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt18label, 250, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt18label, 750, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}
						else if ($('input[name=pt18position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt18label, 400, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt18label, 950, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}
						if ($('input[name=pt17position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt17label, 300, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt17label, 800, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}
						else if ($('input[name=pt17position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt17label, 450, 700, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt17label, 1000, 500, { fontSize: 23, color: 'white', backgroundcolor: '#d58512'});
							}
						}


						if ($('input[name=pt9position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt9label, 200, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt9label, 700, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						else if ($('input[name=pt9position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt9label, 350, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt9label, 900, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						if ($('input[name=pt8position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt8label, 250, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt8label, 750, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						else if ($('input[name=pt8position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt8label, 400, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt8label, 950, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						if ($('input[name=pt7position]:checked').val() === 'left') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt7label, 300, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt7label, 800, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						else if ($('input[name=pt7position]:checked').val() === 'right') {
							// 要塞攻略
							if (mapmode == 11) {
								drawText(ctx, targetSchedule.pt7label, 450, 750, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
							// 要塞防衛
							else if (mapmode == 12) {
								drawText(ctx, targetSchedule.pt7label, 1000, 550, { fontSize: 23, color: 'white', backgroundcolor: '#ac2925'});
							}
						}
						// キャンバスを画像化
						return canvas.toDataURL();
					};
					onclickOperationModify = function (event) {
						var index = $(event.target).parent().find('td.clanname').data('index');
						if (index == undefined) {
							index = $(event.target).parent().parent().find('td.clanname').data('index');
						}
						var _operation = thisis.operations[index];
						$('#operationname').val(_operation.name);
						$('#firstattackimageurl').val(_operation.firstattackimageurl);
						$('#operationmap').val(_operation.map);

						if (_operation.pt39position != '') {
							$('#pt39positionNone').parent().removeClass('active');
						}
						if (_operation.pt38position != '') {
							$('#pt38positionNone').parent().removeClass('active');
						}
						if (_operation.pt37position != '') {
							$('#pt37positionNone').parent().removeClass('active');
						}
						if (_operation.pt29position != '') {
							$('#pt29positionNone').parent().removeClass('active');
						}
						if (_operation.pt28position != '') {
							$('#pt28positionNone').parent().removeClass('active');
						}
						if (_operation.pt27position != '') {
							$('#pt27positionNone').parent().removeClass('active');
						}
						if (_operation.pt19position != '') {
							$('#pt19positionNone').parent().removeClass('active');
						}
						if (_operation.pt18position != '') {
							$('#pt18positionNone').parent().removeClass('active');
						}
						if (_operation.pt17position != '') {
							$('#pt17positionNone').parent().removeClass('active');
						}
						if (_operation.pt9position != '') {
							$('#pt9positionNone').parent().removeClass('active');
						}
						if (_operation.pt8position != '') {
							$('#pt8positionNone').parent().removeClass('active');
						}
						if (_operation.pt7position != '') {
							$('#pt7positionNone').parent().removeClass('active');
						}
						$('#pt39positionleft').parent().removeClass('active');
						$('#pt38positionleft').parent().removeClass('active');
						$('#pt37positionleft').parent().removeClass('active');
						$('#pt29positionleft').parent().removeClass('active');
						$('#pt28positionleft').parent().removeClass('active');
						$('#pt27positionleft').parent().removeClass('active');
						$('#pt19positionleft').parent().removeClass('active');
						$('#pt18positionleft').parent().removeClass('active');
						$('#pt17positionleft').parent().removeClass('active');
						$('#pt9positionleft').parent().removeClass('active');
						$('#pt8positionleft').parent().removeClass('active');
						$('#pt7positionleft').parent().removeClass('active');

						$('#pt39positionright').parent().removeClass('active');
						$('#pt38positionright').parent().removeClass('active');
						$('#pt37positionright').parent().removeClass('active');
						$('#pt29positionright').parent().removeClass('active');
						$('#pt28positionright').parent().removeClass('active');
						$('#pt27positionright').parent().removeClass('active');
						$('#pt19positionright').parent().removeClass('active');
						$('#pt18positionright').parent().removeClass('active');
						$('#pt17positionright').parent().removeClass('active');
						$('#pt9positionright').parent().removeClass('active');
						$('#pt8positionright').parent().removeClass('active');
						$('#pt7positionright').parent().removeClass('active');

						$('#pt39position' + _operation.pt39position).parent().addClass('active');
						$('#pt38position' + _operation.pt38position).parent().addClass('active');
						$('#pt37position' + _operation.pt37position).parent().addClass('active');
						$('#pt29position' + _operation.pt29position).parent().addClass('active');
						$('#pt28position' + _operation.pt28position).parent().addClass('active');
						$('#pt27position' + _operation.pt27position).parent().addClass('active');
						$('#pt19position' + _operation.pt19position).parent().addClass('active');
						$('#pt18position' + _operation.pt18position).parent().addClass('active');
						$('#pt17position' + _operation.pt17position).parent().addClass('active');
						$('#pt9position' + _operation.pt9position).parent().addClass('active');
						$('#pt8position' + _operation.pt8position).parent().addClass('active');
						$('#pt7position' + _operation.pt7position).parent().addClass('active');

						$('#pt39position' + _operation.pt39position).prop('checked', true);
						$('#pt38position' + _operation.pt38position).prop('checked', true);
						$('#pt37position' + _operation.pt37position).prop('checked', true);
						$('#pt29position' + _operation.pt29position).prop('checked', true);
						$('#pt28position' + _operation.pt28position).prop('checked', true);
						$('#pt27position' + _operation.pt27position).prop('checked', true);
						$('#pt19position' + _operation.pt19position).prop('checked', true);
						$('#pt18position' + _operation.pt18position).prop('checked', true);
						$('#pt17position' + _operation.pt17position).prop('checked', true);
						$('#pt9position' + _operation.pt9position).prop('checked', true);
						$('#pt8position' + _operation.pt8position).prop('checked', true);
						$('#pt7position' + _operation.pt7position).prop('checked', true);

						$('#rule').val(_operation.rule);
						$('#detailrule').val(_operation.detailrule);
						$('#operation').val(_operation.operation);
						$('#operationimageurl').val(_operation.operationimageurl);
						$('#firstattack').val(_operation.firstattack);
						$('#firstattackimageurl').val(_operation.firstattackimageurl);
						$('#otheroperation').val(_operation.otheroperation);
						$('#otherimageurl').val(_operation.otherimageurl);
						$('#operationid').val(_operation.ID);
						$('#operationshare').prop('checked', _operation.share);

						onchangeMap(this);
						$('#operationimage-thumbnail').attr('src', _operation.operationimageurl);
						$('#firstattackimage-thumbnail').attr('src', _operation.firstattackimageurl);
						$('#otherimage-thumbnail').attr('src', _operation.otherimageurl);

						return false;
					};
					onclickPreviewOperation = function (event) {
						var docDefinition = {
							content: [
								{ text: convertZenkaku2hankaku(targetSchedule.name + ' 作戦書'), fontSize: 20 },
								{ text: '　', fontSize: 14 },
								{ text: convertZenkaku2hankaku($('#operationname').val() + ' 作戦'), fontSize: 30 },
							],
							defaultStyle: {
								font: 'GenShin',
							},
						};
						if (0 < $('#partyimage img').attr('src').length) {
							docDefinition.content.push({ text: ' ', fontSize: 14 });
							docDefinition.content.push({ text: '【編成】', fontSize: 20 });
							docDefinition.content.push({ text: ' ', fontSize: 14 });
							docDefinition.content.push({ image: $('#partyimage img').attr('src'), width: 520});
							docDefinition.content.push({ text: ' ', fontSize: 14, pageBreak: 'after' });
						}
						docDefinition.content.push({ text: ' ', fontSize: 14 });
						docDefinition.content.push({ text: '【マップ・配置】', fontSize: 20 });
						docDefinition.content.push({ text: ' ', fontSize: 14 });
						docDefinition.content.push({ image: onchangeMap(this), width: 520});
						docDefinition.content.push({ text: ' ', fontSize: 14 });
						docDefinition.content.push({ text: '【ルール】 ' + convertZenkaku2hankaku(($('#rule option:selected').val() == '11')? '即復活アリ' : 'LRTルール'), fontSize: 20 });
						if (0 < $('#detailrule').val().length) {
							docDefinition.content.push({ text: convertZenkaku2hankaku($('#detailrule').val()), fontSize: 14 });
						}
						var operate = false;
						if (0 < $('#operation').val().length) {
							operate = true;
							docDefinition.content.push({ text: ' ', fontSize: 14, pageBreak: 'after' });
							docDefinition.content.push({ text: '【作戦】', fontSize: 20 });
							docDefinition.content.push({ text: convertZenkaku2hankaku($('#operation').val()), fontSize: 14 });
							var operationimage = getBase64Image('operationimage-thumbnail');
							if (10 < operationimage.length) {
								docDefinition.content.push({ text: ' ', fontSize: 14 });
								docDefinition.content.push({image: operationimage, width: 520});
							}
						}
						if (0 < $('#firstattack').val().length) {
							if (operate == false) {
								docDefinition.content.push({ text: ' ', fontSize: 14, pageBreak: 'after' });
							}
							else {
								docDefinition.content.push({ text: ' ', fontSize: 14 });
							}
							docDefinition.content.push({ text: '【初動】', fontSize: 20 });
							docDefinition.content.push({ text: convertZenkaku2hankaku($('#firstattack').val()), fontSize: 14 });
							var firstattackimage = getBase64Image('firstattackimage-thumbnail');
							if (10 < firstattackimage.length) {
								docDefinition.content.push({ text: ' ', fontSize: 14 });
								docDefinition.content.push({image: firstattackimage, width: 520});
							}
						}
						if (0 < $('#otheroperation').val().length) {
							docDefinition.content.push({ text: ' ', fontSize: 14, pageBreak: 'after' });
							docDefinition.content.push({ text: '【その他事項】', fontSize: 20 });
							docDefinition.content.push({ text: convertZenkaku2hankaku($('#otheroperation').val()), fontSize: 14 });
							var otherimage = getBase64Image('otherimage-thumbnail');
							if (10 < otherimage.length) {
								docDefinition.content.push({ text: ' ', fontSize: 14 });
								docDefinition.content.push({image: otherimage, width: 520});
							}
						}
						console.log(docDefinition);
						pdfMake.fonts = {
					      GenShin: {
					        normal: 'GenShinGothic-Normal-Sub.ttf',
					        bold: 'GenShinGothic-Normal-Sub.ttf',
					        italics: 'GenShinGothic-Normal-Sub.ttf',
					        bolditalics: 'GenShinGothic-Normal-Sub.ttf'
					      }
					  };
						if ($(event.target).attr('id') == 'downloadOperationBtn') {
							pdfMake.createPdf(docDefinition).download($('#operationname').val() + '作戦.pdf');
						}
						else if ($(event.target).attr('id') == 'shareOperationBtn') {
							var _webhook = '';
							if ('string' == typeof clan.discordhookid && 'string' == typeof clan.discordhooktoken && 0 < clan.discordhookid.length && 0 < clan.discordhooktoken.length) {
								_webhook = 'https://discordapp.com/api/webhooks/'+ clan.discordhookid + '/' + clan.discordhooktoken;
							}
							swal({
								title: '共有先のチャンネルのWEBHOOK URLを指定して下さい。',
								content: {
									element: 'input',
									attributes: {
										id: 'sharedWebhookURL',
										type: 'text',
										value: _webhook,
									},
								},
								buttons: {
							    cancel: "キャンセル",
							    ok: true
							  }
							}).then(function(val) {
								var ok = false;
								if (val) {
									// 入力値を受け取る
									var __webhook = $('#sharedWebhookURL').val();
									var __webhooks = __webhook.split('/');
									var _discordhookid = null;
									var _discordhooktoken = null;
									if (6 <= __webhook.length &&  2 < __webhooks.length && 10 <= __webhooks[__webhooks.length-1].length && 68 <= __webhooks[__webhooks.length-2]) {
										_discordhookid = __webhooks[__webhooks.length-2];
										_discordhooktoken = __webhooks[__webhooks.length-1];
									}
									if (null != _discordhookid && null != _discordhooktoken) {
										ok = true;
										loading(true);
										pdfMake.createPdf(docDefinition).getBuffer((buffer) => {
											var _buffer = buffer.buffer;
											var discordHook = new Discord.WebhookClient(_discordhookid, _discordhooktoken);
											discordHook.browser = true;
											discordHook.sendFile(_buffer, $('#operationname').val() + '作戦.pdf', '@everyone ' + $('#operationname').val() + '作戦');
											loading(false);
											alert('共有先のチャンネルに作戦書をアップロードしました！');
											return;
										});
									}
								}
								if (ok == false) {
									alert('共有先のチャンネルのWEBHOOK URLを正しく指定して下さい。');
								}
								return;
							});
						}
						else {
							pdfMake.createPdf(docDefinition).open();
						}
						return false;
					};
					onclickRegisterOperation = function (event) {
						var _operation = {};
						_operation.ID = $('#operationid').val();
						if ('object' == typeof thisis.operations[_operation.ID] && clan.ID != thisis.operations[_operation.ID].clanid) {
							alert('公開されている別の' + clanLabel + 'の作戦書を更新する事は出来ません');
							return false;
						}
						if (true != clan.donate && '' == _operation.ID) {
							var myOCnt = 0;
							var OKeys = Object.keys(thisis.operations);
							var totalOCnt = OKeys.length;
							for (var oidx=0; oidx < totalOCnt; oidx++) {
								if (clan.ID == thisis.operations[OKeys[oidx]].clanid) {
									myOCnt++;
								}
							}
							if (myOCnt < 2) {
								alert('作戦書を2件以上保存する場合には寄付履歴が必要になります！\nご注意下さいm(_ _)m');
							}
							else {
								if (confirm('作戦書を2件以上保存するには寄付履歴が必要です！m(_ _)m\n今すぐ寄付を行いますか？')){
									location.hash = 'donation';
								}
								return false;
							}
						}
						// 保存処理
						_operation.name = $('#operationname').val();
						_operation.firstattackimageurl = $('#firstattackimageurl').val();
						_operation.map = parseInt($('#operationmap option:selected').val());
						_operation.pt39position = $('input[name=pt39position]:checked').val();
						_operation.pt38position = $('input[name=pt38position]:checked').val();
						_operation.pt37position = $('input[name=pt37position]:checked').val();
						_operation.pt29position = $('input[name=pt29position]:checked').val();
						_operation.pt28position = $('input[name=pt28position]:checked').val();
						_operation.pt27position = $('input[name=pt27position]:checked').val();
						_operation.pt19position = $('input[name=pt19position]:checked').val();
						_operation.pt18position = $('input[name=pt18position]:checked').val();
						_operation.pt17position = $('input[name=pt17position]:checked').val();
						_operation.pt9position = $('input[name=pt9position]:checked').val();
						_operation.pt8position = $('input[name=pt8position]:checked').val();
						_operation.pt7position = $('input[name=pt7position]:checked').val();
						_operation.rule = parseInt($('#rule option:selected').val());
						_operation.detailrule = $('#detailrule').val();
						_operation.operation = $('#operation').val();
						_operation.operationimageurl = $('#operationimageurl').val();
						_operation.firstattack = $('#firstattack').val();
						_operation.firstattackimageurl = $('#firstattackimageurl').val();
						_operation.otheroperation = $('#otheroperation').val();
						_operation.otherimageurl = $('#otherimageurl').val();
						_operation.ID = $('#operationid').val();
						_operation.share = false;
						if ($('#operationshare').prop('checked')) {
							_operation.share = true;
							if (!confirm('誰でも閲覧可能な作戦書は、他の方が真似をして保存したり\nコピーしたりも出来てしまいます。\n公開を続けてよろしいですか？')){
								return false;
							}
						}
						// バリデーション
						if (0 >= _operation.name.length) {
							alert('簡潔な作戦名を付けて下さい。');
							return false;
						}
						registerOperation(clan.ID, _operation, function(){
							alert('作戦書を保存しました');
							location.reload();
						});
						return false;
					};
				</addoperation>
			</script>

			<!-- howto -->
			<script type="riot/tag">
				<howto>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>ヘルプ <small style="font-size: xx-small;">(※ギルド管理ツール共通)</small></h3>
									<ul>
										<li if={mode==1} ><a href="http://line2revo.strikingly.com" target="_blank"><small><b>●ツールの導入方法を詳しくしりたいです。</d></small></a></li>
										<li if={mode==2} ><a href="http://kurosaba-tool-guide.strikingly.com/" target="_blank"><small><b>●ツールの導入方法を詳しくしりたいです。</d></small></a></li>
										<li><a href="javascript:void(0);" onclick="scrollHelp(1);"><small>●要塞戦の出欠を取りたい場合はどうすれば良いですか？</small></a></li>
										<li><a href="javascript:void(0);" onclick="scrollHelp(2);"><small>●予定を通知して出欠を促す事は出来ますか？</small></a></li>
									</ul>
									<h4>デモページ</h4>
									<small>
										以下のURLからデモ利用する事が出来ます。
										<br/>
										色々試してみたい場合にご利用下さいm(_ _)m
										<br/>
										<a if={mode==1} href="https://line2revo.fun/?clanid=56fhe8sie5UrrZUWVz9V">デモ{clanLabel} => https://line2revo.fun/?clanid=56fhe8sie5UrrZUWVz9V</a>
										<a if={mode==2} href="https://kurosaba.fun/?clanid=qSWLcmYXAEvnWefjhD7Z">デモ{clanLabel} => https://kurosaba.fun/?clanid=qSWLcmYXAEvnWefjhD7Z</a>
									</small>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid" style="padding-bottom: 10px;">
								<div id="helpContents" class="helpimage-container" style="padding-left: 10px; padding-right: 10px;">
									<div class="bg-info helppanel">
										<h4 id="help1" class="text-info">●要塞戦の出欠を取りたい場合はどうすれば良いですか？</h4>
										<div>
											<strong>
												予定を作成して、{clanMemberLabel}に参加表明をしてもらう事で実現出来ます。
											</strong>
											<br/>
											<h5>1. 「{clanLabel}ページ」から「{clanMemberLabel}追加」をしましょう。</h5>
											<a class="helpimage" href="./images/help/help001-001.png"><img src="./images/help/help001-001.png" width="50%"/></a>
											<h5>2. {clanMemberLabel}を追加したら「予定追加」をしましょう。</h5>
											<h6>予定を追加すると「{clanLabel}ページ」の予定の一覧に新しい予定が追加されます。</h6>
											<a class="helpimage" href="./images/help/help001-002.png"><img src="./images/help/help001-002.png" width="50%"/></a>
											<h5>3. 追加された予定から予定の詳細ページに移動出来るようになります。</h5>
											<h6>予定の詳細ページの「未表明一覧」にまだ出欠表明をしていない{clanMemberLabel}が一覧されます。</h6>
											<h6>予定詳細ページのURLを{clanMemberLabel}に知らせましょう。<a href="javascript:void(0);" onclick="scrollHelp(2);">[予定の通知について]</a></h6>
											<h6>{clanMemberLabel}に予定詳細ページへ移動して貰い、自分の名前を選んで出欠登録をして貰いましょう。</h6>
											<a class="helpimage" href="./images/help/help001-003.png"><img src="./images/help/help001-003.png" width="50%"/></a>
											<h5>4. 無事参加表明が完了すると、参加者一覧に表示されるようになります。</h5>
											<a class="helpimage" href="./images/help/help001-004.png"><img src="./images/help/help001-004.png" width="50%"/></a>
										</div>
									</div>
									<div class="bg-info helppanel">
										<h4 id="help2" class="text-info">●予定を通知して出欠を促す事は出来ますか？</h4>
										<div>
											<strong>
												Discordの「Webhook機能」を利用して、Discordに予定ページのURLを通知をする事が出来ます。
											</strong>
											<br/>
											<h5>1. 先ず{clanLabel}のDiscord上でWebhookを作成しましょう。</h5>
											<h6>Webhook作成時に出力される「WEBHOOK URL」をメモして置きましょう。</h6>
											<a class="helpimage" href="./images/help/help002-001-01.png"><img src="./images/help/help002-001-01.png" width="50%"/></a>
											<br/>
											<br/>
											<a class="helpimage" href="./images/help/help002-001-02.png"><img src="./images/help/help002-001-02.png" width="50%"/></a>
											<h6 class="text-danger">※ スマホアプリ版のDiscorddatalist上ではWebhookの管理が行なえません。PC版かブラウザ版のDiscord上で操作して下さい。</h6>
											<br/>
											<h5>2. {clanLabel}管理ツールの「設定」に「WEBHOOK URL」の情報を入力して登録しましょう。</h5>
											<a class="helpimage" href="./images/help/help002-002.png"><img src="./images/help/help002-002.png" width="50%"/></a>
											<h6>これで{clanLabel}のDiscordと{clanLabel}管理ツールの関連付けが出来ました。</h6>
											<br/>
											<h5>3. 次は「{clanLabel}ページ」の「お知らせ管理」からお知らせを登録して、予定に紐づくお知らせを登録します。</h5>
											<a class="helpimage" href="./images/help/help002-003-01.png"><img src="./images/help/help002-003-01.png" width="50%"/></a>
											<a class="helpimage" href="./images/help/help002-003-02.png"><img src="./images/help/help002-003-02.png" width="50%"/></a>
											<h6>お知らせテキスト内に「<b>***urlview***</b>」と言うキーワードを入れて登録します。</h6>
											<h6>このキーワードはお知らせをDiscordに通知する際にその予定ページの<b>参加者用URLに自動変換</b>されます。</h6>
											<br/>
											<h5>4. 予定ページのお知らせ一覧の「通知」ボタンを押すことで連携設定したDiscordに、予定ページのURLが通知されます。</h5>
											<a class="helpimage" href="./images/help/help002-004.png"><img src="./images/help/help002-004.png" width="50%"/></a>
											<br/>
											<br/>
											<h5 class="text-info">♦他にも以下のキーワードを利用する事が出来ます。</h5>
											<h6>&nbsp;■「***urlview***」=> 参加者(閲覧者)用のお知らせ通知をしたページのURLに自動変換されます。</h6>
											<h6>&nbsp;■「***ptview***」=> 参加者(閲覧者)用のPT編成URLに自動変換されます。</h6>
											<h6>&nbsp;■「***url***」 => お知らせ通知をしたページのURLに自動変換されます。</h6>
											<h6>&nbsp;■「***pt***」 => お知らせ通知をしたページの(参加者用では無い)PT編成URLに自動変換されます。</h6>
											<h6>&nbsp;■「***date***」 => お知らせ通知をしたページの予定日時に自動変換されます。</h6>
											<h6>&nbsp;■「***title***」 => お知らせ通知をしたページの予定名に自動変換されます。</h6>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					scrollHelp = function (helpID) {
						$("html,body").animate({scrollTop: $('#helpContents #help' + helpID).offset().top -75 }, "100");
					};
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						dispatchPortlateLayout();
						$('.helpimage-container').magnificPopup({
  						delegate: 'a.helpimage',
  						type: 'image',
  						gallery: {
    						enabled:true
  						}
  					});
					});
				</howto>
			</script>

			<!-- inquiry -->
			<script type="riot/tag">
				<inquiry>
					<div style="padding: 20px;">
						<h3>お問い合わせ</h3>
						<br/>
						<h4><a href="https://twitter.com/saimushi" target="_blank" class="text-success"><i class="fab fa-twitter"></i> saimushi</a></h4>
						<h4>
							<a href="https://discord.gg/mKbGHCd" target="_blank" class="text-info"><i class="fab fa-discord"></i> L2R血盟管理ツール</a>
							<br/>
							<small style="font-size: xx-small;">※【黒い砂漠】ギルド管理ツールのお問い合わせもコチラで承っていますm(_ _)m</small>
						</h4>
						<br/>
						<h5>各種SNS上でお気軽にお問い合わせ下さい。</h5>
						<h5>ご要望もお待ちしています！m(_ _)m</5>
					</div>
				</inquiry>
			</script>

			<!-- manage -->
			<script type="riot/tag">
				<manage>
					<table class="table table-bordered table-hover table-striped">
						<tr each="{_clan, cindex in clans}" if={_clan.memberCnt>=30}>
							<td style="width:40px;">{cindex+1}</td>
							<td style="width:100px;"><a href="./?clanid={_clan.ID}" target="_blank">{_clan.name}</a></td>
							<td style="width:100px; text-align: right;">{_clan.lrtCP.toLocaleString()}</td>
							<td style="width:60px; text-align: right;">{_clan.memberCnt}人</td>
							<td><a href="./?clanid={_clan.ID}" target="_blank">{_clan.ID}</a></td>
						</tr>
					</table>
					var clans = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						thisis.clans = clans;
						swal({
							title: '管理パスワード',
							content: {
								element: 'input',
								attributes: {
									id: 'adminpass',
									type: 'password',
								},
							},
							buttons: {
						    cancel: "キャンセル",
						    ok: true
						  }
						}).then(function(val) {
							if (val) {
								// 入力値を受け取る
								if ('c49be16104f3ad7540f1766a626c4c0086c2d796' === CryptoJS.SHA1($('#adminpass').val()).toString()) {
									getClans(function(clans){
										console.log(clans);
										thisis.clans = clans;
										loading(true);
										var maxClanCnt = 1000;
										var getUsersForLRT = function (clans, idx) {
											if (clans.length <= idx || maxClanCnt < idx) {
												loading(false);
												clans.sort(function(a, b){
													if( parseInt(a.lrtCP) > parseInt(b.lrtCP) ) return -1;
													if( parseInt(a.lrtCP) < parseInt(b.lrtCP) ) return 1;
													return 0;
												});
												riot.update();
												return;
											}
											if (-1 < clans[idx].name.indexOf('テスト') || -1 < clans[idx].name.indexOf('test') || -1 < clans[idx].name.indexOf('Test') || -1 < clans[idx].name.indexOf('TEST') || -1 < clans[idx].name.indexOf('てすと')) {
												clans[idx].lrtCP = 0;
												clans[idx].memberCnt = 0;
												getUsersForLRT(clans, (idx+1));
												return;
											}
											showToast('idx=' + idx);
											firebase.firestore().collection("users").where("clanid", "==", clans[idx].ID).orderBy("activity", "desc").orderBy("cp", "desc").orderBy("joind", "asc").get().then(function(querySnapshot) {
												var lrtCP = 0;
												var memberCnt = 0;
												querySnapshot.forEach(function(snapshot) {
													if(snapshot.exists) {
														var data = snapshot.data();
														if (data.activity > 0) {
															if (memberCnt < 30) {
																lrtCP += parseInt(data.cp);
															}
															memberCnt++;
														}
													}
												});
												clans[idx].lrtCP = lrtCP;
												clans[idx].memberCnt = memberCnt;
												getUsersForLRT(clans, (idx+1));
											});
										};
										getUsersForLRT(clans, 0);
										//riot.update();
									});
								}
							}
							return false;
						});
					});
				</manage>
			</script>
		</section>

		<!-- libraries -->
		<section id="libraries">
			<!-- platform js -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/platform/1.3.5/platform.min.js"></script>

			<!-- bootstrap -->
			<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
			<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

			<!-- SweetAlert -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>

			<!-- Sortable -->
			<script src="//cdn.jsdelivr.net/npm/sortablejs@1.8.0-rc1/Sortable.min.js"></script>

			<!-- Riot -->
			<script src="//cdn.jsdelivr.net/npm/riot@3.9/riot+compiler.min.js"></script>
			<!-- Riot tag base rooting -->
			<script src="//cdn.jsdelivr.net/npm/riot-route@3.1.3/dist/route+tag.min.js"></script>

			<!-- CryptoJS -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>

			<!-- Firebase -->
			<script src="//www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>

			<!-- Discord
			<script src="//greasyfork.org/scripts/29088-discord-js-for-browser/code/Discordjs%20for%20Browser.js?version=208579"></script>-->
			<script src="./js/DiscordjsForBrowser.js"></script>

			<!-- html2canvas -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>

			<!-- pdfmake -->
			<script src="./js/pdfmake/pdfmake.min.js"></script>
			<script src="./js/pdfmake/vfs_fonts.js"></script>
		</section>

		<!-- initialize-scripts -->
		<section id="initialize-scripts">
			<!-- Initialize Firebase -->
			<script>
				var config = {
					apiKey: "AIzaSyDYyTbnnltwtf4qPOjn7i1d3PRVAQBclIE",
					authDomain: "rinerebo-210503.firebaseapp.com",
					databaseURL: "https://rinerebo-210503.firebaseio.com",
					projectId: "rinerebo-210503",
					storageBucket: "rinerebo-210503.appspot.com",
					messagingSenderId: "599651332341",
					timestampsInSnapshots: true,
				};
				if (mode == 2) {
					config = {
					  apiKey: "AIzaSyDC3-vLiNEwEtFKatLtRaEdFyt_Pek_3UU",
					  authDomain: "blackdesert-7c0e8.firebaseapp.com",
					  databaseURL: "https://blackdesert-7c0e8.firebaseio.com",
					  projectId: "blackdesert-7c0e8",
					  storageBucket: "blackdesert-7c0e8.appspot.com",
					  messagingSenderId: "421471852559",
						timestampsInSnapshots: true,
					};
				}
				firebase.initializeApp(config);
				firebase.firestore().settings({timestampsInSnapshots: true,});
			</script>
			<!-- this app [global vars] -->
			<script>
				var getParams = {};
				var loadingCount = 0;
				var portlate = false;
				var toasts = 0;
				var toastIntervals = [];
				var firstView = false;
				var totalcp = 0;
				var prelrtcp = 0;
				var publicURL = 'line2revo.fun';
				if (mode == 2) {
					publicURL = 'kurosaba.fun';
				}
				var botName = 'エリカ様Bot';
				if (mode == 2) {
					botName = '精霊Bot';
				}
				var botURL = 'https://t.co/3CE3BIYqcV';
				if (mode == 2) {
					botURL = 'https://t.co/hiUjWXDU38';
				}

				var clan = { ID: '', name: '', discordhookid: '', discordhooktoken: '', };
				var user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: '', spiritlevel: '', meteo: 0, dzone: null, acce1: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '', discord: '', };
				var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, type: 0, autoReset: null, };
				var partySchedule = {name:'', date: '', incount: 0, };
				var news = { ID: '', text: '', tag: '', notifymode: 0, notifytime: 0, };
				var partyUsers = null;

				var jobimages = [];
				jobimages['パラディン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pa_icon.png';
				jobimages['ウォーロード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/waro_icon.png';
				jobimages['トレジャーハンター'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/tr_icon.png';
				jobimages['ホークアイ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/ho_icon.png';
				jobimages['ソーサラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/so_icon.png';
				jobimages['ビショップ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bs_icon.png';
				jobimages['テンプルナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/te_icon.png';
				jobimages['ソードシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sws_icon.png';
				jobimages['プレインズウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pw_icon.png';
				jobimages['シルバーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sr_icon.png';
				jobimages['スペルシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sps_icon.png';
				jobimages['エルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/el_icon.png';
				jobimages['シリエンナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sn_icon.png';
				jobimages['ブレードダンサー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bd_icon.png';
				jobimages['アビスウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/aw_icon.png';
				jobimages['ファントムレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/fr_icon.png';
				jobimages['スペルハウラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sh_icon.png';
				jobimages['シリエンエルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/se_icon.png';
				jobimages['ガーディアン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/gd_icon.png';
				jobimages['スレイヤー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sl_icon.png';
				jobimages['スカベンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sv_icon.png';
				jobimages['ウォーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/wl_icon.png';
				jobimages['クォーラルウィザード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/qw_icon.png';
				jobimages['セイジ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sj_icon.png';

				jobimages['オークレイダー'] = 'https://gamewith.akamaized.net/img/5e6dcc68342dc8b47f1949e423440f2c.jpg';
				jobimages['オークモンク'] = 'https://gamewith.akamaized.net/img/eb56eea5facb08c64db160a857002113.jpg';
				jobimages['オークシャーマン'] = 'https://gamewith.akamaized.net/img/54a52e90e88f746817616177416386b1.jpg';

				jobimages['バーサーカー'] = './images/l2r/kamaeru-heavy.png';
				jobimages['アヴァレスタ'] = './images/l2r/kamaeru-light.png';
				jobimages['ソウルブレーカー'] = './images/l2r/kamaeru-magic.png';

				// クロサバ用
				if (mode == 2) {
					jobimages = []
					jobimages['ウォーリア'] = './images/kurosaba/classes/icn_warrior.png';
					jobimages['ヴァルキリー'] = './images/kurosaba/classes/icn_valkyrie.png';
					jobimages['ジャイアント'] = './images/kurosaba/classes/icn_giant.png';
					jobimages['ウイッチ'] = './images/kurosaba/classes/icn_witch.png';
					jobimages['レンジャー'] = './images/kurosaba/classes/icn_ranger.png';
					jobimages['ブレイダー'] = './images/kurosaba/classes/icn_blader.png';
					jobimages['リトルサマナー'] = './images/kurosaba/classes/icn_beastmaster.png';
					jobimages['ソーサレス'] = './images/kurosaba/classes/icn_sorceress.png';
					jobimages['ウィザード'] = './images/kurosaba/classes/icn_wizard.png';
					jobimages['ツバキ'] = './images/kurosaba/classes/icn_f-blader.png';
					jobimages['ニンジャ'] = './images/kurosaba/classes/icn_ninja.png';
					jobimages['クノイチ'] = './images/kurosaba/classes/icn_kunoichi.png';
					jobimages['ミスティック'] = './images/kurosaba/classes/icn_mystic.png';
					jobimages['格闘家'] = './images/kurosaba/classes/icn_striker.png';
					jobimages['ダークナイト'] = './images/kurosaba/classes/icn_dark knight.png';
					jobimages['ラン'] = './images/kurosaba/classes/icn_lahn.png';
					jobimages['アーチャー'] = './images/kurosaba/classes/icn_archer.png';
				}

				var jobnamesForURL = [];
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/pa_icon.png'] = 'パラディン';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/waro_icon.png'] = 'ウォーロード';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/tr_icon.png'] = 'トレジャーハンター';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/ho_icon.png'] = 'ホークアイ';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/so_icon.png'] = 'ソーサラー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/bs_icon.png'] = 'ビショップ';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/te_icon.png'] = 'テンプルナイト';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sws_icon.png'] = 'ソードシンガー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/pw_icon.png'] = 'プレインズウォーカー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sr_icon.png'] = 'シルバーレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sps_icon.png'] = 'スペルシンガー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/el_icon.png'] = 'エルダー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sn_icon.png'] = 'シリエンナイト';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/bd_icon.png'] = 'ブレードダンサー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/aw_icon.png'] = 'アビスウォーカー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/fr_icon.png'] = 'ファントムレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sh_icon.png'] = 'スペルハウラー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/se_icon.png'] = 'シリエンエルダー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/gd_icon.png'] = 'ガーディアン';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sl_icon.png'] = 'スレイヤー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sv_icon.png'] = 'スカベンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/wl_icon.png'] = 'ウォーレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/qw_icon.png'] = 'クォーラルウィザード';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sj_icon.png'] = 'セイジ';
				jobnamesForURL['https://gamewith.akamaized.net/img/5e6dcc68342dc8b47f1949e423440f2c.jpg'] = 'オークレイダー';
				jobnamesForURL['https://gamewith.akamaized.net/img/eb56eea5facb08c64db160a857002113.jpg'] = 'オークモンク';
				jobnamesForURL['https://gamewith.akamaized.net/img/54a52e90e88f746817616177416386b1.jpg'] = 'オークシャーマン';

				jobnamesForURL['./images/l2r/kamaeru-heavy.png'] = 'バーサーカー';
				jobnamesForURL['./images/l2r/kamaeru-light.png'] = 'アヴァレスタ';
				jobnamesForURL['./images/l2r/kamaeru-magic.png'] = 'ソウルブレーカー';

				// クロサバ用
				if (mode == 2) {
					jobnamesForURL = [];
					jobnamesForURL['./images/kurosaba/classes/icn_warrior.png'] = 'ウォーリア';
					jobnamesForURL['./images/kurosaba/classes/icn_valkyrie.png'] = 'ヴァルキリー';
					jobnamesForURL['./images/kurosaba/classes/icn_giant.png'] = 'ジャイアント';
					jobnamesForURL['./images/kurosaba/classes/icn_witch.png'] = 'ウイッチ';
					jobnamesForURL['./images/kurosaba/classes/icn_ranger.png'] = 'レンジャー';
					jobnamesForURL['./images/kurosaba/classes/icn_blader.png'] = 'ブレイダー';
					jobnamesForURL['./images/kurosaba/classes/icn_beastmaster.png'] = 'リトルサマナー';
					jobnamesForURL['./images/kurosaba/classes/icn_sorceress.png'] = 'ソーサレス';
					jobnamesForURL['./images/kurosaba/classes/icn_wizard.png'] = 'ウィザード';
					jobnamesForURL['./images/kurosaba/classes/icn_f-blader.png'] = 'ツバキ';
					jobnamesForURL['./images/kurosaba/classes/icn_ninja.png'] = 'ニンジャ';
					jobnamesForURL['./images/kurosaba/classes/icn_kunoichi.png'] = 'クノイチ';
					jobnamesForURL['./images/kurosaba/classes/icn_mystic.png'] = 'ミスティック';
					jobnamesForURL['./images/kurosaba/classes/icn_striker.png'] = '格闘家';
					jobnamesForURL['./images/kurosaba/classes/icn_dark knight.png'] = 'ダークナイト';
					jobnamesForURL['./images/kurosaba/classes/icn_lahn.png'] = 'ラン';
					jobnamesForURL['./images/kurosaba/classes/icn_archer.png'] = 'アーチャー';
				}

				var jobbufs = [];
				jobbufs['パラディン'] = '防御';
				jobbufs['ウォーロード'] = '攻撃';
				jobbufs['トレジャーハンター'] = '移動';
				jobbufs['ホークアイ'] = '命中';
				jobbufs['ソーサラー'] = 'クリ';
				jobbufs['ビショップ'] = 'HP';
				jobbufs['テンプルナイト'] = '防御';
				jobbufs['ソードシンガー'] = '攻撃';
				jobbufs['プレインズウォーカー'] = '移動';
				jobbufs['シルバーレンジャー'] = '命中';
				jobbufs['スペルシンガー'] = 'クリ';
				jobbufs['エルダー'] = 'HP';
				jobbufs['シリエンナイト'] = '防御';
				jobbufs['ブレードダンサー'] = '攻撃';
				jobbufs['アビスウォーカー'] = '移動';
				jobbufs['ファントムレンジャー'] = '命中';
				jobbufs['スペルハウラー'] = 'クリ';
				jobbufs['シリエンエルダー'] = 'HP';
				jobbufs['ガーディアン'] = '防御';
				jobbufs['スレイヤー'] = '攻撃';
				jobbufs['スカベンジャー'] = '移動';
				jobbufs['ウォーレンジャー'] = '命中';
				jobbufs['クォーラルウィザード'] = 'クリ';
				jobbufs['セイジ'] = 'HP';
				jobbufs['オークレイダー'] = '攻撃';
				jobbufs['オークモンク'] = '命中';
				jobbufs['オークシャーマン'] = 'クリ';
				jobbufs['バーサーカー'] = '攻撃';
				jobbufs['アヴァレスタ'] = '命中';
				jobbufs['ソウルブレーカー'] = 'クリ';

				// クロサバ用
				if (mode == 2) {
					jobbufs = [];
					jobbufs['ウォーリア'] = '近距離';
					jobbufs['ヴァルキリー'] = '近距離';
					jobbufs['ジャイアント'] = '近距離';
					jobbufs['ウイッチ'] = '遠距離';
					jobbufs['レンジャー'] = '遠距離';
					jobbufs['ブレイダー'] = '近距離';
					jobbufs['リトルサマナー'] = '遠距離';
					jobbufs['ソーサレス'] = '遠距離';
					jobbufs['ウィザード'] = '遠距離';
					jobbufs['ツバキ'] = '近距離';
					jobbufs['ニンジャ'] = '近距離';
					jobbufs['クノイチ'] = '近距離';
					jobbufs['ミスティック'] = '近距離';
					jobbufs['格闘家'] = '近距離';
					jobbufs['ダークナイト'] = '近距離';
					jobbufs['ラン'] = '遠距離';
					jobbufs['アーチャー'] = '遠距離';
				}

				var jobs = [];
				jobs['パラディン'] = 'フェニックスナイト';
				jobs['ウォーロード'] = 'ドレッドノート';
				jobs['トレジャーハンター'] = 'アドベンチャラー';
				jobs['ホークアイ'] = 'サジタリウス';
				jobs['ソーサラー'] = 'アークメイジ';
				jobs['ビショップ'] = 'カーディナル';
				jobs['テンプルナイト'] = 'エヴァステンプラー';
				jobs['ソードシンガー'] = 'ソードミューズ';
				jobs['プレインズウォーカー'] = 'ウィンドライダー';
				jobs['シルバーレンジャー'] = 'ムーンライトセンティネル';
				jobs['スペルシンガー'] = 'ミスティックミューズ';
				jobs['エルダー'] = 'エヴァスセイント';
				jobs['シリエンナイト'] = 'シリエンテンプラー';
				jobs['ブレードダンサー'] = 'スペクトラルダンサー';
				jobs['アビスウォーカー'] = 'ゴーストハンター';
				jobs['ファントムレンジャー'] = 'ゴーストセンティネル';
				jobs['スペルハウラー'] = 'ストームスクリーマー';
				jobs['シリエンエルダー'] = 'シリエンセイント';
				jobs['ガーディアン'] = 'エターナルガーディアン';
				jobs['スレイヤー'] = 'ウォースレイヤー';
				jobs['スカベンジャー'] = 'バウンティハンター';
				jobs['ウォーレンジャー'] = 'ウォースミス';
				jobs['クォーラルウィザード'] = 'エルドリッチウィザード';
				jobs['クォーラルウィザード'] = 'エルドリッヂウィザード';
				jobs['クォーラルウィザード'] = 'エルドリッジウィザード';
				jobs['セイジ'] = 'マスターセイジ';
				jobs['オークレイダー'] = 'デストロイヤー';
				jobs['オークモンク'] = 'タイラント';
				jobs['オークシャーマン'] = 'ウォークライヤー';
				jobs['バーサーカー'] = 'ドゥームブリンガー';
				jobs['アヴァレスタ'] = 'トリックスター';
				jobs['ソウルブレーカー'] = 'ソウルハウンド';

				// クロサバ用
				if (mode == 2) {
					jobs = [];
					jobs['ウォーリア'] = 'ウォーリア';
					jobs['ヴァルキリー'] = 'ヴァルキリー';
					jobs['ジャイアント'] = 'ジャイアント';
					jobs['ウイッチ'] = 'ウイッチ';
					jobs['レンジャー'] = 'レンジャー';
					jobs['ブレイダー'] = 'ブレイダー';
					jobs['リトルサマナー'] = 'リトルサマナー';
					jobs['ソーサレス'] = 'ソーサレス';
					jobs['ウィザード'] = 'ウィザード';
					jobs['ツバキ'] = 'ツバキ';
					jobs['ニンジャ'] = 'ニンジャ';
					jobs['クノイチ'] = 'クノイチ';
					jobs['ミスティック'] = 'ミスティック';
					jobs['格闘家'] = '格闘家';
					jobs['ダークナイト'] = 'ダークナイト';
					jobs['ラン'] = 'ラン';
					jobs['アーチャー'] = 'アーチャー';
				}

				var rejobs = [];
				rejobs['フェニックスナイト'] = 'パラディン';
				rejobs['ドレッドノート'] = 'ウォーロード';
				rejobs['アドベンチャラー'] = 'トレジャーハンター';
				rejobs['サジタリウス'] = 'ホークアイ';
				rejobs['アークメイジ'] = 'ソーサラー';
				rejobs['カーディナル'] = 'ビショップ';
				rejobs['エヴァステンプラー'] = 'テンプルナイト';
				rejobs['ソードミューズ'] = 'ソードシンガー';
				rejobs['ウィンドライダー'] = 'プレインズウォーカー';
				rejobs['ムーンライトセンティネル'] = 'シルバーレンジャー';
				rejobs['ミスティックミューズ'] = 'スペルシンガー';
				rejobs['エヴァスセイント'] = 'エルダー';
				rejobs['シリエンテンプラー'] = 'シリエンナイト';
				rejobs['スペクトラルダンサー'] = 'ブレードダンサー';
				rejobs['ゴーストハンター'] = 'アビスウォーカー';
				rejobs['ゴーストセンティネル'] = 'ファントムレンジャー';
				rejobs['ストームスクリーマー'] = 'スペルハウラー';
				rejobs['シリエンセイント'] = 'シリエンエルダー';
				rejobs['エターナルガーディアン'] = 'ガーディアン';
				rejobs['ウォースレイヤー'] = 'スレイヤー';
				rejobs['バウンティハンター'] = 'スカベンジャー';
				rejobs['ウォースミス'] = 'ウォーレンジャー';
				rejobs['エルドリッヂウィザード'] = 'クォーラルウィザード';
				rejobs['マスターセイジ'] = 'セイジ';
				rejobs['デストロイヤー'] = 'オークレイダー';
				rejobs['タイラント'] = 'オークモンク';
				rejobs['ウォークライヤー'] = 'オークシャーマン';
				rejobs['ドゥームブリンガー'] = 'バーサーカー';
				rejobs['トリックスター'] = 'アヴァレスタ';
				rejobs['ソウルハウンド'] = 'ソウルブレーカー';

				rejobs['パラディン'] = 'パラディン';
				rejobs['ウォーロード'] = 'ウォーロード';
				rejobs['トレジャーハンター'] = 'トレジャーハンター';
				rejobs['ホークアイ'] = 'ホークアイ';
				rejobs['ソーサラー'] = 'ソーサラー';
				rejobs['ビショップ'] = 'ビショップ';
				rejobs['テンプルナイト'] = 'テンプルナイト';
				rejobs['ソードシンガー'] = 'ソードシンガー';
				rejobs['プレインズウォーカー'] = 'プレインズウォーカー';
				rejobs['シルバーレンジャー'] = 'シルバーレンジャー';
				rejobs['スペルシンガー'] = 'スペルシンガー';
				rejobs['エルダー'] = 'エルダー';
				rejobs['シリエンナイト'] = 'シリエンナイト';
				rejobs['ブレードダンサー'] = 'ブレードダンサー';
				rejobs['アビスウォーカー'] = 'アビスウォーカー';
				rejobs['ファントムレンジャー'] = 'ファントムレンジャー';
				rejobs['スペルハウラー'] = 'スペルハウラー';
				rejobs['シリエンエルダー'] = 'シリエンエルダー';
				rejobs['ガーディアン'] = 'ガーディアン';
				rejobs['スレイヤー'] = 'スレイヤー';
				rejobs['スカベンジャー'] = 'スカベンジャー';
				rejobs['ウォーレンジャー'] = 'ウォーレンジャー';
				rejobs['クォーラルウィザード'] = 'クォーラルウィザード';
				rejobs['セイジ'] = 'セイジ';
				rejobs['オークレイダー'] = 'オークレイダー';
				rejobs['オークモンク'] = 'オークモンク';
				rejobs['オークシャーマン'] = 'オークシャーマン';
				rejobs['バーサーカー'] = 'バーサーカー';
				rejobs['アヴァレスタ'] = 'アヴァレスタ';
				rejobs['ソウルブレーカー'] = 'ソウルブレーカー';

				// クロサバ用
				if (mode == 2) {
					rejobs = [];
					rejobs['ウォーリア'] = 'ウォーリア';
					rejobs['ヴァルキリー'] = 'ヴァルキリー';
					rejobs['ジャイアント'] = 'ジャイアント';
					rejobs['ウイッチ'] = 'ウイッチ';
					rejobs['レンジャー'] = 'レンジャー';
					rejobs['ブレイダー'] = 'ブレイダー';
					rejobs['リトルサマナー'] = 'リトルサマナー';
					rejobs['ソーサレス'] = 'ソーサレス';
					rejobs['ウィザード'] = 'ウィザード';
					rejobs['ツバキ'] = 'ツバキ';
					rejobs['ニンジャ'] = 'ニンジャ';
					rejobs['クノイチ'] = 'クノイチ';
					rejobs['ミスティック'] = 'ミスティック';
					rejobs['格闘家'] = '格闘家';
					rejobs['ダークナイト'] = 'ダークナイト';
					rejobs['ラン'] = 'ラン';
					rejobs['アーチャー'] = 'アーチャー';
				}
			</script>
		</section>

		<!-- this app functions -->
		<section id="scripts">
			<!-- this app [utility functions] -->
			<script>
				var dispatchPortlateLayout = function(){
					if ((navigator.userAgent.indexOf('iPhone') > 0 && navigator.userAgent.indexOf('iPad') == -1) || navigator.userAgent.indexOf('iPod') > 0 || navigator.userAgent.indexOf('Android') > 0) {
						var orientation = window.orientation;
						if (orientation == undefined && 'undefined' != typeof getParams['orientation'] && 'landscape' == getParams['orientation']) {
							orientation = 1;
						}
						console.log('orientation='+orientation);
						if(orientation == 0 || undefined == orientation){
							$("body").addClass("portrait");
							$("body").removeClass("landscape");
							$('.riotcontes .col-xs-4').addClass('col-sm-4').removeClass('col-xs-4');
							$('.riotcontes .col-xs-8').addClass('col-sm-8').removeClass('col-xs-8');
							$('.riotcontes .col-xs-3').addClass('col-sm-3').removeClass('col-xs-3');
							$('.riotcontes .col-xs-9').addClass('col-sm-9').removeClass('col-xs-9');
							portlate = true;
						}
						else{
							$("body").addClass("landscape");
							$("body").removeClass("portrait");
							$('.riotcontes .col-sm-4').addClass('col-xs-4').removeClass('col-sm-4');
							$('.riotcontes .col-sm-8').addClass('col-xs-8').removeClass('col-sm-8');
							$('.riotcontes .col-sm-3').addClass('col-xs-3').removeClass('col-sm-3');
							$('.riotcontes .col-sm-9').addClass('col-xs-9').removeClass('col-sm-9');
						}
					}
				}
				var getUrlVars = function(){
					var vars = {};
					var param = location.search.substring(1).split('&');
					for(var i = 0; i < param.length; i++) {
							var keySearch = param[i].search(/=/);
							var key = '';
							if(keySearch != -1) key = param[i].slice(0, keySearch);
							var val = param[i].slice(param[i].indexOf('=', 0) + 1);
							if(key != '') vars[key] = decodeURI(val);
					}
					return vars;
				};
				var escapeHTML = function (str) {
				   return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
				};
				var loading = function (show) {
					if (show) {
						loadingCount++;
						$('#loader').fadeIn();
					}
					else {
						loadingCount--;
						if (1 > loadingCount) {
							$('#loader').fadeOut();
							loadingCount = 0;
						}
					}
				};
				var showToast = function (argMessage) {
				  toasts++;
				  if (0 < $('#toast').size()) {
				    $('#toast').text(argMessage);
						$('#toast').show();
				  }
				  else {
				      $('body').append('<b id="toast" style="background-color: gray; opacity: 0.6; color: white; font-size: x-small; text-align: center; position: fixed; bottom: 10px; right: 10px; padding: 10px; z-index: 3000;" onclick="closeToast(true);">' + argMessage + '</b>');
				  }
					console.log(argMessage);
				  toastIntervals.push(setInterval(function(){
				    closeToast(false, toastIntervals.length);
				  }, 10000));
				};
				var closeToast = function (argForceFlag, idx) {
				  toasts--;
				  if (argForceFlag) {
				    toasts = 0;
				  }
					else {
				    clearInterval(toastIntervals[idx]);
				    toastIntervals[idx] = null;
				  }
				  if (0 >= toasts) {
				    toasts = 0;
				    $('#toast').fadeOut('nomal');
						toastIntervals = [];
				  }
				};
				var uploadImageToImgur = function (base64image, callback) {
					loading(true);
					var bese64idx = base64image.indexOf('base64,');
					if (-1 < bese64idx) {
						base64image = base64image.substr(bese64idx+7).trim();
					}
					var formData = new FormData();
					formData.append('image', base64image);
					return $.ajax({
						contentType: false,
						data: formData,
						headers: {
							Authorization: 'Client-ID 3a8b3d4747fe56d',
						},
						processData: false,
						type: 'POST',
						url: 'https://api.imgur.com/3/image'
					}).done(function(data) {
						loading(false);
						if ('function' == typeof callback) {
							callback(true, data);
						}
					}).fail(function(data) {
						loader(false);
						console.log(data);
						if ('function' == typeof callback) {
							callback(false, data);
						}
						else {
							alert('画像のアップロードに失敗しました。');
						}
					});
				};
				var getBase64Image = function (targetID){
					if (!('string' == typeof $('#'+targetID).attr('src') && 0 < $('#'+targetID).attr('src').length)) {
						return '';
					}
					if (1 < $('#'+targetID).attr('src').indexOf(';base64')) {
						return $('#'+targetID).attr('src');
					}
  				//img要素オブジェクトを取得する
  				var obj = document.getElementById(targetID);
					obj.crossOrigin = 'anonymous';
					//canvas要素を生成してimg要素を反映する
					var cvs = document.createElement('canvas');
					cvs.width  = obj.width;
					cvs.height = obj.height;
					var ctx = cvs.getContext('2d');
					ctx.drawImage(obj, 0, 0);
					//canvas要素をBase64化する
					return cvs.toDataURL();
 				};
				var convertZenkaku2hankaku = function (val) {
					var regex = /[Ａ-Ｚａ-ｚ０-９！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［＼］＾＿｀｛｜｝]/g;
					// 入力値の全角を半角の文字に置換
					value = val.replace(regex, function(s) {
						return String.fromCharCode(s.charCodeAt(0) - 0xfee0);
					})
					.replace(/[‐－―]/g, "-") // ハイフンなど
					.replace(/[～〜]/g, "~") // チルダ
					.replace(/　/g, " "); // スペース
					return value;
				};
				var drawText = function(ctx, txt, x, y, opt){
				    var def = {
				        baseline:'middle',
				        align:'left',
								color: 'black',
				        backgroundcolor: null,
				        fontSize:12
				    };
				    $.extend(def,opt);
				    ctx.font = def.fontSize + "px Meiryo";
				    ctx.textAlign = def.align;
				    ctx.textBaseline = def.baseline;

				    var leftX, topY, width, height;
				    height = def.fontSize;
				    width = ctx.measureText(txt).width;

				    switch(def.baseline){
				        case 'top':
				            height *= 1.5;
				            topY = y;
				            break;
				        case 'middle':
				            topY = y - (height/2);
				            break;
				        case 'bottom':
				            height *= 1.5;
				            topY = y - height;
				            break;
				    }
				    switch(def.align){
				        case 'left':
				            leftX = x;
				            break;
				        case 'center':
				            leftX = x + (width/2);
				            break;
				        case 'right':
				            leftX = x + width;
				            break;
				    }

				    if(topY && leftX && def.backgroundcolor){
				        ctx.fillStyle = def.backgroundcolor;
								// paddingを少し入れる
				        ctx.fillRect(leftX, topY, width + 6, height + 6);
								x += 4;
								y += 4;
				    }
				    ctx.fillStyle = def.color;
				    /*指定位置に点を打つ
				    ctx.beginPath();
				    ctx.arc(x, y, 3, 0, Math.PI*2, false);
				    ctx.fill();
				    */
				    ctx.fillText(txt, x, y);
				};
			</script>

			<!-- this app [database functions] -->
			<script>
				var auth = function (clanID, callback) {
					loading(true);
					var loginRedirect = false;
					var key = null;
					if ('undefined' != typeof clanID && 0 < clanID.length) {
						key = clanID;
						loginRedirect = true;
					} else if ('undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
						key = getParams['clanid'];
						if ('' == location.hash || '#login' == location.hash) {
							loginRedirect = true;
						}
					}
					if (key == null) {
						// ログイン画面へ
						location.href = '#login';
						loading(false);
						return;
					}
					// firbase問い合わせ
					firebase.firestore().collection("clans").doc(key).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							// 血盟名が取れていればOK
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								clan = data;
								clan.ID = snapshot.id;
								if (loginRedirect) {
									getParams['clanid'] = key;
									var newhref = '?clanid=' + key + '#dashboard';
									if ('on' == getParams['view']) {
										newhref = newhref.replace('#dashboard', '&view=on#dashboard');
									}
									location.href = newhref;
								}
								if (!('undefined' != typeof clan.addisabled && clan.addisabled)) {
									riot.mount('footerbar');
								}
								if (callback) {
									callback(data);
								}
								loading(false);
								// 鍵が掛かっていた場合は鍵を入れないと入れない
								if ('string' == typeof data.clanpass) {
									var showPassAlert = function () {
										swal({
											title: 'パスワード',
											content: {
												element: 'input',
												attributes: {
													id: 'clanpass',
													type: 'password',
												},
											},
											buttons: {
										    cancel: "キャンセル",
										    ok: true
										  }
										}).then(function(val) {
											if (val) {
												// 入力値を受け取る
												if (data.clanpass.toLowerCase() === CryptoJS.SHA1($('#clanpass').val()).toString().toLowerCase()) {
													// 一致
													return;
												}
												else {
													alert('パスワードが一致しませんでした。');
													showPassAlert();
												}
											}
											else {
												// ログイン画面へ
												location.href = './#login';
											}
										});
									};
									showPassAlert();
								}
								return;
							}
						}
						alert('該当する' + clanLabel + 'が見つかりませんでした。');
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '/#login';
						loading(false);
					}).catch(function(error) {
						alert('認証エラーが発生した為、ログイン処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '#login';
						loading(false);
					});
				};
				var getClans = function (callback) {
					loading(true);
					firebase.firestore().collection("clans").get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerClan = function (updateID, data, callback) {
					loading(true);
					if (updateID != null && 0 < updateID.length) {
						firebase.firestore().collection("clans").doc(updateID).update(data).then(function(snapshot) {
							if (callback) {
								callback(updateID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else  {
						data.useInfoJob = true;
						firebase.firestore().collection("clans").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('登録エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterContribution = function (clanID, targetID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("contributions").doc(targetID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('貢献度集計削除エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				}
				var registerContribution = function (clanID, date, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					var dateLabel = date;
					if (-1 < dateLabel.indexOf('/')) {
						dateLabel = dateLabel.replace(/\//g, '');
					}
					if (-1 < dateLabel.indexOf(' ')) {
						dateLabel = dateLabel.split(' ')[0];
					}
					dateLabel = dateLabel + '-' + clanID;
					data.contributionID = dateLabel;
					data.clanid = clanID;
					loading(true);
					var registerContributionUser = function (_dateLabel, _data, _callback) {
						firebase.firestore().collection("contributions").doc(_dateLabel).collection("users").doc(_data.ID).set(_data).then(function(snapshot) {
							if (_callback) {
								callback();
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('貢献登録エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					};
					firebase.firestore().collection("contributions").doc(dateLabel).get().then(function(snapshot){
  					if(snapshot.exists) {
							// データがもうある場合
							registerContributionUser(dateLabel, data, callback);
							return;
						}
						else {
							// データがまだない場合
							firebase.firestore().collection("contributions").doc(dateLabel).set({ID:dateLabel, clanid:clanID, date: new Date(date), }).then(function(snapshot) {
								registerContributionUser(dateLabel, data, callback);
								return;
							}).catch(function(error) {
								alert('貢献度集計日登録エラーが発生した為、処理を中断します。');
								console.error("Error writing document: ", error);
								// ログイン出来ていないのでログイン画面へ戻す
								loading(false);
							});
						}
					}).catch(function(error) {
						alert('貢献度集計日参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerNews = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						newsID = data.ID;
						delete data.ID;
						firebase.firestore().collection("news").doc(newsID).update(data).then(function(snapshot) {
							if (callback) {
								callback(newsID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('お知らせ更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("news").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('お知らせ追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterNews = function (newsID, callback) {
					if (newsID == null || 'undefined' == typeof newsID || 1 > newsID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("news").doc(newsID).delete().then(function(snapshot) {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('お知らせ削除エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerSchedule = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						scheduleID = data.ID;
						delete data.ID;
						firebase.firestore().collection("schedules").doc(scheduleID).update(data).then(function(snapshot) {
							if (callback) {
								callback(scheduleID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("schedules").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerScheduleuser = function (scheduleID, data, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("schedules").doc(scheduleID).collection("users").doc(data.ID).set(data).then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参加登録エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var unregisterScheduleuser = function (scheduleID, userID, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("schedules").doc(scheduleID).collection("users").doc(userID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参加者削除エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerUser = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					data.modified = new Date();
					if (data.ID != '') {
						userID = data.ID;
						delete data.ID;
						firebase.firestore().collection("users").doc(userID).update(data).then(function(snapshot) {
							if (callback) {
								callback(userID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("users").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("users").doc(userID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('更新エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedules = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var targettime = Math.round((new Date()).getTime() - (60 * 60 * 12 * 1000));
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).orderBy("date", "asc").startAt(targettime).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									data.date = data.date.toDate();
									if (targettime > data.date.getTime()){
										return;
									}
									data.date = data.date.toLocaleString();
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUsers = function (clanID, selectable, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("users").where("clanid", "==", clanID);
					if (false !== selectable) {
						// XXX >,>=,<,=<とorderはどうも一緒には出来ない模様・・・
						if (true === selectable) {
							collection = collection.where("activity", ">", -9);
						}
						else {
							collection = collection.where("activity", ">=", parseInt(selectable)).orderBy("activity", "desc");
						}
					}
					else {
						collection = collection.orderBy("activity", "desc").orderBy("cp", "desc").orderBy("joind", "asc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								if ('undefined' != typeof data.modified && 'string' != typeof data.modified) {
									data.modified = data.modified.toDate();
									data.modified = data.modified.toLocaleString();
									data.modified = data.modified.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getContributions = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var targettime = Math.round((new Date()).getTime() - (60 * 60 * 24 * 8 * 1000));
					firebase.firestore().collection("contributions").where("clanid", "==", clanID).orderBy("date", "desc").get().then(function(querySnapshot) {
						var datas = {};
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									data.date = data.date.toDate();
									if (targettime > data.date.getTime()){
										return;
									}
									data.date = data.date.toLocaleString();
									data.date = data.date.split(' ')[0];
								}
								datas[data.ID] = data;
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getContributionUsers = function (clanID, date, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					var dateLabel = date;
					if (-1 < dateLabel.indexOf('/')) {
						dateLabel = dateLabel.replace(/\//g, '');
					}
					if (-1 < dateLabel.indexOf(' ')) {
						dateLabel = dateLabel.split(' ')[0];
					}
					dateLabel = dateLabel + '-' + clanID;
					loading(true);
					var collection = firebase.firestore().collection("contributions").doc(dateLabel).collection("users").get().then(function(querySnapshot) {
						var datas = {};
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas[data.ID] = data;
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getNews = function (clanID, tag, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("news").where("clanid", "==", clanID);
					if (null != tag && 0 < tag.length) {
						collection = collection.where("tag", "==", tag);
					}
					else {
						collection = collection.orderBy('tag', 'desc');
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleByTag = function (clanID, tag, callback) {
					if (tag == null || 'undefined' == typeof tag || 1 > tag.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).where("tag", "==", tag).orderBy('date', 'desc').orderBy('incount', 'desc').limit(3).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedule = function (scheduleID, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").doc(scheduleID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.date) {
								data.date = data.date.toDate();
								data.date = data.date.toLocaleString();
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleUsers = function (scheduleID, entryOK, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("schedules").doc(scheduleID).collection("users");
					if (entryOK) {
						collection = collection.where('entry', '>', -1);
					}
					else {
						//collection = collection.orderBy("entry", "desc").orderBy("cp", "desc");
						collection = collection.orderBy("party", "desc").orderBy("entry", "desc").orderBy("cp", "desc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("users").doc(userID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
								data.joind = data.joind.toDate();
								data.joind = data.joind.toLocaleString();
								data.joind = data.joind.split(' ')[0];
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
								loading(false);
								return;
							}
						}
						if (callback) {
							callback(null);
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUserFromName = function (clanID, userName, callback) {
					if (userName == null || 'undefined' == typeof userName || 1 > userName.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("users").where("clanid", "==", clanID).where('name', '==', userName).limit(1).get().then(function(querySnapshot) {
						var user = null;
						querySnapshot.forEach(function(snapshot) {
	  					if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								if ('undefined' != typeof data.name && 0 < data.name.length) {
									user = data;
								}
							}
						});
						if ('undefined' != typeof user) {
							if (callback) {
								callback(user);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getOperations = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("operations").where("clanid", "==", clanID).orderBy("date", "desc").get().then(function(querySnapshot) {
						var datas = {};
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									data.date = data.date.toDate();
									data.date = data.date.toLocaleString();
								}
								datas[data.ID] = data;
							}
						});
						firebase.firestore().collection("operations").where("share", "==", true).orderBy("date", "desc").get().then(function(_querySnapshot) {
							_querySnapshot.forEach(function(_snapshot) {
								if(_snapshot.exists) {
									var data = _snapshot.data();
									data.ID = _snapshot.id;
									if ('undefined' != typeof data.date) {
										data.date = data.date.toDate();
										data.date = data.date.toLocaleString();
									}
									datas[data.ID] = data;
								}
							});
							if ('undefined' != typeof datas) {
								if (callback) {
									callback(datas);
								}
							}
							loading(false);
							return;
						});
					}).catch(function(error) {
						alert('作戦書一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerOperation = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					data.clanname = clan.name;
					if (data.ID != '') {
						newsID = data.ID;
						delete data.ID;
						firebase.firestore().collection("operations").doc(newsID).update(data).then(function(snapshot) {
							if (callback) {
								callback(newsID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('作戦書更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						data.date = new Date();
						firebase.firestore().collection("operations").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('作戦書追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
			</script>

			<!-- this app [event functions] -->
			<script>
				var clerinput = function (target) {
					$(target).parent().find('input').val('');
				};
				var onclickLogin = function (target) {
					var clanID = $('#loginform').find('input[name=clanID]').val();
					auth(clanID);
					return false;
				};
				var onclickAddClan = function (target) {
					location.href='#addclan';
				};
				var onclickRegisterClan = function (target) {
					var clanname = $('#registerClanform').find('input[name=clan]').val();
					var clanurl = $('#registerClanform').find('input[name=url]').val();
					var updateClnaID = null;
					if (0 < clanname.length) {
						var data = {name: clanname, url: clanurl};
						var webhook = $('#registerClanform').find('input[name=discordwebhook]').val();
						if ('string' == typeof webhook) {
							var webhooks = webhook.split('/');
							console.log(webhooks);
							if (6 <= webhooks.length && 10 <= webhooks[webhooks.length-1].length && 68 <= webhooks[webhooks.length-2]) {
								data.discordhookid = webhooks[webhooks.length-2];
								data.discordhooktoken = webhooks[webhooks.length-1];
							}
						}
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							updateClnaID = getParams['clanid'];
						}
						data.twitterDisabled = 1;
						if ($('#registerClanform').find('input[name=twitterDisabled]').prop('checked')) {
							data.twitterDisabled = 0;
						}
						data.twitterPCEnabled = 0;
						if ($('#registerClanform').find('input[name=twitterPCEnabled]').prop('checked')) {
							data.twitterPCEnabled = 1;
						}
						console.log(data);
						registerClan(updateClnaID, data, function (newClanID){
							alert('登録しました。');
							if ('#addclan' == location.hash) {
								var url = location.protocol + '//' + document.domain + location.pathname + '?clanid=' + newClanID;
								alert('あなたの' + clanLabel + 'URLは「' + url + '」です。\nログイン用' + clanLabel + 'IDは「' + newClanID + '」です。\n無くさないように保管してください！');
							}
							getParams['clanid'] = newClanID;
							location.href = '?clanid=' + newClanID + '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var duplicateEntryUserCnt = 0;
				var duplicateEntryCnt = 0;
				var duplicateEntrySchedule = function (baseSchedule, newSchedule, duplicateEntryUsers) {
					if (duplicateEntryUserCnt < duplicateEntryUsers.length) {
						if (0 > duplicateEntryUsers[duplicateEntryUserCnt].entry) {
							duplicateEntryUserCnt++;
							duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
							return;
						}
						getUser(duplicateEntryUsers[duplicateEntryUserCnt].ID, function (targetUser) {
							if (null === targetUser) {
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
								return;
							}
							if (targetUser.activity < 0) {
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
								return;
							}
							targetUser.entry = 0;
							targetUser.status = 0;
							targetUser.party = 0;
							targetUser.voice = 0;
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].status) {
								targetUser.status = duplicateEntryUsers[duplicateEntryUserCnt].status;
							}
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].party) {
								targetUser.party = duplicateEntryUsers[duplicateEntryUserCnt].party;
							}
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].voice) {
								targetUser.voice = duplicateEntryUsers[duplicateEntryUserCnt].voice;
							}
							targetUser.comment = '同一タグの前回のPT編成をコピー';
							duplicateEntryUsers[duplicateEntryUserCnt].entry = 0;
							registerScheduleuser(newSchedule.ID, targetUser, function (){
								duplicateEntryCnt++;
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
							});
						});
						return;
					}
					else {
						newSchedule.incount = duplicateEntryCnt;
						registerSchedule(clan.ID, newSchedule, function (){
							// コピー完了
							alert('登録しました。');
							location.href = '#dashboard';
						});
					}
				};
				var onclickRegisterSchedule = function (target, scheduleID, duplicate) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduletag = $('#addscheduleform').find('input[name=scheduletag]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					var scheduleincount = $('#addscheduleform').find('input[name=scheduleincount]').val();
					var scheduletype = $('#addscheduleform').find('select[name=scheduletype] option:selected').val();
					var scheduleautoreset = false;
					var scheduleautoresetpt = false;
					if ($('#addscheduleform').find('input[name=scheduleautoreset]').prop('checked')) {
						scheduleautoreset = true;
						if ($('#addscheduleform').find('input[name=scheduleautoresetpt]').prop('checked')) {
							scheduleautoresetpt = true;
						}
					}
					if (1 > scheduleincount.length) {
						scheduleincount = '0';
					}
					if (true == duplicate) {
						if (1 > scheduletag.length) {
							alert('コピー元になるタグの設定がありません。');
							return;
						}
					}
					if (0 < schedulename.length && 0 < scheduledate.length && 0 < scheduleincount.length) {
						var data = { ID: scheduleID, name: schedulename, date: new Date(scheduledate), tag: scheduletag, incount: parseInt(scheduleincount), type: parseInt(scheduletype), autoReset: scheduleautoreset, autoResetPT: scheduleautoresetpt };
						registerSchedule(clan.ID, data, function (newScheduleID){
							data.ID = newScheduleID;
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								if (target) {
									alert('更新しました。');
								}
								else {
									//location.href = '?clanid=' + clan.ID + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
									location.reload();
								}
								return;
							}
							if (true == duplicate) {
								getScheduleByTag(clan.ID, scheduletag, function(datas){
									if (1 < datas.length) {
										var baseSchedule = {incount:0};
										if ('undefined' != typeof datas[0] && 0 < datas[0].incount) {
											baseSchedule = datas[0];
										}
										else if ('undefined' != typeof datas[1] && baseSchedule.incount < datas[1].incount) {
											baseSchedule = datas[1];
										}
										else if ('undefined' != typeof datas[2] && baseSchedule.incount < datas[2].incount) {
											baseSchedule = datas[2];
										}
										if (1 > baseSchedule.incount){
											alert('登録しました。');
											location.href = '#dashboard';
											return;
										}
										getScheduleUsers(baseSchedule.ID, null, function (entryUsers){
											if (0 < entryUsers.length) {
												duplicateEntryCnt = 0;
												duplicateEntryUserCnt = 0;
												duplicateEntrySchedule(baseSchedule, data, entryUsers);
												return;
											}
											alert('登録しました。');
											location.href = '#dashboard';
										});
									}
								});
								return;
							}
							alert('登録しました。');
							location.href = '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickSavePTLabel = function (target, scheduleID) {
					if (0 < scheduleID.length) {
						var schedulept49label = $('#entryscheduleform').find('input[name=schedulept49label]').val();
						var schedulept48label = $('#entryscheduleform').find('input[name=schedulept48label]').val();
						//var schedulept47label = $('#entryscheduleform').find('input[name=schedulept47label]').val();
						var schedulept39label = $('#entryscheduleform').find('input[name=schedulept39label]').val();
						var schedulept38label = $('#entryscheduleform').find('input[name=schedulept38label]').val();
						var schedulept37label = $('#entryscheduleform').find('input[name=schedulept37label]').val();
						var schedulept29label = $('#entryscheduleform').find('input[name=schedulept29label]').val();
						var schedulept28label = $('#entryscheduleform').find('input[name=schedulept28label]').val();
						var schedulept27label = $('#entryscheduleform').find('input[name=schedulept27label]').val();
						var schedulept19label = $('#entryscheduleform').find('input[name=schedulept19label]').val();
						var schedulept18label = $('#entryscheduleform').find('input[name=schedulept18label]').val();
						var schedulept17label = $('#entryscheduleform').find('input[name=schedulept17label]').val();
						var schedulept9label = $('#entryscheduleform').find('input[name=schedulept9label]').val();
						var schedulept8label = $('#entryscheduleform').find('input[name=schedulept8label]').val();
						var schedulept7label = $('#entryscheduleform').find('input[name=schedulept7label]').val();
						var data = { ID: scheduleID };
						if ('string' == typeof schedulept49label && 0 < schedulept49label.length) {
							data.pt49label = schedulept49label;
						}
						if ('string' == typeof schedulept48label && 0 < schedulept48label.length) {
							data.pt48label = schedulept48label;
						}
						/*if ('string' == typeof schedulept47label && 0 < schedulept47label.length) {
							data.pt49label = schedulept47label;
						}*/
						if ('string' == typeof schedulept39label && 0 < schedulept39label.length) {
							data.pt39label = schedulept39label;
						}
						if ('string' == typeof schedulept38label && 0 < schedulept38label.length) {
							data.pt38label = schedulept38label;
						}
						if ('string' == typeof schedulept37label && 0 < schedulept37label.length) {
							data.pt37label = schedulept37label;
						}
						if ('string' == typeof schedulept29label && 0 < schedulept29label.length) {
							data.pt29label = schedulept29label;
						}
						if ('string' == typeof schedulept28label && 0 < schedulept28label.length) {
							data.pt28label = schedulept28label;
						}
						if ('string' == typeof schedulept27label && 0 < schedulept27label.length) {
							data.pt27label = schedulept27label;
						}
						if ('string' == typeof schedulept19label && 0 < schedulept19label.length) {
							data.pt19label = schedulept19label;
						}
						if ('string' == typeof schedulept18label && 0 < schedulept18label.length) {
							data.pt18label = schedulept18label;
						}
						if ('string' == typeof schedulept17label && 0 < schedulept17label.length) {
							data.pt17label = schedulept17label;
						}
						if ('string' == typeof schedulept9label && 0 < schedulept9label.length) {
							data.pt9label = schedulept9label;
						}
						if ('string' == typeof schedulept8label && 0 < schedulept8label.length) {
							data.pt8label = schedulept8label;
						}
						if ('string' == typeof schedulept7label && 0 < schedulept7label.length) {
							data.pt7label = schedulept7label;
						}
						registerSchedule(clan.ID, data, function (newScheduleID){
							alert('更新しました。');
							return;
						});
					}
				};
				var onclickRegisterNews = function (target) {
					var newstext = $('#editnewsform').find('textarea[name=newstext]').val();
					var newsID = $('#editnewsform').find('input[name=newsid]').val();
					var newstag = $('#editnewsform').find('input[name=newstag]').val();
					var newsnotifymode = parseInt($('#editnewsform').find('select[name=newsnotifymode] option:selected').val());
					var newsnotifytime = parseInt($('#editnewsform').find('select[name=newsnotifytime] option:selected').val());
					if ('undefined' != typeof newstext && 0 < newstext.length) {
						var data = { ID: newsID, text: newstext, tag: newstag, notifymode: 0, notifytime: 0, };
						if (!isNaN(newsnotifymode) && 0 < newsnotifymode) {
							data.notifymode = newsnotifymode;
						}
						if (!isNaN(newsnotifytime) && 0 < newsnotifytime) {
							data.notifytime = newsnotifytime;
						}
						registerNews(clan.ID, data, function (){
							alert('登録しました。');
							location.reload();
							return;
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickUnRegisterNews = function (target) {
					var newsID = $('#editnewsform').find('input[name=newsid]').val();
					if ('undefined' != typeof newsID && 0 < newsID.length) {
						unregisterNews(newsID, function (){
							alert('お知らせを削除しました。');
							location.reload();
							return;
						});
					}
					return;
				};
				var onclickRegister = function (target, userID, beforeUserName) {
					var username = $('#registerform').find('input[name=username]').val();
					if ('on' == getParams['view'] && beforeUserName != username) {
						// Viewモードで名前が変わっていたら違う人
						userID = '';
					}
					var userjob = $('#registerform').find('select[name=userjob] option:selected').val();
					var userlevel = $('#registerform').find('input[name=userlevel]').val();
					var usercp = $('#registerform').find('input[name=usercp]').val();
					var usermemo = $('#registerform').find('input[name=memo]').val();
					var userdiscord = $('#registerform').find('input[name=discord]').val();
					var useractivity = $('#registerform').find('select[name=useractivity] option:selected').val();
					var userjoind = $('#registerform').find('#joinddate').data().date;
					if (true != ('職業' != userjob && '区分' != useractivity && 0 < username.length && 0 < userjob.length && 0 < userlevel.length && 0 < usercp.length && 0 < useractivity.length)) {
						if ('職業' == userjob) {
							alert('職業を選択して下さい。');
						}
						if ('区分' == useractivity) {
							alert('区分を選択して下さい。');
						}
						alert('入力が正しくない項目があった為、処理を中断します。');
						return;
					}
					var data = { ID: userID, name: username, job: userjob, level: parseInt(userlevel), cp: parseInt(usercp), memo: usermemo, activity: parseInt(useractivity), discord: userdiscord, };
					if (0 < userjoind.length) {
						data.joind = new Date(userjoind);
					}
					if (mode==1) {
						var userjob3d = $('#registerform').find('select[name=userjob3d] option:selected').val();
						var usermeteo = $('#registerform').find('select[name=usermeteo] option:selected').val();
						var userdzone = $('#registerform').find('select[name=userdzone] option:selected').val();
						var userpvpat = $('#registerform').find('select[name=userpvpat] option:selected').val();
						var userpvpdf = $('#registerform').find('select[name=userpvpdf] option:selected').val();
						var usersweet = $('#registerform').find('select[name=usersweet] option:selected').val();
						var usermamono = $('#registerform').find('select[name=usermamono] option:selected').val();
						var userdragon = $('#registerform').find('select[name=userdragon] option:selected').val();
						var userboss = $('#registerform').find('select[name=userboss] option:selected').val();

						var usersubjob = $('#registerform').find('select[name=usersubjob] option:selected').val();
						var usersubjob3d = $('#registerform').find('select[name=usersubjob3d] option:selected').val();
						var usersubcp = $('#registerform').find('input[name=usersubcp]').val();
						if ('デュアルクラス' === usersubjob) {
							usersubjob = null;
							usersubjob3d = null;
							usersubcp = null;
						}
						else {
							usersubjob3d = parseInt(usersubjob3d);
							usersubcp = parseInt(usersubcp);
							if (isNaN(usersubcp)) {
								usersubcp = null;
							}
						}
						if ('対人攻撃特性' === userpvpat) {
							userpvpat = null;
						}
						else {
							userpvpat = parseInt(userpvpat);
						}
						if ('対人防御特性(平均)' === userpvpdf) {
							userpvpdf = null;
						}
						else {
							userpvpdf = parseInt(userpvpdf);
						}
						if ('スイート特性' === usersweet) {
							usersweet = null;
						}
						else {
							usersweet = parseInt(usersweet);
						}
						if ('ボス特性' === userboss) {
							userboss = null;
						}
						else {
							userboss = parseInt(userboss);
						}
						if ('魔物特性' === usermamono) {
							usermamono = null;
						}
						else {
							usermamono = parseInt(usermamono);
						}
						if ('竜特性' === userdragon) {
							userdragon = null;
						}
						else {
							userdragon = parseInt(userdragon);
						}
						if ('' === userdzone) {
							userdzone = null;
						}
						else {
							userdzone = parseInt(userdzone);
						}
						var useracce1 = $('#registerform').find('select[name=useracce1] option:selected').val();
						var useracce2 = $('#registerform').find('select[name=useracce2] option:selected').val();
						var userbukicos = $('#registerform').find('select[name=userbukicos] option:selected').val();
						var usermanto = $('#registerform').find('select[name=usermanto] option:selected').val();
						if (true != ('メテオ' != usermeteo && '装飾品' != useracce1 && 0 < usermeteo.length && 0 < useracce1.length)) {
							if ('メテオ' == usermeteo) {
								alert('メテオレベルを選択して下さい。');
							}
							if ('装飾品' == useracce1) {
								alert('装飾品を選択して下さい。');
							}
							alert('入力が正しくない項目があった為、処理を中断します。');
							return;
						}
						data.job3d = parseInt(userjob3d);
						data.meteo = parseInt(usermeteo);
						data.dzone = userdzone;
						data.acce1 = parseInt(useracce1);
						if ('サブ装飾品' != useracce2 && !isNaN(parseInt(useracce2))) {
							data.acce2 = parseInt(useracce2);
						}
						data.bukicos = userbukicos;
						data.manto = usermanto;
						data.pvpat = userpvpat;
						data.pvpdf = userpvpdf;
						data.sweet = usersweet;
						data.mamono = usermamono;
						data.dragon = userdragon;
						data.boss = userboss;
						data.subjob = usersubjob;
						data.subjob3d = usersubjob3d;
						data.subcp = usersubcp;
					}
					else if (mode==2) {
						var userspiritlevel = $('#registerform').find('input[name=userspiritlevel]').val();
						data.spiritlevel = parseInt(userspiritlevel);
						if (isNaN(data.spiritlevel)) {
							data.spiritlevel = null;
						}
					}
					registerUser(clan.ID, data, function (){
						alert('登録しました。');
						location.href='#dashboard';
					});
					return;
				};
				var onclickUnregister = function (target, userID) {
					if (confirm('本当に削除してよろしいですか？')) {
						unregisterUser(userID, function (){
							alert('削除しました。');
							location.href='#dashboard';
						});
						return;
					}
				};
				var onclickSchedule = function (target, scheduleID) {
					getParams['clanid'] = clan.ID;
					getParams['scheduleid'] = scheduleID;
					var newhref = '?clanid=' + clan.ID + '&scheduleid=' + scheduleID + '#detailschedule';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#detailschedule', '&view=on#detailschedule');
					}
					location.href = newhref;
				};
				var onclickDetail = function (target, rowID) {
					var text = $(target).text();
					if (0 < text.length) {
						swal(text);
					}
				};
				var onclickModify = function (target, rowID) {
					if ('#addnews' == location.hash) {
						var newstext = $(target).parent().parent().find('.newstext').text();
						var newstag = $(target).parent().parent().find('.newstag').text();
						var newsnotifymode = '';
						var newsnotifytime = '';
						var notifymode = $(target).parent().parent().find('.notifymode').text();
						var notifytime = $(target).parent().parent().find('.notifytime').text();
						if (-1 < notifymode.indexOf('毎日')) {
							newsnotifymode = 1;
						}
						else if(-1 < notifymode.indexOf('毎週日曜')) {
							newsnotifymode = 11;
						}
						else if(-1 < notifymode.indexOf('毎週月曜')) {
							newsnotifymode = 12;
						}
						else if(-1 < notifymode.indexOf('毎週火曜')) {
							newsnotifymode = 13;
						}
						else if(-1 < notifymode.indexOf('毎週水曜')) {
							newsnotifymode = 14;
						}
						else if(-1 < notifymode.indexOf('毎週木曜')) {
							newsnotifymode = 15;
						}
						else if(-1 < notifymode.indexOf('毎週金曜')) {
							newsnotifymode = 16;
						}
						else if(-1 < notifymode.indexOf('毎週土曜')) {
							newsnotifymode = 17;
						}
						if (notifytime == '0時') {
							newsnotifytime = 24;
						}
						else if (notifytime == '23時') {
							newsnotifytime = 23;
						}
						else if (notifytime == '22時') {
							newsnotifytime = 22;
						}
						else if (notifytime == '21時') {
							newsnotifytime = 21;
						}
						else if (notifytime == '20時') {
							newsnotifytime = 20;
						}
						else if (notifytime == '19時') {
							newsnotifytime = 19;
						}
						else if (notifytime == '18時') {
							newsnotifytime = 18;
						}
						else if (notifytime == '17時') {
							newsnotifytime = 17;
						}
						else if (notifytime == '16時') {
							newsnotifytime = 16;
						}
						else if (notifytime == '15時') {
							newsnotifytime = 15;
						}
						else if (notifytime == '14時') {
							newsnotifytime = 14;
						}
						else if (notifytime == '13時') {
							newsnotifytime = 13;
						}
						else if (notifytime == '12時') {
							newsnotifytime = 12;
						}
						else if (notifytime == '11時') {
							newsnotifytime = 11;
						}
						else if (notifytime == '10時') {
							newsnotifytime = 10;
						}
						else if (notifytime == '9時') {
							newsnotifytime = 9;
						}
						else if (notifytime == '8時') {
							newsnotifytime = 8;
						}
						else if (notifytime == '7時') {
							newsnotifytime = 7;
						}
						else if (notifytime == '6時') {
							newsnotifytime = 6;
						}
						$('#editnewsform').find('input[name=newsid]').val(rowID);
						$('#editnewsform').find('textarea[name=newstext]').val(newstext);
						$('#editnewsform').find('input[name=newstag]').val(newstag);
						$('#editnewsform').find('select[name=newsnotifymode]').val(newsnotifymode);
						if ('' != newsnotifytime) {
							$('#editnewsform').find('select[name=newsnotifytime]').val(newsnotifytime);
						}
						$("html,body").animate({scrollTop: 0}, "100");
						return;
					}
					else if ('#contribution' == location.hash) {
						if ($(target).text() === '修正') {
							var newstextDom = $(target).parent().parent().find('.newstext');
							var newstext = newstextDom.find('pre');
							var newstextHigth = newstext.height();
							//newstext.
							newstextDom.html('<textarea class="form-control" name="newstext">'+newstext.text()+'</textarea>');
							newstextDom.find('textarea').height(newstextHigth);
							$(target).text('保存');
						}
						else if ($(target).text() === '保存') {
							var newstext = $(target).parent().parent().find('textarea[name=newstext]').val();
							var newsID = rowID;
							var newstag = '週間貢献度集計';
							if ('undefined' != typeof newstext && 0 < newstext.length) {
								var data = { ID: newsID, text: newstext, tag: newstag, };
								registerNews(clan.ID, data, function (){
									alert('更新しました。');
									$(target).text('修正');
									var newstextDom = $(target).parent().parent().find('.newstext');
									newstextDom.html('<pre>'+newstext+'</pre>');
									return;
								});
								return;
							}
						}
						else {
							var contributionusername = $(target).parent().find('.contributionusername').text();
							var contribution = $(target).parent().find('.contribution').attr('contribution');
							var weekquestcnt = $(target).parent().find('.weekquestcnt').attr('weekquestcnt');
							var contributionuserindex = $('#entrycontributionform').find('select[name=contributionuser] option[data="' + contributionusername + '"]').val();
							var weekquestcntindex = $('#entrycontributionform').find('select[name=weekquestcnt] option[value="' + weekquestcnt + '"]').val();
							$('#entrycontributionform').find('select[name=contributionuser]').val(contributionuserindex);
							$('#entrycontributionform').find('select[name=weekquestcnt]').val(weekquestcntindex);
							$('#entrycontributionform').find('input[name=contribution]').val(contribution);
							$("html,body").animate({scrollTop: 0}, "100");
						}
						return;
					}
					else if ('#detailschedule' == location.hash) {
						if ($(target).text() === '修正') {
							var newstextDom = $(target).parent().parent().find('.newstext');
							var newstext = newstextDom.find('pre');
							var newstextHigth = newstext.height();
							//newstext.
							newstextDom.html('<textarea class="form-control" name="newstext">'+newstext.text()+'</textarea>');
							newstextDom.find('textarea').height(newstextHigth);
							$(target).text('保存');
						}
						else if ($(target).text() === '保存') {
							var newstext = $(target).parent().parent().find('textarea[name=newstext]').val();
							var newsID = rowID;
							var newstag = $('#addscheduleform').find('input[name=scheduletag]').val();
							if ('undefined' != typeof newstext && 0 < newstext.length) {
								var data = { ID: newsID, text: newstext, tag: newstag, };
								registerNews(clan.ID, data, function (){
									alert('更新しました。');
									$(target).text('修正');
									var newstextDom = $(target).parent().parent().find('.newstext');
									newstextDom.html('<pre>'+newstext+'</pre>');
									return;
								});
								return;
							}
						}
						else {
							var scheduleusername = $(target).parent().find('.scheduleusername').text();
							var schedulecomment = $(target).parent().find('.schedulecomment').text();
							var scheduleparty = $(target).parent().find('.scheduleparty').data();
							var scheduleuserindex = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + escapeHTML(scheduleusername) + '"]').val();
							$('#entryscheduleform').find('select[name=scheduleuser]').val(scheduleuserindex);
							$('#entryscheduleform').find('input[name=schedulecomment]').val(schedulecomment);
							if ('undefined' != typeof scheduleparty && 'undefined' != typeof scheduleparty.party) {
								$('#entryscheduleform').find('input[name=scheduleparty]').val(scheduleparty.party);
							}
							$("html,body").animate({scrollTop: 0}, "100");
						}
						return;
					}
					getParams['clanid'] = clan.ID;
					getParams['userid'] = rowID;
					var newhref = '?clanid=' + clan.ID + '&userid=' + rowID + '#modifyuser';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#modifyuser', '&view=on#modifyuser');
					}
					location.href = newhref;
				};
				var onclickInfomation = function (target) {
					var message = $(target).parent().parent().find('.newstext').text();
					if (-1 < message.indexOf('***date***')) {
						var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
						if ('undefined' != typeof targetDate) {
							message = message.replace('***date***', targetDate);
						}
					}
					if (-1 < message.indexOf('***title***')) {
						var targetTitle = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form input.form-control[name=schedulename]').val();
						message = message.replace('***title***', targetTitle);
					}
					if (-1 < message.indexOf('***urlview***')) {
						if ('#contribution' == location.hash && false === ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length)) {
							var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
							targetDate = targetDate.replace(/\//g, '-');
							targetDate = targetDate.split(' ')[0];
							message = message.replace('***urlview***', location.href.replace('#contribution', '&contributiondate=' + targetDate + '&view=on#contribution'));
						}
						else {
							message = message.replace('***urlview***', location.href.replace('#detailschedule', '&view=on#detailschedule'));
						}
					}
					if (-1 < message.indexOf('***url***')) {
						if ('#contribution' == location.hash && false === ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length)) {
							var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
							targetDate = targetDate.replace(/\//g, '-');
							targetDate = targetDate.split(' ')[0];
							message = message.replace('***url***', location.href.replace('#contribution', '&contributiondate=' + targetDate + '#contribution'));
						}
						else {
							message = message.replace('***url***', location.href);
						}
					}
					if (-1 < message.indexOf('***pt***')) {
						message = message.replace('***pt***', location.href.replace('#detailschedule', '#party'));
					}
					if (-1 < message.indexOf('***ptview***')) {
						message = message.replace('***ptview***', location.href.replace('#detailschedule', '&view=on#party'));
					}
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに通知しました!');
					return;
				};
				var onclickNotify = function (target, name, discord) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					if (false === ('undefined' != typeof clan.discordhookid && 0 < clan.discordhookid.length)) {
						alert(clanLabel + 'で使用しているDiscordのWebhook情報が登録されていない為、この機能を利用出来ません！\n「設定」から設定して下さい。');
						return;
					}
					var discordIDMsg = '';
					if ('undefined' != typeof discord && 0 < discord.length) {
						discordIDMsg = ' ( \@' + discord + ' ) ';
					}
					var message = '【緊急】おいぃ！ ' + name + discordIDMsg + '！！「 ' + schedulename + ' (' + scheduledate + '開催) 」' + 'への出欠登録がされてないぞ！！【催促】';
					message = message + '\n欠席でいいのか！？良くないならば今スグ登録タノムっ！！ => ' + location.protocol + '//' + publicURL + '/?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに催促通知しました!');
					return;
				};
				var onclickCSVExport = function (target) {
					// 配列 の用意
					var fields = $(target).parent().find('thead tr');
					console.log(fields);
					var users = $(target).parent().find('#partylist tr');
					var array_data = [];
					for (var uidx=0; uidx < fields.length; uidx++) {
						var cols = $(fields[uidx]).find('th');
						var dataArr = [];
						for (var didx=0; didx < cols.length; didx++) {
							var label = $(cols[didx]).text();
							if (label == 'キャラ') {
								label = 'キャラ名';
							}
							else if (label == 'status') {
								label = 'PTリーダー';
							}
							else if (label == 'Job') {
								label = 'Job","3次職';
							}
							else if (label == 'Dual戦闘力') {
								label = 'デュアル戦闘力';
							}
							else if (label == 'Dualクラス') {
								label = 'デュアルクラス","デュアル3次職';
							}
							else if (label == '装飾品') {
								label = '装飾品","特性';
							}
							else if (label == 'サブ装飾品') {
								label = 'サブ装飾品","サブ特性';
							}
							else if (label == '武') {
								label = '武器コス';
							}
							else if (label == 'マ') {
								label = 'マント';
							}
							else if (label == '攻') {
								label = '対人攻撃特性';
							}
							else if (label == '防') {
								label = '対人防御特性(平均)';
							}
							else if (label == '甘') {
								label = 'スイート特性';
							}
							else if (label == '魔') {
								label = '魔物特性';
							}
							else if (label == 'ボ') {
								label = 'ボス特性';
							}
							else if (label == '竜') {
								label = '竜特性';
							}
							else if (label == 'メ') {
								label = 'メテオLv';
							}
							else if (label == 'DZ') {
								label = 'ディフェンスゾーンLv';
							}
							else if (label == 'Dz') {
								label = 'ディフェンスゾーンLv';
							}
							else if (label == '区') {
								label = '区分';
							}
							else if (label == '') {
								label = '参加可否';
							}
							dataArr.push('"' + label + '"');
						}
						array_data.push(dataArr);
					}
					for (var uidx=0; uidx < users.length; uidx++) {
						var userDatas = $(users[uidx]).find('td');
						var dataArr = [];
						for (var didx=0; didx < userDatas.length; didx++) {
							var value = $(userDatas[didx]).html();
							value = value.replace(/&nbsp;/g, ' ');
							value = value.replace(/[\r\n]/g, ' ');
							value = value.trim();
							value = value.replace(/"/g, '""');
							//console.log(value);
							if (value == '<i class=""fas fa-microphone""></i>') {
								value = 'VC可';
							}
							else if (value == '<i class=""fas fa-microphone-slash""></i>') {
								value = '聞き専';
							}
							else if (value == '<i class="fas"">✕</i>') {
								value = 'VC不可';
							}
							else if (value == '<i class=""fas""></i>') {
								value = '';
							}
							else if (-1 < value.indexOf('<img ')) {
								var imgURL = $(userDatas[didx]).find('img').attr('src');
								if (0 < value.indexOf('2d')) {
									value = jobnamesForURL[imgURL] + '","2次職';
								}
								else {
									value = jobs[jobnamesForURL[imgURL]] + '","3次職';
								}
							}
							else if ($(cols[didx]).text() == 'Dualクラス') {
								value = '","';
							}
							else if (value == 'リダ') {
								value = 'PTリーダー';
							}
							else if (value == 'サブ') {
								value = 'PTサブリーダー';
							}
							else if (value == 'AC') {
								value = 'アクティブ';
							}
							else if (value == 'IAC') {
								value = 'インアクティブ';
							}
							else if (value == '傭') {
								value = '傭兵';
							}
							else if (value == '除') {
								value = '除名';
							}
							var bgimage = $(userDatas[didx]).css('background-image');
							if (-1 < bgimage.indexOf('gamewith') || -1 < bgimage.indexOf('kara')) {
									var acce = '';
									if (-1 < bgimage.indexOf('kara')) {
										acce = 'カラ';
									}
									else if (0 < bgimage.indexOf('75801')) {
										acce = '魔女';
									}
									else if (0 < bgimage.indexOf('66514')) {
										acce = 'エルヴン';
									}
									else if (0 < bgimage.indexOf('66511')) {
										acce = 'ナッセン';
									}
									else if (0 < bgimage.indexOf('66502')) {
										acce = 'ムーンストーン';
									}
									else if (0 < bgimage.indexOf('66517')) {
										acce = 'ブラックオール';
									}
									else if (0 < bgimage.indexOf('66505')) {
										acce = 'アルボール';
									}
									else if (0 < bgimage.indexOf('66508')) {
										acce = 'フェニックス';
									}
									value = acce + '","' + value;
							}
							dataArr.push('"' + value + '"');
						}
						array_data.push(dataArr);
					}
					console.log(array_data);
			    // BOM の用意（文字化け対策）
			    var bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
			    // CSV データの用意
			    var csv_data = array_data.map(function(l){return l.join(',')}).join('\r\n');
			    var blob = new Blob([bom, csv_data], { type: 'text/csv' });
			    var url = (window.URL || window.webkitURL).createObjectURL(blob);
			    var a = document.getElementById('downloader');
			    a.download = 'members.csv';
					if ('#detailschedule' == location.hash) {
						a.download = 'schedule-members.csv';
					}
			    a.href = url;
					$('#downloader')[0].click();
					return false;
				};
				var onchangeFile = function (event) {
		      var targetID = $(event.target).attr('id');
		      console.log(targetID);
		      var file = $(event.target).prop('files')[0];
		      console.log(file);
					// 画像以外は処理を停止
		      if (!file.type.match('image.*')) {
		        // クリア
		        return;
		      }
					var reader = new FileReader();
		      reader.onload = function(img) {
						var base64image = img.target.result;
						$('#' + targetID + '-thumbnail').attr('src', base64image);
		        // アップロード
						loading(true);
						uploadImageToImgur(base64image, function (response, result) {
							console.log(result);
							$('#' + targetID + 'url').val(result.data.link);
							loading(false);
						});
		      };
		      reader.readAsDataURL(file);
				};
			</script>

			<!-- this app start -->
			<script>
				$(function() {
					loading(true);
					getParams = getUrlVars();
					$(window).load(function() {
						riot.mount('navigationbar');
						riot.mount('donation');
						riot.mount('router');
						loading(false);
					});
					$(window).resize(function(){
						dispatchPortlateLayout();
					});
				});
			</script>
		</section>

	</body>
</html>
