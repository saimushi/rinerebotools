<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta name="description" content="血盟管理ツール"/>
		<meta name="robots" content="noindex"/>
		<meta id="ogimage" property="og:image" content="https://line2revo.fun/images/ogimage.png" />
		<title>L2R Tool</title>
		<link rel="icon" href="./favicon.ico">
		<link rel="mask-icon" href="./favicon.svg" sizes="any" color="black">
		<!-- bootstrap -->
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/css-spinning-spinners/1.1.1/load8.css"/>
		<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" />
		<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

		<!-- ブラウザチェック -->
		<script type="text/javascript">
			var browserEnabled = true;
			var result = null;
	 	  var agent = window.navigator.userAgent.toLowerCase();
	  	var version = window.navigator.appVersion.toLowerCase();
		  if(agent.indexOf("msie") > -1){
		    if (version.indexOf("msie 6.") > -1){
		      result = 'IE6';
		    }
				else if (version.indexOf("msie 7.") > -1){
		      result = 'IE7';
		    }
				else if (version.indexOf("msie 8.") > -1){
		      result = 'IE8';
		    }
				else if (version.indexOf("msie 9.") > -1){
		      result = 'IE9';
		    }
				else if (version.indexOf("msie 10.") > -1){
		      result = 'IE10';
		    }
				else{
		      result = 'IE(バージョン不明)';
		    }
				browserEnabled = false;
		  }
			else if(agent.indexOf("trident/7") > -1){
		    result = 'IE11';
				browserEnabled = false;
		  }
			else if(agent.indexOf("edge") > -1){
		    result = 'Edge';
				browserEnabled = false;
		  }
			else if (agent.indexOf("chrome") > -1){
		    result = 'Chrome';
		  }
			else if (agent.indexOf("safari") > -1){
		    result = 'Safari';
		  }
			else if (agent.indexOf("opera") > -1){
		    result = 'Opera';
		  }
			else if (agent.indexOf("firefox") > -1){
		    result = 'Firefox';
		  }
			if (true !== browserEnabled) {
				alert('申し訳御座いません、お使いのブラウザには現在対応していせん。\nPCでご利用の場合はGoogle Chromeを推奨します。');
			}
		</script>

		<!-- this app -->
		<style>
			html, body {
				height: 100%;
			}
			input, select, textarea {
				font-size: 16px !important;
			}
			table {
			  table-layout: fixed;
			}
			ul li {
				padding-top: 5px;
				padding-bottom: 5px;
			}
			tr.activity-1 {
				background-color: rgb(183, 227, 255) !important;
			}
			.navbar {
				min-height: 60px;
			}
			.navbar-toggle {
				margin-top: 12px;
				margin-bottom: 13px;
			}
			.table-striped>tbody>tr {
				background-color: #f6f6f6;
			}
			.table-striped>tbody>tr:nth-of-type(odd) {
				background-color: #ffffff;
			}
			.table-hover>tbody>tr:hover {
				background-color: #2dabc1;
			}
			navigationbar .container {
				width: 100%;
			}
			.orverlay {
				display: none;
				position: fixed;
				height: 100%;
				width: 100%;
				z-index: 9999;
				background-color: rgba(0, 0, 0, 0.4);
			}
			.helppanel {
				margin-top: 20px;
				padding: 10px;
				padding-top: 5px;
			}
			.helppanel div {
				background-color: white;
				padding: 10px;
			}
			.row {
				margin-left: 0;
				margin-right: 0;
			}
			route>.riotcontes>div:first-child {
				min-height: calc(100% - 300px);
			}
			div.row {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-xs-8 {
				padding-left: 0;
				padding-right: 0;
			}
			dashboard div.row div.col-xs-8, contribution div.row div.col-xs-8 {
				padding-top: 50px;
			}
			div.row div.col-sm-4 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div.col-sm-8 {
				padding-left: 0;
				padding-right: 0;
			}
			div.row div div.container-fluid {
				padding: 0;
			}
			.btn-group {
				width: 100%;
			}
			.btn-group .form-control {
				padding-right: 20px;
			}
			.clearbtn {
				position: absolute;
				right: 5px;
				top: 0;
				bottom: 0;
				height: 14px;
				margin: auto;
				font-size: 14px;
				cursor: pointer;
				color: #ccc;
			}
			th, tr {
				font-size: 10px;
			}
			td.scheduleparty[data-party="39"] {
				background-color: dodgerblue;
			}
			td.scheduleparty[data-party="38"] {
				background-color: blue;
			}
			td.scheduleparty[data-party="37"] {
				background-color: navy;
			}
			td.scheduleparty[data-party="29"] {
				background-color: limegreen;
			}
			td.scheduleparty[data-party="28"] {
				background-color: green;
			}
			td.scheduleparty[data-party="27"] {
				background-color: darkgreen;
			}
			td.scheduleparty[data-party="19"] {
				background-color: gold;
			}
			td.scheduleparty[data-party="18"] {
				background-color: orange;
			}
			td.scheduleparty[data-party="17"] {
				background-color: darkorange;
			}
			td.scheduleparty[data-party="9"] {
				background-color: red;
			}
			td.scheduleparty[data-party="8"] {
				background-color: crimson;
			}
			td.scheduleparty[data-party="7"] {
				background-color: firebrick;
			}
			td.scheduleparty[data-party="0"] {
				background-color: gray;
			}
			td.scheduleparty[data-party=""] {
				background-color: gray;
			}
			td.jobimage p {
				position: absolute;
				display: block;
				width: 20px;
				height: 20px;
				font-size: 15px;
				color: white;
				margin-left: 2px;
				margin-top: -20px;
			}
			@media screen and (max-width: 480px) {
				td.jobimage p {
					display: none;
				}
				tr.partycp td {
					padding-right: 35px !important;
				}
			}
			#loader {
				z-index: 99999;
			}
			.footer {
				width: 100%;
				height: 180px;
			  background-color: lightgray;
			}
			.footer div {
				padding: 0;
				background-color: lightgray;
			}
			#payment-request-button {
				position: fixed;
				width: 100px;
				z-index: 2000;
				top: 10px;
				right: 70px;
			}
			.donation-form {
				position: fixed;
				width: 82px;
				z-index: 1500;
				top: 13px;
				right: 180px;
				height: 0;
			}
		</style>
	</head>

	<body>
		<div id="loader" class="orverlay loading"></div>
		<div id="popup" class="orverlay"></div>
		<donation></donation>
		<navigationbar></navigationbar>
		<app class="container">
			<router class="row">
				<route path="/">
					<top class="riotcontes"/>
				</route>
				<route path="dashboard">
					<dashboard class="riotcontes"/>
				</route>
				<route path="setting">
					<addclan class="riotcontes"/>
				</route>
				<route path="login">
					<login/>
				</route>
				<route path="addclan">
					<addclan class="riotcontes"/>
				</route>
				<route path="adduser">
					<adduser class="riotcontes"/>
				</route>
				<route path="addschedule">
					<addschedule class="riotcontes"/>
				</route>
				<route path="addnews">
					<addnews class="riotcontes"/>
				</route>
				<route path="contribution">
					<contribution class="riotcontes"/>
				</route>
				<route path="modifyuser">
					<adduser class="riotcontes"/>
				</route>
				<route path="detailschedule">
					<detailschedule class="riotcontes"/>
				</route>
				<route path="party">
					<party class="riotcontes"/>
				</route>
				<route path="howto">
					<howto class="riotcontes"/>
				</route>
				<route path="inquiry">
					<inquiry class="riotcontes"/>
				</route>
				<route path="manage">
					<manage class="riotcontes"/>
				</route>
				<route path="donation">
					<donat class="riotcontes"/>
				</route>
			</router>
		</app>
		<footer class="footer">
			<p class="text-muted" style="margin: 5px; color: white;">広告から外部サイトに出られます！</p>
			<div  class="row">
				<!-- rakuten -->
				<div class="col-sm-2">
					&nbsp;
				</div>
				<div class="col-sm-3">
					<table cellpadding="0" cellspacing="0" border="0" style="background-color: white; border:1px solid #ccc; width:350px;"><tr style="border-style:none;"><td style="vertical-align:top; border-style:none; padding:10px; width:75px;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow"><img border="0" alt="" src="http://thumbnail.image.rakuten.co.jp/@0_mall/kaen-web/cabinet/itunes10000.jpg?_ex=64x64" /></a></td><td style="font-size:12px; vertical-align:middle; border-style:none; padding:10px;"><p style="padding:0; margin:0;"><a href="https://rpx.a8.net/svt/ejp?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT&rakuten=y&a8ejpredirect=http%3A%2F%2Fhb.afl.rakuten.co.jp%2Fhgc%2Fg00qxb34.2bo1139a.g00qxb34.2bo12cfd%2Fa18080696711_2ZNAZL_FOEY9E_2HOM_BWGDT%3Fpc%3Dhttp%253A%252F%252Fitem.rakuten.co.jp%252Fkaen-web%252Fitunes10000%252F%26m%3Dhttp%253A%252F%252Fm.rakuten.co.jp%252Fkaen-web%252Fi%252F10014129%252F" target="_blank" rel="nofollow">APPLE アップル iTunesCard　アイチューンズカード10000円</a></p><p style="color:#666; margin-top:5px line-height:1.5;">価格:<span style="font-size:14px; color:#C00; font-weight:bold;">9,922円</span><br/><span style="font-size:10px; font-weight:normal;">(2018/8/6 13:08時点)</span><br/><span style="font-weight:bold;">感想(0件)</span></p></td></tr></table>
					<img border="0" width="1" height="1" src="https://www18.a8.net/0.gif?a8mat=2ZNAZL+FOEY9E+2HOM+BWGDT" alt="">
				</div>
				<!-- ドコモオンラインモール -->
				<div class="col-sm-3">
					<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" target="_blank" rel="nofollow">
						<img border="0" width="350" alt="" src="https://www29.a8.net/svt/bgt?aid=180806241950&wid=001&eno=01&mid=s00000014967001010000&mc=1">
					</a>
					<img border="0" width="1" height="1" src="https://www15.a8.net/0.gif?a8mat=2ZNAZL+FPLTGY+37HI+60H7L" alt="">
				</div>
				<!-- お名前.com -->
				<div class="col-sm-3">
					<a href="https://px.a8.net/svt/ejp?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" target="_blank" rel="nofollow">
						<img border="0" width="140" height="140" alt="" src="https://www26.a8.net/svt/bgt?aid=180806241949&wid=001&eno=01&mid=s00000000018015054000&mc=1">
					</a>
					<img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=2ZNAZL+FP0DV6+50+2HMLEP" alt="">
				</div>
			</div>
		</footer>

		<!-- Riot tags -->
		<section id="riot-tags">

			<script type="riot/tag" src="./customtags/donation.tag"></script>

			<script type="riot/tag">
				<navigationbar>
					<div if={'#party' != location.hash} class="navbar navbar-inverse navbar-fixed-top" role="navigation">
						<div class="container">
							<div class="navbar-header">
								<!-- sp用 -->
								<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
									<span class="sr-only">Toggle navigation</span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a if={null == getParams['clanid']} class="navbar-brand" href="./" style="padding: 0;"><img src="./images/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
								<a if={null != getParams['clanid']} class="navbar-brand" href="?clanid={clan.ID}" style="padding: 0;"><img src="./images/titlelogo.png" border="0" height="60" alt="L2R Tool"/></a>
							</div>
							<div class="collapse navbar-collapse">
								<ul class="nav navbar-nav">
									<li if={'#login' != location.hash && '' != location.hash}><a href="#dashboard">血盟ページ</a></li>
									<li if={'#login' != location.hash && '' != location.hash}><a href="{clan.url}">血盟コミュ</a></li>
									<li if={'#login' != location.hash && '' != location.hash && 'on'!=getParams['view']}><a href="#setting">設定</a></li>
									<li if={'#login' != location.hash && '' != location.hash && 'on'!=getParams['view']}><a href="./">ログアウト</a></li>
									<li><a href="#howto">ヘルプ</a></li>
									<li><a href="#inquiry">お問い合わせ</a></li>
								</ul>
							</div>
						</div>
					</div>
					this.on('mount', function() {
						$(".navbar-nav li a").click(function(event) {
							$(".navbar-collapse").collapse('hide');
						});
					});
				</navigationbar>
			</script>

			<script type="riot/tag">
				<top>
					this.on('mount', function() {
						// 認証
						auth();
					});
				</top>
			</script>

			<script type="riot/tag">
				<donat>
					<div style="padding: 10px;">
						<h2>寄付に興味を持って頂き有難うございます！</h2>
						<h3>寄付は右上の「寄付する」「Apple Pay(対応機種のみ)」ボタンより行なえます。</h3>
					</div>
					interval = null;
					thisis = null;
					this.on('mount', function() {
						this.interval = interval;
						thisis = this;
						thisis.interval = setInterval(function() {
							if ($('.stripe-button-el')[0] && thisis.interval) {
								clearInterval(thisis.interval);
								thisis.interval = null;
								if ($('#payment-request-button')[0]) {
									$('#payment-request-button')[0].click();
								}
								else {
									$('.stripe-button-el')[0].click();
								}
							}
						}, 2000);
					});
				</donat>
			</script>

			<script type="riot/tag">
				<dashboard>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid" style="padding: 10px;">
								<h2 style="margin-top: 5px;"><a href="{clanurl}">{clanname}</a></h2>
								<h4>アクティブ血盟員数: {usercnt}</h4>
								<h5>LRT選考基準CP: {prelrtcp.toLocaleString()}</h5>
								<h5>総アクティブCP: {totalcp.toLocaleString()}</h5>
								<small>
									<b style="font-size: x-small;">{url}</b>
									<br/>
									<small style="color: red; font-size: xx-small;">
										※この血盟のURLです。忘れずメモして下さい！
										<br/>
										※ゲーム内のコミュにこのURLをリンクすると幸せになれます！
									</small>
								</small>
								<div if={'on'!=getParams['view']} class="row" style="padding-top: 10px;">
									<a class="btn btn-success" href="#addschedule" style="margin-bottom: 10px;">予定追加</a>
									<a class="btn btn-info" href="#adduser" style="margin-bottom: 10px;">血盟員追加</a>
									<a class="btn btn-warning" href="#addnews" style="margin-bottom: 10px;">お知らせ管理</a>
									<a class="btn btn-primary" href="#contribution" style="margin-bottom: 10px;">週間貢献度集計</a>
								</div>
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr class="info">
											<th>予定日</th>
											<th>予定内容</th>
											<th>参加人数</th>
										</tr>
									</thead>
									<tbody>
										<tr each="{schedule, index in schedules}">
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.date}</td>
											<td onclick="onclickSchedule(this, '{schedule.ID}');">{schedule.name}</td>
											<td if={schedule.type!=1}><a href="?clanid={clan.ID}&scheduleid={schedule.ID}{viewON}#party">{schedule.incount}</a></td>
											<td if={schedule.type==1}>出欠不要</td>
										</tr>
									</tbody>
								</table>
							</div>
							<br/>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div style="width: 150px; margin-top: -45px; margin-left: auto; margin-right: 10px; margin-bottom: 5px;">
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: firebrick;">&nbsp;前衛&nbsp;{attckAssistans}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: orange;">&nbsp;魔攻&nbsp;{criticalAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: blue;">&nbsp;盾職&nbsp;{defenseAssistans}</span>
									<br style="clear: both;"/>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: green;">&nbsp;短剣&nbsp;{moveAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: dodgerblue;">&nbsp;弓職&nbsp;{hitAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: deeppink;">&nbsp;回復&nbsp;{healAssistans}</span>
									<br style="clear: both;"/>
								</div>
								<users data='{users}'/>
							</div>
						</div>
					</div>
					var attckAssistans = 0;
					var criticalAssistants = 0;
					var defenseAssistans = 0;
					var moveAssistants = 0;
					var hitAssistants = 0;
					var healAssistans = 0;

					var url = location.protocol + '//' + document.domain + location.pathname;
					var clanname = '';
					var clanurl = 'javascript: void(0); return false;';
					var usercnt = 0;
					var totalcp = 0;
					var prelrtcp = 0;
					var users = [];
					var schedules = [];
					var cpSort = false;
					var viewON = '';
					var thisis;
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						thisis = this;
						thisis.attckAssistans = attckAssistans;
						thisis.criticalAssistants = criticalAssistants;
						thisis.defenseAssistans = defenseAssistans;
						thisis.moveAssistants = moveAssistants;
						thisis.hitAssistants = hitAssistants;
						thisis.healAssistans = healAssistans;
						if ('on' == getParams['view']) {
							this.viewON = '&view=on';
						}
						// 認証
						auth(false, function (clan) {
							if ('undefined' != typeof clan.name) {
								this.url = url + '?clanid=' + clan.ID;
								this.clanname = clan.name;
								this.clanurl = clan.url;
								getUsers(clan.ID, false, function(users) {
									this.users = users;
									this.usercnt = usercnt;
									this.totalcp = totalcp;
									this.prelrtcp = prelrtcp;
									for (var uidx=0; uidx < users.length; uidx++) {
										if (users[uidx].activity > 0) {
											this.totalcp += parseInt(users[uidx].cp);
											if (30 > this.usercnt) {
												this.prelrtcp += parseInt(users[uidx].cp);
											}
											this.usercnt++;
											// 種別振り分けは一度すれば十分
											if (jobbufs[users[uidx].job]=='攻撃') {
												thisis.attckAssistans++;
											}
											if (jobbufs[users[uidx].job]=='クリ') {
												thisis.criticalAssistants++;
											}
											if (jobbufs[users[uidx].job]=='防御') {
												thisis.defenseAssistans++;
											}
											if (jobbufs[users[uidx].job]=='移動') {
												thisis.moveAssistants++;
											}
											if (jobbufs[users[uidx].job]=='命中') {
												thisis.hitAssistants++;
											}
											if (jobbufs[users[uidx].job]=='HP') {
												thisis.healAssistans++;
											}
										}
									}
									riot.update();
									sortCP();
									getSchedules(clan.ID, function(schedules) {
										this.schedules = schedules;
										riot.update();
									});
								});
							}
						});
						dispatchPortlateLayout();
					});
				</dashboard>
			</script>

			<script type="riot/tag">
				<login>
					<div class="row" style="padding-top: 45px">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div class="col-sm-6" style="height: 200px; padding-top: 50px; text-align: center; background-image: url('./images/logo.png'); background-repeat: no-repeat; background-size: contain; background-position: center bottom;">
							<h2>&nbsp;&nbsp;&nbsp;血盟管理を<b style="font-size: 120%;">も</b><b>っと</b>簡単に。</h2>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-3 bg-primary" style="margin-top: 50px; padding: 30px;">
							<h4>血盟ログイン</h4>
							<form id="loginform">
								<div class="form-group">
									<div class="btn-group">
										<input type="text" name="clanID" class="form-control" placeholder="血盟ID"/>
										<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
									</div>
								</div>
								<botton class="btn btn-success" onclick="onclickLogin(this)" style="margin-bottom: 10px;">ログイン</botton>
								&nbsp;&nbsp;&nbsp;<botton class="btn btn-info" onclick="onclickAddClan(this)" style="margin-bottom: 10px;">血盟登録</botton>
							</form>
						</div>
						<div class="col-sm-1">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div class="row">
						<div class="col-sm-2">
							&nbsp;
						</div>
						<div class="col-sm-6" style="padding-top: 30px; text-align: center;">
							<h4 style="margin: 0;">&nbsp;&nbsp;&nbsp;<small>血盟員管理／血盟イベントスケジュール／お知らせ通知／パーティ編成</small></h4>
							<h3 style="margin-top: 5px; margin-bottom: 20px;">&nbsp;&nbsp;&nbsp;<small><b>必要な全ての機能を備えています。</b></small></h3>
						</div>
						<div class="col-sm-4">
							&nbsp;
						</div>
					</div>
					<!-- 次行 -->
					<div class="row parent-container">
						<div class="col-sm-1">
							&nbsp;
						</div>
						<div class="col-sm-2">
							<a href="./images/sample001.png"><img width="240" src="./images/sample001.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/sample002.png"><img width="240" src="./images/sample002.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/sample003.png"><img width="240" src="./images/sample003.png"/></a>
						</div>
						<div class="col-sm-2">
							<a href="./images/sample004.png"><img width="240" src="./images/sample004.png"/></a>
						</div>
						<div class="col-sm-3">
							&nbsp;
						</div>
					</div>
					this.on('mount', function() {
						$('.parent-container').magnificPopup({
  						delegate: 'a',
  						type: 'image',
  						gallery: {
    						enabled:true
  						}
  					});
						auth();
					});
				</login>
			</script>

			<script type="riot/tag">
				<addclan>
					<div style="padding: 10px;">
						<form id="registerClanform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="clan" value="{clan.name}" class="form-control" placeholder="血盟名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="url" value="{clan.url}" class="form-control" placeholder="血盟コミュニティURL"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={'#setting' == location.hash} class="form-group">
								<div class="btn-group">
									<input type="text" name="discordhookid" value="{clan.discordhookid}" class="form-control" placeholder="Discord Webhook ID"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div if={'#setting' == location.hash} class="form-group">
								<div class="btn-group">
									<input type="text" name="discordhooktoken" value="{clan.discordhooktoken}" class="form-control" placeholder="Discord Webhook Token"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<botton class="btn btn-success" onclick="onclickRegisterClan(this)">登録</botton>
						</form>
					</div>
					var clan = { ID: '', name: '', discordhookid: '', discordhooktoken: '', };
					this.on('mount', function() {
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							auth(false, function (clan) {
								// modifyモード
								this.clan = clan;
								riot.update();
							});
						}
					});
				</addclan>
			</script>

			<script type="riot/tag">
				<adduser>
					<div style="padding: 10px;">
						<h2>血盟員追加</h2>
						<form id="registerform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="username" value="{user.name}" class="form-control" placeholder="キャラクター名"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<select class="form-control" name="userjob">
									<option>職業</option>
									<optgroup label="オーク">
										<option if={user.job=='オークレイダー'} value="オークレイダー" selected="selected">オークレイダー</option>
										<option if={user.job!='オークレイダー'} value="オークレイダー">オークレイダー</option>
										<option if={user.job=='オークモンク'} value="オークモンク" selected="selected">オークモンク</option>
										<option if={user.job!='オークモンク'} value="オークモンク">オークモンク</option>
										<option if={user.job=='オークシャーマン'} value="オークシャーマン" selected="selected">オークシャーマン</option>
										<option if={user.job!='オークシャーマン'} value="オークシャーマン">オークシャーマン</option>
									</optgroup>
									<optgroup label="ヒューマン">
										<option if={user.job=='パラディン'} value="パラディン" selected="selected">パラディン</option>
										<option if={user.job!='パラディン'} value="パラディン">パラディン</option>
										<option if={user.job=='ウォーロード'} value="ウォーロード" selected="selected">ウォーロード</option>
										<option if={user.job!='ウォーロード'} value="ウォーロード">ウォーロード</option>
										<option if={user.job=='トレジャーハンター'} value="トレジャーハンター" selected="selected">トレジャーハンター</option>
										<option if={user.job!='トレジャーハンター'} value="トレジャーハンター">トレジャーハンター</option>
										<option if={user.job=='ホークアイ'} value="ホークアイ" selected="selected">ホークアイ</option>
										<option if={user.job!='ホークアイ'} value="ホークアイ">ホークアイ</option>
										<option if={user.job=='ソーサラー'} value="ソーサラー" selected="selected">ソーサラー</option>
										<option if={user.job!='ソーサラー'} value="ソーサラー">ソーサラー</option>
										<option if={user.job=='ビショップ'} value="ビショップ" selected="selected">ビショップ</option>
										<option if={user.job!='ビショップ'} value="ビショップ">ビショップ</option>
									</optgroup>
									<optgroup label="エルフ">
										<option if={user.job=='テンプルナイト'} value="テンプルナイト" selected="selected">テンプルナイト	</option>
										<option if={user.job!='テンプルナイト'} value="テンプルナイト">テンプルナイト	</option>
										<option if={user.job=='ソードシンガー'} value="ソードシンガー" selected="selected">ソードシンガー	</option>
										<option if={user.job!='ソードシンガー'} value="ソードシンガー">ソードシンガー	</option>
										<option if={user.job=='プレインズウォーカー'} value="プレインズウォーカー" selected="selected">プレインズウォーカー</option>
										<option if={user.job!='プレインズウォーカー'} value="プレインズウォーカー">プレインズウォーカー</option>
										<option if={user.job=='シルバーレンジャー'} value="シルバーレンジャー" selected="selected">シルバーレンジャー</option>
										<option if={user.job!='シルバーレンジャー'} value="シルバーレンジャー">シルバーレンジャー</option>
										<option if={user.job=='スペルシンガー'} value="スペルシンガー" selected="selected">スペルシンガー</option>
										<option if={user.job!='スペルシンガー'} value="スペルシンガー">スペルシンガー</option>
										<option if={user.job=='エルダー'} value="エルダー" selected="selected">エルダー</option>
										<option if={user.job!='エルダー'} value="エルダー">エルダー</option>
									</optgroup>
									<optgroup label="ダークエルフ">
										<option if={user.job=='シリエンナイト'} value="シリエンナイト" selected="selected">シリエンナイト</option>
										<option if={user.job!='シリエンナイト'} value="シリエンナイト">シリエンナイト</option>
										<option if={user.job=='ブレードダンサー'} value="ブレードダンサー" selected="selected">ブレードダンサー</option>
										<option if={user.job!='ブレードダンサー'} value="ブレードダンサー">ブレードダンサー</option>
										<option if={user.job=='アビスウォーカー'} value="アビスウォーカー" selected="selected">アビスウォーカー</option>
										<option if={user.job!='アビスウォーカー'} value="アビスウォーカー">アビスウォーカー</option>
										<option if={user.job=='ファントムレンジャー'} value="ファントムレンジャー" selected="selected">ファントムレンジャー</option>
										<option if={user.job!='ファントムレンジャー'} value="ファントムレンジャー">ファントムレンジャー</option>
										<option if={user.job=='スペルハウラー'} value="スペルハウラー" selected="selected">スペルハウラー</option>
										<option if={user.job!='スペルハウラー'} value="スペルハウラー">スペルハウラー</option>
										<option if={user.job=='シリエンエルダー'} value="シリエンエルダー" selected="selected">シリエンエルダー</option>
										<option if={user.job!='シリエンエルダー'} value="シリエンエルダー">シリエンエルダー</option>
									</optgroup>
									<optgroup label="ドワーフ">
										<option if={user.job=='ガーディアン'} value="ガーディアン" selected="selected">ガーディアン</option>
										<option if={user.job!='ガーディアン'} value="ガーディアン">ガーディアン</option>
										<option if={user.job=='スレイヤー'} value="スレイヤー" selected="selected">スレイヤー</option>
										<option if={user.job!='スレイヤー'} value="スレイヤー">スレイヤー</option>
										<option if={user.job=='スカベンジャー'} value="スカベンジャー" selected="selected">スカベンジャー</option>
										<option if={user.job!='スカベンジャー'} value="スカベンジャー">スカベンジャー</option>
										<option if={user.job=='ウォーレンジャー'} value="ウォーレンジャー" selected="selected">ウォーレンジャー</option>
										<option if={user.job!='ウォーレンジャー'} value="ウォーレンジャー">ウォーレンジャー</option>
										<option if={user.job=='クォーラルウィザード'} value="クォーラルウィザード" selected="selected">クォーラルウィザード</option>
										<option if={user.job!='クォーラルウィザード'} value="クォーラルウィザード">クォーラルウィザード</option>
										<option if={user.job=='セイジ'} value="セイジ" selected="selected">セイジ</option>
										<option if={user.job!='セイジ'} value="セイジ">セイジ</option>
									</optgroup>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userjob3d">
									<option value="0">3次職未転職</option>
									<option if={user.job3d=='1'} value="1" selected="selected">3次職転職済</option>
									<option if={user.job3d!='1'} value="1">3次職転職済</option>
								</select>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{4,8}" name="usercp" value="{user.cp}" class="form-control" placeholder="戦闘力"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="number" pattern="\d{2,3}" name="userlevel" value="{user.level}" class="form-control" placeholder="レベル"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="discord" value="{user.discord}" class="form-control" placeholder="でぃすこ#4321"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="memo" value="{user.memo}" class="form-control" placeholder="なんでもメモ"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<select class="form-control" name="useracce1">
									<option>装飾品</option>
									<optgroup label="エルヴン">
										<option if={user.acce1==79} value="79" selected="selected">エルヴン 平均特性10</option>
										<option if={user.acce1==78} value="78" selected="selected">エルヴン 平均特性9</option>
										<option if={user.acce1==77} value="77" selected="selected">エルヴン 平均特性8</option>
										<option if={user.acce1==76} value="76" selected="selected">エルヴン 平均特性7</option>
										<option if={user.acce1==75} value="75" selected="selected">エルヴン 平均特性6</option>
										<option if={user.acce1==74} value="74" selected="selected">エルヴン 平均特性5</option>
										<option if={user.acce1==73} value="73" selected="selected">エルヴン 平均特性4</option>
										<option if={user.acce1==72} value="72" selected="selected">エルヴン 平均特性3</option>
										<option if={user.acce1==71} value="71" selected="selected">エルヴン 平均特性2</option>
										<option if={user.acce1==70} value="70" selected="selected">エルヴン 平均特性1</option>
										<option if={user.acce1!=79} value="79">エルヴン 平均特性10</option>
										<option if={user.acce1!=78} value="78">エルヴン 平均特性9</option>
										<option if={user.acce1!=77} value="77">エルヴン 平均特性8</option>
										<option if={user.acce1!=76} value="76">エルヴン 平均特性7</option>
										<option if={user.acce1!=75} value="75">エルヴン 平均特性6</option>
										<option if={user.acce1!=74} value="74">エルヴン 平均特性5</option>
										<option if={user.acce1!=73} value="73">エルヴン 平均特性4</option>
										<option if={user.acce1!=72} value="72">エルヴン 平均特性3</option>
										<option if={user.acce1!=71} value="71">エルヴン 平均特性2</option>
										<option if={user.acce1!=70} value="70">エルヴン 平均特性1</option>
									</optgroup>
									<optgroup label="ナッセン">
										<option if={user.acce1==59} value="59" selected="selected">ナッセン 平均特性10</option>
										<option if={user.acce1==58} value="58" selected="selected">ナッセン 平均特性9</option>
										<option if={user.acce1==57} value="57" selected="selected">ナッセン 平均特性8</option>
										<option if={user.acce1==56} value="56" selected="selected">ナッセン 平均特性7</option>
										<option if={user.acce1==55} value="55" selected="selected">ナッセン 平均特性6</option>
										<option if={user.acce1==54} value="54" selected="selected">ナッセン 平均特性5</option>
										<option if={user.acce1==53} value="53" selected="selected">ナッセン 平均特性4</option>
										<option if={user.acce1==52} value="52" selected="selected">ナッセン 平均特性3</option>
										<option if={user.acce1==51} value="51" selected="selected">ナッセン 平均特性2</option>
										<option if={user.acce1==50} value="50" selected="selected">ナッセン 平均特性1</option>
										<option if={user.acce1!=59} value="59">ナッセン 平均特性10</option>
										<option if={user.acce1!=58} value="58">ナッセン 平均特性9</option>
										<option if={user.acce1!=57} value="57">ナッセン 平均特性8</option>
										<option if={user.acce1!=56} value="56">ナッセン 平均特性7</option>
										<option if={user.acce1!=55} value="55">ナッセン 平均特性6</option>
										<option if={user.acce1!=54} value="54">ナッセン 平均特性5</option>
										<option if={user.acce1!=53} value="53">ナッセン 平均特性4</option>
										<option if={user.acce1!=52} value="52">ナッセン 平均特性3</option>
										<option if={user.acce1!=51} value="51">ナッセン 平均特性2</option>
										<option if={user.acce1!=50} value="50">ナッセン 平均特性1</option>
									</optgroup>
									<optgroup label="カラ">
										<option if={user.acce1==69} value="69" selected="selected">カラ 平均特性10</option>
										<option if={user.acce1==68} value="68" selected="selected">カラ 平均特性9</option>
										<option if={user.acce1==67} value="67" selected="selected">カラ 平均特性8</option>
										<option if={user.acce1==66} value="66" selected="selected">カラ 平均特性7</option>
										<option if={user.acce1==65} value="65" selected="selected">カラ 平均特性6</option>
										<option if={user.acce1==64} value="64" selected="selected">カラ 平均特性5</option>
										<option if={user.acce1==63} value="63" selected="selected">カラ 平均特性4</option>
										<option if={user.acce1==62} value="62" selected="selected">カラ 平均特性3</option>
										<option if={user.acce1==61} value="61" selected="selected">カラ 平均特性2</option>
										<option if={user.acce1==60} value="69" selected="selected">カラ 平均特性1</option>
										<option if={user.acce1!=69} value="69">カラ 平均特性10</option>
										<option if={user.acce1!=68} value="68">カラ 平均特性9</option>
										<option if={user.acce1!=67} value="67">カラ 平均特性8</option>
										<option if={user.acce1!=66} value="66">カラ 平均特性7</option>
										<option if={user.acce1!=65} value="65">カラ 平均特性6</option>
										<option if={user.acce1!=64} value="64">カラ 平均特性5</option>
										<option if={user.acce1!=63} value="63">カラ 平均特性4</option>
										<option if={user.acce1!=62} value="62">カラ 平均特性3</option>
										<option if={user.acce1!=61} value="61">カラ 平均特性2</option>
										<option if={user.acce1!=60} value="60">カラ 平均特性1</option>
									</optgroup>
									<optgroup label="ブラックオール">
										<option if={user.acce1==39} value="39" selected="selected">ブラックオール 平均特性10</option>
										<option if={user.acce1==38} value="38" selected="selected">ブラックオール 平均特性9</option>
										<option if={user.acce1==37} value="37" selected="selected">ブラックオール 平均特性8</option>
										<option if={user.acce1==36} value="36" selected="selected">ブラックオール 平均特性7</option>
										<option if={user.acce1==35} value="35" selected="selected">ブラックオール 平均特性6</option>
										<option if={user.acce1==34} value="34" selected="selected">ブラックオール 平均特性5</option>
										<option if={user.acce1==33} value="33" selected="selected">ブラックオール 平均特性4</option>
										<option if={user.acce1==32} value="32" selected="selected">ブラックオール 平均特性3</option>
										<option if={user.acce1==31} value="31" selected="selected">ブラックオール 平均特性2</option>
										<option if={user.acce1==30} value="30" selected="selected">ブラックオール 平均特性1</option>
										<option if={user.acce1!=39} value="39">ブラックオール 平均特性10</option>
										<option if={user.acce1!=38} value="38">ブラックオール 平均特性9</option>
										<option if={user.acce1!=37} value="37">ブラックオール 平均特性8</option>
										<option if={user.acce1!=36} value="36">ブラックオール 平均特性7</option>
										<option if={user.acce1!=35} value="35">ブラックオール 平均特性6</option>
										<option if={user.acce1!=34} value="34">ブラックオール 平均特性5</option>
										<option if={user.acce1!=33} value="33">ブラックオール 平均特性4</option>
										<option if={user.acce1!=32} value="32">ブラックオール 平均特性3</option>
										<option if={user.acce1!=31} value="31">ブラックオール 平均特性2</option>
										<option if={user.acce1!=30} value="30">ブラックオール 平均特性1</option>
									</optgroup>
									<optgroup label="魔女">
										<option if={user.acce1==89} value="89" selected="selected">魔女 平均特性10</option>
										<option if={user.acce1==88} value="88" selected="selected">魔女 平均特性9</option>
										<option if={user.acce1==87} value="87" selected="selected">魔女 平均特性8</option>
										<option if={user.acce1==86} value="86" selected="selected">魔女 平均特性7</option>
										<option if={user.acce1==85} value="85" selected="selected">魔女 平均特性6</option>
										<option if={user.acce1==84} value="84" selected="selected">魔女 平均特性5</option>
										<option if={user.acce1==83} value="83" selected="selected">魔女 平均特性4</option>
										<option if={user.acce1==82} value="82" selected="selected">魔女 平均特性3</option>
										<option if={user.acce1==81} value="81" selected="selected">魔女 平均特性2</option>
										<option if={user.acce1==80} value="80" selected="selected">魔女 平均特性1</option>
										<option if={user.acce1!=89} value="89">魔女 平均特性10</option>
										<option if={user.acce1!=88} value="88">魔女 平均特性9</option>
										<option if={user.acce1!=87} value="87">魔女 平均特性8</option>
										<option if={user.acce1!=86} value="86">魔女 平均特性7</option>
										<option if={user.acce1!=85} value="85">魔女 平均特性6</option>
										<option if={user.acce1!=84} value="84">魔女 平均特性5</option>
										<option if={user.acce1!=83} value="83">魔女 平均特性4</option>
										<option if={user.acce1!=82} value="82">魔女 平均特性3</option>
										<option if={user.acce1!=81} value="81">魔女 平均特性2</option>
										<option if={user.acce1!=80} value="80">魔女 平均特性1</option>
									</optgroup>
									<optgroup label="アルボール">
										<option if={user.acce1==29} value="29" selected="selected">アルボール 平均特性10</option>
										<option if={user.acce1==28} value="28" selected="selected">アルボール 平均特性9</option>
										<option if={user.acce1==27} value="27" selected="selected">アルボール 平均特性8</option>
										<option if={user.acce1==26} value="26" selected="selected">アルボール 平均特性7</option>
										<option if={user.acce1==25} value="25" selected="selected">アルボール 平均特性6</option>
										<option if={user.acce1==24} value="24" selected="selected">アルボール 平均特性5</option>
										<option if={user.acce1==23} value="23" selected="selected">アルボール 平均特性4</option>
										<option if={user.acce1==22} value="22" selected="selected">アルボール 平均特性3</option>
										<option if={user.acce1==21} value="21" selected="selected">アルボール 平均特性2</option>
										<option if={user.acce1==20} value="20" selected="selected">アルボール 平均特性1</option>
										<option if={user.acce1!=29} value="29">アルボール 平均特性10</option>
										<option if={user.acce1!=28} value="28">アルボール 平均特性9</option>
										<option if={user.acce1!=27} value="27">アルボール 平均特性8</option>
										<option if={user.acce1!=26} value="26">アルボール 平均特性7</option>
										<option if={user.acce1!=25} value="25">アルボール 平均特性6</option>
										<option if={user.acce1!=24} value="24">アルボール 平均特性5</option>
										<option if={user.acce1!=23} value="23">アルボール 平均特性4</option>
										<option if={user.acce1!=22} value="22">アルボール 平均特性3</option>
										<option if={user.acce1!=21} value="21">アルボール 平均特性2</option>
										<option if={user.acce1!=20} value="20">アルボール 平均特性1</option>
									</optgroup>
									<optgroup label="フェニックス">
										<option if={user.acce1==19} value="19" selected="selected">フェニックス 平均特性10</option>
										<option if={user.acce1==18} value="18" selected="selected">フェニックス 平均特性9</option>
										<option if={user.acce1==17} value="17" selected="selected">フェニックス 平均特性8</option>
										<option if={user.acce1==16} value="16" selected="selected">フェニックス 平均特性7</option>
										<option if={user.acce1==15} value="15" selected="selected">フェニックス 平均特性6</option>
										<option if={user.acce1==14} value="14" selected="selected">フェニックス 平均特性5</option>
										<option if={user.acce1==13} value="13" selected="selected">フェニックス 平均特性4</option>
										<option if={user.acce1==12} value="12" selected="selected">フェニックス 平均特性3</option>
										<option if={user.acce1==11} value="11" selected="selected">フェニックス 平均特性2</option>
										<option if={user.acce1==10} value="10" selected="selected">フェニックス 平均特性1</option>
										<option if={user.acce1!=19} value="19">フェニックス 平均特性10</option>
										<option if={user.acce1!=18} value="18">フェニックス 平均特性9</option>
										<option if={user.acce1!=17} value="17">フェニックス 平均特性8</option>
										<option if={user.acce1!=16} value="16">フェニックス 平均特性7</option>
										<option if={user.acce1!=15} value="15">フェニックス 平均特性6</option>
										<option if={user.acce1!=14} value="14">フェニックス 平均特性5</option>
										<option if={user.acce1!=13} value="13">フェニックス 平均特性4</option>
										<option if={user.acce1!=12} value="12">フェニックス 平均特性3</option>
										<option if={user.acce1!=11} value="11">フェニックス 平均特性2</option>
										<option if={user.acce1!=10} value="10">フェニックス 平均特性1</option>
									</optgroup>
									<optgroup label="ムーンストーン">
										<option if={user.acce1==49} value="49" selected="selected">ムーンストーン 平均特性10</option>
										<option if={user.acce1==48} value="48" selected="selected">ムーンストーン 平均特性9</option>
										<option if={user.acce1==47} value="47" selected="selected">ムーンストーン 平均特性8</option>
										<option if={user.acce1==46} value="46" selected="selected">ムーンストーン 平均特性7</option>
										<option if={user.acce1==45} value="45" selected="selected">ムーンストーン 平均特性6</option>
										<option if={user.acce1==44} value="44" selected="selected">ムーンストーン 平均特性5</option>
										<option if={user.acce1==43} value="43" selected="selected">ムーンストーン 平均特性4</option>
										<option if={user.acce1==42} value="42" selected="selected">ムーンストーン 平均特性3</option>
										<option if={user.acce1==41} value="41" selected="selected">ムーンストーン 平均特性2</option>
										<option if={user.acce1==40} value="40" selected="selected">ムーンストーン 平均特性1</option>
										<option if={user.acce1!=49} value="49">ムーンストーン 平均特性10</option>
										<option if={user.acce1!=48} value="48">ムーンストーン 平均特性9</option>
										<option if={user.acce1!=47} value="47">ムーンストーン 平均特性8</option>
										<option if={user.acce1!=46} value="46">ムーンストーン 平均特性7</option>
										<option if={user.acce1!=45} value="45">ムーンストーン 平均特性6</option>
										<option if={user.acce1!=44} value="44">ムーンストーン 平均特性5</option>
										<option if={user.acce1!=43} value="43">ムーンストーン 平均特性4</option>
										<option if={user.acce1!=42} value="42">ムーンストーン 平均特性3</option>
										<option if={user.acce1!=41} value="41">ムーンストーン 平均特性2</option>
										<option if={user.acce1!=40} value="40">ムーンストーン 平均特性1</option>
									</optgroup>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userbukicos">
									<option value="">武器コス</option>
									<optgroup label="海賊王">
										<option if={user.bukicos=='海賊10'} value="海賊10" selected="selected">海賊王 特性Lv10</option>
										<option if={user.bukicos=='海賊9'} value="海賊9" selected="selected">海賊王 特性Lv9</option>
										<option if={user.bukicos=='海賊8'} value="海賊8" selected="selected">海賊王 特性Lv8</option>
										<option if={user.bukicos=='海賊7'} value="海賊7" selected="selected">海賊王 特性Lv7</option>
										<option if={user.bukicos=='海賊6'} value="海賊6" selected="selected">海賊王 特性Lv6</option>
										<option if={user.bukicos=='海賊5'} value="海賊5" selected="selected">海賊王 特性Lv5</option>
										<option if={user.bukicos=='海賊4'} value="海賊4" selected="selected">海賊王 特性Lv4</option>
										<option if={user.bukicos=='海賊3'} value="海賊3" selected="selected">海賊王 特性Lv3</option>
										<option if={user.bukicos=='海賊2'} value="海賊2" selected="selected">海賊王 特性Lv2</option>
										<option if={user.bukicos=='海賊1'} value="海賊1" selected="selected">海賊王 特性Lv1</option>
										<option if={user.bukicos!='海賊10'} value="海賊10">海賊王 特性Lv10</option>
										<option if={user.bukicos!='海賊9'} value="海賊9">海賊王 特性Lv9</option>
										<option if={user.bukicos!='海賊8'} value="海賊8">海賊王 特性Lv8</option>
										<option if={user.bukicos!='海賊7'} value="海賊7">海賊王 特性Lv7</option>
										<option if={user.bukicos!='海賊6'} value="海賊6">海賊王 特性Lv6</option>
										<option if={user.bukicos!='海賊5'} value="海賊5">海賊王 特性Lv5</option>
										<option if={user.bukicos!='海賊4'} value="海賊4">海賊王 特性Lv4</option>
										<option if={user.bukicos!='海賊3'} value="海賊3">海賊王 特性Lv3</option>
										<option if={user.bukicos!='海賊2'} value="海賊2">海賊王 特性Lv2</option>
										<option if={user.bukicos!='海賊1'} value="海賊1">海賊王 特性Lv1</option>
									</optgroup>
									<optgroup label="百鬼夜行">
										<option if={user.bukicos=='百鬼10'} value="百鬼10" selected="selected">百鬼夜行 特性Lv10</option>
										<option if={user.bukicos=='百鬼9'} value="百鬼9" selected="selected">百鬼夜行 特性Lv9</option>
										<option if={user.bukicos=='百鬼8'} value="百鬼8" selected="selected">百鬼夜行 特性Lv8</option>
										<option if={user.bukicos=='百鬼7'} value="百鬼7" selected="selected">百鬼夜行 特性Lv7</option>
										<option if={user.bukicos=='百鬼6'} value="百鬼6" selected="selected">百鬼夜行 特性Lv6</option>
										<option if={user.bukicos=='百鬼5'} value="百鬼5" selected="selected">百鬼夜行 特性Lv5</option>
										<option if={user.bukicos=='百鬼4'} value="百鬼4" selected="selected">百鬼夜行 特性Lv4</option>
										<option if={user.bukicos=='百鬼3'} value="百鬼3" selected="selected">百鬼夜行 特性Lv3</option>
										<option if={user.bukicos=='百鬼2'} value="百鬼2" selected="selected">百鬼夜行 特性Lv2</option>
										<option if={user.bukicos=='百鬼1'} value="百鬼1" selected="selected">百鬼夜行 特性Lv1</option>
										<option if={user.bukicos!='百鬼10'} value="百鬼10">百鬼夜行 特性Lv10</option>
										<option if={user.bukicos!='百鬼9'} value="百鬼9">百鬼夜行 特性Lv9</option>
										<option if={user.bukicos!='百鬼8'} value="百鬼8">百鬼夜行 特性Lv8</option>
										<option if={user.bukicos!='百鬼7'} value="百鬼7">百鬼夜行 特性Lv7</option>
										<option if={user.bukicos!='百鬼6'} value="百鬼6">百鬼夜行 特性Lv6</option>
										<option if={user.bukicos!='百鬼5'} value="百鬼5">百鬼夜行 特性Lv5</option>
										<option if={user.bukicos!='百鬼4'} value="百鬼4">百鬼夜行 特性Lv4</option>
										<option if={user.bukicos!='百鬼3'} value="百鬼3">百鬼夜行 特性Lv3</option>
										<option if={user.bukicos!='百鬼2'} value="百鬼2">百鬼夜行 特性Lv2</option>
										<option if={user.bukicos!='百鬼1'} value="百鬼1">百鬼夜行 特性Lv1</option>
									</optgroup>
									<optgroup label="ハロウィン">
										<option if={user.bukicos=='カボ10'} value="カボ10" selected="selected">ハロウィン 特性Lv10</option>
										<option if={user.bukicos=='カボ9'} value="カボ9" selected="selected">ハロウィン 特性Lv9</option>
										<option if={user.bukicos=='カボ8'} value="カボ8" selected="selected">ハロウィン 特性Lv8</option>
										<option if={user.bukicos=='カボ7'} value="カボ7" selected="selected">ハロウィン 特性Lv7</option>
										<option if={user.bukicos=='カボ6'} value="カボ6" selected="selected">ハロウィン 特性Lv6</option>
										<option if={user.bukicos=='カボ5'} value="カボ5" selected="selected">ハロウィン 特性Lv5</option>
										<option if={user.bukicos=='カボ4'} value="カボ4" selected="selected">ハロウィン 特性Lv4</option>
										<option if={user.bukicos=='カボ3'} value="カボ3" selected="selected">ハロウィン 特性Lv3</option>
										<option if={user.bukicos=='カボ2'} value="カボ2" selected="selected">ハロウィン 特性Lv2</option>
										<option if={user.bukicos=='カボ1'} value="カボ1" selected="selected">ハロウィン 特性Lv1</option>
										<option if={user.bukicos!='カボ10'} value="カボ10">ハロウィン 特性Lv10</option>
										<option if={user.bukicos!='カボ9'} value="カボ9">ハロウィン 特性Lv9</option>
										<option if={user.bukicos!='カボ8'} value="カボ8">ハロウィン 特性Lv8</option>
										<option if={user.bukicos!='カボ7'} value="カボ7">ハロウィン 特性Lv7</option>
										<option if={user.bukicos!='カボ6'} value="カボ6">ハロウィン 特性Lv6</option>
										<option if={user.bukicos!='カボ5'} value="カボ5">ハロウィン 特性Lv5</option>
										<option if={user.bukicos!='カボ4'} value="カボ4">ハロウィン 特性Lv4</option>
										<option if={user.bukicos!='カボ3'} value="カボ3">ハロウィン 特性Lv3</option>
										<option if={user.bukicos!='カボ2'} value="カボ2">ハロウィン 特性Lv2</option>
										<option if={user.bukicos!='カボ1'} value="カボ1">ハロウィン 特性Lv1</option>
									</optgroup>
									<optgroup label="アイスエッジ">
										<option if={user.bukicos=='氷刃10'} value="氷刃10" selected="selected">アイスエッジ 特性Lv10</option>
										<option if={user.bukicos=='氷刃9'} value="氷刃9" selected="selected">アイスエッジ 特性Lv9</option>
										<option if={user.bukicos=='氷刃8'} value="氷刃8" selected="selected">アイスエッジ 特性Lv8</option>
										<option if={user.bukicos=='氷刃7'} value="氷刃7" selected="selected">アイスエッジ 特性Lv7</option>
										<option if={user.bukicos=='氷刃6'} value="氷刃6" selected="selected">アイスエッジ 特性Lv6</option>
										<option if={user.bukicos=='氷刃5'} value="氷刃5" selected="selected">アイスエッジ 特性Lv5</option>
										<option if={user.bukicos=='氷刃4'} value="氷刃4" selected="selected">アイスエッジ 特性Lv4</option>
										<option if={user.bukicos=='氷刃3'} value="氷刃3" selected="selected">アイスエッジ 特性Lv3</option>
										<option if={user.bukicos=='氷刃2'} value="氷刃2" selected="selected">アイスエッジ 特性Lv2</option>
										<option if={user.bukicos=='氷刃1'} value="氷刃1" selected="selected">アイスエッジ 特性Lv1</option>
										<option if={user.bukicos!='氷刃10'} value="氷刃10">アイスエッジ 特性Lv10</option>
										<option if={user.bukicos!='氷刃9'} value="氷刃9">アイスエッジ 特性Lv9</option>
										<option if={user.bukicos!='氷刃8'} value="氷刃8">アイスエッジ 特性Lv8</option>
										<option if={user.bukicos!='氷刃7'} value="氷刃7">アイスエッジ 特性Lv7</option>
										<option if={user.bukicos!='氷刃6'} value="氷刃6">アイスエッジ 特性Lv6</option>
										<option if={user.bukicos!='氷刃5'} value="氷刃5">アイスエッジ 特性Lv5</option>
										<option if={user.bukicos!='氷刃4'} value="氷刃4">アイスエッジ 特性Lv4</option>
										<option if={user.bukicos!='氷刃3'} value="氷刃3">アイスエッジ 特性Lv3</option>
										<option if={user.bukicos!='氷刃2'} value="氷刃2">アイスエッジ 特性Lv2</option>
										<option if={user.bukicos!='氷刃1'} value="氷刃1">アイスエッジ 特性Lv1</option>
									</optgroup>
									<optgroup label="フェアリーローズ">
										<option if={user.bukicos=='薔薇10'} value="薔薇10" selected="selected">フェアリーローズ 特性Lv10</option>
										<option if={user.bukicos=='薔薇9'} value="薔薇9" selected="selected">フェアリーローズ 特性Lv9</option>
										<option if={user.bukicos=='薔薇8'} value="薔薇8" selected="selected">フェアリーローズ 特性Lv8</option>
										<option if={user.bukicos=='薔薇7'} value="薔薇7" selected="selected">フェアリーローズ 特性Lv7</option>
										<option if={user.bukicos=='薔薇6'} value="薔薇6" selected="selected">フェアリーローズ 特性Lv6</option>
										<option if={user.bukicos=='薔薇5'} value="薔薇5" selected="selected">フェアリーローズ 特性Lv5</option>
										<option if={user.bukicos=='薔薇4'} value="薔薇4" selected="selected">フェアリーローズ 特性Lv4</option>
										<option if={user.bukicos=='薔薇3'} value="薔薇3" selected="selected">フェアリーローズ 特性Lv3</option>
										<option if={user.bukicos=='薔薇2'} value="薔薇2" selected="selected">フェアリーローズ 特性Lv2</option>
										<option if={user.bukicos=='薔薇1'} value="薔薇1" selected="selected">フェアリーローズ 特性Lv1</option>
										<option if={user.bukicos!='薔薇10'} value="薔薇10">フェアリーローズ 特性Lv10</option>
										<option if={user.bukicos!='薔薇9'} value="薔薇9">フェアリーローズ 特性Lv9</option>
										<option if={user.bukicos!='薔薇8'} value="薔薇8">フェアリーローズ 特性Lv8</option>
										<option if={user.bukicos!='薔薇7'} value="薔薇7">フェアリーローズ 特性Lv7</option>
										<option if={user.bukicos!='薔薇6'} value="薔薇6">フェアリーローズ 特性Lv6</option>
										<option if={user.bukicos!='薔薇5'} value="薔薇5">フェアリーローズ 特性Lv5</option>
										<option if={user.bukicos!='薔薇4'} value="薔薇4">フェアリーローズ 特性Lv4</option>
										<option if={user.bukicos!='薔薇3'} value="薔薇3">フェアリーローズ 特性Lv3</option>
										<option if={user.bukicos!='薔薇2'} value="薔薇2">フェアリーローズ 特性Lv2</option>
										<option if={user.bukicos!='薔薇1'} value="薔薇1">フェアリーローズ 特性Lv1</option>
									</optgroup>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="usermanto">
									<option value="">マント</option>
									<optgroup label="高潔なる血のマント">
										<option if={user.manto=='高潔30'} value="高潔30" selected="selected">高潔Lv30</option>
										<option if={user.manto=='高潔29'} value="高潔29" selected="selected">高潔Lv29</option>
										<option if={user.manto=='高潔28'} value="高潔28" selected="selected">高潔Lv28</option>
										<option if={user.manto=='高潔27'} value="高潔27" selected="selected">高潔Lv27</option>
										<option if={user.manto=='高潔26'} value="高潔26" selected="selected">高潔Lv26</option>
										<option if={user.manto=='高潔25'} value="高潔25" selected="selected">高潔Lv25</option>
										<option if={user.manto=='高潔24'} value="高潔24" selected="selected">高潔Lv24</option>
										<option if={user.manto=='高潔23'} value="高潔23" selected="selected">高潔Lv23</option>
										<option if={user.manto=='高潔22'} value="高潔22" selected="selected">高潔Lv22</option>
										<option if={user.manto=='高潔21'} value="高潔21" selected="selected">高潔Lv21</option>
										<option if={user.manto=='高潔20'} value="高潔20" selected="selected">高潔Lv20</option>
										<option if={user.manto=='高潔19'} value="高潔19" selected="selected">高潔Lv19</option>
										<option if={user.manto=='高潔18'} value="高潔18" selected="selected">高潔Lv18</option>
										<option if={user.manto=='高潔17'} value="高潔17" selected="selected">高潔Lv17</option>
										<option if={user.manto=='高潔16'} value="高潔16" selected="selected">高潔Lv16</option>
										<option if={user.manto=='高潔15'} value="高潔15" selected="selected">高潔Lv15</option>
										<option if={user.manto=='高潔14'} value="高潔14" selected="selected">高潔Lv14</option>
										<option if={user.manto=='高潔13'} value="高潔13" selected="selected">高潔Lv13</option>
										<option if={user.manto=='高潔12'} value="高潔12" selected="selected">高潔Lv12</option>
										<option if={user.manto=='高潔11'} value="高潔11" selected="selected">高潔Lv11</option>
										<option if={user.manto=='高潔10'} value="高潔10" selected="selected">高潔Lv10</option>
										<option if={user.manto=='高潔9'} value="高潔9" selected="selected">高潔Lv9</option>
										<option if={user.manto=='高潔8'} value="高潔8" selected="selected">高潔Lv8</option>
										<option if={user.manto=='高潔7'} value="高潔7" selected="selected">高潔Lv7</option>
										<option if={user.manto=='高潔6'} value="高潔6" selected="selected">高潔Lv6</option>
										<option if={user.manto=='高潔5'} value="高潔5" selected="selected">高潔Lv5</option>
										<option if={user.manto=='高潔4'} value="高潔4" selected="selected">高潔Lv4</option>
										<option if={user.manto=='高潔3'} value="高潔3" selected="selected">高潔Lv3</option>
										<option if={user.manto=='高潔2'} value="高潔2" selected="selected">高潔Lv2</option>
										<option if={user.manto=='高潔1'} value="高潔1" selected="selected">高潔Lv1</option>
										<option if={user.manto!='高潔30'} value="高潔30">高潔Lv30</option>
										<option if={user.manto!='高潔29'} value="高潔29">高潔Lv29</option>
										<option if={user.manto!='高潔28'} value="高潔28">高潔Lv28</option>
										<option if={user.manto!='高潔27'} value="高潔27">高潔Lv27</option>
										<option if={user.manto!='高潔26'} value="高潔26">高潔Lv26</option>
										<option if={user.manto!='高潔25'} value="高潔25">高潔Lv25</option>
										<option if={user.manto!='高潔24'} value="高潔24">高潔Lv24</option>
										<option if={user.manto!='高潔23'} value="高潔23">高潔Lv23</option>
										<option if={user.manto!='高潔22'} value="高潔22">高潔Lv22</option>
										<option if={user.manto!='高潔21'} value="高潔21">高潔Lv21</option>
										<option if={user.manto!='高潔20'} value="高潔20">高潔Lv20</option>
										<option if={user.manto!='高潔19'} value="高潔19">高潔Lv19</option>
										<option if={user.manto!='高潔18'} value="高潔18">高潔Lv18</option>
										<option if={user.manto!='高潔17'} value="高潔17">高潔Lv17</option>
										<option if={user.manto!='高潔16'} value="高潔16">高潔Lv16</option>
										<option if={user.manto!='高潔15'} value="高潔15">高潔Lv15</option>
										<option if={user.manto!='高潔14'} value="高潔14">高潔Lv14</option>
										<option if={user.manto!='高潔13'} value="高潔13">高潔Lv13</option>
										<option if={user.manto!='高潔12'} value="高潔12">高潔Lv12</option>
										<option if={user.manto!='高潔11'} value="高潔11">高潔Lv11</option>
										<option if={user.manto!='高潔10'} value="高潔10">高潔Lv10</option>
										<option if={user.manto!='高潔9'} value="高潔9">高潔Lv9</option>
										<option if={user.manto!='高潔8'} value="高潔8">高潔Lv8</option>
										<option if={user.manto!='高潔7'} value="高潔7">高潔Lv7</option>
										<option if={user.manto!='高潔6'} value="高潔6">高潔Lv6</option>
										<option if={user.manto!='高潔5'} value="高潔5">高潔Lv5</option>
										<option if={user.manto!='高潔4'} value="高潔4">高潔Lv4</option>
										<option if={user.manto!='高潔3'} value="高潔3">高潔Lv3</option>
										<option if={user.manto!='高潔2'} value="高潔2">高潔Lv2</option>
										<option if={user.manto!='高潔1'} value="高潔1">高潔Lv1</option>
									</optgroup>
									<optgroup label="ハギオスのマント">
										<option if={user.manto=='ハギ30'} value="ハギ30" selected="selected">ハギオスLv30</option>
										<option if={user.manto=='ハギ29'} value="ハギ29" selected="selected">ハギオスLv29</option>
										<option if={user.manto=='ハギ28'} value="ハギ28" selected="selected">ハギオスLv28</option>
										<option if={user.manto=='ハギ27'} value="ハギ27" selected="selected">ハギオスLv27</option>
										<option if={user.manto=='ハギ26'} value="ハギ26" selected="selected">ハギオスLv26</option>
										<option if={user.manto=='ハギ25'} value="ハギ25" selected="selected">ハギオスLv25</option>
										<option if={user.manto=='ハギ24'} value="ハギ24" selected="selected">ハギオスLv24</option>
										<option if={user.manto=='ハギ23'} value="ハギ23" selected="selected">ハギオスLv23</option>
										<option if={user.manto=='ハギ22'} value="ハギ22" selected="selected">ハギオスLv22</option>
										<option if={user.manto=='ハギ21'} value="ハギ21" selected="selected">ハギオスLv21</option>
										<option if={user.manto=='ハギ20'} value="ハギ20" selected="selected">ハギオスLv20</option>
										<option if={user.manto=='ハギ19'} value="ハギ19" selected="selected">ハギオスLv19</option>
										<option if={user.manto=='ハギ18'} value="ハギ18" selected="selected">ハギオスLv18</option>
										<option if={user.manto=='ハギ17'} value="ハギ17" selected="selected">ハギオスLv17</option>
										<option if={user.manto=='ハギ16'} value="ハギ16" selected="selected">ハギオスLv16</option>
										<option if={user.manto=='ハギ15'} value="ハギ15" selected="selected">ハギオスLv15</option>
										<option if={user.manto=='ハギ14'} value="ハギ14" selected="selected">ハギオスLv14</option>
										<option if={user.manto=='ハギ13'} value="ハギ13" selected="selected">ハギオスLv13</option>
										<option if={user.manto=='ハギ12'} value="ハギ12" selected="selected">ハギオスLv12</option>
										<option if={user.manto=='ハギ11'} value="ハギ11" selected="selected">ハギオスLv11</option>
										<option if={user.manto=='ハギ10'} value="ハギ10" selected="selected">ハギオスLv10</option>
										<option if={user.manto=='ハギ9'} value="ハギ9" selected="selected">ハギオスLv9</option>
										<option if={user.manto=='ハギ8'} value="ハギ8" selected="selected">ハギオスLv8</option>
										<option if={user.manto=='ハギ7'} value="ハギ7" selected="selected">ハギオスLv7</option>
										<option if={user.manto=='ハギ6'} value="ハギ6" selected="selected">ハギオスLv6</option>
										<option if={user.manto=='ハギ5'} value="ハギ5" selected="selected">ハギオスLv5</option>
										<option if={user.manto=='ハギ4'} value="ハギ4" selected="selected">ハギオスLv4</option>
										<option if={user.manto=='ハギ3'} value="ハギ3" selected="selected">ハギオスLv3</option>
										<option if={user.manto=='ハギ2'} value="ハギ2" selected="selected">ハギオスLv2</option>
										<option if={user.manto=='ハギ1'} value="ハギ1" selected="selected">ハギオスLv1</option>
										<option if={user.manto!='ハギ30'} value="ハギ30">ハギオスLv30</option>
										<option if={user.manto!='ハギ29'} value="ハギ29">ハギオスLv29</option>
										<option if={user.manto!='ハギ28'} value="ハギ28">ハギオスLv28</option>
										<option if={user.manto!='ハギ27'} value="ハギ27">ハギオスLv27</option>
										<option if={user.manto!='ハギ26'} value="ハギ26">ハギオスLv26</option>
										<option if={user.manto!='ハギ25'} value="ハギ25">ハギオスLv25</option>
										<option if={user.manto!='ハギ24'} value="ハギ24">ハギオスLv24</option>
										<option if={user.manto!='ハギ23'} value="ハギ23">ハギオスLv23</option>
										<option if={user.manto!='ハギ22'} value="ハギ22">ハギオスLv22</option>
										<option if={user.manto!='ハギ21'} value="ハギ21">ハギオスLv21</option>
										<option if={user.manto!='ハギ20'} value="ハギ20">ハギオスLv20</option>
										<option if={user.manto!='ハギ19'} value="ハギ19">ハギオスLv19</option>
										<option if={user.manto!='ハギ18'} value="ハギ18">ハギオスLv18</option>
										<option if={user.manto!='ハギ17'} value="ハギ17">ハギオスLv17</option>
										<option if={user.manto!='ハギ16'} value="ハギ16">ハギオスLv16</option>
										<option if={user.manto!='ハギ15'} value="ハギ15">ハギオスLv15</option>
										<option if={user.manto!='ハギ14'} value="ハギ14">ハギオスLv14</option>
										<option if={user.manto!='ハギ13'} value="ハギ13">ハギオスLv13</option>
										<option if={user.manto!='ハギ12'} value="ハギ12">ハギオスLv12</option>
										<option if={user.manto!='ハギ11'} value="ハギ11">ハギオスLv11</option>
										<option if={user.manto!='ハギ10'} value="ハギ10">ハギオスLv10</option>
										<option if={user.manto!='ハギ9'} value="ハギ9">ハギオスLv9</option>
										<option if={user.manto!='ハギ8'} value="ハギ8">ハギオスLv8</option>
										<option if={user.manto!='ハギ7'} value="ハギ7">ハギオスLv7</option>
										<option if={user.manto!='ハギ6'} value="ハギ6">ハギオスLv6</option>
										<option if={user.manto!='ハギ5'} value="ハギ5">ハギオスLv5</option>
										<option if={user.manto!='ハギ4'} value="ハギ4">ハギオスLv4</option>
										<option if={user.manto!='ハギ3'} value="ハギ3">ハギオスLv3</option>
										<option if={user.manto!='ハギ2'} value="ハギ2">ハギオスLv2</option>
										<option if={user.manto!='ハギ1'} value="ハギ1">ハギオスLv1</option>
									</optgroup>
									<optgroup label="堅守なる氷結のマント">
										<option if={user.manto=='氷結30'} value="氷結30" selected="selected">氷結Lv30</option>
										<option if={user.manto=='氷結29'} value="氷結29" selected="selected">氷結Lv29</option>
										<option if={user.manto=='氷結28'} value="氷結28" selected="selected">氷結Lv28</option>
										<option if={user.manto=='氷結27'} value="氷結27" selected="selected">氷結Lv27</option>
										<option if={user.manto=='氷結26'} value="氷結26" selected="selected">氷結Lv26</option>
										<option if={user.manto=='氷結25'} value="氷結25" selected="selected">氷結Lv25</option>
										<option if={user.manto=='氷結24'} value="氷結24" selected="selected">氷結Lv24</option>
										<option if={user.manto=='氷結23'} value="氷結23" selected="selected">氷結Lv23</option>
										<option if={user.manto=='氷結22'} value="氷結22" selected="selected">氷結Lv22</option>
										<option if={user.manto=='氷結21'} value="氷結21" selected="selected">氷結Lv21</option>
										<option if={user.manto=='氷結20'} value="氷結20" selected="selected">氷結Lv20</option>
										<option if={user.manto=='氷結19'} value="氷結19" selected="selected">氷結Lv19</option>
										<option if={user.manto=='氷結18'} value="氷結18" selected="selected">氷結Lv18</option>
										<option if={user.manto=='氷結17'} value="氷結17" selected="selected">氷結Lv17</option>
										<option if={user.manto=='氷結16'} value="氷結16" selected="selected">氷結Lv16</option>
										<option if={user.manto=='氷結15'} value="氷結15" selected="selected">氷結Lv15</option>
										<option if={user.manto=='氷結14'} value="氷結14" selected="selected">氷結Lv14</option>
										<option if={user.manto=='氷結13'} value="氷結13" selected="selected">氷結Lv13</option>
										<option if={user.manto=='氷結12'} value="氷結12" selected="selected">氷結Lv12</option>
										<option if={user.manto=='氷結11'} value="氷結11" selected="selected">氷結Lv11</option>
										<option if={user.manto=='氷結10'} value="氷結10" selected="selected">氷結Lv10</option>
										<option if={user.manto=='氷結9'} value="氷結9" selected="selected">氷結Lv9</option>
										<option if={user.manto=='氷結8'} value="氷結8" selected="selected">氷結Lv8</option>
										<option if={user.manto=='氷結7'} value="氷結7" selected="selected">氷結Lv7</option>
										<option if={user.manto=='氷結6'} value="氷結6" selected="selected">氷結Lv6</option>
										<option if={user.manto=='氷結5'} value="氷結5" selected="selected">氷結Lv5</option>
										<option if={user.manto=='氷結4'} value="氷結4" selected="selected">氷結Lv4</option>
										<option if={user.manto=='氷結3'} value="氷結3" selected="selected">氷結Lv3</option>
										<option if={user.manto=='氷結2'} value="氷結2" selected="selected">氷結Lv2</option>
										<option if={user.manto=='氷結1'} value="氷結1" selected="selected">氷結Lv1</option>
										<option if={user.manto!='氷結30'} value="氷結30">氷結Lv30</option>
										<option if={user.manto!='氷結29'} value="氷結29">氷結Lv29</option>
										<option if={user.manto!='氷結28'} value="氷結28">氷結Lv28</option>
										<option if={user.manto!='氷結27'} value="氷結27">氷結Lv27</option>
										<option if={user.manto!='氷結26'} value="氷結26">氷結Lv26</option>
										<option if={user.manto!='氷結25'} value="氷結25">氷結Lv25</option>
										<option if={user.manto!='氷結24'} value="氷結24">氷結Lv24</option>
										<option if={user.manto!='氷結23'} value="氷結23">氷結Lv23</option>
										<option if={user.manto!='氷結22'} value="氷結22">氷結Lv22</option>
										<option if={user.manto!='氷結21'} value="氷結21">氷結Lv21</option>
										<option if={user.manto!='氷結20'} value="氷結20">氷結Lv20</option>
										<option if={user.manto!='氷結19'} value="氷結19">氷結Lv19</option>
										<option if={user.manto!='氷結18'} value="氷結18">氷結Lv18</option>
										<option if={user.manto!='氷結17'} value="氷結17">氷結Lv17</option>
										<option if={user.manto!='氷結16'} value="氷結16">氷結Lv16</option>
										<option if={user.manto!='氷結15'} value="氷結15">氷結Lv15</option>
										<option if={user.manto!='氷結14'} value="氷結14">氷結Lv14</option>
										<option if={user.manto!='氷結13'} value="氷結13">氷結Lv13</option>
										<option if={user.manto!='氷結12'} value="氷結12">氷結Lv12</option>
										<option if={user.manto!='氷結11'} value="氷結11">氷結Lv11</option>
										<option if={user.manto!='氷結10'} value="氷結10">氷結Lv10</option>
										<option if={user.manto!='氷結9'} value="氷結9">氷結Lv9</option>
										<option if={user.manto!='氷結8'} value="氷結8">氷結Lv8</option>
										<option if={user.manto!='氷結7'} value="氷結7">氷結Lv7</option>
										<option if={user.manto!='氷結6'} value="氷結6">氷結Lv6</option>
										<option if={user.manto!='氷結5'} value="氷結5">氷結Lv5</option>
										<option if={user.manto!='氷結4'} value="氷結4">氷結Lv4</option>
										<option if={user.manto!='氷結3'} value="氷結3">氷結Lv3</option>
										<option if={user.manto!='氷結2'} value="氷結2">氷結Lv2</option>
										<option if={user.manto!='氷結1'} value="氷結1">氷結Lv1</option>
									</optgroup>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="usermeteo">
									<option>メテオ</option>
									<option if={user.meteo==10} value="10" selected="selected">メテオLv10</option>
									<option if={user.meteo==9} value="9" selected="selected">メテオLv9</option>
									<option if={user.meteo==8} value="8" selected="selected">メテオLv8</option>
									<option if={user.meteo==7} value="7" selected="selected">メテオLv7</option>
									<option if={user.meteo==6} value="6" selected="selected">メテオLv6</option>
									<option if={user.meteo==5} value="5" selected="selected">メテオLv5</option>
									<option if={user.meteo==4} value="4" selected="selected">メテオLv4</option>
									<option if={user.meteo==3} value="3" selected="selected">メテオLv3</option>
									<option if={user.meteo==2} value="2" selected="selected">メテオLv2</option>
									<option if={user.meteo==1} value="1" selected="selected">メテオLv1</option>
									<option if={user.meteo!=10} value="10">メテオLv10</option>
									<option if={user.meteo!=9} value="9">メテオLv9</option>
									<option if={user.meteo!=8} value="8">メテオLv8</option>
									<option if={user.meteo!=7} value="7">メテオLv7</option>
									<option if={user.meteo!=6} value="6">メテオLv6</option>
									<option if={user.meteo!=5} value="5">メテオLv5</option>
									<option if={user.meteo!=4} value="4">メテオLv4</option>
									<option if={user.meteo!=3} value="3">メテオLv3</option>
									<option if={user.meteo!=2} value="2">メテオLv2</option>
									<option if={user.meteo!=1} value="1">メテオLv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userdzone">
									<option value="">ディフェンスゾーン</option>
									<option if={user.dzone==10} value="10" selected="selected">ディフェンスゾーンLv10</option>
									<option if={user.dzone==9} value="9" selected="selected">ディフェンスゾーンLv9</option>
									<option if={user.dzone==8} value="8" selected="selected">ディフェンスゾーンLv8</option>
									<option if={user.dzone==7} value="7" selected="selected">ディフェンスゾーンLv7</option>
									<option if={user.dzone==6} value="6" selected="selected">ディフェンスゾーンLv6</option>
									<option if={user.dzone==5} value="5" selected="selected">ディフェンスゾーンLv5</option>
									<option if={user.dzone==4} value="4" selected="selected">ディフェンスゾーンLv4</option>
									<option if={user.dzone==3} value="3" selected="selected">ディフェンスゾーンLv3</option>
									<option if={user.dzone==2} value="2" selected="selected">ディフェンスゾーンLv2</option>
									<option if={user.dzone==1} value="1" selected="selected">ディフェンスゾーンLv1</option>
									<option if={user.dzone!=10} value="10">ディフェンスゾーンLv10</option>
									<option if={user.dzone!=9} value="9">ディフェンスゾーンLv9</option>
									<option if={user.dzone!=8} value="8">ディフェンスゾーンLv8</option>
									<option if={user.dzone!=7} value="7">ディフェンスゾーンLv7</option>
									<option if={user.dzone!=6} value="6">ディフェンスゾーンLv6</option>
									<option if={user.dzone!=5} value="5">ディフェンスゾーンLv5</option>
									<option if={user.dzone!=4} value="4">ディフェンスゾーンLv4</option>
									<option if={user.dzone!=3} value="3">ディフェンスゾーンLv3</option>
									<option if={user.dzone!=2} value="2">ディフェンスゾーンLv2</option>
									<option if={user.dzone!=1} value="1">ディフェンスゾーンLv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userpvpat">
									<option>対人攻撃特性</option>
									<option if={user.pvpat==10} value="10" selected="selected">対人攻撃特性Lv10</option>
									<option if={user.pvpat==9} value="9" selected="selected">対人攻撃特性Lv9</option>
									<option if={user.pvpat==8} value="8" selected="selected">対人攻撃特性Lv8</option>
									<option if={user.pvpat==7} value="7" selected="selected">対人攻撃特性Lv7</option>
									<option if={user.pvpat==6} value="6" selected="selected">対人攻撃特性Lv6</option>
									<option if={user.pvpat==5} value="5" selected="selected">対人攻撃特性Lv5</option>
									<option if={user.pvpat==4} value="4" selected="selected">対人攻撃特性Lv4</option>
									<option if={user.pvpat==3} value="3" selected="selected">対人攻撃特性Lv3</option>
									<option if={user.pvpat==2} value="2" selected="selected">対人攻撃特性Lv2</option>
									<option if={user.pvpat==1} value="1" selected="selected">対人攻撃特性Lv1</option>
									<option if={user.pvpat!=10} value="10">対人攻撃特性Lv10</option>
									<option if={user.pvpat!=9} value="9">対人攻撃特性Lv9</option>
									<option if={user.pvpat!=8} value="8">対人攻撃特性Lv8</option>
									<option if={user.pvpat!=7} value="7">対人攻撃特性Lv7</option>
									<option if={user.pvpat!=6} value="6">対人攻撃特性Lv6</option>
									<option if={user.pvpat!=5} value="5">対人攻撃特性Lv5</option>
									<option if={user.pvpat!=4} value="4">対人攻撃特性Lv4</option>
									<option if={user.pvpat!=3} value="3">対人攻撃特性Lv3</option>
									<option if={user.pvpat!=2} value="2">対人攻撃特性Lv2</option>
									<option if={user.pvpat!=1} value="1">対人攻撃特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userpvpdf">
									<option>対人防御特性(平均)</option>
									<option if={user.pvpdf==10} value="10" selected="selected">対人防御特性Lv10</option>
									<option if={user.pvpdf==9} value="9" selected="selected">対人防御特性Lv9</option>
									<option if={user.pvpdf==8} value="8" selected="selected">対人防御特性Lv8</option>
									<option if={user.pvpdf==7} value="7" selected="selected">対人防御特性Lv7</option>
									<option if={user.pvpdf==6} value="6" selected="selected">対人防御特性Lv6</option>
									<option if={user.pvpdf==5} value="5" selected="selected">対人防御特性Lv5</option>
									<option if={user.pvpdf==4} value="4" selected="selected">対人防御特性Lv4</option>
									<option if={user.pvpdf==3} value="3" selected="selected">対人防御特性Lv3</option>
									<option if={user.pvpdf==2} value="2" selected="selected">対人防御特性Lv2</option>
									<option if={user.pvpdf==1} value="1" selected="selected">対人防御特性Lv1</option>
									<option if={user.pvpdf!=10} value="10">対人防御特性Lv10</option>
									<option if={user.pvpdf!=9} value="9">対人防御特性Lv9</option>
									<option if={user.pvpdf!=8} value="8">対人防御特性Lv8</option>
									<option if={user.pvpdf!=7} value="7">対人防御特性Lv7</option>
									<option if={user.pvpdf!=6} value="6">対人防御特性Lv6</option>
									<option if={user.pvpdf!=5} value="5">対人防御特性Lv5</option>
									<option if={user.pvpdf!=4} value="4">対人防御特性Lv4</option>
									<option if={user.pvpdf!=3} value="3">対人防御特性Lv3</option>
									<option if={user.pvpdf!=2} value="2">対人防御特性Lv2</option>
									<option if={user.pvpdf!=1} value="1">対人防御特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="usersweet">
									<option>スイート特性</option>
									<option if={user.sweet==10} value="10" selected="selected">スイート特性Lv10</option>
									<option if={user.sweet==9} value="9" selected="selected">スイート特性Lv9</option>
									<option if={user.sweet==8} value="8" selected="selected">スイート特性Lv8</option>
									<option if={user.sweet==7} value="7" selected="selected">スイート特性Lv7</option>
									<option if={user.sweet==6} value="6" selected="selected">スイート特性Lv6</option>
									<option if={user.sweet==5} value="5" selected="selected">スイート特性Lv5</option>
									<option if={user.sweet==4} value="4" selected="selected">スイート特性Lv4</option>
									<option if={user.sweet==3} value="3" selected="selected">スイート特性Lv3</option>
									<option if={user.sweet==2} value="2" selected="selected">スイート特性Lv2</option>
									<option if={user.sweet==1} value="1" selected="selected">スイート特性Lv1</option>
									<option if={user.sweet!=10} value="10">スイート特性Lv10</option>
									<option if={user.sweet!=9} value="9">スイート特性Lv9</option>
									<option if={user.sweet!=8} value="8">スイート特性Lv8</option>
									<option if={user.sweet!=7} value="7">スイート特性Lv7</option>
									<option if={user.sweet!=6} value="6">スイート特性Lv6</option>
									<option if={user.sweet!=5} value="5">スイート特性Lv5</option>
									<option if={user.sweet!=4} value="4">スイート特性Lv4</option>
									<option if={user.sweet!=3} value="3">スイート特性Lv3</option>
									<option if={user.sweet!=2} value="2">スイート特性Lv2</option>
									<option if={user.sweet!=1} value="1">スイート特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userboss">
									<option>ボス特性</option>
									<option if={user.boss==10} value="10" selected="selected">ボス特性Lv10</option>
									<option if={user.boss==9} value="9" selected="selected">ボス特性Lv9</option>
									<option if={user.boss==8} value="8" selected="selected">ボス特性Lv8</option>
									<option if={user.boss==7} value="7" selected="selected">ボス特性Lv7</option>
									<option if={user.boss==6} value="6" selected="selected">ボス特性Lv6</option>
									<option if={user.boss==5} value="5" selected="selected">ボス特性Lv5</option>
									<option if={user.boss==4} value="4" selected="selected">ボス特性Lv4</option>
									<option if={user.boss==3} value="3" selected="selected">ボス特性Lv3</option>
									<option if={user.boss==2} value="2" selected="selected">ボス特性Lv2</option>
									<option if={user.boss==1} value="1" selected="selected">ボス特性Lv1</option>
									<option if={user.boss!=10} value="10">ボス特性Lv10</option>
									<option if={user.boss!=9} value="9">ボス特性Lv9</option>
									<option if={user.boss!=8} value="8">ボス特性Lv8</option>
									<option if={user.boss!=7} value="7">ボス特性Lv7</option>
									<option if={user.boss!=6} value="6">ボス特性Lv6</option>
									<option if={user.boss!=5} value="5">ボス特性Lv5</option>
									<option if={user.boss!=4} value="4">ボス特性Lv4</option>
									<option if={user.boss!=3} value="3">ボス特性Lv3</option>
									<option if={user.boss!=2} value="2">ボス特性Lv2</option>
									<option if={user.boss!=1} value="1">ボス特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="usermamono">
									<option>魔物特性</option>
									<option if={user.mamono==10} value="10" selected="selected">魔物特性Lv10</option>
									<option if={user.mamono==9} value="9" selected="selected">魔物特性Lv9</option>
									<option if={user.mamono==8} value="8" selected="selected">魔物特性Lv8</option>
									<option if={user.mamono==7} value="7" selected="selected">魔物特性Lv7</option>
									<option if={user.mamono==6} value="6" selected="selected">魔物特性Lv6</option>
									<option if={user.mamono==5} value="5" selected="selected">魔物特性Lv5</option>
									<option if={user.mamono==4} value="4" selected="selected">魔物特性Lv4</option>
									<option if={user.mamono==3} value="3" selected="selected">魔物特性Lv3</option>
									<option if={user.mamono==2} value="2" selected="selected">魔物特性Lv2</option>
									<option if={user.mamono==1} value="1" selected="selected">魔物特性Lv1</option>
									<option if={user.mamono!=10} value="10">魔物特性Lv10</option>
									<option if={user.mamono!=9} value="9">魔物特性Lv9</option>
									<option if={user.mamono!=8} value="8">魔物特性Lv8</option>
									<option if={user.mamono!=7} value="7">魔物特性Lv7</option>
									<option if={user.mamono!=6} value="6">魔物特性Lv6</option>
									<option if={user.mamono!=5} value="5">魔物特性Lv5</option>
									<option if={user.mamono!=4} value="4">魔物特性Lv4</option>
									<option if={user.mamono!=3} value="3">魔物特性Lv3</option>
									<option if={user.mamono!=2} value="2">魔物特性Lv2</option>
									<option if={user.mamono!=1} value="1">魔物特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="userdragon">
									<option>竜特性</option>
									<option if={user.dragon==10} value="10" selected="selected">竜特性Lv10</option>
									<option if={user.dragon==9} value="9" selected="selected">竜特性Lv9</option>
									<option if={user.dragon==8} value="8" selected="selected">竜特性Lv8</option>
									<option if={user.dragon==7} value="7" selected="selected">竜特性Lv7</option>
									<option if={user.dragon==6} value="6" selected="selected">竜特性Lv6</option>
									<option if={user.dragon==5} value="5" selected="selected">竜特性Lv5</option>
									<option if={user.dragon==4} value="4" selected="selected">竜特性Lv4</option>
									<option if={user.dragon==3} value="3" selected="selected">竜特性Lv3</option>
									<option if={user.dragon==2} value="2" selected="selected">竜特性Lv2</option>
									<option if={user.dragon==1} value="1" selected="selected">竜特性Lv1</option>
									<option if={user.dragon!=10} value="10">竜特性Lv10</option>
									<option if={user.dragon!=9} value="9">竜特性Lv9</option>
									<option if={user.dragon!=8} value="8">竜特性Lv8</option>
									<option if={user.dragon!=7} value="7">竜特性Lv7</option>
									<option if={user.dragon!=6} value="6">竜特性Lv6</option>
									<option if={user.dragon!=5} value="5">竜特性Lv5</option>
									<option if={user.dragon!=4} value="4">竜特性Lv4</option>
									<option if={user.dragon!=3} value="3">竜特性Lv3</option>
									<option if={user.dragon!=2} value="2">竜特性Lv2</option>
									<option if={user.dragon!=1} value="1">竜特性Lv1</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control" name="useractivity">
									<option>区分</option>
									<option if={user.activity==1} value="1" selected="selected">アクティブ</option>
									<option if={user.activity==0} value="0" selected="selected">インアクティブ</option>
									<option if={user.activity==-9} value="-9" selected="selected">除名</option>
									<option if={user.activity==-1} value="-1" selected="selected">傭兵</option>
									<option if={user.activity!=1} value="1">アクティブ</option>
									<option if={user.activity!=0} value="0">インアクティブ</option>
									<option if={user.activity!=-9} value="-9">除名</option>
									<option if={user.activity!=-1} value="-1">傭兵</option>
								</select>
							</div>
							<div class="form-group bg-info">
								<h5>入団日(選択して下さい)</h5>
								<div class='input-group date' id='joinddate'/>
							</div>
							<botton class="btn btn-success" onclick="onclickRegister(this, '{user.ID}', '{user.name}')">登録</botton>
							<botton if={user.ID!='' && 'on'!= getParams['view']} class="btn btn-danger" onclick="onclickUnregister(this, '{user.ID}')">削除</botton>
						</form>
					</div>
					var user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: '', meteo: 0, dzone: null, acce1: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '',};
					this.on('mount', function() {
						//$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00",});
						auth(false, function (clan) {
							if ('#modifyuser' == location.hash && 'undefined' != typeof getParams['userid'] && 0 < getParams['userid'].length) {
								// modifyモード
								getUser(getParams['userid'], function(user) {
									this.user = user;
									$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00", defaultDate: user.joind, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.user = user;
								$('#joinddate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00"});
								riot.update();
							}
						});
					});
				</adduser>
			</script>

			<script type="riot/tag">
				<addschedule>
					<div style="padding: 10px;">
						<h4 if={'on'==getParams['view']}>{schedule.date}<h4/>
						<h4 if={'on'==getParams['view']}>{schedule.name}<h4/>
						<h4 if={'#detailschedule' == location.hash && schedule.type!=1}>参加予定: {schedule.incount} 人<h4/>
						<form id="addscheduleform">
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="schedulename" value="{schedule.name}" class="form-control" placeholder="予定内容"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<input type="text" name="scheduletag" value="{schedule.tag}" class="form-control" placeholder="#要塞戦"/>
									<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
								</div>
							</div>
							<div class="form-group bg-info">
								<h5>予定日時(選択して下さい)</h5>
								<div class='input-group date' id='scheduledate'/>
							</div>
							<div class="form-group">
								<select class="form-control" name="scheduletype">
									<option value="0">出欠確認アリ</option>
									<option if={schedule.type!=1} value="1">出欠確認不要(予定のみ)</option>
									<option if={schedule.type==1} value="1" selected="selected">出欠確認不要(予定のみ)</option>
								</select>
							</div>
							<div class="form-check">
								<input if={schedule.autoReset==true} type="checkbox" name="scheduleautoreset" value="1"  class="form-check-input" id="scheduleautoreset" checked="checked"/>
								<input if={schedule.autoReset!=true} type="checkbox" name="scheduleautoreset" value="1"  class="form-check-input" id="scheduleautoreset"/>
								<label class="form-check-label" for="scheduleautoreset">自動リセットを有効</label>
								<br/>
								<small>※毎週同じ予定を開催する場合に有効です。</small>
								<br/>
								<small>※この機能を利用する為には<a href="https://t.co/3CE3BIYqcV" target="_blank">"エリカ様Bot"</a>の導入が必要です！</small>
								<br/>
								<br/>
							</div>
							<input type="hidden" name="scheduleincount" value="{schedule.incount}" id='scheduleincount'/>
							<botton class="btn btn-success" onclick="onclickRegisterSchedule(this, '{schedule.ID}')">登録</botton>
							<botton if={'#detailschedule' != location.hash} class="btn btn-danger" onclick="onclickRegisterSchedule(this, '{schedule.ID}', true)">登録(同一タグの前回のPT編成をコピー)</botton>
						</form>
						<br/>
						<br/>
						<br/>
					</div>
					var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, type: 0, autoReset: null, };
					this.on('mount', function() {
						if ('on'==getParams['view']) {
							$('#addscheduleform').hide();
						}
						auth(false, function (clan) {
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								// modifyモード
								getSchedule(getParams['scheduleid'], function(schedule) {
									this.schedule = schedule;
									$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, defaultDate: schedule.date, });
									riot.update();
								});
							}
							else {
								// 初期化
								this.schedule = schedule;
								$('#scheduledate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, });
								riot.update();
							}
						});
					});
				</addschedule>
			</script>

			<script type="riot/tag">
				<party>
					<div style="position: fixed; top: 5px;">
						<h5 style="margin-top: 0; margin-bottom: 5px; padding-left: 5px;"><a href="{scheduleURL}">PT編成 {partySchedule.date} {partySchedule.name} 参加予定:{partySchedule.incount}人</a>&nbsp;&nbsp;&nbsp;<a href="{clan.url}">[ 血盟コミュに戻る ]</a></h5>
						<div class="row">
							<table class="table border">
								<tr each="{party, index in parties}">
									<td if={'undefined' != typeof pusers} each="{pusers, pindex in party}" style="padding: 0; border: none;">

												<table class="table table-striped"style="overflow: hidden; margin-bottom: 0px;">
													<tr if={pusers[0].party==49 || pusers[0].party==99} style="color: black; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">1A</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==48} style="color: black; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">1B</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==39 || pusers[0].party==89} style="background-color: dodgerblue; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">2A</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">聖刻</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==38} style="background-color: blue; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">2B</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">偵察</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==37} style="background-color: navy; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">封殺</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==29 || pusers[0].party==79} style="background-color: limegreen; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">3A</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==28} style="border: none; background-color: green; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">3B</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==27} style="border: none; background-color: darkgreen; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">FW3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==19 || pusers[0].party==69} style="border: none; background-color: gold; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">4A</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==18} style="border: none; background-color: orange; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">4B</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==17} style="border: none; background-color: darkorange; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">MF3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==9 || pusers[0].party==59} style="border: none; background-color: red; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">5A</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF1</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==8} style="border: none; background-color: crimson; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">5B</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF2</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==7} style="border: none; background-color: firebrick; color: white; font-size: 8px;">
														<th if={ -1 < partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">&nbsp;</th>
														<th if={ 0 > partySchedule.tag.indexOf('レイド')} style="border: none; width:100px; padding: 5px;">DF3</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr if={pusers[0].party==0} style="border: none; background-color: gray; color: white; font-size: 8px;">
														<th style="border: none; width:100px; padding: 5px;">欠席</th>
														<th style="border: none;"></th>
														<th style="border: none; width:25px;"></th>
													</tr>
													<tr each="{puser, uindex in pusers}" style="border: none;" class="activity{puser.activity}">
														<td if={puser.status==2} class="text-info" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 30px;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</td>
														<td if={puser.status==1} class="text-success" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 30px;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</td>
														<td if={puser.status==-1} class="text-danger" style="font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 30px;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</td>
														<td if={puser.entry!=1 && puser.status!=-1 && puser.status!=2 && puser.status!=1} style="color: orange; font-weight: bolder; border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 30px;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</td>
														<td if={puser.entry==1 && puser.status!=-1 && puser.status!=2 && puser.status!=1} style="border: none; padding: 5px; padding-left: 3px; padding-right: 0; border-left: 1px solid gray; height: 30px;"><i if={puser.voice==1} class="fas fa-microphone"></i><i if={puser.voice==2} class="fas fa-microphone-slash"></i> {puser.name}</td>
														<td style="overflow: hidden; border: none; padding: 5px; border-left: 1px solid gray; text-align: right;">{puser.cp}</td>
														<td if={jobbufs[puser.job]=='攻撃'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: firebrick;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={jobbufs[puser.job]=='クリ'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: orange;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={jobbufs[puser.job]=='防御'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: blue;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={jobbufs[puser.job]=='移動'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: green;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={jobbufs[puser.job]=='命中'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: dodgerblue;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={jobbufs[puser.job]=='HP'} class="jobimage" style="border: none; padding: 5px; padding-left: 3px; background-color: deeppink;"><img src="{jobimages[puser.job]}" title="{puser.job}" alt="{puser.job}" width="20" height="18"/><p if={1 == puser.job3d}>3d</p></td>
														<td if={'undefined' == typeof jobbufs[puser.job]} style="border: none; padding: 5px; background-color: gray;">&nbsp;</td>
													</tr>
													<tr if={'on'!=getParams['view']} class="partycp" style="padding: 0; border: solid 1px gray; border-top: solid 1px #ddd; border-bottom: solid 1px #ddd; background-color: white; text-align: right; height: 20px;">
														<td colspan="2" style="border: none; padding: 2px;"><b>{partyCPs[((index-1)*5)+pindex].toLocaleString()}</b></td><td style="padding: 0;">&nbsp;</td>
													</tr>
												</table>

									</td>
								</tr>
							</table>

						</div>
					</div>
					var scheduleURL = '';
					var partySchedule = {name:'', date: '', incount: 0, autoReset: null, };
					var parties = [];
					var partyCPs = [];
					this.on('unmount', function() {
						$('donation').show();
						$('footer').show();
					});
					this.on('mount', function() {
						$('donation').hide();
						$('footer').hide();
						var viewGrid = function (schedule, data) {
							if (-1 < schedule.tag.indexOf('レイド')) {
								for (var pidx=0; pidx < data.length; pidx++) {
									if (0 == (data[pidx].party + 1) % 10) {
										data[pidx].party = data[pidx].party + 50;
									}
								}
								// PTで並べ直し
								data.sort(function(a, b){
									if( a.party > b.party ) {
										return -1;
									}
									if( a.party < b.party ) {
										return 1;
									}
									return 0;
								});
								console.log(data);
							}
							data.sort(function(a, b){
								if( 'undefined' == typeof a.status  ) {
									a.status = 0;
								}
								if( 'undefined' == typeof b.status  ) {
									b.status = 0;
								}
								if( a.party >= b.party ) {
									if( a.status > b.status ) {
										return -1;
									}
									if( a.status <= b.status ) {
										return 1;
									}
								}
								return 0;
							});
							this.scheduleURL = '?clanid=' + clan.ID + '&scheduleid=' + schedule.ID + '#detailschedule';
							if ('on' == getParams['view']) {
									this.scheduleURL = this.scheduleURL.replace('#detailschedule', '&view=on#detailschedule')
							}
							this.partySchedule = schedule;
							this.parties = parties;
							this.partyCPs = partyCPs;
							var rowCnt = 0;
							var partyCnt = 0;
							var beforeParty = -1;
							this.parties[rowCnt] = [];
							this.partyCPs[partyCnt] = 0;
							for (var pidx=0; pidx < data.length; pidx++) {
								if (beforeParty != data[pidx].party) {
									if (0 < partyCnt && 5 > this.parties[rowCnt][partyCnt-1].length) {
										var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
										for (var mpidx=0; mpidx < paddingLen; mpidx++) {
											var emptyUser = {name: '　', cp: '　',};
											this.parties[rowCnt][partyCnt-1].push(emptyUser);
										}
									}
									partyCnt++;
									if (0 < partyCnt && 0 == (partyCnt-1)%5) {
										rowCnt++;
									}
									if ('undefined' == typeof this.parties[rowCnt]) {
										this.parties[rowCnt] = [];
									}
									if ('undefined' == typeof this.parties[rowCnt][partyCnt-1]) {
										this.parties[rowCnt][partyCnt-1] = [];
										this.partyCPs[partyCnt-1] = 0;
									}
								}
								this.parties[rowCnt][partyCnt-1].push(data[pidx]);
								this.partyCPs[partyCnt-1] += parseInt(data[pidx].cp);
								beforeParty = data[pidx].party;
							}
							if (0 < partyCnt && 5 > this.parties[rowCnt][partyCnt-1].length) {
								var paddingLen = 5 - this.parties[rowCnt][partyCnt-1].length;
								for (var mpidx=0; mpidx < paddingLen; mpidx++) {
									var emptyUser = {name: '　', cp: '　',};
									this.parties[rowCnt][partyCnt-1].push(emptyUser);
								}
							}
							console.log(this.partyCPs);
							riot.update();
						};
						if (partyUsers != null && 'undefined' != typeof partyUsers.length) {
							partyUsers.sort(function(a, b){
								if( parseInt(a.cp) > parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return 1;
								return 0;
							});
							partyUsers.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
							viewGrid(schedule, partyUsers);
						}
						else {
							auth(false, function (clan) {
								// APIからデータを撮ってくる
								getSchedule(getParams['scheduleid'], function(schedule) {
									getScheduleUsers(getParams['scheduleid'], null, function(entryOKUsers) {
										viewGrid(schedule, entryOKUsers);
									});
								});
							});
						}
					});
				</party>
			</script>

			<script type="riot/tag">
				<detailschedule>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div if={schedule.type!=1} style="padding-left: 10px; padding-right: 10px;">
									<h3>参加登録</h3>
									<form id="entryscheduleform">
										<div class="form-group">
											<select class="form-control" name="scheduleuser">
												<option value="-1">参加キャラ</option>
												<option each="{_user, index in selectusers_}" value={index} data={_user.name}>{_user.outlabel}{_user.name}</option>
											</select>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="schedulecomment" class="form-control" placeholder="コメント(任意 希望配置とかあれば)"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<input type="hidden" name="scheduleparty" class="form-control" value="0"/>
											<div class="btn-group">
												<botton class="btn btn-success" onclick="{onEntryOK}">◯</botton>
												<botton class="btn btn-warning" onclick="{onEntryMaybe}">△</botton>
												<botton class="btn btn-danger" onclick="{onEntryNG}">✕</botton>
											</div>
										</div>
										<div if={'on'!=getParams['view']}>
											<h4 if={-1 < schedule.tag.indexOf('レイド')}>
												レイドPT設定
												<small style="font-size: xx-small;">
													<br/>
													※レイドボス一覧で上から1,2,3と勘定するのが理想です
												</small>
											</h4>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-default" disabled="disabled"><b>ボス1</b></botton>
													<botton class="btn btn-default" onclick="{onEntryPT}" data-party="49">1A</botton>
													<botton class="btn btn-default" onclick="{onEntryPT}" data-party="48">1B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
												<botton class="btn btn-info" disabled="disabled"><b>ボス2</b></botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="39">2A</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="38">2B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-success" disabled="disabled"><b>ボス3</b></botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="29">3A</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="28">3B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-warning" disabled="disabled"><b>ボス4</b></botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="19">4A</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="18">4B</botton>
												</div>
											</div>
											<div if={-1 < schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger" disabled="disabled"><b>ボス5</b></botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="9">5A</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="8">5B</botton>
												</div>
											</div>
											<h4 if={0 > schedule.tag.indexOf('レイド')}>PT設定</h4>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="39">聖刻</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="38">偵察</botton>
													<botton class="btn btn-info" onclick="{onEntryPT}" data-party="37">封殺</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="29">FW1</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="28">FW2</botton>
													<botton class="btn btn-success" onclick="{onEntryPT}" data-party="27">FW3</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="19">MF1</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="18">MF2</botton>
													<botton class="btn btn-warning" onclick="{onEntryPT}" data-party="17">MF3</botton>
												</div>
											</div>
											<div if={0 > schedule.tag.indexOf('レイド')} class="form-group">
												<div class="btn-group">
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="9">DF1</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="8">DF2</botton>
													<botton class="btn btn-danger" onclick="{onEntryPT}" data-party="7">DF3</botton>
												</div>
											</div>
										</div>
									</form>
								</div>
								<h3 style="margin-left: 10px; margin-bottom: -10px;">予定詳細</h3>
								<addschedule/>
							</div>
						</div>
						<div class="col-xs-8">
							<div if={schedule.type!=1} class="container-fluid">
								<h3 style="padding-left: 10px;">参加者一覧 <small><a href="javascript: void(0);" onclick="{showPT}">[PT表]</a></small></h3>
								<div style="width: 150px; margin-top: -50px; margin-left: auto; margin-right: 10px; margin-bottom: 5px;">
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: firebrick;">&nbsp;前衛&nbsp;{attckAssistans}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: orange;">&nbsp;魔攻&nbsp;{criticalAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: blue;">&nbsp;盾職&nbsp;{defenseAssistans}</span>
									<br style="clear: both;"/>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: green;">&nbsp;短剣&nbsp;{moveAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: dodgerblue;">&nbsp;弓職&nbsp;{hitAssistants}</span>
									<span style="font-size: 12px; display: block; width: 50px; float: left; padding: 2px; padding-top: 3px; color: white; background-color: deeppink;">&nbsp;回復&nbsp;{healAssistans}</span>
									<br style="clear: both;"/>
								</div>
								<users if={-1 < schedule.tag.indexOf('レイド')} data='{scheduleusers}' mode='schedule' submode='bossraid'/>
								<users if={-1 < schedule.tag.indexOf('要塞') || -1 < schedule.tag.indexOf('攻城')} data='{scheduleusers}' mode='schedule' submode='gvg'/>
								<users if={0 > schedule.tag.indexOf('レイド') && 0 > schedule.tag.indexOf('要塞') && 0 > schedule.tag.indexOf('攻城')} data='{scheduleusers}' mode='schedule'/>
							</div>
							<div if={schedule.type!=1 && 'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>未表明者一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th style="width:80px;">未表明キャラ</th>
												<th style="width:100px;">discordタグ</th>
												<th>メモ</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{_outuser, index in outusers}" >
												<td class="action"><botton class="btn btn-danger" onclick="onclickNotify(this, '{_outuser.name}', '{_outuser.discord}');">催促</botton></td>
												<td onclick="onclickModify(this, '{_outuser.ID}');"><strong class="scheduleusername">{_outuser.name}</strong></td>
												<td onclick="onclickModify(this, '{_outuser.ID}');" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;"><strong class="danger">{_outuser.discord}</strong></td>
												<td onclick="onclickDetail(this, '{_outuser.ID}');" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;">{_outuser.memo}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>同一タグお知らせ一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<br/>
													<br/>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');">修正</botton>
												</td>
												<td class="newstext" style="width: 34px; font-size: 5px;"><pre>{news.text}</pre></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					var attckAssistans = 0;
					var criticalAssistants = 0;
					var defenseAssistans = 0;
					var moveAssistants = 0;
					var hitAssistants = 0;
					var healAssistans = 0;

					var selectusers = [];
					var scheduleusers = [];
					var outusers = [];
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getUsers(clan.ID, false, function(users) {
								thisis.selectusers = users;
								getScheduleUsers(getParams['scheduleid'], null, function(scheduleusers) {
									thisis.attckAssistans = attckAssistans;
									thisis.criticalAssistants = criticalAssistants;
									thisis.defenseAssistans = defenseAssistans;
									thisis.moveAssistants = moveAssistants;
									thisis.hitAssistants = hitAssistants;
									thisis.healAssistans = healAssistans;
									var inuser = [];
									var outuser = [];
									thisis.outusers = [];
									scheduleusers.sort(function(a, b){
										if( 'undefined' == typeof a.status  ) {
											a.status = 0;
										}
										if( 'undefined' == typeof b.status  ) {
											b.status = 0;
										}
										if( a.party >= b.party ) {
											if( a.status > b.status ) {
												return -1;
											}
											if( a.status <= b.status ) {
												return 1;
											}
										}
										return 0;
									});
									thisis.scheduleusers = scheduleusers;
									var inLoop = 0;
									for (var uidx=0; uidx < thisis.selectusers.length; uidx++) {
										var entryed = false;
										thisis.selectusers[uidx].outlabel = '未表明:';
										for (var suidx=0; suidx < thisis.scheduleusers.length; suidx++) {
											if (thisis.selectusers[uidx].ID == thisis.scheduleusers[suidx].ID){
												// 最新パラメータのコピー
												thisis.scheduleusers[suidx].cp = parseInt(thisis.selectusers[uidx].cp);
												thisis.scheduleusers[suidx].job3d = thisis.selectusers[uidx].job3d;
												thisis.scheduleusers[suidx].acce1 = parseInt(thisis.selectusers[uidx].acce1);
												thisis.scheduleusers[suidx].bukicos = thisis.selectusers[uidx].bukicos;
												thisis.scheduleusers[suidx].meteo = thisis.selectusers[uidx].meteo;
												thisis.scheduleusers[suidx].dzone = thisis.selectusers[uidx].dzone;
												thisis.scheduleusers[suidx].manto = thisis.selectusers[uidx].manto;
												thisis.scheduleusers[suidx].pvpat = thisis.selectusers[uidx].pvpat;
												thisis.scheduleusers[suidx].pvpdf = thisis.selectusers[uidx].pvpdf;
												thisis.scheduleusers[suidx].sweet = thisis.selectusers[uidx].sweet;
												thisis.scheduleusers[suidx].mamono = thisis.selectusers[uidx].mamono;
												thisis.scheduleusers[suidx].dragon = thisis.selectusers[uidx].dragon;
												thisis.scheduleusers[suidx].boss = thisis.selectusers[uidx].boss;
												thisis.scheduleusers[suidx].activity = thisis.selectusers[uidx].activity;
												thisis.selectusers[uidx].outlabel = '';
												if (thisis.selectusers[uidx].activity == -9) {
													thisis.selectusers[uidx].outlabel = '除名:';
												}
												thisis.selectusers[uidx].entry = thisis.scheduleusers[suidx].entry;
												thisis.selectusers[uidx].party = thisis.scheduleusers[suidx].party;
												if ('undefined' != typeof thisis.scheduleusers[suidx].status) {
													thisis.selectusers[uidx].status = thisis.scheduleusers[suidx].status;
												}
												if ('undefined' != typeof thisis.scheduleusers[suidx].voice) {
													thisis.selectusers[uidx].voice = thisis.scheduleusers[suidx].voice;
												}
												if (inLoop < thisis.scheduleusers.length) {
													// 種別振り分けは一度すれば十分
													if (jobbufs[thisis.scheduleusers[suidx].job]=='攻撃') {
														thisis.attckAssistans++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='クリ') {
														thisis.criticalAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='防御') {
														thisis.defenseAssistans++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='移動') {
														thisis.moveAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='命中') {
														thisis.hitAssistants++;
													}
													if (jobbufs[thisis.scheduleusers[suidx].job]=='HP') {
														thisis.healAssistans++;
													}
													inLoop++;
												}
												inuser.push(thisis.selectusers[uidx]);
												entryed = true;
											}
										}
										if (false == entryed && thisis.selectusers[uidx].activity < 0) {
											thisis.selectusers[uidx].outlabel = '';
											if (thisis.selectusers[uidx].activity == -1) {
												thisis.selectusers[uidx].outlabel = '傭兵:';
											}
											inuser.push(thisis.selectusers[uidx]);
											entryed = true;
										}
										if (false === entryed) {
											outuser.push(thisis.selectusers[uidx]);
										}
									}
									if (0 < outuser.length) {
										thisis.outusers = outuser;
										thisis.selectusers = inuser;
										var length = outuser.length;
										for (var oIdx=0; oIdx < length; oIdx++) {
											thisis.selectusers.unshift(outuser[oIdx]);
										}
										// XXX バグ対応の暫定処理
										selectusers_ = thisis.selectusers;
										thisis.selectusers_ = selectusers_;
									}
									else {
										thisis.selectusers_ = thisis.selectusers;
									}
									$('#addscheduleform input[name=scheduletag]').ready(function (){
										if ($('#partylist') && 0 < $('#partylist').size() && 'iOS' != platform.os.family && 'Android' != platform.os.family && 'Windows Phone' != platform.os.family) {
											// XXX PCのみドラッグアンドドロップソートを有効にする
											Sortable.create( document.getElementById('partylist'),
												{
													tag: 'tr',
													/*handle: '. draggable',*/
												  onUpdate: function(e) {
														console.log(e);
														console.log(e.newIndex);
														var to = $($('#partylist tr')[e.newIndex-1]).find('.scheduleparty');
														var from  = $($('#partylist tr')[e.newIndex]).find('.scheduleparty');
														var next = $($('#partylist tr')[e.newIndex+1]).find('.scheduleparty');
														var dataindex = parseInt($($('#partylist tr')[e.newIndex]).attr('index'));
														console.log(dataindex);
														console.log(to);
														console.log(from);
														console.log(next);
														if (!to.text()) {
															to = next;
														}
														var scheduleusername = from.parent().find('.scheduleusername').text();
														var schedulecomment = from.parent().find('.schedulecomment').text();
														var scheduleparty = to.data();
														var scheduleuserindex = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + scheduleusername + '"]').val();
														if (scheduleparty.party == thisis.selectusers_[scheduleuserindex].party) {
															// PT変わってないので無視
															return;
														}
														console.log(scheduleuserindex);
														var scheduleuser = thisis.selectusers_[scheduleuserindex];
														scheduleuser.party = scheduleparty.party;
														thisis.scheduleusers[dataindex].party = parseInt(scheduleparty.party);
														console.log(thisis.selectusers_);
														var entryCnt = 0;
														for (var eIdx=0; eIdx < thisis.scheduleusers.length; eIdx++) {
															if ('undefined' != typeof thisis.scheduleusers[eIdx].party && scheduleuser.party == thisis.scheduleusers[eIdx].party && 0 < parseInt(scheduleuser.party)) {
																entryCnt++;
																if (5 < entryCnt) {
																	alert('このPTは既に5人編成済みですが処理そのまま保存されますのでご注意下さい！');
																	break;
																}
															}
														}
														from.data(to.data());
														from.text(to.text());
														from.attr('data-party', scheduleparty.party);
														if (1 > thisis.scheduleusers[dataindex].party) {
															var target = from.parent().find('.scheduleuserstatus');
															console.log('target=');
															console.log(target);
															$(target).removeClass('bg-info');
															$(target).removeClass('bg-success');
															$(target).removeClass('bg-danger');
															$(target).removeClass('text-info');
															$(target).removeClass('text-success');
															$(target).removeClass('text-danger');
															$(target).attr('propaty', 0);
															$(target).text('');
															thisis.scheduleusers[dataindex].status = 0;
														}
														loading(true);
														registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
															loading(false);
														});
														return false;
													}
												}
											);
										}
										var tag = $('#addscheduleform input[name=scheduletag]').val();
										if ('undefined' != typeof tag && 0 < tag.length) {
											getNews(clan.ID, tag, function (newses) {
												thisis.newses = newses;
												riot.update();
											});
										}
										else {
											riot.update();
										}
									});
								});
							});
						});
						dispatchPortlateLayout();
					});
					showPT = function () {
						//partyUsers = thisis.scheduleusers;
						var newhref = '?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#party';
						if ('on' == getParams['view']) {
								newhref = newhref.replace('#party', '&view=on#party')
						}
						location.href = newhref;
					};
					onEntryOK = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = 1;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryMaybe = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = 0;
						if ('undefined' == typeof scheduleuser.party) {
							scheduleuser.party = parseInt($('#entryscheduleform').find('input[name=scheduleparty]').val());
						}
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						else if (!confirm('条件付きで参加可の場合コメントにその条件を明記して\n予定の管理者にその旨を伝えましょう！\n無視して登録を続ける場合はOKを押して下さい。')){
							return;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					onEntryNG = function () {
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
						if (0 > parseInt(index)) {
							alert('参加キャラを選択して下さい。');
							return;
						}
						var scheduleuser = thisis.selectusers_[index];
						scheduleuser.entry = -1;
						scheduleuser.status = 0;
						scheduleuser.party = 0;
						scheduleuser.voice = 0;
						scheduleuser.comment = '';
						var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
						if (0 < comment.length && comment != '同一タグの前回のPT編成をコピー') {
							scheduleuser.comment = comment;
						}
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
								$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
									onclickRegisterSchedule(null, getParams['scheduleid']);
								});
							});
						});
					};
					switchType = function (target, propaty) {
						var now = $(target).attr('propaty');
						if ('status' == propaty) {
							next = parseInt(now) - 1;
							if (-1 > next) {
								next = 2;
							}
						}
						else {
							next = parseInt(now) + 1;
							if (2 < next) {
								next = -1;
							}
						}
						var scheduleusername = $(target).parent().find('.scheduleusername').text();
						var index = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + scheduleusername + '"]').val();
						var scheduleuser = thisis.selectusers_[index];
						if ('undefined' == typeof scheduleuser.entry) {
							alert('出欠登録を先にする必要があります。');
							return;
						}
						if ('status' == propaty) {
							if (0 > parseInt(scheduleuser.entry)) {
								alert('欠席予定の方のステータスを変更する事は出来ません。');
								return;
							}
							if ('undefined' == typeof scheduleuser.party) {
								alert('PTに入っていない方のステータスを変更する事は出来ません。');
								return;
							}
							if (0 >= parseInt(scheduleuser.party)) {
								alert('PTに入っていない方のステータスを変更する事は出来ません。');
								return;
							}
							scheduleuser.status = next;
						}
						scheduleuser[propaty] = next;
						loading(true);
						registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
							if ('status' == propaty) {
								$(target).removeClass('bg-info');
								$(target).removeClass('bg-success');
								$(target).removeClass('bg-danger');
								$(target).removeClass('text-info');
								$(target).removeClass('text-success');
								$(target).removeClass('text-danger');
								if (2 == next) {
									$(target).addClass('bg-info');
									$(target).addClass('text-info');
									$(target).attr('propaty', next);
									$(target).text('リダ');
								}
								else if (1 == next) {
									$(target).addClass('bg-success');
									$(target).addClass('text-success');
									$(target).attr('propaty', next);
									$(target).text('サブ');
								}
								else if (-1 == next) {
									$(target).addClass('bg-danger');
									$(target).addClass('text-danger');
									$(target).attr('propaty', next);
									$(target).text('急欠');
								}
								else {
									$(target).attr('propaty', next);
									$(target).text('');
								}
							}
							else if ('voice' == propaty) {
								$(target).removeClass('bg-success');
								if (1 == next) {
									$(target).addClass('bg-info');
									$(target).removeClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').addClass('fa-microphone');
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').text('');
								}
								else if (2 == next) {
									$(target).removeClass('bg-info');
									$(target).addClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').addClass('fa-microphone-slash');
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').text('');
								}
								else if (-1 == next) {
									$(target).removeClass('bg-success');
									$(target).removeClass('bg-info');
									$(target).attr('propaty', next);
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').text('✕');
								}
								else {
									$(target).removeClass('bg-info');
									$(target).removeClass('bg-success');
									$(target).attr('propaty', next);
									$(target).find('i.fas').removeClass('fa-microphone-slash');
									$(target).find('i.fas').removeClass('fa-microphone');
									$(target).find('i.fas').text('');
								}
							}
							thisis.selectusers_[index] = scheduleuser;
							loading(false);
						});
					}
					onEntryPT = function (target) {
						var partyData = $(target.srcElement).data();
						if ('undefined' != typeof partyData && 'undefined' != typeof partyData.party && 0 < parseInt(partyData.party)){
							var index = $('#entryscheduleform').find('select[name=scheduleuser] option:selected').val();
							if (0 > parseInt(index)) {
								alert('参加キャラを選択して下さい。');
								return;
							}
							var scheduleuser = thisis.selectusers_[index];
							if ('undefined' == typeof scheduleuser.entry) {
								alert('出欠登録を先にする必要があります。');
								return;
							}
							if (0 > parseInt(scheduleuser.entry)) {
								alert('欠席予定の方をPTに入れる事は出来ません。');
								return;
							}
							scheduleuser.comment = '';
							var comment = $('#entryscheduleform').find('input[name=schedulecomment]').val();
							if (0 < comment.length) {
								scheduleuser.comment = comment;
							}
							var uIdx = 0;
							var bufDuplicated = false;
							var jobDuplicated = false;
							var entryCnt = 0;
							for (var eIdx=0; eIdx < thisis.scheduleusers.length; eIdx++) {
								if ('undefined' != typeof thisis.scheduleusers[eIdx].party && partyData.party == thisis.scheduleusers[eIdx].party) {
									entryCnt++;
									if (scheduleuser.job == thisis.scheduleusers[eIdx].job) {
										jobDuplicated = true;
										bufDuplicated = false;
									}
									if (false == jobDuplicated && 'undefined' != jobbufs[scheduleuser.job] && 'undefined' != typeof jobbufs[thisis.scheduleusers[eIdx].job] && jobbufs[scheduleuser.job] == jobbufs[thisis.scheduleusers[eIdx].job]) {
										bufDuplicated = true;
									}
									if (5 <= entryCnt) {
										alert('このPTは既に5人編成済みです。');
										return;
										break;
									}
								}
								if (scheduleuser.name == thisis.scheduleusers[eIdx].name) {
									uIdx = eIdx;
								}
							}
							if (jobDuplicated) {
								if (!confirm('同じ職種のキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							if (bufDuplicated) {
								if (!confirm('同種PTバフのキャラが既にPTに居ますが登録しますか？')) {
									return;
								}
							}
							scheduleuser.party = partyData.party;
							thisis.scheduleusers[uIdx].party = partyData.party;
							var targetElm = $('#partylist tr[index="'+uIdx+'"] .scheduleparty');
							targetElm.data(partyData);
							targetElm.text($(target.srcElement).text());
							targetElm.attr('data-party', partyData.party);
							loading(true);
							registerScheduleuser(getParams['scheduleid'], scheduleuser, function (){
								loading(false);
								/*getScheduleUsers(getParams['scheduleid'], true, function(entryOKUsers) {
									$('#addscheduleform').find('input[name=scheduleincount]').val(entryOKUsers.length).ready(function (){
										onclickRegisterSchedule(null, getParams['scheduleid']);
									});
								});*/
							});
						}
					};
				</detailschedule>
			</script>

			<script type="riot/tag">
				<addnews>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ登録</h3>
									<form id="editnewsform">
										<div class="form-group">
											<textarea class="form-control" name="newstext" placeholder="【周知】木曜22時はギロフェスです！" rows="3">{news.text}</textarea>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newstag" class="form-control" placeholder="#要塞戦"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
											<small style="font-size: xx-small;">
												予定とタグで連動した場合、お知らせテキストには予定の情報を変数で利用できます
												<br/>
												【利用可能な変数】
												<br/>
												***urlview*** (参加者(閲覧者)用の予定のURL)
												<br/>
												***ptview*** (参加者(閲覧者)用のPT編成URL)
												<br/>
												***url*** (予定のURL)
												<br/>
												***pt*** (予定の(参加者用では無い)PT編成URL)
												<br/>
												***date*** (予定日時)
												<br/>
												***title*** (予定名)
											</small>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="text" name="newsid" class="form-control" placeholder="任意:空欄は新規登録"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<br/>
										<h4>お知らせの自動通知設定</h4>
										<small style="font-size: xx-small;">
											※デフォルトは同じタグで設定された予定と連動した通知になっています
											<br/>
											設定を変えた場合、予定とは連動せずに独立して通知されます。
										</small>
										<div class="form-group">
											<select class="form-control" name="newsnotifymode">
												<option value="">同じタグの予定と連動(3日前から0時頃に通知)</option>
												<option if={user.newsnotifymode==1} value="1" selected="selected">毎日通知</option>
												<option if={user.newsnotifymode!=1} value="1">毎日通知</option>
												<option if={user.newsnotifymode==11} value="11" selected="selected">毎週日曜通知</option>
												<option if={user.newsnotifymode!=11} value="11">毎週日曜通知</option>
												<option if={user.newsnotifymode==12} value="12" selected="selected">毎週月曜通知</option>
												<option if={user.newsnotifymode!=12} value="12">毎週月曜通知</option>
												<option if={user.newsnotifymode==13} value="13" selected="selected">毎週火曜通知</option>
												<option if={user.newsnotifymode!=13} value="13">毎週火曜通知</option>
												<option if={user.newsnotifymode==14} value="14" selected="selected">毎週水曜通知</option>
												<option if={user.newsnotifymode!=14} value="14">毎週水曜通知</option>
												<option if={user.newsnotifymode==15} value="15" selected="selected">毎週木曜通知</option>
												<option if={user.newsnotifymode!=15} value="15">毎週木曜通知</option>
												<option if={user.newsnotifymode==16} value="16" selected="selected">毎週金曜通知</option>
												<option if={user.newsnotifymode!=16} value="16">毎週金曜通知</option>
												<option if={user.newsnotifymode==17} value="17" selected="selected">毎週土曜通知</option>
												<option if={user.newsnotifymode!=17} value="17">毎週土曜通知</option>
											</select>
										</div>
										<div class="form-group">
											<select class="form-control" name="newsnotifytime">
												<option if={user.newsnotifytime==24} value="24" selected="selected">0時頃</option>
												<option if={user.newsnotifytime!=24} value="24">0時頃</option>
												<option if={user.newsnotifytime==23} value="23" selected="selected">23時頃</option>
												<option if={user.newsnotifytime!=23} value="23">23時頃</option>
												<option if={user.newsnotifytime==22} value="22" selected="selected">22時頃</option>
												<option if={user.newsnotifytime!=22} value="22">22時頃</option>
												<option if={user.newsnotifytime==21} value="21" selected="selected">21時頃</option>
												<option if={user.newsnotifytime!=21} value="21">21時頃</option>
												<option if={user.newsnotifytime==20} value="20" selected="selected">20時頃</option>
												<option if={user.newsnotifytime!=20} value="20">20時頃</option>
												<option if={user.newsnotifytime==19} value="19" selected="selected">19時頃</option>
												<option if={user.newsnotifytime!=19} value="19">19時頃</option>
												<option if={user.newsnotifytime==18} value="18" selected="selected">18時頃</option>
												<option if={user.newsnotifytime!=18} value="18">18時頃</option>
												<option if={user.newsnotifytime==17} value="17" selected="selected">17時頃</option>
												<option if={user.newsnotifytime!=17} value="17">17時頃</option>
												<option if={user.newsnotifytime==16} value="16" selected="selected">16時頃</option>
												<option if={user.newsnotifytime!=16} value="16">16時頃</option>
												<option if={user.newsnotifytime==15} value="15" selected="selected">15時頃</option>
												<option if={user.newsnotifytime!=15} value="15">15時頃</option>
												<option if={user.newsnotifytime==14} value="14" selected="selected">14時頃</option>
												<option if={user.newsnotifytime!=14} value="14">14時頃</option>
												<option if={user.newsnotifytime==13} value="13" selected="selected">13時頃</option>
												<option if={user.newsnotifytime!=13} value="13">13時頃</option>
												<option if={user.newsnotifytime==12} value="12" selected="selected">12時頃</option>
												<option if={user.newsnotifytime!=12} value="12">12時頃</option>
												<option if={user.newsnotifytime==11} value="11" selected="selected">11時頃</option>
												<option if={user.newsnotifytime!=11} value="11">11時頃</option>
												<option if={user.newsnotifytime==10} value="10" selected="selected">10時頃</option>
												<option if={user.newsnotifytime!=10} value="10">10時頃</option>
												<option if={user.newsnotifytime==9} value="9" selected="selected">9時頃</option>
												<option if={user.newsnotifytime!=9} value="9">9時頃</option>
												<option if={user.newsnotifytime==8} value="8" selected="selected">8時頃</option>
												<option if={user.newsnotifytime!=8} value="8">8時頃</option>
												<option if={user.newsnotifytime==7} value="7" selected="selected">7時頃</option>
												<option if={user.newsnotifytime!=7} value="7">7時頃</option>
												<option if={user.newsnotifytime==6} value="6" selected="selected">6時頃</option>
												<option if={user.newsnotifytime!=6} value="6">6時頃</option>
											</select>
										</div>
										<botton class="btn btn-success" onclick="onclickRegisterNews(this)">登録</botton>
									</form>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>定型お知らせ一覧</h3>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
												<th style="width:60px;">タグ</th>
												<th style="width:60px;">通知設定</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');" style="margin-top: 10px;">修正</botton>
												</td>
												<td class="newstext"><pre>{news.text}</pre></td>
												<td class="newstag">{news.tag}</td>
												<td>
													<p class="notifymode" if={'undefined' == typeof news.notifymode || 0 == news.notifymode}>同じタグ<br/>の予定<br/>と連動</p>
													<p class="notifymode" if={1 == news.notifymode}>毎日</p>
													<p class="notifymode" if={11 == news.notifymode}>毎週日曜</p>
													<p class="notifymode" if={12 == news.notifymode}>毎週月曜</p>
													<p class="notifymode" if={13 == news.notifymode}>毎週火曜</p>
													<p class="notifymode" if={14 == news.notifymode}>毎週水曜</p>
													<p class="notifymode" if={15 == news.notifymode}>毎週木曜</p>
													<p class="notifymode" if={16 == news.notifymode}>毎週金曜</p>
													<p class="notifymode" if={17 == news.notifymode}>毎週土曜</p>
													<p class="notifytime" if={'undefined' == typeof news.notifytime || 0 == news.notifytime}>3日前<br/>から0時</p>
													<p class="notifytime" if={24 == news.notifytime}>0時</p>
													<p class="notifytime" if={23 == news.notifytime}>23時</p>
													<p class="notifytime" if={22 == news.notifytime}>22時</p>
													<p class="notifytime" if={21 == news.notifytime}>21時</p>
													<p class="notifytime" if={20 == news.notifytime}>20時</p>
													<p class="notifytime" if={19 == news.notifytime}>19時</p>
													<p class="notifytime" if={18 == news.notifytime}>18時</p>
													<p class="notifytime" if={17 == news.notifytime}>17時</p>
													<p class="notifytime" if={16 == news.notifytime}>16時</p>
													<p class="notifytime" if={15 == news.notifytime}>15時</p>
													<p class="notifytime" if={14 == news.notifytime}>14時</p>
													<p class="notifytime" if={13 == news.notifytime}>13時</p>
													<p class="notifytime" if={12 == news.notifytime}>12時</p>
													<p class="notifytime" if={11 == news.notifytime}>11時</p>
													<p class="notifytime" if={10 == news.notifytime}>10時</p>
													<p class="notifytime" if={9 == news.notifytime}>9時</p>
													<p class="notifytime" if={8 == news.notifytime}>8時</p>
													<p class="notifytime" if={7 == news.notifytime}>7時</p>
													<p class="notifytime" if={6 == news.notifytime}>6時</p>
												</td>
											</tr>
										</tbody>
									</table>
							</div>
						</div>
					</div>
					var newses = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						// 認証
						auth(false, function (clan) {
							getNews(clan.ID, null, function(newses) {
								thisis.newses = newses;
								riot.update();
							});
						});
						dispatchPortlateLayout();
					});
				</addnews>
			</script>

			<script type="riot/tag">
				<contribution>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid" style="padding: 10px;">
								<h3>週間貢献度集計 {targetDate}</h3>
								<div if={'on'!= getParams['view']}>
									<form id="entrycontributionform">
										<div class="form-group">
											<select class="form-control" name="contributionuser">
												<option value="-1">集計対象キャラ</option>
												<option each="{user, index in users}" value={index} data={user.name}>{user.name}</option>
											</select>
										</div>
										<div class="form-group">
											<div class="btn-group">
												<input type="number" name="contribution" class="form-control" placeholder="貢献度数"/>
												<span class="clearbtn glyphicon glyphicon-remove-circle" onclick="clerinput(this)"></span>
											</div>
										</div>
										<div class="form-group">
											<select class="form-control" name="weekquestcnt">
												<option value="0">週クエ消化数:0</option>
												<option value="1">週クエ消化数:1</option>
												<option value="2">週クエ消化数:2</option>
												<option value="3">週クエ消化数:3</option>
												<option value="4">週クエ消化数:4</option>
												<option value="5">週クエ消化数:5</option>
												<option value="6">週クエ消化数:6</option>
												<option value="7">週クエ消化数:7</option>
												<option value="8">週クエ消化数:8</option>
												<option value="9">週クエ消化数:9</option>
												<option value="10">週クエ消化数:10</option>
											</select>
										</div>
										<div class="form-group bg-info">
											<h5>集計日</h5>
											<div class='input-group date' id='contributiondate'/>
										</div>
										<div class="form-group">
											<botton class="btn btn-success" onclick="{onclickRegisterContribution}">登録</botton>
										</div>
									</form>
								</div>
								<table class="table table-bordered table-hover table-striped">
									<thead>
										<tr class="info">
											<th>集計日</th>
											<th if={'on'!= getParams['view']} style="width: 70px;">&nbsp;</th>
										</tr>
									</thead>
									<tbody>
										<tr each="{contribution, index in contributions}">
											<td if={'on'== getParams['view']}><a href="?clanid={clan.ID}&contributiondate={contribution.date.replace(/\//g, '-')}&view=on#contribution">{contribution.date}</a></td>
											<td if={'on'!= getParams['view']}><a href="?clanid={clan.ID}&contributiondate={contribution.date.replace(/\//g, '-')}#contribution">{contribution.date}</a></td>
											<td if={'on'!= getParams['view']}><a class="btn btn-danger" href="javascript:void(0)" onclick="onclickUnregisterContribution('{contribution.ID}')">削除</a></td>
										</tr>
									</tbody>
								</table>
							</div>
							<br/>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid" style="margin-top: -25px;">
								<users data='{users}' mode='contribution' contributiondata='{contributionUsers}'/>
							</div>
							<div if={'on'!=getParams['view']} class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h4>同一タグお知らせ一覧</h4>
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr class="info">
												<th style="width:70px;">アクション</th>
												<th>お知らせテキスト</th>
											</tr>
										</thead>
										<tbody>
											<tr each="{news, index in newses}">
												<td class="action">
													<botton class="btn btn-danger" onclick="onclickInfomation(this);">通知</botton>
													<br/>
													<br/>
													<botton class="btn btn-success" onclick="onclickModify(this, '{news.ID}');">修正</botton>
												</td>
												<td class="newstext" style="width: 34px; font-size: 5px;"><pre>{news.text}</pre></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					var contributiondesc = false;
					var targetDate;
					var users = [];
					var newses = [];
					var contributionUsers = {};
					var contributions = {};
					var thisis;
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						thisis = this;
						thisis.targetDate = targetDate;
						sortContribution = function () {
							if (contributiondesc) {
								contributiondesc = false;
								thisis.users.sort(function(a, b){
									var aContribution = 0;
									var bContribution = 0;
									if ('undefined' != typeof thisis.contributionUsers[a.ID]) {
										aContribution = parseInt(thisis.contributionUsers[a.ID].contribution) - (50 * thisis.contributionUsers[a.ID].weekquestcnt);
									}
									if ('undefined' != typeof thisis.contributionUsers[b.ID]) {
										bContribution = parseInt(thisis.contributionUsers[b.ID].contribution) - (50 * thisis.contributionUsers[b.ID].weekquestcnt);
									}
									if( aContribution < bContribution ) return -1;
									if( aContribution > bContribution ) return 1;
									return 0;
								});
							}
							else {
								contributiondesc = true;
								thisis.users.sort(function(a, b){
									var aContribution = 0;
									var bContribution = 0;
									if ('undefined' != typeof thisis.contributionUsers[a.ID]) {
										aContribution = parseInt(thisis.contributionUsers[a.ID].contribution) - (50 * thisis.contributionUsers[a.ID].weekquestcnt);
									}
									if ('undefined' != typeof thisis.contributionUsers[b.ID]) {
										bContribution = parseInt(thisis.contributionUsers[b.ID].contribution) - (50 * thisis.contributionUsers[b.ID].weekquestcnt);
									}
									if( aContribution > bContribution ) return -1;
									if( aContribution < bContribution ) return 1;
									return 0;
								});
							}
						};
						onclickUnregisterContribution = function (targetID) {
							unregisterContribution(clan.ID, targetID, function (){
								alert('削除しました。');
								location.reload();
								return;
							});
							return;
						};
						onclickRegisterContribution = function (target) {
							var index = $('#entrycontributionform').find('select[name=contributionuser] option:selected').val();
							if (0 > parseInt(index)) {
								alert('集計対象キャラを選択して下さい。');
								return;
							}
							var contribution = $('#entrycontributionform').find('input[name=contribution]').val();
							if (0 >= contribution.length) {
								alert('貢献度を入力して下さい。');
								return;
							}
							contribution = parseInt(contribution);
							var weekquestcnt = parseInt($('#entrycontributionform').find('select[name=weekquestcnt] option:selected').val());
							var contributionUser = this.users[index];
							var contributiondate = $('#entrycontributionform').find('#contributiondate').data().date;
							contributionUser.contribution = contribution;
							contributionUser.weekquestcnt = weekquestcnt;
							contributionUser.contributiondate = new Date(contributiondate);
							registerContribution(clan.ID, contributiondate, contributionUser, function (){
								alert('登録しました。');
								location.reload();
								return;
							});
							return;
						};
						var now = new Date();
						nowStr = now.toLocaleString();
						if ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length) {
							contributiondate = getParams['contributiondate'];
							nowStr = contributiondate.replace(/-/g, '/') + ' 00:00:00';
							var now = new Date(nowStr);
						}
						var month = '' + (now.getMonth() + 1);
						var day = '' + now.getDate();
						if (1 === month.length) {
							nowStr = nowStr.replace('/' + month + '/', '/0' + month + '/');
						}
						if (1 === day.length) {
							nowStr = nowStr.replace('/' + day + ' ', '/0' + day + ' ');
						}
						nowStr = nowStr.split(' ')[0];
						thisis.targetDate = nowStr;
						// 認証
						auth(false, function (clan) {
							getContributions(clan.ID, function(contributions) {
								thisis.contributions = contributions;
								thisis.contributionUsers = contributionUsers;
								$('#contributiondate').datetimepicker({locale: 'ja', inline: true, sideBySide: true, format: "YYYY/MM/DD 00:00:00", defaultDate: nowStr + ' 00:00:00'});
								getNews(clan.ID, '週間貢献度集計', function (newses) {
									thisis.newses = newses;
									getUsers(clan.ID, 0, function(users) {
										thisis.users = users;
										var contributionLabel = nowStr.replace(/\//g, '') + '-'  + clan.ID;
										//if ('undefined' != typeof thisis.contributions[contributionLabel]) {
											getContributionUsers(clan.ID, nowStr, function(contributionUsers) {
												thisis.contributionUsers = contributionUsers;
												sortContribution();
												riot.update();
											});
											return;
										//}
										//riot.update();
									});
								});
							});
						});
						dispatchPortlateLayout();
					});
				</contribution>
			</script>

			<script type="riot/tag">
				<users>
					<div style="padding-left: 10px; padding-right: 10px;">
						<table class="table table-bordered table-hover table-striped">
							<thead>
								<tr class="info">
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 20px; padding-left: 3px; padding-right: 0;">No</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 45px; padding-left: 1px; padding-right: 0;">実貢献度</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 35px; padding-left: 1px; padding-right: 0;">貢献度</th>
									<th if={opts.mode=='contribution'} onclick="{sortContribution}" style="width: 35px; padding-left: 1px; padding-right: 0;">週クエ</th>
									<th if={opts.mode=='schedule'} style="width: 10px;"></th>
									<th if={opts.mode=='schedule'} onclick="{sortPT}" style="width: 20px; padding-left: 3px;">PT</th>
									<th if={opts.mode=='schedule'} style="width: 28px; padding-left: 0px;">status</th>
									<th if={opts.mode=='schedule'} style="width: 20px; padding-left: 3px; padding-right: 2px;">VC</th>
									<th style="width: 65px;">キャラ</th>
									<th if={opts.mode!='contribution'} onclick="{sortCP}" style="width: 40px; padding-left: 5px; padding-right: 0;">戦闘力</th>
									<th if={opts.mode!='contribution'} onclick="{sortJob}" style="width: 20px; padding-left: 2px;">Job</th>
									<th if={opts.mode!='contribution'} onclick="{sortAcce1}" style="width: 20px; padding-left: 5px;">飾</th>
									<th if={opts.mode!='contribution'} style="width: 20px; padding-left: 5px;">武</th>
									<th if={opts.mode!='contribution'} style="width: 20px; padding-left: 5px;">マ</th>
									<th if={opts.mode!='schedule'} onclick="{sortLevel}" style="width: 20px; padding-left: 3px;">Lv</th>
									<th if={opts.mode=='contribution'} style="width: 12px; padding-left: 1px;">メ</th>
									<th style="width: 12px; padding-left: 0;">Dz</th>
									<th if={!opts.mode || opts.submode=='gvg'} style="background-color: royalblue; color: white; width: 12px; padding-left: 1px;">攻</th>
									<th if={!opts.mode || opts.submode=='gvg'} style="background-color: royalblue; color: white; width: 12px; padding-left: 1px;">防</th>
									<th if={!opts.mode || opts.submode=='gvg'} style="background-color: yellow; width: 12px; padding-left: 1px;">甘</th>
									<th if={!opts.mode || opts.submode=='bossraid'} style="background-color: crimson; color: white; width: 12px; padding-left: 1px;">魔</th>
									<th if={!opts.mode || opts.submode=='bossraid'} style="width: 12px; padding-left: 1px;">竜</th>
									<th if={!opts.mode || opts.submode=='bossraid'} style="width: 12px; padding-left: 1px;">ボ</th>
									<th style="width: 15px; padding-left: 2px;">区</th>
									<th if={opts.mode!='schedule'} onclick="{sortJoind}" style="width: 31px; padding-left: 0; padding-right: 0;">入隊日</th>
									<th if={opts.mode=='schedule'} style="font-size: 6px; padding-left: 1px; padding-right: 0;">コメ</th>
									<th if={opts.mode!='schedule'} style="font-size: 6px; padding-left: 1px; padding-right: 0;">メモ</th>
								</tr>
							</thead>
							<tbody id="partylist">
								<tr each="{user, index in opts.data}" class="activity{user.activity}" id="party_{index+1}" index="{index}">
									<td if={opts.mode=='contribution'} onclick="onclickModify(this, '{user.ID}');" style="padding-left: 3px; padding-right: 3px; text-align: right;">{index+1}</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="text-info contribution draggable" contribution="{opts.contributiondata[user.ID].contribution}" onclick="onclickModify(this, '{user.ID}');" style="padding-left: 6px; padding-right: 0; text-align: right;"><b>{opts.contributiondata[user.ID].contribution - (50*opts.contributiondata[user.ID].weekquestcnt)}</b></td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="contribution draggable" contribution="0" onclick="onclickModify(this, '{user.ID}');" style="padding-left: 6px; padding-right: 0;">未入力</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="orgcontribution draggable" onclick="onclickModify(this, '{user.ID}');" style="padding-left: 6px; padding-right: 0; text-align: right;">{opts.contributiondata[user.ID].contribution}</td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="orgcontribution draggable" onclick="onclickModify(this, '{user.ID}');" style="padding-left: 2px; padding-right: 0;">未入力</td>
									<td if={opts.mode=='contribution' && 'undefined' != typeof opts.contributiondata[user.ID]} class="weekquestcnt draggable" weekquestcnt="{opts.contributiondata[user.ID].weekquestcnt}" onclick="onclickModify(this, '{user.ID}');">{opts.contributiondata[user.ID].weekquestcnt}</td>
									<td if={opts.mode=='contribution' && 'undefined' == typeof opts.contributiondata[user.ID]} class="weekquestcnt draggable" weekquestcnt="0" onclick="onclickModify(this, '{user.ID}');" style="padding-left: 2px; padding-right: 0;">未入力</td>
									<td if={opts.mode=='schedule' && user.entry==1} onclick="onclickModify(this, '{user.ID}');" class="success draggable" style="font-size: xx-small; padding-left: 3px; padding-right: 0;">◯</td>
									<td if={opts.mode=='schedule' && user.entry==0} onclick="onclickModify(this, '{user.ID}');" class="warning draggable" style="font-size: xx-small; padding-left: 3px; padding-right: 0;">△</td>
									<td if={opts.mode=='schedule' && user.entry==-1} onclick="onclickModify(this, '{user.ID}');" class="danger draggable" style="font-size: xx-small; padding-left: 4px; padding-right: 0;">✕</td>

									<td if={opts.mode=='schedule' && user.party==49 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="49" style="color: black; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;1A</td>
									<td if={opts.mode=='schedule' && user.party==48 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="48" style="color: black; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;1B</td>
									<td if={opts.mode=='schedule' && user.party==39 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="39" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;2A</td>
									<td if={opts.mode=='schedule' && user.party==38 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="38" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;2B</td>
									<td if={opts.mode=='schedule' && user.party==37 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>
									<td if={opts.mode=='schedule' && user.party==29 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="29" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;3A</td>
									<td if={opts.mode=='schedule' && user.party==28 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="28" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;3B</td>
									<td if={opts.mode=='schedule' && user.party==27 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>
									<td if={opts.mode=='schedule' && user.party==19 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="19" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;4A</td>
									<td if={opts.mode=='schedule' && user.party==18 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="18" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;4B</td>
									<td if={opts.mode=='schedule' && user.party==17 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>
									<td if={opts.mode=='schedule' && user.party==9 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="9" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;5A</td>
									<td if={opts.mode=='schedule' && user.party==8 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="8" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;5B</td>
									<td if={opts.mode=='schedule' && user.party==7 && -1 < schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>

									<td if={opts.mode=='schedule' && user.party==39 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="39" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">聖刻</td>
									<td if={opts.mode=='schedule' && user.party==38 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="38" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">偵察</td>
									<td if={opts.mode=='schedule' && user.party==37 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="37" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">封殺</td>
									<td if={opts.mode=='schedule' && user.party==29 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="29" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">FW1</td>
									<td if={opts.mode=='schedule' && user.party==28 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="28" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">FW2</td>
									<td if={opts.mode=='schedule' && user.party==27 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="27" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">FW3</td>
									<td if={opts.mode=='schedule' && user.party==19 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="19" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">MF1</td>
									<td if={opts.mode=='schedule' && user.party==18 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="18" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">MF2</td>
									<td if={opts.mode=='schedule' && user.party==17 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="17" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">MF3</td>
									<td if={opts.mode=='schedule' && user.party==9 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="9" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">DF1</td>
									<td if={opts.mode=='schedule' && user.party==8 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="8" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">DF2</td>
									<td if={opts.mode=='schedule' && user.party==7 && 0 > schedule.tag.indexOf('レイド')} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="7" style="color: white; font-size: 8px; padding-left: 1px; padding-right: 0;">DF3</td>

									<td if={opts.mode=='schedule' && user.party==0} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>
									<td if={opts.mode=='schedule' && user.party===''} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty draggable" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>
									<td if={opts.mode=='schedule' && user.party==undefined} onclick="onclickModify(this, '{user.ID}');" class="scheduleparty" data-party="0" style="color: white; font-size: 8px; padding-left: 1px;">&nbsp;&nbsp;無</td>

									<td if={opts.mode=='schedule' && user.status==2} class="scheduleuserstatus bg-info text-info draggable" propaty="2" onclick="switchType(this, 'status');" style="font-size: xx-small; padding-left: 5px; padding-right: 0;">リダ</td>
									<td if={opts.mode=='schedule' && user.status==1} class="scheduleuserstatus bg-success text-success draggable" propaty="1" onclick="switchType(this, 'status');" style="font-size: xx-small; padding-left: 5px; padding-right: 0;">サブ</td>
									<td if={opts.mode=='schedule' && user.status==-1} class="scheduleuserstatus bg-danger text-danger draggable" propaty="-1" onclick="switchType(this, 'status');" style="font-size: xx-small; padding-left: 5px; padding-right: 0;">急欠</td>
									<td if={opts.mode=='schedule' && user.status!=-1 && user.status!=2 && user.status!=1} class="scheduleuserstatus draggable" propaty="0" onclick="switchType(this, 'status');" style="font-size: xx-small; padding-left: 5px; padding-right: 0;">&nbsp;</td>
									<td if={opts.mode=='schedule' && user.voice==1} class="scheduleuservoice bg-info draggable" style="padding-left: auto; padding-right: auto;" propaty="1" onclick="switchType(this, 'voice');"><i class="fas fa-microphone"></i></td>
									<td if={opts.mode=='schedule' && user.voice==2} class="scheduleuservoice bg-success draggable" style="padding-left: auto; padding-right: auto;" propaty="2" onclick="switchType(this, 'voice');"><i class="fas fa-microphone-slash"></i></td>
									<td if={opts.mode=='schedule' && user.voice==-1} class="scheduleuservoice bg-success draggable" style="padding-left: auto; padding-right: auto;" propaty="-1" onclick="switchType(this, 'voice');"><i class="fas">✕</i></td>
									<td if={opts.mode=='schedule' && user.voice!=-1 && user.voice!=2 && user.voice!=1} class="scheduleuservoice draggable" style="padding-left: auto; padding-right: auto;" propaty="0" onclick="switchType(this, 'voice');"><i class="fas"></i></td>
									<td onclick="onclickModify(this, '{user.ID}');" class="scheduleusername contributionusername draggable" style="font-size: xx-small; padding-left: 2px; padding-right: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{user.name}</td>
									<td if={opts.mode!='contribution'} style="font-size: xx-small; padding-left: 1px; padding-right: 1px; text-align: right;">{user.cp}</td>

									<td if={opts.mode!='contribution' && jobbufs[user.job]=='攻撃'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: firebrick; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && jobbufs[user.job]=='クリ'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: orange; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && jobbufs[user.job]=='防御'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: blue; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && jobbufs[user.job]=='移動'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: green; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && jobbufs[user.job]=='命中'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: dodgerblue; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && jobbufs[user.job]=='HP'} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="background-color: deeppink; padding: 5px; padding-left: 0px;"><img src="{jobimages[user.job]}" title="{user.job}" alt="{user.job}" width="20"/><p if={1 == user.job3d}>3d</p></td>
									<td if={opts.mode!='contribution' && 'undefined' == typeof jobbufs[user.job]} onclick="onclickModify(this, '{user.ID}');" class="draggable jobimage" style="font-size: 5px;">{user.job}</td>

										<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 80 <= user.acce1 && 90 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px;  vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_75801_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 70 <= user.acce1 && 80 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66514_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 60 <= user.acce1 && 70 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(./images/kara.jpg)  no-repeat left top; background-size: auto 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 50 <= user.acce1 && 60 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66511_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 40 <= user.acce1 && 50 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66502_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 30 <= user.acce1 && 40 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66517_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 20 <= user.acce1 && 30 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66505_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && 'undefined' != typeof user.acce1 && 10 <= user.acce1 && 20 > user.acce1} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 16px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_66508_ur.png)  no-repeat center top; background-size: 30px;">{parseInt((user.acce1+'').substring(1))+1}</td>
									<td if={opts.mode!='contribution' && false === ('undefined' != typeof user.acce1 && 10 <= user.acce1)} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-weight: bolder; font-size: 20px; padding: 0px; vertical-align: middle; text-align: center; color: white; background: url(https://gamewith.akamaized.net/article_tools/lineage2/gacha/i_noimage.png)  no-repeat center top; background-size: 0">&nbsp;</td>
									<td if={opts.mode!='contribution'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-size: xx-small; padding:0; padding-top: 2px; padding-right: 1px; text-align: right;">{user.bukicos}</td>
									<td if={opts.mode!='contribution'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-size: xx-small; padding:0; padding-top: 2px; padding-right: 1px; text-align: right;">{user.manto}</td>

									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="font-size: xx-small; padding-left: 2px;">{user.level}</td>
									<td if={opts.mode=='contribution' && user.meteo==10} onclick="onclickModify(this, '{user.ID}');" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.meteo}</td>
									<td if={opts.mode=='contribution' && user.meteo!=10} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.meteo}</td>
									<td if={user.dzone==10} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.dzone}</td>
									<td if={user.dzone!=10} onclick="onclickModify(this, '{user.ID}');" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.dzone}</td>
									<td if={!opts.mode || opts.submode=='gvg'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: royalblue; color: white; font-size: xx-small; padding-left: 0; padding-right: 2px; text-align: right;">{user.pvpat}</td>
									<td if={!opts.mode || opts.submode=='gvg'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: royalblue; color: white; font-size: xx-small; padding-left: 0; padding-right: 2px; text-align: right;">{user.pvpdf}</td>
									<td if={!opts.mode || opts.submode=='gvg'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: yellow; font-size: xx-small; padding-left: 0; padding-right: 2px; text-align: right;">{user.sweet}</td>
									<td if={!opts.mode || opts.submode=='bossraid'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="background-color: crimson; color: white; font-size: xx-small; padding-left: 0; padding-right: 2px; text-align: right;">{user.mamono}</td>
									<td if={!opts.mode || opts.submode=='bossraid'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.dragon}</td>
									<td if={!opts.mode || opts.submode=='bossraid'} onclick="onclickModify(this, '{user.ID}');" class="draggable" style="font-size: xx-small; padding-left: 0; padding-right: 1px; text-align: right;">{user.boss}</td>
									<td if={user.activity==1} onclick="onclickModify(this, '{user.ID}');" class="success" style="font-size: xx-small; padding-left: 1px; padding-right: 0;">AC</td>
									<td if={user.activity==0} onclick="onclickModify(this, '{user.ID}');" class="warning" style="font-size: xx-small; padding-left: 1px; padding-right: 0;">IAC</td>
									<td if={user.activity==-9} onclick="onclickModify(this, '{user.ID}');" class="danger" style="font-size: xx-small; padding-left: 2px; padding-right: 0;">除</td>
									<td if={user.activity==-1} onclick="onclickModify(this, '{user.ID}');" class="info" style="font-size: xx-small; padding-left: 2px; padding-right: 0;">傭</td>
									<td if={opts.mode!='schedule'} onclick="onclickModify(this, '{user.ID}');" style="font-size: xx-small; padding:0; padding-top: 2px; padding-right: 3px; text-align: right;">{user.joind.replace('/', '\n')}</td>
									<td if={opts.mode!='schedule'} onclick="onclickDetail(this, '{user.ID}');" style="font-size: 6px; padding-left: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;">{user.memo}</td>
									<td if={opts.mode=='schedule'} onclick="onclickDetail(this, '{user.ID}');" class="schedulecomment" style="font-size: 6px; padding-left: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 0;">{user.comment}</td>
								</tr>
							</tbody>
						</table>
						<botton class="btn btn-danger" onclick="onclickCSVExport(this);">CSVエクスポート</botton>
						<label class="btn btn-info" for="csvimport">CSVインポート</label>
						<a style="display:none;" id="downloader" href="#"></a>
						<form style="display:none;" id="csvimportForm" name="csvimport">
							<input id="csvimport" name="csv" type="file" />
						</form>
					</div>
					var thisis;
					this.on('mount', function() {
						thisis = this;
						thisis.users = opts.data;
						var reader = new FileReader();
						reader.addEventListener('load', function() {
							var fileBody = reader.result;
							if (0 > fileBody.indexOf('\n') && 0 > fileBody.indexOf('\r')) {
								alert('指定されたファイルはCSVファイルでは無いか\nまたはデータが1行以下です');
								return;
							}
							var delim = '\n';
							// 2行以上あるCSVファイル
							if (-1 > fileBody.indexOf('\r')) {
								delim = '\r';
							}
							var lines = reader.result.split(delim);
							if (1 > lines.length) {
								alert('指定されたファイルはCSVファイルでは無いか\nまたはデータがありません');
								return;
							}
							console.log(lines);
							var fields = lines[0].replace(/[\r\n]/g, '').trim().split(',');
							if (20 > fields.length){
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							if (0 > fields[0].indexOf('キャラ名')
							 || 0 > fields[1].indexOf('戦闘力')
							 || 0 > fields[2].indexOf('Job')
							 || 0 > fields[3].indexOf('3次職')
							 || 0 > fields[4].indexOf('装飾品')
							 || 0 > fields[5].indexOf('特性')
							 || 0 > fields[6].indexOf('武器コス')
							 || 0 > fields[7].indexOf('マント')
							 || 0 > fields[8].indexOf('Lv')
							 || 0 > fields[9].indexOf('メテオLv')
							 || 0 > fields[10].indexOf('ディフェンスゾーンLv')
							 || 0 > fields[11].indexOf('対人攻撃特性')
							 || 0 > fields[12].indexOf('対人防御特性(平均)')
							 || 0 > fields[13].indexOf('スイート特性')
							 || 0 > fields[14].indexOf('魔物特性')
							 || 0 > fields[15].indexOf('竜特性')
							 || 0 > fields[16].indexOf('ボス特性')
							 || 0 > fields[17].indexOf('区分')
							 || 0 > fields[18].indexOf('入隊日')
							 || 0 > fields[19].indexOf('メモ')
							) {
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							var _users = [];
							for (var lidx=1; lidx < lines.length; lidx++) {
								line = lines[lidx].replace(/[\r\n"]/g, '').trim();
								if (1 > line.length || -1 < line.indexOf('キャラ名') || -1 < line.indexOf('戦闘力') || -1 < line.indexOf('cp') || -1 < line.indexOf('CP')) {
									continue;
								}
								var cols = line.split(',');
								console.log(cols);
								if (20 > cols.length){
									alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
									return;
								}
								var _user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: 0, meteo: 0, dzone: null, acce1: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '' };
								_user.name = cols[0].trim();
								_user.cp = parseInt(cols[1].trim());
								_user.job = cols[2].trim();
								_user.job3d = (cols[3].trim() == '3次職')? 1: 0;
								_user.acce1 = cols[4].trim();
								acce1tokusei = cols[5].trim();
								if (-1 < _user.acce1.indexOf('カラ')) {
									_user.acce1 = 60 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('魔女')) {
									_user.acce1 = 80 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('エルヴン')) {
									_user.acce1 = 70 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ナッセン')) {
									_user.acce1 = 50 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ムーンストーン')) {
									_user.acce1 = 40 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('ブラックオール')) {
									_user.acce1 = 30 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('アルボール')) {
									_user.acce1 = 20 + parseInt(acce1tokusei) -1;
								}
								else if (-1 < _user.acce1.indexOf('フェニックス')) {
									_user.acce1 = 10 + parseInt(acce1tokusei) -1;
								}
								else {
									_user.acce1 = 0;
								}
								_user.bukicos = cols[6].trim();
								_user.manto = cols[7].trim();
								_user.level = parseInt(cols[8].trim());
								_user.meteo = parseInt(cols[9].trim());
								_user.dzone = parseInt(cols[10].trim());
								_user.pvpat = (cols[11].trim() == '')? null: parseInt(cols[11].trim());
								_user.pvpdf = (cols[12].trim() == '')? null: parseInt(cols[12].trim());
								_user.sweet = (cols[13].trim() == '')? null: parseInt(cols[13].trim());
								_user.mamono = (cols[14].trim() == '')? null: parseInt(cols[14].trim());
								_user.dragon = (cols[15].trim() == '')? null: parseInt(cols[15].trim());
								_user.boss = (cols[16].trim() == '')? null: parseInt(cols[16].trim());
								_user.activity = cols[17].trim();
								if (_user.activity == 'アクティブ') {
									_user.activity = 1;
								}
								else if (_user.activity == 'インアクティブ') {
									_user.activity = 0;
								}
								else if (_user.activity == '傭兵') {
									_user.activity = -1;
								}
								else if (_user.activity == '除名') {
									_user.activity = -9;
								}
								var _joind = cols[18].trim().replace(' ', '/').split('/');
								_user.joind = (('0000' + _joind[0]).slice(-4)) + '/' + (('00' + _joind[1]).slice(-2)) + '/' + (('00' + _joind[2]).slice(-2));
								_user.memo = cols[19].trim();
								_users.push(_user);
							}
							console.log('usser=');
							console.log(_users);
							console.log(clan.ID);
							if (1 > _users.length) {
								alert('指定されたファイルは項目数が足りないか\n独自フォーマットのCSVです\n\nCSVエクスポートしたCSVと同じ項目とフォーマットの\nCSVをお使い下さい');
								return;
							}
							if (!confirm(_users.length + '件のユーザーをインポートします。\n(※同じキャラ名以外のデータは必ず追加になる事にご注意下さい！)\n本当にインポートしてよろしいですか？')) {
								return;
							}
							// register
							var registerUsers = function (_argUIdx, _argUsers) {
								if (_argUIdx < _argUsers.length) {
									getUserFromName(clan.ID, _argUsers[_argUIdx].name, function (_user){
										if (null != _user && 'undefined' != typeof _user.ID) {
											_argUsers[_argUIdx].ID = _user.ID;
										}
										registerUser(clan.ID, _argUsers[_argUIdx], function (){
											_argUIdx = _argUIdx + 1;
											registerUsers(_argUIdx, _argUsers);
										});
									});
								}
								else {
									alert('インポートしました。');
									location.reload();
								}
							};
							registerUsers(0, _users);
						});
						$('#csvimportForm').change(function (e){
							if (0 < e.target.files.length) {
								var csv = e.target.files[0];
								console.log(csv);
								if (csv.type != 'text/plain' && csv.type != 'text/csv') {
									alert('指定されたファイルはCSVファイルではありません');
									return;
								}
								reader.readAsText(csv);
							}
						});
					});
					var cpdesc = false;
					var leveldesc = true;
					var joinddesc = true;
					var jobdesc = true;
					var partydesc = true;
					var acce1desc = false;
					sortCP = function () {
						if (cpdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) > parseInt(b.cp) ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( parseInt(a.cp) > parseInt(b.cp) ) return -1;
								if( parseInt(a.cp) < parseInt(b.cp) ) return 1;
								return 0;
							});
						}
					};
					sortLevel = function () {
						if (leveldesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level < b.level ) return -1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.level > b.level ) return -1;
								if( a.level < b.level ) return 1;
								return 0;
							});
						}
					};
					sortPT = function () {
						if (partydesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.party < b.party ) return -1;
								if( a.party > b.party ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.party > b.party ) return -1;
								if( a.party < b.party ) return 1;
								return 0;
							});
						}
					};
					sortJob = function () {
						if (jobdesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job < b.job ) return -1;
								if( a.job > b.job ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if( a.job > b.job ) return -1;
								if( a.job < b.job ) return 1;
								return 0;
							});
						}
					};
					sortAcce1 = function () {
						if (acce1desc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < -1) return 1;
								if ('undefined' == typeof a.acce1) return -1;
								if ('undefined' == typeof b.acce1) return 1;
								if( a.acce1 < b.acce1 || 'undefined' == typeof b.acce1) return -1;
								if( a.acce1 > b.acce1 ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < -1) return 1;
								if ('undefined' == typeof a.acce1) return 1;
								if ('undefined' == typeof b.acce1) return -1;
								if( a.acce1 > b.acce1 ) return -1;
								if( a.acce1 < b.acce1 ) return 1;
								return 0;
							});
						}
					};
					sortJoind = function () {
						if (joinddesc) {
							cpdesc = false;
							leveldesc = false;
							joinddesc = false;
							jobdesc = false;
							partydesc = false;
							acce1desc = false;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return -1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return 1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return 1;
								if( a.level > b.level ) return 1;
								return 0;
							});
						}
						else {
							cpdesc = true;
							leveldesc = true;
							joinddesc = true;
							jobdesc = true;
							partydesc = true;
							acce1desc = true;
							opts.data.sort(function(a, b){
								if( a.activity < 0 ) return 1;
								if ('' == a.joind || 'undefined' == typeof a.joind) return 1;
								if ('' == b.joind || 'undefined' == typeof b.joind) return -1;
								if( new Date(a.joind).getTime() > new Date(b.joind).getTime() ) return -1;
								if( new Date(a.joind).getTime() < new Date(b.joind).getTime() ) return 1;
								return 0;
							});
						}
					};
				</users>
			</script>

			<script type="riot/tag">
				<howto>
					<div  class="row">
						<div class="col-xs-4">
							<div class="container-fluid">
								<div style="padding-left: 10px; padding-right: 10px;">
									<h3>ヘルプ</h3>
									<ul>
										<li><a herf="javascript:void(0);" onclick="scrollHelp(1);"><small>●要塞戦の出欠を取りたい場合はどうすれば良いですか？</small></a></li>
										<li><a herf="javascript:void(0);" onclick="scrollHelp(2);"><small>●予定を通知して出欠を促す事は出来ますか？</small></a></li>
									</ul>
									<h4>デモページ</h4>
									<small>
										以下のURLからデモ利用する事が出来ます。
										<br/>
										色々試してみたい場合にご利用下さいm(_ _)m
										<br/>
										<a href="https://line2revo.fun/?clanid=56fhe8sie5UrrZUWVz9V">デモ血盟管理 => https://line2revo.fun/?clanid=56fhe8sie5UrrZUWVz9V</a>
									</small>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="container-fluid">
								<div id="helpContents" class="helpimage-container" style="padding-left: 10px; padding-right: 10px;">
									<div class="bg-info helppanel">
										<h4 id="help1" class="text-info">●要塞戦の出欠を取りたい場合はどうすれば良いですか？</h4>
										<div>
											<strong>
												予定を作成して、血盟員に参加表明をしてもらう事で実現出来ます。
											</strong>
											<br/>
											<h5>1. 「血盟ページ」から「血盟員追加」をしましょう。</h5>
											<a class="helpimage" href="./images/help/help001-001.png"><img src="./images/help/help001-001.png" width="50%"/></a>
											<h5>2. 血盟員を追加したら「予定追加」をしましょう。</h5>
											<h6>予定を追加すると「血盟ページ」の予定の一覧に新しい予定が追加されます。</h6>
											<a class="helpimage" href="./images/help/help001-002.png"><img src="./images/help/help001-002.png" width="50%"/></a>
											<h5>3. 追加された予定から予定の詳細ページに移動出来るようになります。</h5>
											<h6>予定の詳細ページの「未表明一覧」にまだ出欠表明をしていない血盟員が一覧されます。</h6>
											<h6>予定詳細ページのURLを血盟員に知らせましょう。<a herf="javascript:void(0);" onclick="scrollHelp(2);">[予定の通知について]</a></h6>
											<h6>血盟員に予定詳細ページへ移動して貰い、自分の名前を選んで出欠登録をして貰いましょう。</h6>
											<a class="helpimage" href="./images/help/help001-003.png"><img src="./images/help/help001-003.png" width="50%"/></a>
											<h5>4. 無事参加表明が完了すると、参加者一覧に表示されるようになります。</h5>
											<a class="helpimage" href="./images/help/help001-004.png"><img src="./images/help/help001-004.png" width="50%"/></a>
										</div>
									</div>
									<div class="bg-info helppanel">
										<h4 id="help2" class="text-info">●予定を通知して出欠を促す事は出来ますか？</h4>
										<div>
											<strong>
												Discordの「Webhook機能」を利用して、Discordに予定ページのURLを通知をする事が出来ます。
											</strong>
											<br/>
											<h5>1. 先ず血盟のDiscord上でWebhookを作成しましょう。</h5>
											<h6>Webhook作成時に出力される「WEBHOOK URL」をメモして置きましょう。</h6>
											<a class="helpimage" href="./images/help/help002-001-01.png"><img src="./images/help/help002-001-01.png" width="50%"/></a>
											<br/>
											<br/>
											<a class="helpimage" href="./images/help/help002-001-02.png"><img src="./images/help/help002-001-02.png" width="50%"/></a>
											<h6 class="text-danger">※ スマホアプリ版のDiscorddatalist上ではWebhookの管理が行なえません。PC版かブラウザ版のDiscord上で操作して下さい。</h6>
											<br/>
											<h5>2. 血盟管理ツールの「設定」に「WEBHOOK URL」の情報を入力して登録しましょう。</h5>
											<a class="helpimage" href="./images/help/help002-002.png"><img src="./images/help/help002-002.png" width="50%"/></a>
											<h6>これで血盟のDiscordと血盟管理ツールの関連付けが出来ました。</h6>
											<br/>
											<h5>3. 次は「血盟ページ」の「お知らせ管理」からお知らせを登録して、予定に紐づくお知らせを登録します。</h5>
											<a class="helpimage" href="./images/help/help002-003-01.png"><img src="./images/help/help002-003-01.png" width="50%"/></a>
											<a class="helpimage" href="./images/help/help002-003-02.png"><img src="./images/help/help002-003-02.png" width="50%"/></a>
											<h6>お知らせテキスト内に「<b>***urlview***</b>」と言うキーワードを入れて登録します。</h6>
											<h6>このキーワードはお知らせをDiscordに通知する際にその予定ページの<b>参加者用URLに自動変換</b>されます。</h6>
											<br/>
											<h5>4. 予定ページのお知らせ一覧の「通知」ボタンを押すことで連携設定したDiscordに、予定ページのURLが通知されます。</h5>
											<a class="helpimage" href="./images/help/help002-004.png"><img src="./images/help/help002-004.png" width="50%"/></a>
											<br/>
											<br/>
											<h5 class="text-info">♦他にも以下のキーワードを利用する事が出来ます。</h5>
											<h6>&nbsp;■「***urlview***」=> 参加者(閲覧者)用のお知らせ通知をしたページのURLに自動変換されます。</h6>
											<h6>&nbsp;■「***ptview***」=> 参加者(閲覧者)用のPT編成URLに自動変換されます。</h6>
											<h6>&nbsp;■「***url***」 => お知らせ通知をしたページのURLに自動変換されます。</h6>
											<h6>&nbsp;■「***pt***」 => お知らせ通知をしたページの(参加者用では無い)PT編成URLに自動変換されます。</h6>
											<h6>&nbsp;■「***date***」 => お知らせ通知をしたページの予定日時に自動変換されます。</h6>
											<h6>&nbsp;■「***title***」 => お知らせ通知をしたページの予定名に自動変換されます。</h6>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					scrollHelp = function (helpID) {
						$("html,body").animate({scrollTop: $('#helpContents #help' + helpID).offset().top -75 }, "100");
					};
					this.on('mount', function() {
						$("html,body").animate({scrollTop: 0, }, "100");
						dispatchPortlateLayout();
						$('.helpimage-container').magnificPopup({
  						delegate: 'a.helpimage',
  						type: 'image',
  						gallery: {
    						enabled:true
  						}
  					});
					});
				</howto>
			</script>

			<script type="riot/tag">
				<inquiry>
					<div style="padding: 20px;">
						<h3>お問い合わせ</h3>
						<br/>
						<h4><a href="https://twitter.com/saimushi" target="_blank" class="text-success"><i class="fab fa-twitter"></i> saimushi</a></h4>
						<h4><a href="https://discord.gg/mKbGHCd" target="_blank" class="text-info"><i class="fab fa-discord"></i> L2R血盟管理ツール</a></h4>
						<br/>
						<h5>各種SNS上でお気軽にお問い合わせ下さい。</h5>
						<h5>ご要望もお待ちしています！m(_ _)m</5>
					</div>
				</inquiry>
			</script>

			<script type="riot/tag">
				<manage>
					<div style="padding: 20px;">
						<h5 each="{_clan, cindex in clans}">
							<a href="./?clanid={_clan.ID}" target="_blank">{cindex+1}. {_clan.name} ({_clan.ID})</a>
						</h5>
					</div>
					var clans = [];
					var thisis;
					this.on('mount', function() {
						thisis = this;
						thisis.clans = clans;
						swal({
							title: '管理パスワード',
							content: {
								element: 'input',
								attributes: {
									id: 'adminpass',
									type: 'password',
								},
							},
							buttons: {
						    cancel: "キャンセル",
						    ok: true
						  }
						}).then(function(val) {
							if (val) {
								// 入力値を受け取る
								if ('c49be16104f3ad7540f1766a626c4c0086c2d796' === CryptoJS.SHA1($('#adminpass').val()).toString()) {
									getClans(function(clans){
										console.log(clans);
										thisis.clans = clans;
										riot.update();
									});
								}
							}
							return false;
						});
					});
				</manage>
			</script>

		</section>

		<section id="scripts">
			<!-- platform js -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/platform/1.3.5/platform.min.js"></script>

			<!-- bootstrap -->
			<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
			<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
			<script src="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

			<!-- SweetAlert -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>

			<!-- Sortable -->
			<script src="//cdn.jsdelivr.net/npm/sortablejs@1.8.0-rc1/Sortable.min.js"></script>

			<!-- Riot -->
			<script src="//cdn.jsdelivr.net/npm/riot@3.9/riot+compiler.min.js"></script>
			<!-- Riot tag base rooting -->
			<script src="//cdn.jsdelivr.net/npm/riot-route@3.1.3/dist/route+tag.min.js"></script>

			<!-- CryptoJS -->
			<script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>

			<!-- Firebase -->
			<script src="//www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>

			<!-- Discord -->
			<script src="//greasyfork.org/scripts/29088-discord-js-for-browser/code/Discordjs%20for%20Browser.js?version=208579"></script>

			<script>
				// Initialize Firebase
				var config = {
					apiKey: "AIzaSyDYyTbnnltwtf4qPOjn7i1d3PRVAQBclIE",
					authDomain: "rinerebo-210503.firebaseapp.com",
					databaseURL: "https://rinerebo-210503.firebaseio.com",
					projectId: "rinerebo-210503",
					storageBucket: "rinerebo-210503.appspot.com",
					messagingSenderId: "599651332341",
					timestampsInSnapshots: true,
				};
				firebase.initializeApp(config);
				firebase.firestore().settings({timestampsInSnapshots: true,});
			</script>

			<!-- this app -->
			<script>
				var firstView = false;
				var totalcp = 0;
				var prelrtcp = 0;
				var publicURL = 'line2revo.fun';
				var getParams = {};
				var loadingCount = 0;
				var clan = { ID: '', name: '', discordhookid: '', discordhooktoken: '', };
				var user = { ID: '', name: '', job: '', job3d: 0, cp: '', level: '', meteo: 0, dzone: null, acce1: 0, bukicos: '', manto: '', pvpat: null, pvpdf: null, sweet: null, mamono: null, dragon: null, boss: null, memo: '', activity: 9, joind: '', discord: '', };
				var schedule = { ID: '', name: '', date: '', tag: '', incount: 0, type: 0, autoReset: null, };
				var partySchedule = {name:'', date: '', incount: 0, };
				var news = { ID: '', text: '', tag: '', notifymode: 0, notifytime: 0, };
				var partyUsers = null;

				var jobimages = [];
				jobimages['パラディン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pa_icon.png';
				jobimages['ウォーロード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/waro_icon.png';
				jobimages['トレジャーハンター'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/tr_icon.png';
				jobimages['ホークアイ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/ho_icon.png';
				jobimages['ソーサラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/so_icon.png';
				jobimages['ビショップ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bs_icon.png';
				jobimages['テンプルナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/te_icon.png';
				jobimages['ソードシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sws_icon.png';
				jobimages['プレインズウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/pw_icon.png';
				jobimages['シルバーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sr_icon.png';
				jobimages['スペルシンガー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sps_icon.png';
				jobimages['エルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/el_icon.png';
				jobimages['シリエンナイト'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sn_icon.png';
				jobimages['ブレードダンサー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/bd_icon.png';
				jobimages['アビスウォーカー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/aw_icon.png';
				jobimages['ファントムレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/fr_icon.png';
				jobimages['スペルハウラー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sh_icon.png';
				jobimages['シリエンエルダー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/se_icon.png';
				jobimages['ガーディアン'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/gd_icon.png';
				jobimages['スレイヤー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sl_icon.png';
				jobimages['スカベンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sv_icon.png';
				jobimages['ウォーレンジャー'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/wl_icon.png';
				jobimages['クォーラルウィザード'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/qw_icon.png';
				jobimages['セイジ'] = 'https://gamewith.akamaized.net/article_tools/lineage2/gacha/sj_icon.png';

				jobimages['オークレイダー'] = 'https://gamewith.akamaized.net/img/5e6dcc68342dc8b47f1949e423440f2c.jpg';
				jobimages['オークモンク'] = 'https://gamewith.akamaized.net/img/eb56eea5facb08c64db160a857002113.jpg';
				jobimages['オークシャーマン'] = 'https://gamewith.akamaized.net/img/54a52e90e88f746817616177416386b1.jpg';

				var jobnamesForURL = [];
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/pa_icon.png'] = 'パラディン';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/waro_icon.png'] = 'ウォーロード';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/tr_icon.png'] = 'トレジャーハンター';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/ho_icon.png'] = 'ホークアイ';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/so_icon.png'] = 'ソーサラー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/bs_icon.png'] = 'ビショップ';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/te_icon.png'] = 'テンプルナイト';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sws_icon.png'] = 'ソードシンガー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/pw_icon.png'] = 'プレインズウォーカー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sr_icon.png'] = 'シルバーレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sps_icon.png'] = 'スペルシンガー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/el_icon.png'] = 'エルダー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sn_icon.png'] = 'シリエンナイト';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/bd_icon.png'] = 'ブレードダンサー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/aw_icon.png'] = 'アビスウォーカー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/fr_icon.png'] = 'ファントムレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sh_icon.png'] = 'スペルハウラー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/se_icon.png'] = 'シリエンエルダー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/gd_icon.png'] = 'ガーディアン';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sl_icon.png'] = 'スレイヤー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sv_icon.png'] = 'スカベンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/wl_icon.png'] = 'ウォーレンジャー';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/qw_icon.png'] = 'クォーラルウィザード';
				jobnamesForURL['https://gamewith.akamaized.net/article_tools/lineage2/gacha/sj_icon.png'] = 'セイジ';
				jobnamesForURL['https://gamewith.akamaized.net/img/5e6dcc68342dc8b47f1949e423440f2c.jpg'] = 'オークレイダー';
				jobnamesForURL['https://gamewith.akamaized.net/img/eb56eea5facb08c64db160a857002113.jpg'] = 'オークモンク';
				jobnamesForURL['https://gamewith.akamaized.net/img/54a52e90e88f746817616177416386b1.jpg'] = 'オークシャーマン';

				var jobbufs = [];
				jobbufs['パラディン'] = '防御';
				jobbufs['ウォーロード'] = '攻撃';
				jobbufs['トレジャーハンター'] = '移動';
				jobbufs['ホークアイ'] = '命中';
				jobbufs['ソーサラー'] = 'クリ';
				jobbufs['ビショップ'] = 'HP';
				jobbufs['テンプルナイト'] = '防御';
				jobbufs['ソードシンガー'] = '攻撃';
				jobbufs['プレインズウォーカー'] = '移動';
				jobbufs['シルバーレンジャー'] = '命中';
				jobbufs['スペルシンガー'] = 'クリ';
				jobbufs['エルダー'] = 'HP';
				jobbufs['シリエンナイト'] = '防御';
				jobbufs['ブレードダンサー'] = '攻撃';
				jobbufs['アビスウォーカー'] = '移動';
				jobbufs['ファントムレンジャー'] = '命中';
				jobbufs['スペルハウラー'] = 'クリ';
				jobbufs['シリエンエルダー'] = 'HP';
				jobbufs['ガーディアン'] = '防御';
				jobbufs['スレイヤー'] = '攻撃';
				jobbufs['スカベンジャー'] = '移動';
				jobbufs['ウォーレンジャー'] = '命中';
				jobbufs['クォーラルウィザード'] = 'クリ';
				jobbufs['セイジ'] = 'HP';
				jobbufs['オークレイダー'] = '攻撃';
				jobbufs['オークモンク'] = '命中';
				jobbufs['オークシャーマン'] = 'クリ';

				var portlate = false;
				var dispatchPortlateLayout = function(){
					if ((navigator.userAgent.indexOf('iPhone') > 0 && navigator.userAgent.indexOf('iPad') == -1) || navigator.userAgent.indexOf('iPod') > 0 || navigator.userAgent.indexOf('Android') > 0) {
						var orientation = window.orientation;
						if(orientation == 0 || undefined == orientation){
							$("body").addClass("portrait");
							$("body").removeClass("landscape");
							$('.riotcontes .col-xs-4').addClass('col-sm-4').removeClass('col-xs-4');
							$('.riotcontes .col-xs-8').addClass('col-sm-8').removeClass('col-xs-8');
							$('.riotcontes .col-xs-3').addClass('col-sm-3').removeClass('col-xs-3');
							$('.riotcontes .col-xs-9').addClass('col-sm-9').removeClass('col-xs-9');
							portlate = true;
						}
						else{
							$("body").addClass("landscape");
							$("body").removeClass("portrait");
							$('.riotcontes .col-sm-4').addClass('col-xs-4').removeClass('col-sm-4');
							$('.riotcontes .col-sm-8').addClass('col-xs-8').removeClass('col-sm-8');
							$('.riotcontes .col-sm-3').addClass('col-xs-3').removeClass('col-sm-3');
							$('.riotcontes .col-sm-9').addClass('col-xs-9').removeClass('col-sm-9');
						}
					}
				}

				var getUrlVars = function(){
					var vars = {};
					var param = location.search.substring(1).split('&');
					for(var i = 0; i < param.length; i++) {
							var keySearch = param[i].search(/=/);
							var key = '';
							if(keySearch != -1) key = param[i].slice(0, keySearch);
							var val = param[i].slice(param[i].indexOf('=', 0) + 1);
							if(key != '') vars[key] = decodeURI(val);
					}
					return vars;
				};
				var loading = function (show) {
					if (show) {
						loadingCount++;
						$('#loader').fadeIn();
					}
					else {
						loadingCount--;
						if (1 > loadingCount) {
							$('#loader').fadeOut();
							loadingCount = 0;
						}
					}
				};
				var auth = function (clanID, callback) {
					loading(true);
					var loginRedirect = false;
					var key = null;
					if ('undefined' != typeof clanID && 0 < clanID.length) {
						key = clanID;
						loginRedirect = true;
					} else if ('undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
						key = getParams['clanid'];
						if ('' == location.hash || '#login' == location.hash) {
							loginRedirect = true;
						}
					}
					if (key == null) {
						// ログイン画面へ
						location.href = '#login';
						loading(false);
						return;
					}
					// firbase問い合わせ
					firebase.firestore().collection("clans").doc(key).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							// 血盟名が取れていればOK
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								clan = data;
								clan.ID = snapshot.id;
								if (loginRedirect) {
									getParams['clanid'] = key;
									var newhref = '?clanid=' + key + '#dashboard';
									if ('on' == getParams['view']) {
										newhref = newhref.replace('#dashboard', '&view=on#dashboard');
									}
									location.href = newhref;
								}
								if (callback) {
									callback(data);
								}
								loading(false);
								return;
							}
						}
						alert('該当する血盟が見つかりませんでした。');
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '#login';
					}).catch(function(error) {
						alert('認証エラーが発生した為、ログイン処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						location.href = '#login';
						loading(false);
					});
				};
				var getClans = function (callback) {
					loading(true);
					firebase.firestore().collection("clans").get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerClan = function (updateID, data, callback) {
					loading(true);
					if (updateID != null && 0 < updateID.length) {
						firebase.firestore().collection("clans").doc(updateID).update(data).then(function(snapshot) {
							if (callback) {
								callback(updateID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else  {
						data.useInfoJob = true;
						firebase.firestore().collection("clans").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('登録エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterContribution = function (clanID, targetID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("contributions").doc(targetID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('貢献度集計削除エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				}
				var registerContribution = function (clanID, date, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					var dateLabel = date;
					if (-1 < dateLabel.indexOf('/')) {
						dateLabel = dateLabel.replace(/\//g, '');
					}
					if (-1 < dateLabel.indexOf(' ')) {
						dateLabel = dateLabel.split(' ')[0];
					}
					dateLabel = dateLabel + '-' + clanID;
					data.contributionID = dateLabel;
					data.clanid = clanID;
					loading(true);
					var registerContributionUser = function (_dateLabel, _data, _callback) {
						firebase.firestore().collection("contributions").doc(_dateLabel).collection("users").doc(_data.ID).set(_data).then(function(snapshot) {
							if (_callback) {
								callback();
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('貢献登録エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					};
					firebase.firestore().collection("contributions").doc(dateLabel).get().then(function(snapshot){
  					if(snapshot.exists) {
							// データがもうある場合
							registerContributionUser(dateLabel, data, callback);
							return;
						}
						else {
							// データがまだない場合
							firebase.firestore().collection("contributions").doc(dateLabel).set({ID:dateLabel, clanid:clanID, date: new Date(date), }).then(function(snapshot) {
								registerContributionUser(dateLabel, data, callback);
								return;
							}).catch(function(error) {
								alert('貢献度集計日登録エラーが発生した為、処理を中断します。');
								console.error("Error writing document: ", error);
								// ログイン出来ていないのでログイン画面へ戻す
								loading(false);
							});
						}
					}).catch(function(error) {
						alert('貢献度集計日参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerNews = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						newsID = data.ID;
						delete data.ID;
						firebase.firestore().collection("news").doc(newsID).update(data).then(function(snapshot) {
							if (callback) {
								callback(newsID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("news").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerSchedule = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						scheduleID = data.ID;
						delete data.ID;
						firebase.firestore().collection("schedules").doc(scheduleID).set(data).then(function(snapshot) {
							if (callback) {
								callback(scheduleID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("schedules").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('予定追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var registerScheduleuser = function (scheduleID, data, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("schedules").doc(scheduleID).collection("users").doc(data.ID).set(data).then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参加登録エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var registerUser = function (clanID, data, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					data.clanid = clanID;
					if (data.ID != '') {
						userID = data.ID;
						delete data.ID;
						firebase.firestore().collection("users").doc(userID).set(data).then(function(snapshot) {
							if (callback) {
								callback(userID);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('更新エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
					else {
						delete data.ID;
						firebase.firestore().collection("users").add(data).then(function(snapshot) {
							if (callback) {
								callback(snapshot.id);
							}
							loading(false);
							return;
						}).catch(function(error) {
							alert('追加エラーが発生した為、処理を中断します。');
							console.error("Error writing document: ", error);
							// ログイン出来ていないのでログイン画面へ戻す
							loading(false);
						});
					}
				};
				var unregisterUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					firebase.firestore().collection("users").doc(userID).delete().then(function() {
						if (callback) {
							callback();
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('更新エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedules = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var targettime = Math.round((new Date()).getTime() - (60 * 60 * 12 * 1000));
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).orderBy("date", "asc").startAt(targettime).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									data.date = data.date.toDate();
									if (targettime > data.date.getTime()){
										return;
									}
									data.date = data.date.toLocaleString();
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUsers = function (clanID, selectable, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("users").where("clanid", "==", clanID);
					if (false !== selectable) {
						// XXX >,>=,<,=<とorderはどうも一緒には出来ない模様・・・
						if (true === selectable) {
							collection = collection.where("activity", ">", -9);
						}
						else {
							collection = collection.where("activity", ">=", parseInt(selectable)).orderBy("activity", "desc");
						}
					}
					else {
						collection = collection.orderBy("activity", "desc").orderBy("cp", "desc").orderBy("joind", "asc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getContributions = function (clanID, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var targettime = Math.round((new Date()).getTime() - (60 * 60 * 24 * 8 * 1000));
					firebase.firestore().collection("contributions").where("clanid", "==", clanID).orderBy("date", "desc").get().then(function(querySnapshot) {
						var datas = {};
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.date) {
									data.date = data.date.toDate();
									if (targettime > data.date.getTime()){
										return;
									}
									data.date = data.date.toLocaleString();
									data.date = data.date.split(' ')[0];
								}
								datas[data.ID] = data;
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getContributionUsers = function (clanID, date, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					var dateLabel = date;
					if (-1 < dateLabel.indexOf('/')) {
						dateLabel = dateLabel.replace(/\//g, '');
					}
					if (-1 < dateLabel.indexOf(' ')) {
						dateLabel = dateLabel.split(' ')[0];
					}
					dateLabel = dateLabel + '-' + clanID;
					loading(true);
					var collection = firebase.firestore().collection("contributions").doc(dateLabel).collection("users").get().then(function(querySnapshot) {
						var datas = {};
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas[data.ID] = data;
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getNews = function (clanID, tag, callback) {
					if (clanID == null || 'undefined' == typeof clanID || 1 > clanID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("news").where("clanid", "==", clanID);
					if (null != tag && 0 < tag.length) {
						collection = collection.where("tag", "==", tag);
					}
					else {
						collection = collection.orderBy('tag', 'desc');
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleByTag = function (clanID, tag, callback) {
					if (tag == null || 'undefined' == typeof tag || 1 > tag.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").where("clanid", "==", clanID).where("tag", "==", tag).orderBy('date', 'desc').orderBy('incount', 'desc').limit(3).get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('一覧参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getSchedule = function (scheduleID, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("schedules").doc(scheduleID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.date) {
								data.date = data.date.toDate();
								data.date = data.date.toLocaleString();
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('予定詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getScheduleUsers = function (scheduleID, entryOK, callback) {
					if (scheduleID == null || 'undefined' == typeof scheduleID || 1 > scheduleID.length) {
						return;
					}
					loading(true);
					var collection = firebase.firestore().collection("schedules").doc(scheduleID).collection("users");
					if (entryOK) {
						collection = collection.where('entry', '>', -1);
					}
					else {
						//collection = collection.orderBy("entry", "desc").orderBy("cp", "desc");
						collection = collection.orderBy("party", "desc").orderBy("entry", "desc").orderBy("cp", "desc");
					}
					collection.get().then(function(querySnapshot) {
						var datas = [];
						querySnapshot.forEach(function(snapshot) {
							if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								datas.push(data);
							}
						});
						if ('undefined' != typeof datas) {
							if (callback) {
								callback(datas);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUser = function (userID, callback) {
					if (userID == null || 'undefined' == typeof userID || 1 > userID.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("users").doc(userID).get().then(function(snapshot){
  					if(snapshot.exists) {
							var data = snapshot.data();
							data.ID = snapshot.id;
							if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
								data.joind = data.joind.toDate();
								data.joind = data.joind.toLocaleString();
								data.joind = data.joind.split(' ')[0];
							}
							if ('undefined' != typeof data.name && 0 < data.name.length) {
								if (callback) {
									callback(data);
								}
								loading(false);
								return;
							}
						}
						if (callback) {
							callback(null);
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var getUserFromName = function (clanID, userName, callback) {
					if (userName == null || 'undefined' == typeof userName || 1 > userName.length) {
						return;
					}
					loading(true);
					// firbase問い合わせ
					firebase.firestore().collection("users").where("clanid", "==", clanID).where('name', '==', userName).limit(1).get().then(function(querySnapshot) {
						var user = null;
						querySnapshot.forEach(function(snapshot) {
	  					if(snapshot.exists) {
								var data = snapshot.data();
								data.ID = snapshot.id;
								if ('undefined' != typeof data.joind && 'string' != typeof data.joind) {
									data.joind = data.joind.toDate();
									data.joind = data.joind.toLocaleString();
									data.joind = data.joind.split(' ')[0];
								}
								if ('undefined' != typeof data.name && 0 < data.name.length) {
									user = data;
								}
							}
						});
						if ('undefined' != typeof user) {
							if (callback) {
								callback(user);
							}
						}
						loading(false);
						return;
					}).catch(function(error) {
						alert('詳細参照エラーが発生した為、処理を中断します。');
						console.error("Error writing document: ", error);
						// ログイン出来ていないのでログイン画面へ戻す
						loading(false);
					});
				};
				var clerinput = function (target) {
					$(target).parent().find('input').val('');
				};
				var onclickLogin = function (target) {
					var clanID = $('#loginform').find('input[name=clanID]').val();
					auth(clanID);
				};
				var onclickAddClan = function (target) {
					location.href='#addclan';
				};
				var onclickRegisterClan = function (target) {
					var clanname = $('#registerClanform').find('input[name=clan]').val();
					var clanurl = $('#registerClanform').find('input[name=url]').val();
					var updateClnaID = null;
					if (0 < clanname.length) {
						var data = {name: clanname, url: clanurl};
						var webhookID = $('#registerClanform').find('input[name=discordhookid]').val();
						var webhookToken = $('#registerClanform').find('input[name=discordhooktoken]').val();
						if ('undefined' != typeof webhookID && 0 < webhookID.length) {
							data.discordhookid = webhookID;
						}
						if ('undefined' != typeof webhookToken && 0 < webhookToken.length) {
							data.discordhooktoken = webhookToken;
						}
						if ('#setting' == location.hash && 'undefined' != typeof getParams['clanid'] && 0 < getParams['clanid'].length) {
							updateClnaID = getParams['clanid'];
						}
						registerClan(updateClnaID, data, function (newClanID){
							alert('登録しました。');
							if ('#addclan' == location.hash) {
								var url = location.protocol + '//' + document.domain + location.pathname + '?clanid=' + newClanID;
								alert('あなたの血盟URLは「' + url + '」です。\nログイン用血盟IDは「' + newClanID + '」です。\n無くさないように保管してください！');
							}
							getParams['clanid'] = newClanID;
							location.href = '?clanid=' + newClanID + '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var duplicateEntryUserCnt = 0;
				var duplicateEntryCnt = 0;
				var duplicateEntrySchedule = function (baseSchedule, newSchedule, duplicateEntryUsers) {
					if (duplicateEntryUserCnt < duplicateEntryUsers.length) {
						if (0 > duplicateEntryUsers[duplicateEntryUserCnt].entry) {
							duplicateEntryUserCnt++;
							duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
							return;
						}
						getUser(duplicateEntryUsers[duplicateEntryUserCnt].ID, function (targetUser) {
							if (null === targetUser) {
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
								return;
							}
							if (targetUser.activity < 0) {
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
								return;
							}
							targetUser.entry = 0;
							targetUser.status = 0;
							targetUser.party = 0;
							targetUser.voice = 0;
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].status) {
								targetUser.status = duplicateEntryUsers[duplicateEntryUserCnt].status;
							}
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].party) {
								targetUser.party = duplicateEntryUsers[duplicateEntryUserCnt].party;
							}
							if ('undefined' != typeof duplicateEntryUsers[duplicateEntryUserCnt].voice) {
								targetUser.voice = duplicateEntryUsers[duplicateEntryUserCnt].voice;
							}
							targetUser.comment = '同一タグの前回のPT編成をコピー';
							duplicateEntryUsers[duplicateEntryUserCnt].entry = 0;
							registerScheduleuser(newSchedule.ID, targetUser, function (){
								duplicateEntryCnt++;
								duplicateEntryUserCnt++;
								duplicateEntrySchedule(baseSchedule, newSchedule, duplicateEntryUsers);
							});
						});
						return;
					}
					else {
						newSchedule.incount = duplicateEntryCnt;
						registerSchedule(clan.ID, newSchedule, function (){
							// コピー完了
							alert('登録しました。');
							location.href = '#dashboard';
						});
					}
				};
				var onclickRegisterSchedule = function (target, scheduleID, duplicate) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduletag = $('#addscheduleform').find('input[name=scheduletag]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					var scheduleincount = $('#addscheduleform').find('input[name=scheduleincount]').val();
					var scheduletype = $('#addscheduleform').find('select[name=scheduletype] option:selected').val();
					var scheduleautoreset = false;
					if ($('#addscheduleform').find('input[name=scheduleautoreset]').prop('checked')) {
						scheduleautoreset = true;
					}
					if (1 > scheduleincount.length) {
						scheduleincount = '0';
					}
					if (true == duplicate) {
						if (1 > scheduletag.length) {
							alert('コピー元になるタグの設定がありません。');
							return;
						}
					}
					if (0 < schedulename.length && 0 < scheduledate.length && 0 < scheduleincount.length) {
						var data = { ID: scheduleID, name: schedulename, date: new Date(scheduledate), tag: scheduletag, incount: parseInt(scheduleincount), type: parseInt(scheduletype), autoReset: scheduleautoreset };
						registerSchedule(clan.ID, data, function (newScheduleID){
							data.ID = newScheduleID;
							if ('#detailschedule' == location.hash && 'undefined' != typeof getParams['scheduleid'] && 0 < getParams['scheduleid'].length) {
								if (target) {
									alert('更新しました。');
								}
								else {
									//location.href = '?clanid=' + clan.ID + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
									location.reload();
								}
								return;
							}
							if (true == duplicate) {
								getScheduleByTag(clan.ID, scheduletag, function(datas){
									if (1 < datas.length) {
										var baseSchedule = {incount:0};
										if ('undefined' != typeof datas[0] && 0 < datas[0].incount) {
											baseSchedule = datas[0];
										}
										else if ('undefined' != typeof datas[1] && baseSchedule.incount < datas[1].incount) {
											baseSchedule = datas[1];
										}
										else if ('undefined' != typeof datas[2] && baseSchedule.incount < datas[2].incount) {
											baseSchedule = datas[2];
										}
										if (1 > baseSchedule.incount){
											alert('登録しました。');
											location.href = '#dashboard';
											return;
										}
										getScheduleUsers(baseSchedule.ID, null, function (entryUsers){
											if (0 < entryUsers.length) {
												duplicateEntryCnt = 0;
												duplicateEntryUserCnt = 0;
												duplicateEntrySchedule(baseSchedule, data, entryUsers);
												return;
											}
											alert('登録しました。');
											location.href = '#dashboard';
										});
									}
								});
								return;
							}
							alert('登録しました。');
							location.href = '#dashboard';
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickRegisterNews = function (target) {
					var newstext = $('#editnewsform').find('textarea[name=newstext]').val();
					var newsID = $('#editnewsform').find('input[name=newsid]').val();
					var newstag = $('#editnewsform').find('input[name=newstag]').val();
					var newsnotifymode = parseInt($('#editnewsform').find('select[name=newsnotifymode] option:selected').val());
					var newsnotifytime = parseInt($('#editnewsform').find('select[name=newsnotifytime] option:selected').val());
					if ('undefined' != typeof newstext && 0 < newstext.length) {
						var data = { ID: newsID, text: newstext, tag: newstag, notifymode: newsnotifymode, notifytime: newsnotifytime };
						registerNews(clan.ID, data, function (){
							alert('登録しました。');
							location.reload();
							return;
						});
						return;
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickRegister = function (target, userID, beforeUserName) {
					var username = $('#registerform').find('input[name=username]').val();
					if ('on' == getParams['view'] && beforeUserName != username) {
						// Viewモードで名前が変わっていたら違う人
						userID = '';
					}
					var userjob = $('#registerform').find('select[name=userjob] option:selected').val();
					var userjob3d = $('#registerform').find('select[name=userjob3d] option:selected').val();
					var userlevel = $('#registerform').find('input[name=userlevel]').val();
					var usercp = $('#registerform').find('input[name=usercp]').val();
					var usermemo = $('#registerform').find('input[name=memo]').val();
					var userdiscord = $('#registerform').find('input[name=discord]').val();
					var usermeteo = $('#registerform').find('select[name=usermeteo] option:selected').val();
					var userdzone = $('#registerform').find('select[name=userdzone] option:selected').val();
					var userpvpat = $('#registerform').find('select[name=userpvpat] option:selected').val();
					var userpvpdf = $('#registerform').find('select[name=userpvpdf] option:selected').val();
					var usersweet = $('#registerform').find('select[name=usersweet] option:selected').val();
					var usermamono = $('#registerform').find('select[name=usermamono] option:selected').val();
					var userdragon = $('#registerform').find('select[name=userdragon] option:selected').val();
					var userboss = $('#registerform').find('select[name=userboss] option:selected').val();
					if ('対人攻撃特性' === userpvpat) {
						userpvpat = null;
					}
					else {
						userpvpat = parseInt(userpvpat);
					}
					if ('対人防御特性(平均)' === userpvpdf) {
						userpvpdf = null;
					}
					else {
						userpvpdf = parseInt(userpvpdf);
					}
					if ('スイート特性' === usersweet) {
						usersweet = null;
					}
					else {
						usersweet = parseInt(usersweet);
					}
					if ('ボス特性' === userboss) {
						userboss = null;
					}
					else {
						userboss = parseInt(userboss);
					}
					if ('魔物特性' === usermamono) {
						usermamono = null;
					}
					else {
						usermamono = parseInt(usermamono);
					}
					if ('竜特性' === userdragon) {
						userdragon = null;
					}
					else {
						userdragon = parseInt(userdragon);
					}
					if ('' === userdzone) {
						userdzone = null;
					}
					else {
						userdzone = parseInt(userdzone);
					}
					var useracce1 = $('#registerform').find('select[name=useracce1] option:selected').val();
					var userbukicos = $('#registerform').find('select[name=userbukicos] option:selected').val();
					var usermanto = $('#registerform').find('select[name=usermanto] option:selected').val();
					var useractivity = $('#registerform').find('select[name=useractivity] option:selected').val();
					var userjoind = $('#registerform').find('#joinddate').data().date;
					if ('職業' != userjob && 'メテオ' != usermeteo && '装飾品' != useracce1 && '区分' != useractivity && 0 < username.length && 0 < userjob.length && 0 < userlevel.length && 0 < usercp.length && 0 < usermeteo.length && 0 < useractivity.length) {
						var data = { ID: userID, name: username, job: userjob, job3d: parseInt(userjob3d), level: parseInt(userlevel), cp: parseInt(usercp), memo: usermemo, meteo: parseInt(usermeteo), dzone: userdzone, acce1: parseInt(useracce1), bukicos: userbukicos, manto: usermanto, pvpat: userpvpat, pvpdf: userpvpdf, sweet: usersweet, mamono: usermamono, dragon: userdragon, boss: userboss, activity: parseInt(useractivity), discord: userdiscord, };
						if (0 < userjoind.length) {
							data.joind = new Date(userjoind);
						}
						registerUser(clan.ID, data, function (){
							alert('登録しました。');
							location.href='#dashboard';
						});
						return;
					}
					if ('職業' == userjob) {
						alert('職業を選択して下さい。');
					}
					if ('装飾品' == useracce1) {
						alert('装飾品を選択して下さい。');
					}
					if ('区分' == useractivity) {
						alert('区分を選択して下さい。');
					}
					alert('入力が正しくない項目があった為、処理を中断します。');
				};
				var onclickUnregister = function (target, userID) {
					if (confirm('本当に削除してよろしいですか？')) {
						unregisterUser(userID, function (){
							alert('削除しました。');
							location.href='#dashboard';
						});
						return;
					}
				};
				var onclickSchedule = function (target, scheduleID) {
					getParams['clanid'] = clan.ID;
					getParams['scheduleid'] = scheduleID;
					var newhref = '?clanid=' + clan.ID + '&scheduleid=' + scheduleID + '#detailschedule';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#detailschedule', '&view=on#detailschedule');
					}
					location.href = newhref;
				};
				var onclickDetail = function (target, rowID) {
					var text = $(target).text();
					if (0 < text.length) {
						swal(text);
					}
				};
				var onclickModify = function (target, rowID) {
					if ('#addnews' == location.hash) {
						var newstext = $(target).parent().parent().find('.newstext').text();
						var newstag = $(target).parent().parent().find('.newstag').text();
						var newsnotifymode = '';
						var newsnotifytime = '';
						var notifymode = $(target).parent().parent().find('.notifymode').text();
						var notifytime = $(target).parent().parent().find('.notifytime').text();
						if (-1 < notifymode.indexOf('毎日')) {
							newsnotifymode = 1;
						}
						else if(-1 < notifymode.indexOf('毎週日曜')) {
							newsnotifymode = 11;
						}
						else if(-1 < notifymode.indexOf('毎週月曜')) {
							newsnotifymode = 12;
						}
						else if(-1 < notifymode.indexOf('毎週火曜')) {
							newsnotifymode = 13;
						}
						else if(-1 < notifymode.indexOf('毎週水曜')) {
							newsnotifymode = 14;
						}
						else if(-1 < notifymode.indexOf('毎週木曜')) {
							newsnotifymode = 15;
						}
						else if(-1 < notifymode.indexOf('毎週金曜')) {
							newsnotifymode = 16;
						}
						else if(-1 < notifymode.indexOf('毎週土曜')) {
							newsnotifymode = 17;
						}
						if (notifytime == '0時') {
							newsnotifytime = 24;
						}
						else if (notifytime == '23時') {
							newsnotifytime = 23;
						}
						else if (notifytime == '22時') {
							newsnotifytime = 22;
						}
						else if (notifytime == '21時') {
							newsnotifytime = 21;
						}
						else if (notifytime == '20時') {
							newsnotifytime = 20;
						}
						else if (notifytime == '19時') {
							newsnotifytime = 19;
						}
						else if (notifytime == '18時') {
							newsnotifytime = 18;
						}
						else if (notifytime == '17時') {
							newsnotifytime = 17;
						}
						else if (notifytime == '16時') {
							newsnotifytime = 16;
						}
						else if (notifytime == '15時') {
							newsnotifytime = 15;
						}
						else if (notifytime == '14時') {
							newsnotifytime = 14;
						}
						else if (notifytime == '13時') {
							newsnotifytime = 13;
						}
						else if (notifytime == '12時') {
							newsnotifytime = 12;
						}
						else if (notifytime == '11時') {
							newsnotifytime = 11;
						}
						else if (notifytime == '10時') {
							newsnotifytime = 10;
						}
						else if (notifytime == '9時') {
							newsnotifytime = 9;
						}
						else if (notifytime == '8時') {
							newsnotifytime = 8;
						}
						else if (notifytime == '7時') {
							newsnotifytime = 7;
						}
						else if (notifytime == '6時') {
							newsnotifytime = 6;
						}
						$('#editnewsform').find('input[name=newsid]').val(rowID);
						$('#editnewsform').find('textarea[name=newstext]').val(newstext);
						$('#editnewsform').find('input[name=newstag]').val(newstag);
						$('#editnewsform').find('select[name=newsnotifymode]').val(newsnotifymode);
						$('#editnewsform').find('select[name=newsnotifytime]').val(newsnotifytime);
						$("html,body").animate({scrollTop: 0}, "100");
						return;
					}
					else if ('#contribution' == location.hash) {
						if ($(target).text() === '修正') {
							var newstextDom = $(target).parent().parent().find('.newstext');
							var newstext = newstextDom.find('pre');
							var newstextHigth = newstext.height();
							//newstext.
							newstextDom.html('<textarea class="form-control" name="newstext">'+newstext.text()+'</textarea>');
							newstextDom.find('textarea').height(newstextHigth);
							$(target).text('保存');
						}
						else if ($(target).text() === '保存') {
							var newstext = $(target).parent().parent().find('textarea[name=newstext]').val();
							var newsID = rowID;
							var newstag = '週間貢献度集計';
							if ('undefined' != typeof newstext && 0 < newstext.length) {
								var data = { ID: newsID, text: newstext, tag: newstag, };
								registerNews(clan.ID, data, function (){
									alert('更新しました。');
									$(target).text('修正');
									var newstextDom = $(target).parent().parent().find('.newstext');
									newstextDom.html('<pre>'+newstext+'</pre>');
									return;
								});
								return;
							}
						}
						else {
							var contributionusername = $(target).parent().find('.contributionusername').text();
							var contribution = $(target).parent().find('.contribution').attr('contribution');
							var weekquestcnt = $(target).parent().find('.weekquestcnt').attr('weekquestcnt');
							var contributionuserindex = $('#entrycontributionform').find('select[name=contributionuser] option[data="' + contributionusername + '"]').val();
							var weekquestcntindex = $('#entrycontributionform').find('select[name=weekquestcnt] option[value="' + weekquestcnt + '"]').val();
							$('#entrycontributionform').find('select[name=contributionuser]').val(contributionuserindex);
							$('#entrycontributionform').find('select[name=weekquestcnt]').val(weekquestcntindex);
							$('#entrycontributionform').find('input[name=contribution]').val(contribution);
							$("html,body").animate({scrollTop: 0}, "100");
						}
						return;
					}
					else if ('#detailschedule' == location.hash) {
						if ($(target).text() === '修正') {
							var newstextDom = $(target).parent().parent().find('.newstext');
							var newstext = newstextDom.find('pre');
							var newstextHigth = newstext.height();
							//newstext.
							newstextDom.html('<textarea class="form-control" name="newstext">'+newstext.text()+'</textarea>');
							newstextDom.find('textarea').height(newstextHigth);
							$(target).text('保存');
						}
						else if ($(target).text() === '保存') {
							var newstext = $(target).parent().parent().find('textarea[name=newstext]').val();
							var newsID = rowID;
							var newstag = $('#addscheduleform').find('input[name=scheduletag]').val();
							if ('undefined' != typeof newstext && 0 < newstext.length) {
								var data = { ID: newsID, text: newstext, tag: newstag, };
								registerNews(clan.ID, data, function (){
									alert('更新しました。');
									$(target).text('修正');
									var newstextDom = $(target).parent().parent().find('.newstext');
									newstextDom.html('<pre>'+newstext+'</pre>');
									return;
								});
								return;
							}
						}
						else {
							var scheduleusername = $(target).parent().find('.scheduleusername').text();
							var schedulecomment = $(target).parent().find('.schedulecomment').text();
							var scheduleparty = $(target).parent().find('.scheduleparty').data();
							var scheduleuserindex = $('#entryscheduleform').find('select[name=scheduleuser] option[data="' + scheduleusername + '"]').val();
							$('#entryscheduleform').find('select[name=scheduleuser]').val(scheduleuserindex);
							$('#entryscheduleform').find('input[name=schedulecomment]').val(schedulecomment);
							if ('undefined' != typeof scheduleparty && 'undefined' != typeof scheduleparty.party) {
								$('#entryscheduleform').find('input[name=scheduleparty]').val(scheduleparty.party);
							}
							$("html,body").animate({scrollTop: 0}, "100");
						}
						return;
					}
					getParams['clanid'] = clan.ID;
					getParams['userid'] = rowID;
					var newhref = '?clanid=' + clan.ID + '&userid=' + rowID + '#modifyuser';
					if ('on' == getParams['view']) {
						newhref = newhref.replace('#modifyuser', '&view=on#modifyuser');
					}
					location.href = newhref;
				};
				var onclickInfomation = function (target) {
					var message = $(target).parent().parent().find('.newstext').text();
					if (-1 < message.indexOf('***date***')) {
						var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
						if ('undefined' != typeof targetDate) {
							message = message.replace('***date***', targetDate);
						}
					}
					if (-1 < message.indexOf('***title***')) {
						var targetTitle = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form input.form-control[name=schedulename]').val();
						message = message.replace('***title***', targetTitle);
					}
					if (-1 < message.indexOf('***urlview***')) {
						if ('#contribution' == location.hash && false === ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length)) {
							var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
							targetDate = targetDate.replace(/\//g, '-');
							targetDate = targetDate.split(' ')[0];
							message = message.replace('***urlview***', location.href.replace('#contribution', '&contributiondate=' + targetDate + '&view=on#contribution'));
						}
						else {
							message = message.replace('***urlview***', location.href.replace('#detailschedule', '&view=on#detailschedule'));
						}
					}
					if (-1 < message.indexOf('***url***')) {
						if ('#contribution' == location.hash && false === ('undefined' != typeof getParams['contributiondate'] && 0 < getParams['contributiondate'].length)) {
							var targetDate = $(target).parent().parent().parent().parent().parent().parent().parent().parent().find('form .input-group.date').data().date;
							targetDate = targetDate.replace(/\//g, '-');
							targetDate = targetDate.split(' ')[0];
							message = message.replace('***url***', location.href.replace('#contribution', '&contributiondate=' + targetDate + '#contribution'));
						}
						else {
							message = message.replace('***url***', location.href);
						}
					}
					if (-1 < message.indexOf('***pt***')) {
						message = message.replace('***pt***', location.href.replace('#detailschedule', '#party'));
					}
					if (-1 < message.indexOf('***ptview***')) {
						message = message.replace('***ptview***', location.href.replace('#detailschedule', '&view=on#party'));
					}
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに通知しました!');
					return;
				};
				var onclickNotify = function (target, name, discord) {
					var schedulename = $('#addscheduleform').find('input[name=schedulename]').val();
					var scheduledate = $('#addscheduleform').find('#scheduledate').data().date;
					if (false === ('undefined' != typeof clan.discordhookid && 0 < clan.discordhookid.length)) {
						alert('血盟で使用しているDiscordのWebhook情報が登録されていない為、この機能を利用出来ません！\n「設定」から設定して下さい。');
						return;
					}
					var discordIDMsg = '';
					if ('undefined' != typeof discord && 0 < discord.length) {
						discordIDMsg = ' ( \@' + discord + ' ) ';
					}
					var message = '【緊急】おいぃ！ ' + name + discordIDMsg + '！！「 ' + schedulename + ' (' + scheduledate + '開催) 」' + 'への出欠登録がされてないぞ！！【催促】';
					message = message + '\n欠席でいいのか！？良くないならば今スグ登録タノムっ！！ => ' + location.protocol + '//' + publicURL + '/?clanid=' + getParams['clanid'] + '&scheduleid=' + getParams['scheduleid'] + '#detailschedule';
					var discordHook = new Discord.WebhookClient(clan.discordhookid, clan.discordhooktoken);
					discordHook.send(message);
					alert('ディスコに催促通知しました!');
					return;
				};
				var onclickCSVExport = function (target) {
					// 配列 の用意
					var fields = $(target).parent().find('thead tr');
					var users = $(target).parent().find('#partylist tr');
					//var array_data = [['りんご',1,200],['メロン',2,4000],['バナナ',4,500]];
					var array_data = [];
					for (var uidx=0; uidx < fields.length; uidx++) {
						var cols = $(fields[uidx]).find('th');
						var dataArr = [];
						for (var didx=0; didx < cols.length; didx++) {
							var label = $(cols[didx]).text();
							if (label == 'キャラ') {
								label = 'キャラ名';
							}
							else if (label == 'status') {
								label = 'PTリーダー';
							}
							else if (label == 'Job') {
								label = 'Job","3次職';
							}
							else if (label == '飾') {
								label = '装飾品","特性';
							}
							else if (label == '武') {
								label = '武器コス';
							}
							else if (label == 'マ') {
								label = 'マント';
							}
							else if (label == '攻') {
								label = '対人攻撃特性';
							}
							else if (label == '防') {
								label = '対人防御特性(平均)';
							}
							else if (label == '甘') {
								label = 'スイート特性';
							}
							else if (label == '魔') {
								label = '魔物特性';
							}
							else if (label == 'ボ') {
								label = 'ボス特性';
							}
							else if (label == 'メ') {
								label = 'メテオLv';
							}
							else if (label == 'DZ') {
								label = 'ディフェンスゾーンLv';
							}
							else if (label == '区') {
								label = '区分';
							}
							else if (label == '') {
								label = '参加可否';
							}
							dataArr.push('"' + label + '"');
						}
						array_data.push(dataArr);
					}
					for (var uidx=0; uidx < users.length; uidx++) {
						var userDatas = $(users[uidx]).find('td');
						var dataArr = [];
						for (var didx=0; didx < userDatas.length; didx++) {
							var value = $(userDatas[didx]).html();
							value = value.replace(/&nbsp;/g, ' ');
							value = value.replace(/[\r\n]/g, ' ');
							value = value.trim();
							console.log(value);
							if (value == '<i class="fas fa-microphone"></i>') {
								value = 'VC可';
							}
							else if (value == '<i class="fas fa-microphone-slash"></i>') {
								value = '聞き専';
							}
							else if (value == '<i class="fas">✕</i>') {
								value = 'VC不可';
							}
							else if (value == '<i class="fas"></i>') {
								value = '';
							}
							else if (value == '<i class="fas"></i>') {
								value = '';
							}
							else if (-1 < value.indexOf('<img ')) {
								var imgURL = $(value).attr('src');
								if (0 < value.indexOf('3d')) {
									value = jobnamesForURL[imgURL] + '","3次職';
								}
								else {
									value = jobnamesForURL[imgURL] + '","';;
								}
								console.log('job value=' + value);
							}
							else if (value == 'リダ') {
								value = 'PTリーダー';
							}
							else if (value == 'サブ') {
								value = 'PTサブリーダー';
							}
							else if (value == 'AC') {
								value = 'アクティブ';
							}
							else if (value == 'IAC') {
								value = 'インアクティブ';
							}
							else if (value == '傭') {
								value = '傭兵';
							}
							else if (value == '除') {
								value = '除名';
							}
							var bgimage = $(userDatas[didx]).css('background-image');
							if (-1 < bgimage.indexOf('gamewith') || -1 < bgimage.indexOf('kara')) {
									var acce = '';
									if (-1 < bgimage.indexOf('kara')) {
										acce = 'カラ';
									}
									else if (0 < bgimage.indexOf('75801')) {
										acce = '魔女';
									}
									else if (0 < bgimage.indexOf('66514')) {
										acce = 'エルヴン';
									}
									else if (0 < bgimage.indexOf('66511')) {
										acce = 'ナッセン';
									}
									else if (0 < bgimage.indexOf('66502')) {
										acce = 'ムーンストーン';
									}
									else if (0 < bgimage.indexOf('66517')) {
										acce = 'ブラックオール';
									}
									else if (0 < bgimage.indexOf('66505')) {
										acce = 'アルボール';
									}
									else if (0 < bgimage.indexOf('66508')) {
										acce = 'フェニックス';
									}
									value = acce + '","' + value;
							}
							dataArr.push('"' + value + '"');
						}
						array_data.push(dataArr);
					}
					console.log(array_data);
			    // BOM の用意（文字化け対策）
			    var bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
			    // CSV データの用意
			    var csv_data = array_data.map(function(l){return l.join(',')}).join('\r\n');
			    var blob = new Blob([bom, csv_data], { type: 'text/csv' });
			    var url = (window.URL || window.webkitURL).createObjectURL(blob);
			    var a = document.getElementById('downloader');
			    a.download = 'members.csv';
					if ('#detailschedule' == location.hash) {
						a.download = 'schedule-members.csv';
					}
			    a.href = url;
					$('#downloader')[0].click();
					return false;
				};
				$(function() {
					loading(true);
					getParams = getUrlVars();
					$(window).load(function() {
						riot.mount('navigationbar');
						riot.mount('footerbar');
						riot.mount('donation');
						riot.mount('router');
						loading(false);
					});
					$(window).resize(function(){
						dispatchPortlateLayout();
					});
				});
			</script>
		</section>

	</body>
</html>
